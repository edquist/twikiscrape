<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> EngageTGYROGuide &lt; Engagement &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Engagement/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Engagement/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Engagement/EngageTGYROGuide?_T=16 Feb 2017" type="application/x-wiki" title="edit EngageTGYROGuide" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Engagement/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Engagement/EngageTGYROGuide"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <div class="twikiToc"> <ul>
<li> <a href="?cover=print#Overview"> Overview</a>
</li> <li> <a href="?cover=print#Authorization_and_authentication"> Authorization and authentication.</a> <ul>
<li> <a href="?cover=print#Obtaining_an_X_509_certificate_o"> Obtaining an X.509 certificate (once only).</a> <ul>
<li> <a href="?cover=print#Ensure_your_browser_recognizes_a"> Ensure your browser recognizes and accepts DOE certificates.</a>
</li> <li> <a href="?cover=print#Apply_for_a_personal_certificate"> Apply for a personal certificate</a>
</li> <li> <a href="?cover=print#Retrieve_your_personal_certifica"> Retrieve your personal certificate</a>
</li> <li> <a href="?cover=print#Export_your_certificate_for_use"> Export your certificate for use in job submission.</a>
</li></ul> 
</li> <li> <a href="?cover=print#Join_the_Engage_VO_once_only"> Join the Engage VO (once only).</a>
</li> <li> <a href="?cover=print#Obtain_access_to_the_central_Eng"> Obtain access to the central Engage VO submit node.</a>
</li> <li> <a href="?cover=print#Renewing_your_DOEGrids_certifica"> Renewing your DOEGrids certificate (once per year only).</a>
</li> <li> <a href="?cover=print#Re_signing_the_VO_Usage_Policy_o"> Re-signing the VO Usage Policy (once per year only).</a>
</li> <li> <a href="?cover=print#Obtain_VOMS_credentials_for_job"> Obtain VOMS credentials for job submission (prior to job submission but not more often than once per 24h).</a>
</li> <li> <a href="?cover=print#Site_specific_authorization_step"> Site-specific authorization steps (once only per site).</a>
</li> <li> <a href="?cover=print#NERSC_sites"> NERSC sites.</a>
</li></ul> 
</li> <li> <a href="?cover=print#Running_TGYRO_jobs_on_the_OSG"> Running TGYRO jobs on the OSG.</a>
</li></ul> 
</div>
<p />
<h1><a name="Guide_to_using_OSG_for_users_of"></a>  Guide to using OSG for users of the TGYRO application. </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Overview"></a> Overview </span></h2>
<p />
This guide is specifically aimed at enabling TGYRO users to take advantage of the Open Science Grid. It may look daunting at first, but a large fraction of these instructions only need to be followed once; yet more need to be done only once per year. There are two main sections: <a href="/bin/view/Engagement/EngageTGYROGuide#Authorization_and_authentication" class="twikiCurrentTopicLink twikiAnchorLink">Authorization and authentication</a> dealing with how to get the required access to run via the OSG, and <a href="/bin/view/Engagement/EngageTGYROGuide#Running_TGYRO_jobs_on_the_OSG" class="twikiCurrentTopicLink twikiAnchorLink">Running TGYRO jobs on the OSG</a> which tells you what you need to know to submit jobs to OSG sites and obtain the results.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Authorization_and_authentication"></a> Authorization and authentication. </span></h2>
<p />
Perhaps the biggest difference from the methods for running TGYRO with which you are familiar is that one logs onto one machine, <code>engage-submit.renci.org</code> in order to submit jobs to any one of several sites. The authentication and authorization requirements of those sites are generally handled using X.509 certificates. The ones used are so-called, "extended attribute" certificates known as, "VOMS proxies." These extended attributes encode information about your, "Virtual Organization" and, particular scientific purpose to enable sites to decide whether to allow you access and how to prioritize your usage with respect to everyone else.
<p />
<h3><a name="Obtaining_an_X_509_certificate_o"></a> Obtaining an X.509 certificate (<em>once only</em>). </h3>
<p />
The first thing one needs to do is obtain an X.509 certificate. If you do not already have an X.509 certificate of your own, you should obtain one from the DOE. In order to do this you should use a browser, preferably Mozilla Firefox.
<p />
<h4><a name="Ensure_your_browser_recognizes_a"></a> Ensure your browser recognizes and accepts DOE certificates. </h4>
<p />
<p />
<p />
<h4><a name="Apply_for_a_personal_certificate"></a> Apply for a personal certificate </h4>
<p />
<p />
To apply for a personal certificate, use a web browser and go to:
<p />
<a href="http://oim.grid.iu.edu/oim/certificate" target="_top">http://oim.grid.iu.edu/oim/certificate</a>
<p />
Select "Request New Certificate" from the menu in the upper left.. For Virtual Organization name, select ' <strong>Engage</strong> '. Please include the name of your Engage contact in the comments section. If you require help, please contact the Engage team at <a href="mailto&#58;engage&#45;team&#64;opensciencegrid">engage-team&#64;opensciencegrid</a> dot org
<p />
<p />
<h4><a name="Retrieve_your_personal_certifica"></a> Retrieve your personal certificate </h4>
<p />
When your certificate has been successfully issued, you will receive an email that contains a link to a page containing all your certificate information. Open that page in your browser and click on <font color="#993399">Import Your Certificate</font> button at the bottom of that page.
<p />
<h4><a name="Export_your_certificate_for_use"></a> Export your certificate for use in job submission. </h4>
<p />
See the instructions on the <a href="http://www.doegrids.org/pages/cert-request.html#Globus" target="_top">DOEGrids certificate page</a>.
<p />
<h3><a name="Join_the_Engage_VO_once_only"></a> Join the Engage VO (<em>once only</em>). </h3>
<p />
<p />
Once you have your certificate, you can join the Engage Virtual Organization (VO). Go to:
<p />
<p />
<a href="https://osg-engage.renci.org:8443/voms/Engage/" target="_top">https://osg-engage.renci.org:8443/voms/Engage/</a>
<p />
<p />
The browser should present your certificate to the server, and you should see something like this on the bottom of the page (but with your name):
<p />
<pre>
DN: /DC&#61;com/DC&#61;DigiCert-Grid/O&#61;Open Science Grid/OU&#61;People/CN&#61;JANE DOE 72645
</pre>
<p />
Fill out and submit the form. 
<p />
<p />
Specify your VO representative as, "Christopher H. Green (Engage)."
<p />
Ensure that you specify:<pre>&#60;your-institute&#62; (TGYRO)</pre>
as your affiliation to ensure that your application gets routed appropriately.
<p />
Be sure to follow immediately the instructions in the "Phase I" email you will receive in order for your application to progress.
<p />
You and/or your institute's TGYRO / ITER representative may receive further inquiries, but you should normally receive an email notification that you have been admitted to the Engage VO within one business day. Follow the instructions therein to finalize your admittance to the VO.
<p />
<h3><a name="Obtain_access_to_the_central_Eng"></a> Obtain access to the central Engage VO submit node. </h3>
<p />
Visit the RENCI <a href="https://access.renci.org/request" target="_top">account request page</a> and fill in the following information:
<p /> <ul>
<li> RENCI contact: John McGee
</li> <li> RENCI contact e-email: <a href="mailto&#58;mcgee&#64;renci&#46;org">mcgee&#64;renci.org</a>
</li> <li> Please select "Don't need one" regarding: If you need to be added to the gridmap file please select the appropriate option. 
</li> <li> Please give a short description of why you need this account: OSG via Chris Green.
</li></ul> 
<p />
<h3><a name="Renewing_your_DOEGrids_certifica"></a> Renewing your DOEGrids certificate (<em>once per year only</em>). </h3>
<p />
A few weeks before your certificate arrives you will start receiving emails warning you of the impending expiration of your certificate. In order to renew your certificate <em>at any time before it expires</em>, do the following:
<p /> <ol>
<li> Ensure you have your current certificate in your browser. For greatest ease use the same browser from which you requested the certificate in the first place; otherwise import from the backup you made (and kept, right?)
</li> <li> Visit <a href="http://www.doegrids.org/" target="_top">http://www.doegrids.org/</a> and select the "Certificate Renewal" link from the left sidebar.
</li> <li> Follow the instructions. Your certificate will be automatically renewed and imported into your browser.
</li> <li> Follow the instructions <a href="/bin/view/Engagement/EngageTGYROGuide#Export_your_certificate_for_use" class="twikiCurrentTopicLink twikiAnchorLink">above</a>.
</li></ol> 
<p />
If your certificate has expired, you will need to <a href="/bin/view/Engagement/EngageTGYROGuide#Apply_for_a_personal_certificate" class="twikiCurrentTopicLink twikiAnchorLink">request a new one</a>. In the comments field, request that your certificate be issued with the same DN (including "random" number) as your existing one, and paste the DN in the comments field also. This can be obtained either from your browser or certificate handling utility or by executing the command from your submit node:<pre>openssl x509 -noout -in $HOME/.globus/usercert.pem -subject</pre>
<p />
<h3><a name="Re_signing_the_VO_Usage_Policy_o"></a> Re-signing the VO Usage Policy (<em>once per year only</em>). </h3>
<p />
Once per year, you should receive an email directing you to re-sign the Acceptable Use Policy, or AUP. Read and agree to abide by the AUP in order to continue membership of the Engage VO for another year.
<p />
<h3><a name="Obtain_VOMS_credentials_for_job"></a> Obtain VOMS credentials for job submission (<em>prior to job submission but not more often than once per 24h</em>). </h3>
<p />
<p />
Note that you will have to have your certificate exported as mentioned above, and placed in ~/.globus/ on the submit host. A proxy is a time limited version of your certificate. The proxy is what is actually presented to the remote site during authentication. To create a proxy, use the voms-proxy-init command:
<p />
<pre>[rynge@nantahala ~]$ voms-proxy-init -voms Engage:/Engage/Fusion/TGYRO -valid 72:00
Cannot find file or dir: $prefix/etc/vomses
Your identity: /DC=org/DC=doegrids/OU=People/CN=Mats Rynge 722233
Enter GRID pass phrase:
Creating temporary proxy ...................................... Done
Contacting  osg-engage.renci.org:15001 [/DC=org/DC=doegrids/OU=Services/CN=osg-engage.renci.org] "Engage" Done

Creating proxy ............................................ Done
Your proxy is valid until Thu Apr  5 10:29:08 2007
</pre>
<p />
Note that you can specify how long the proxy should be valid for. It should be long enough for the job run to finish, but should not be longer than 72 hours. You might see some warnings in the output of voms-proxy-init. Do not worry about them as long as you get a proxy at the end. You can check the proxy with voms-proxy-info:
<p />
<pre>
&#91;rynge&#64;nantahala ~]$ voms-proxy-info
WARNING: Unable to verify signature! Server certificate possibly not installed.
Error: Cannot find certificate of AC issuer for vo Engage
subject   : /DC&#61;org/DC&#61;doegrids/OU&#61;People/CN&#61;Mats Rynge 722233/CN&#61;proxy
issuer    : /DC&#61;org/DC&#61;doegrids/OU&#61;People/CN&#61;Mats Rynge 722233
identity  : /DC&#61;org/DC&#61;doegrids/OU&#61;People/CN&#61;Mats Rynge 722233
type      : proxy
strength  : 512 bits
path      : /tmp/x509up&#95;u1031
timeleft  : 23:20:17
</pre>
<p />
<p />
<h3><a name="Site_specific_authorization_step"></a> Site-specific authorization steps (<em>once only per site</em>). </h3>
<p />
Some sites require special steps to be taken to obtain access. These are listed below, along with the specific actions required.
<p />
<h3><a name="NERSC_sites"></a> NERSC sites. </h3>
<p />
You must be an authorized user of NERSC resources. If you are not, talk to your project management and follow your group's procedures to obtain access, and in particular, <a href="https://nim.nersc.gov/" target="_top">NIM</a> login abilities. Assuming this is done, access the <a href="https://nim.nersc.gov/" target="_top">NIM</a> site and look for the, "Grid Certificates" tab on the right of the main frame. Use the link provided to add your certificate to the list. You will need the information obtained by executing the following command on your grid submission node (the one onto which you <a href="/bin/view/Engagement/EngageTGYROGuide#Export_your_certificate_for_use" class="twikiCurrentTopicLink twikiAnchorLink">placed your DOE certificate</a>):
<pre>openssl x509 -noout -in $HOME/.globus/usercert.pem -subject</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Running_TGYRO_jobs_on_the_OSG"></a> Running TGYRO jobs on the OSG. </span></h2>
<p />
Before attempting to run jobs on the OSG, ensure first that you are able to <a href="/bin/view/Engagement/EngageTGYROGuide#Obtain_access_to_the_central_Eng" class="twikiCurrentTopicLink twikiAnchorLink">log on to the current Engage submit host at RENCI</a>, NC, and that you are able to <a href="/bin/view/Engagement/EngageTGYROGuide#Obtain_VOMS_credentials_for_job" class="twikiCurrentTopicLink twikiAnchorLink">obtain the correct user proxy</a> from there. Then:
<p /> <ol>
<li> Ensure you have the correct environment for TGYRO job submission:<pre>. ~greenc/tgyro-suite/setup.sh</pre><em>or</em>:<pre>source ~greenc/tgyro-suite/setup.csh</pre>as appropriate.
</li> <li> Ensure you have a local top-level work directory (eg <code>~/mpi-work/tgyro</code>).
</li> <li> Generate your work area, either by importing or copying an older directory or by generating it from a template, eg:<pre>tgyro -g stest_1 -p ~/mpi-work/tgyro</pre>
</li> <li> Submit your job as normal, eg:<pre>tgyro_bat -e stest_1 -n 4 -p ~/mpi-work/tgyro</pre>Answer the questions as appropriate.
</li> <li> Monitor the progress of your job with <code>condor_q &lt;user&gt;</code> or <code>condor_q &lt;job#&gt;</code>.
</li> <li> Upon completion of the job, expand the results archive, <code>output_files.tar.bz2</code>.
</li></ol> 
<p />
Submission of TGYRO jobs is still being improved, so please bookmark <a href="/bin/view/Engagement/EngageTGYROGuide#Running_TGYRO_jobs_on_the_OSG" class="twikiCurrentTopicLink twikiAnchorLink">this section</a> and check back regularly for news of any changes.
<p />
If you are interested, here are some <a href="/bin/view/Engagement/EngageTGYROTechnicalDetails" class="twikiLink">technical details</a> of how the TGYRO system was adapted to run on the OSG.
-- <a href="/bin/view/Main/ChrisGreen" class="twikiLink">ChrisGreen</a> - 18 Sep 2009</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Engagement<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Engagement/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a> &gt; <a href="/bin/view/Engagement/EngageNewUserGuide" class="twikiLink">EngageNewUserGuide</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>EngageTGYROGuide</span> <br />    
Topic revision: r8 - 25 Oct 2011 - 17:22:34 - <a href="/bin/view/Main/MatsRynge" class="twikiLink">MatsRynge</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />