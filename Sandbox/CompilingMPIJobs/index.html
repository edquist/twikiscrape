<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> CompilingMPIJobs &lt; Sandbox &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Sandbox/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Sandbox/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Sandbox/CompilingMPIJobs?_T=16 Feb 2017" type="application/x-wiki" title="edit CompilingMPIJobs" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><meta name="robots" content="noindex,nofollow"> 
<base href="https://twiki.opensciencegrid.org/bin/view/Sandbox/CompilingMPIJobs"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#DDDDDD;
	}
	.patternBookView {
		border-color:#DDDDDD;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Compiling_MPIJobs"></a>  <strong><noop>Compiling MPIJobs</strong> </h1>
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Picking_A_Site"> Picking A Site</a>
</li> <li> <a href="?cover=print#Compiling_MPI_Jobs"> Compiling MPI Jobs</a> <ul>
<li> <a href="?cover=print#A_Sample_Compile_Script"> A Sample Compile Script</a>
</li> <li> <a href="?cover=print#A_Sample_Submit_Script"> A Sample Submit Script</a>
</li></ul> 
</li> <li> <a href="?cover=print#Running_your_application"> Running your application</a>
</li></ul> 
</div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Picking_A_Site"></a> Picking A Site </span></h2>
<p />
The first step is to pick an OSG site that supports your VO and has an MPI version installed. The easiest way to do this is decide on an MPI implementation (MPICH, MVAPICH, MPICH2, <span class="twikiNewLink">OpenMPI<a href="/bin/edit/Sandbox/OpenMPI?topicparent=Sandbox.CompilingMPIJobs" rel="nofollow" title="OpenMPI (this topic does not yet exist; you can create it)">?</a></span>, etc.) and perform an LDAP query. For example, to see all of the MPICH versions installed on Purdue's Steele cluster, the following command can be used:
<p />
<pre class=screen>
tg-steele$ ldapsearch -x -l 60 -b mds-vo-name=Purdue-Steele,mds-vo-name=local,o=grid -h is1.grid.iu.edu -p 2170 "GlueSoftwareName=MPICH" GlueSoftwareEnvironmentSetup
</pre>
<p />
The "GlueSoftwareEnvironmentSetup" field shows what command to use in order to load the MPI version into your environment. This is important for compiling and running the application.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Compiling_MPI_Jobs"></a> Compiling MPI Jobs </span></h2>
<p />
Compiling the application can be done in one of two ways. If the site allows local logins, you can login directly to the server, run the command to load MPI into your environment, and compile your application. This is essentially the same workflow you would use to run the application on your own machine.
<p />
Since most sites don't allow local logins, however, another way to compile your application is to submit a batch job that will compile the application for you. This can be accomplished by writing a short script that will source the module and compile the application. The following is an example script that will compile the cpi program.
<h3><a name="A_Sample_Compile_Script"></a> A Sample Compile Script </h3>
<p />
<pre class=screen>
#!/bin/bash
#
# Right now on Purdue's Steele cluster, the modules program is not in the user's
# path when a job is run. In order to ensure the module command works, we need
# to source the module setup script. For sites using softenv, sourcing
# /etc/profile.d/softenv.sh should work instead.

source /etc/profile.d/modules.sh
# This is where the command from GlueSoftwareEnvironmentSetup goes
module load mpich-gcc

mpicc -o cpi cpi.c
</pre>
<p />
<h3><a name="A_Sample_Submit_Script"></a> A Sample Submit Script </h3>
<p />
Once you have a script that will compile your application, you can submit a Condor-G job to compile your application. For example, the following submit script will compile and return the working executable for the above compile script on Purdue's Steele cluster:
<p />
<pre class=screen>
Universe = grid
Grid_Resource = gt2 lepton.rcac.purdue.edu/jobmanager-pbs

Executable = compile.sh

Output = compile_job.out
Log    = compile_job.log
Error  = compile_job.error
WhenToTransferOutput = ON_EXIT
Transfer_Input_Files = cpi.c,compile.sh
Transfer_Output_Files = cpi

Queue 
</pre>
<p />
Once the Condor-G job ends, you'll most likely have to make your program executable by running:
<pre class=screen>
chmod +x <program_name>
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Running_your_application"></a> Running your application </span></h2>
<p />
Now that you've compiled the executable, it's time to run the job. The following RSL attributes need to be included in your Condor-G job: <ul>
<li> jobType=mpi
</li> <li> handle=MODULE_NAME
</li> <li> directory=JOB_DIRECTORY
</li></ul> 
<p />
Here is an example submit script for a simple "cpi" application:
<p />
<pre class=screen>
# file: cpi.submit
Universe = grid
Grid_type= gt2

# Set Scheduler to the proper resource
GlobusScheduler = lepton.rcac.purdue.edu/jobmanager-pbs

# Make sure to set handle to the appropriate software module
GlobusRSL = (jobType=mpi)(handle=mpich2-gcc)(xcount=2)(host_xcount=1)(directory=/home/ba01/u100/ahoward/testjobs/cpi)

Executable = /home/ba01/u100/ahoward/testjobs/cpi/cpi
Arguments = -i 10000 

Stream_output = False
Stream_error = False

WhenToTransferOutput = ON_EXIT
TransferExecutable = False

Output = cpi.out
Error = cpi.err
Log = cpi.log

Notification = NEVER
Queue
</pre>
<p />
Finally, the job can be started by running:
<p />
<pre class=screen>
tg-steele$ grid-proxy-init
tg-steele$ condor_submit cpi.submit
</pre>
<p />
-- <a href="/bin/view/Main/AndrewHoward" class="twikiLink">AndrewHoward</a> - 07 Oct 2008</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Sandbox<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>CompilingMPIJobs</span> <br />    
Topic revision: r8 - 10 Feb 2009 - 21:46:39 - <span class="twikiNewLink">ShreyasCholia<a href="/bin/edit/Main/ShreyasCholia?topicparent=Sandbox.CompilingMPIJobs" rel="nofollow" title="ShreyasCholia (this topic does not yet exist; you can create it)">?</a></span>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />