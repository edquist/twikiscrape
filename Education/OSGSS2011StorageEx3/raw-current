<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> OSGSS2011StorageEx3 &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/OSGSS2011StorageEx3?_T=16 Feb 2017" type="application/x-wiki" title="edit OSGSS2011StorageEx3" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/OSGSS2011StorageEx3"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiPref.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twiki_edit.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern_edit.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">
#patternTopBar,
#patternTopBarContentsOuter {
	height:95px; /* top bar height; make room for header columns */
}
#twikinetTopToolBar,
#twikinetTopToolBar table {
	top:95px; /* top bar height */
	height:48px;
}
#patternClearHeaderCenter,
#patternClearHeaderLeft,
#patternClearHeaderRight {
	height:144px; /* 95 + border + 48 */
}
#twikinetLogo {
	position:absolute;
	width:100%;
	height:95px;
}
#twikinetLogo a {
	position:absolute;
	display:block;
	width:179px;
	height:65px;
	background:none;
	top:10px;
	left:340px;
}
#twikinetLogo a:link, 
#twikinetLogo a:visited {
	border:none;
}
#twikinetLogo a:hover {
	border-style:none none solid none;
	border-width:1px;
	border-color:#c4cbd6;
}
#twikinetLogo a span {
	display:none;
}
#patternOuter {
	margin-left:220px;
}
#patternLeftBar {
	width:220px;
	margin-left:-220px;
}
</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternRawViewPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternWrapper"><div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain"><div id="patternClearHeaderCenter"></div>
<div id="patternMainContents"><div class="patternTop"><span class="patternHomePath"><span class="patternHomePathTitle">You are here: </span> <a href="/bin/view/Main/WebHome" class="twikiLink">TWiki    </a><span class='twikiSeparator'>&gt;</span><img src="/twiki/pub/TWiki/TWikiDocGraphics/web-bg-small.gif" border="0" alt="" width="13" height="13" style="background-color:#D0D0D0" />&nbsp;<a href="/bin/view/Education/WebHome">Education Web</a><span class='twikiSeparator'>&gt;</span><a href="/bin/view/Education/GridWorkshops" class="twikiLink">GridWorkshops</a><span class='twikiSeparator'>&gt;</span><a href="/bin/view/Education/OSGSummerSchool2011" class="twikiLink">OSGSummerSchool2011</a><span class='twikiSeparator'>&gt;</span><a href="/bin/view/Education/OSGSS2011Materials" class="twikiLink">OSGSS2011Materials</a><span class='twikiSeparator'>&gt;</span><a href="https://twiki.opensciencegrid.org/bin/view/Education/OSGSS2011StorageEx3" title='Topic revision: 5 (19 Jun 2012 - 22:10:27)'>OSGSS2011StorageEx3</a> <span class='patternRevInfo'>(19 Jun 2012, <a href="/bin/view/Main/DerekWeitzel" class="twikiLink">DerekWeitzel</a>)</span> (raw view)</span><!-- /patternHomePath--></div><!--/patternTop--><div class="twikiContentHeader"></div><div class="patternContent"><div class="patternTopic"> <textarea name=""  rows="22    " cols="70    " readonly="readonly" style="width: 99%    " id="topic" class="twikiTextarea twikiTextareaRawView">---+ Introduction

In Exercise set 2, we improved the scalability of our BLAST runs by first staging the data to an OSG SE.  This achieved our goals, but required substantial manual work to move the data across the grid.

In this set of exercises, we will try a different approach: caching.  We will stage the data to one HTTP server, and rely on the site&#39;s HTTP caches to bring the data closer to the running job, and provide scalability.

---+ Customize this document

&lt;!-- OSG Summer School 2011 Defaults
   * Local VO= %URLPARAM{&quot;INPUT_VO&quot; encode=&quot;quote&quot; default=&quot;osgedu&quot;}%
   * Local UCL_HOST = %URLPARAM{&quot;INPUT_HOST&quot; encode=&quot;quote&quot; default=&quot;vdt-itb&quot;}%
   * Local UCL_USER = %URLPARAM{&quot;INPUT_USER&quot; encode=&quot;quote&quot; default=&quot;user&quot;}%
   * Local UCL_DOMAIN = %URLPARAM{&quot;INPUT_DOMAIN&quot; encode=&quot;quote&quot; default=&quot;cs.wisc.edu&quot;}%
   * Local UCL_CWD= %URLPARAM{&quot;INPUT_CWD&quot; encode=&quot;quote&quot; default=&quot;~/osg_school/dm_part_3&quot;}%
   * Local UCL_CWD2= %URLPARAM{&quot;INPUT_CWD&quot; encode=&quot;quote&quot; default=&quot;dm_part_3&quot;}%
   * Local EXPORT_DIR=%URLPARAM{&quot;INPUT_EXPORT_DIR&quot; encode=&quot;quote&quot; default=&quot;/opt/workshop/dm_exercises/part3&quot;}%
   * Local SOURCE_HOST=%URLPARAM{&quot;INPUT_SOURCE_HOST&quot; encode=&quot;quote&quot; default=&quot;vdt-itb.cs.wisc.edu&quot;}%
   * Local SOURCE_ROOT=%URLPARAM{&quot;INPUT_SOURCE_ROOT&quot; encode=&quot;quote&quot; default=&quot;dm_exercises_part3&quot;}%
   * Local SOURCE_URL=http://%SOURCE_HOST%/%SOURCE_ROOT%
   * Local PROXY_HOST=%URLPARAM{&quot;INPUT_PROXY_ENDPOINT&quot; encode=&quot;quote&quot; default=&quot;osg-edu-se.cs.wisc.edu&quot;}%
   * Local PROXY_PORT=%URLPARAM{&quot;INPUT_PROXY_ENDPOINT&quot; encode=&quot;quote&quot; default=&quot;3128&quot;}%
   * Local PROXY_ENDPOINT=%PROXY_HOST%:%PROXY_PORT%
   * Local VDT_LOCATION=/opt/osg-client
--&gt;

%ICON{&quot;warning&quot;}% %RED% Please change your user name and click on the Customize button!%ENDCOLOR%
&lt;form action=&quot;%SCRIPTURLPATH{&quot;view&quot;}%/%WEB%/%TOPIC%&quot;&gt;
&lt;table&gt;
  &lt;tr&gt;
    &lt;td&gt;
      VO
    &lt;/td&gt;
    &lt;td&gt;
      &lt;input size=100 type=&quot;text&quot; name=&quot;INPUT_VO&quot; value=&quot;%VO%&quot;/&gt;
    &lt;/td&gt;
  &lt;tr&gt;
    &lt;td&gt;
      Host Name
    &lt;/td&gt;
    &lt;td&gt;
      &lt;input size=100 type=&quot;text&quot; name=&quot;INPUT_HOST&quot; value=&quot;%UCL_HOST%&quot;/&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;
      Domain Name
    &lt;/td&gt;
    &lt;td&gt;
      &lt;input size=100 type=&quot;text&quot; name=&quot;INPUT_DOMAIN&quot; value=&quot;%UCL_DOMAIN%&quot;/&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;
      Login Name
    &lt;/td&gt;
    &lt;td&gt;
      &lt;input size=100 type=&quot;text&quot; name=&quot;INPUT_USER&quot; value=&quot;%UCL_USER%&quot;/&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
    &lt;td&gt;
      Exercise Path
    &lt;/td&gt;
    &lt;td&gt;
      &lt;input size=100 type=&quot;text&quot; name=&quot;INPUT_CWD&quot; value=&quot;%UCL_CWD%&quot;/&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;
      Source HTTP Server hostname
    &lt;/td&gt;
    &lt;td&gt;
      &lt;input size=100 type=&quot;text&quot; name=&quot;INPUT_SOURCE_HOST&quot; value=&quot;%SOURCE_HOST%&quot;/&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;
      Source HTTP Server URL prefix
    &lt;/td&gt;
    &lt;td&gt;
      &lt;input size=100 type=&quot;text&quot; name=&quot;INPUT_SOURCE_ROOT&quot; value=&quot;%SOURCE_ROOT%&quot;/&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;
      Test HTTP Proxy Hostname
    &lt;/td&gt;
    &lt;td&gt;
      &lt;input size=100 type=&quot;text&quot; name=&quot;INPUT_PROXY_HOST&quot; value=&quot;%PROXY_HOST%&quot;/&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;
     &amp;nbsp;
     &lt;input type=&quot;submit&quot; class=&quot;twikiSubmit&quot; value=&quot;Customize&quot; /&gt;
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
&lt;/form&gt;

---+ Exercises

---++ Prerequisite 

   * Login on submission node &lt;pre class=&quot;screen&quot;&gt;
ssh %UCL_USER%@%UCL_HOST%.%UCL_DOMAIN%
&lt;/pre&gt;
   * Initialize the OSG client environment &lt;pre class=&quot;screen&quot;&gt;
source %VDT_LOCATION%/setup.sh
&lt;/pre&gt;
   * Obtain proxy certificate, if you have not done so already &lt;pre class=&quot;screen&quot;&gt;
voms-proxy-init -voms %VO%:/%VO%
&lt;/pre&gt;
   * Make a working directory for this exercise&lt;pre class=&quot;screen&quot;&gt;
mkdir -p %UCL_CWD%
cd %UCL_CWD%
&lt;/pre&gt;

---++ Using an HTTP Proxy

To successfully use a HTTP cache, three things need to be done:
   1 A file must be uploaded to a source HTTP site (this is known as &quot;staging&quot;).
   1 The location of the cache must be known.
   1 The file must be downloaded by an HTTP client using cache-friendly headers.

We will do these in this exercise, then we will return to the previous BLAST example.

---+++ Staging Files

In the simplest setup, a web server can export a directory on the file system.  To make a file accessible, you simply need to know the directory name and copy the file into it.

For this tutorial, we run the Apache web server and have the directory ==%EXPORT_DIR%== exported to the URL ==%SOURCE_URL%==.  The HTTP proxy software is called Squid and is running on %PROXY_ENDPOINT%.  First, create your ==%UCL_USER%== directory in ==%EXPORT_DIR%==:
&lt;pre class=&quot;screen&quot;&gt;
mkdir -p %EXPORT_DIR%/%UCL_USER%
&lt;/pre&gt;

Then, write a simple file into this directory:
&lt;pre class=&quot;screen&quot;&gt;
echo &#39;Hello world!&#39; &gt; %EXPORT_DIR%/%UCL_USER%/hello_world.txt
&lt;/pre&gt;

Now, redirect your browser to [[%SOURCE_URL%/%UCL_USER%/hello_world.txt][%SOURCE_URL%/%UCL_USER%/hello_world.txt]]; you should see the text =Hello world!=.

---+++ Finding an HTTP Proxy

There are three ways to determine an HTTP proxy:
   1 (Linux standard) Look into the value of ==$http_proxy== in the running environment.
   1 (OSG-specific) On a worker node, the HTTP proxy will be set in ==$OSG_SQUID_LOCATION==.  If there is no proxy available, ==$OSG_SQUID_LOCATION== will be unset or set to ==UNAVAILABLE==.
   1 Manually hard-code the location of a proxy in application code.

All HTTP clients packaged with the OSG will look at the value of ==$http_proxy==.

From the login node %UCL_HOST%.%UCL_DOMAIN%, the correct value of ==http_proxy== is:

&lt;pre class=&quot;screen&quot;&gt;
export http_proxy=%PROXY_ENDPOINT%
&lt;/pre&gt;

Set this in your environment now.

To initialize the ==$http_proxy== variable on an OSG worker node, source =$OSG_GRID/setup.sh= (this is done for you if you use GlideinWMS).  If ==$OSG_SQUID_LOCATION== is defined and not equal to =UNAVAILABLE=, then it points at a proxy you may use.  You will then want to set ==$http_proxy== to the value of ==$OSG_SQUID_LOCATION==.  The following snippet implements this logic for GlideinWMS jobs:

&lt;pre class=&quot;file&quot;&gt;
export OSG_SQUID_LOCATION=${OSG_SQUID_LOCATION:-UNAVAILABLE}
if [ &quot;$OSG_SQUID_LOCATION&quot; != UNAVAILABLE ]; then
  export http_proxy=$OSG_SQUID_LOCATION
fi
&lt;/pre&gt;

---+++ Using an HTTP Proxy

Copy the =yeast.aa.psq= database file into ==%EXPORT_DIR%/%UCL_USER%==.  First, verify ==$http_proxy== is set:
&lt;pre class=&quot;screen&quot;&gt;
[%UCL_USER%@%UCL_HOST% %UCL_CWD2%]$ echo $http_proxy
%PROXY_ENDPOINT%
&lt;/pre&gt;

Now, download the file using =wget=.  We&#39;ll add the =-d= flag to get extra debug information:
&lt;pre class=&quot;screen&quot;&gt;
wget &quot;%SOURCE_URL%/%UCL_USER%/yeast.aa.psq&quot; -d
&lt;/pre&gt;
%TWISTY{
showlink=&quot;Show output&quot;
hidelink=&quot;Hide output&quot;
mode=&quot;div&quot;
showimgleft=&quot;%ICONURLPATH{toggleopen-small}%&quot;
hideimgleft=&quot;%ICONURLPATH{toggleclose-small}%&quot;
}%
&lt;pre class=&quot;screen&quot;&gt;
[%UCL_USER%@%UCL_HOST% %UCL_CWD2%]$ wget &quot;%SOURCE_URL%/%UCL_USER%/yeast.aa.psq&quot; -d
DEBUG output created by Wget 1.11.4 Red Hat modified on linux-gnu.

--2011-06-24 17:43:53--  %SOURCE_URL%/%UCL_USER%/yeast.aa.psq
Resolving %PROXY_HOST%... 198.51.254.111
Caching %PROXY_HOST% =&gt; 198.51.254.111
Connecting to %PROXY_HOST%|198.51.254.111|:%PROXY_PORT%... connected.
Created socket 3.
Releasing 0x000000001efd1d10 (new refcount 1).

---request begin---
GET %SOURCE_URL%/%UCL_USER%/yeast.aa.psq HTTP/1.0
User-Agent: Wget/1.11.4 Red Hat modified
Accept: */*
Host: %SOURCE_HOST%

---request end---
Proxy request sent, awaiting response... 
---response begin---
HTTP/1.0 200 OK
Date: Fri, 24 Jun 2011 22:43:53 GMT
Server: Apache/2.2.3 (Scientific Linux)
Last-Modified: Fri, 24 Jun 2011 22:43:10 GMT
ETag: &quot;2f89a4-2d79f1-4a67ced0c3b80&quot;
Accept-Ranges: bytes
Content-Length: 2980337
Content-Type: text/plain; charset=UTF-8
X-Cache: MISS from %PROXY_HOST%
Via: 1.0 %PROXY_ENDPOINT% (squid/2.6.STABLE23)
Proxy-Connection: close

---response end---
200 OK
Length: 2980337 (2.8M) [text/plain]
Saving to: `yeast.aa.psq&#39;

100%[=====================================================================&gt;] 2,980,337   8.92M/s   in 0.3s    

Closed fd 3
2011-06-24 17:43:54 (8.92 MB/s) - `yeast.aa.psq&#39; saved [2980337/2980337]

&lt;/pre&gt;
%ENDTWISTY%

In the output, note the response headers from the proxy server:

&lt;pre class=&quot;screen&quot;&gt;
---response begin---
HTTP/1.0 200 OK
Date: Fri, 24 Jun 2011 22:43:53 GMT
Server: Apache/2.2.3 (Scientific Linux)
Last-Modified: Fri, 24 Jun 2011 22:43:10 GMT
ETag: &quot;2f89a4-2d79f1-4a67ced0c3b80&quot;
Accept-Ranges: bytes
Content-Length: 2980337
Content-Type: text/plain; charset=UTF-8
X-Cache: MISS from %PROXY_HOST%
Via: 1.0 %PROXY_ENDPOINT% (squid/2.6.STABLE23)
Proxy-Connection: close

---response end---
&lt;/pre&gt;

Specifically, the line =X-Cache: MISS from %PROXY_HOST%= indicates that this was a cache miss: the file was not in the cache and hence the proxy had to talk to the upstream server ==%SOURCE_HOST%== to retrieve the file.  However, the file should be accessible directly from the cache in the next attempt:

&lt;pre class=&quot;screen&quot;&gt;
wget &quot;%SOURCE_URL%/%UCL_USER%/yeast.aa.psq&quot; -d
&lt;/pre&gt;
%TWISTY{
showlink=&quot;Show output&quot;
hidelink=&quot;Hide output&quot;
mode=&quot;div&quot;
showimgleft=&quot;%ICONURLPATH{toggleopen-small}%&quot;
hideimgleft=&quot;%ICONURLPATH{toggleclose-small}%&quot;
}%
&lt;pre class=&quot;screen&quot;&gt;
[%UCL_USER%@%UCL_HOST% %UCL_CWD2%]$ wget &quot;%SOURCE_URL%/%UCL_USER%/yeast.aa.psq&quot; -d
DEBUG output created by Wget 1.11.4 Red Hat modified on linux-gnu.

--2011-06-24 17:43:59--  %SOURCE_URL%/%UCL_USER%/yeast.aa.psq
Resolving %PROXY_HOST%... 198.51.254.111
Caching %PROXY_HOST% =&gt; 198.51.254.111
Connecting to %PROXY_HOST%|198.51.254.111|:%PROXY_PORT%... connected.
Created socket 3.
Releasing 0x00000000094e1d10 (new refcount 1).

---request begin---
GET %SOURCE_URL%/%UCL_USER%/yeast.aa.psq HTTP/1.0
User-Agent: Wget/1.11.4 Red Hat modified
Accept: */*
Host: %SOURCE_HOST%

---request end---
Proxy request sent, awaiting response... 
---response begin---
HTTP/1.0 200 OK
Date: Fri, 24 Jun 2011 22:43:53 GMT
Server: Apache/2.2.3 (Scientific Linux)
Last-Modified: Fri, 24 Jun 2011 22:43:10 GMT
ETag: &quot;2f89a4-2d79f1-4a67ced0c3b80&quot;
Accept-Ranges: bytes
Content-Length: 2980337
Content-Type: text/plain; charset=UTF-8
Age: 7
X-Cache: HIT from %PROXY_HOST%
Via: 1.0 %PROXY_ENDPOINT% (squid/2.6.STABLE23)
Proxy-Connection: close

---response end---
200 OK
Length: 2980337 (2.8M) [text/plain]
Saving to: `yeast.aa.psq.1&#39;

100%[=====================================================================&gt;] 2,980,337   11.2M/s   in 0.3s    

Closed fd 3
2011-06-24 17:43:59 (11.2 MB/s) - `yeast.aa.psq.1&#39; saved [2980337/2980337]

&lt;/pre&gt;
%ENDTWISTY%

The pertinent header this time was =X-Cache: HIT from %PROXY_HOST%=.  This indicates the file was served from the %PROXY_HOST% proxy, not the source server.

&lt;div style=&quot;margin-left: 1em; margin-right: 1em; background-color: #ffff66; border: 1px solid black; padding: 0.5em;&quot;&gt;
Food for thought: Why is it important to always verify =X-Cache: HIT= appears in most of your log files?
%TWISTY{
showlink=&quot;Show the answer!&quot;
hidelink=&quot;Ok, move on...&quot;
mode=&quot;div&quot;
showimgleft=&quot;%ICONURLPATH{toggleopen-small}%&quot;
hideimgleft=&quot;%ICONURLPATH{toggleclose-small}%&quot;
}%
If the proxy at a remote site stops working (or if, due to misconfiguration, none of your files are *ever* cached!), the transparency of caching can cause many issues.  The load of all transfers for running jobs:
   1 Goes over the wide-area-network.  WAN bandwidth is scarce, expensive, and must be shared amongst all VOs.
   1 Goes to your source server.  It is likely your source server can&#39;t support the load of all your running jobs.
If you run in this manner, at best your jobs will run inefficiently.  At worst, your VO may be temporarily banned from a site if it consumes too many scarce resources!
%ENDTWISTY%
&lt;/div&gt;

---+++ Stage a whole database

Copy all the BLAST database files into ==%EXPORT_DIR%==.  Access a few random ones with =wget= as demonstrated previously.  Compare the difference of the access times with and without ==$http_proxy== set.

&lt;div style=&quot;margin-left: 1em; margin-right: 1em; background-color: #ffff66; border: 1px solid black; padding: 0.5em;&quot;&gt;
Food for thought: Do you notice any speed differences from using the proxy?  What about for the largest files?  What about the smallest?
%TWISTY{
showlink=&quot;Show the answer!&quot;
hidelink=&quot;Ok, move on...&quot;
mode=&quot;div&quot;
showimgleft=&quot;%ICONURLPATH{toggleopen-small}%&quot;
hideimgleft=&quot;%ICONURLPATH{toggleclose-small}%&quot;
}%
In the tutorial, we are accessing files from a single proxy (osg-edu-se.cs.wisc.edu) that is hardware similar to the source server (vdt-itb.cs.wisc.edu).  As they are similar hardware and on the same local network as the submit server, it is unlikely there is significant difference in speeds between the two (unless one is overloaded due to the activities of your classmates!).

However, you can expect a more significant difference at large grid sites for two reasons:
   1 The hardware is either more powerful or the proxy service is load-balanced between multiple hosts.
   1 The source is &quot;far away&quot; in terms of networking (and hence slow to access) while the proxy is &quot;close to&quot; the worker node (and faster to access).

%ENDTWISTY%
&lt;/div&gt;

How much easier was it to stage files with HTTP versus SRM?

---+++ Using HTTP Securely

Unlike SRM, HTTP does not have any safeguards to check if the file has been altered in transit.  Therefore, it&#39;s unsafe to transfer executables via HTTP without further safeguard: an attacker might change your code to do something nasty!  To better protect against security threats, you can checksum the files prior to transfer and verify the checksum after download.  If the two values match, the file has not been tampered with.

The =blastp= executable is actually quite large - larger than the =yeast= database we&#39;ve been using!  Instead of transferring it with Condor, let&#39;s transfer it with HTTP.  Because it is an executable file, we&#39;ll want to perform the checksumming procedure.

Copy the =blastp= executable to your working directory, =%UCL_CWD%=.  Calculate the checksum, and then copy the file to your export directory:
&lt;pre class=&quot;screen&quot;&gt;
[%UCL_USER%@%UCL_HOST% %UCL_CWD2%]$ sha1sum blastp
15bcc93b0fc6f78e604a1ee95f78ab05f1b6c17e  blastp
[%UCL_USER%@%UCL_HOST% %UCL_CWD2%]$ sha1sum blastp &gt; my_checksum.sha
[%UCL_USER%@%UCL_HOST% %UCL_CWD2%]$ cp blastp %EXPORT_DIR%/%UCL_USER%
&lt;/pre&gt;

We&#39;ll just transfer the small file with the checksum, =my_checksum.sha=, with Condor, then download and verify the actual executable on the worker node.  To verify, we&#39;ll need a shell snippet like the following (assume that the base URL is given as the first argument and stored in ==$1==):

&lt;pre class=&quot;file&quot;&gt;
export OSG_SQUID_LOCATION=${OSG_SQUID_LOCATION:-UNAVAILABLE}
if [ &quot;$OSG_SQUID_LOCATION&quot; != UNAVAILABLE ]; then
  export http_proxy=$OSG_SQUID_LOCATION
fi
BASE_URL=$1
wget -d --retry-connrefused --waitretry=10 &quot;$BASE_URL/blastp&quot; || exit $?
sha1sum -c my_checksum.sha || exit 1
chmod +x blastp
&lt;/pre&gt;

Previously, we had the following lines in the Condor submit file ==test.submit==:
&lt;pre class=&quot;file&quot;&gt;
transfer_input_files = blastp,$(query_input_name)
Arguments =  srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/bbockelm yeast $(query_input_name) blast_results.$(Cluster).$(Process)
&lt;/pre&gt;

This would be changed to:
&lt;pre class=&quot;file&quot;&gt;
transfer_input_files = my_checksum.sha,$(query_input_name)
Arguments =  %SOURCE_URL%/%UCL_USER% yeast $(query_input_name) blast_results.$(Cluster).$(Process)
&lt;/pre&gt;

---++ Caching and BLAST

Return to the ==blast_wrapper.sh== script from [[OSGSS2011StorageEx2][Exercise 2]].  Make the following changes:

   1 Instead of downloading files via SRM, rewrite the script to take advantage of HTTP caching.  Run it on the submit node.
   1 Re-run the single-query exercise.  Instead of transferring the ==blastp== executable using Condor, transfer it securely using the HTTP proxy.  Only the query file should be transferred by Condor.
   1 Re-run the many-jobs exercise.
   1 Re-run the many-jobs on multiple sites exercise.
   1 EXTRA CREDIT: Write a DAG to completely automate the previous exercise, including staging the input and creating a tarball out of the output.

Note one difference with HTTP caching compared to SRM is that SRM provides a mechanism for listing the contents of the directory, which we used to download all the database files in the original ==blast_wrapper.sh==.  A successful solution of the above problem will have to come up with an alternate method for downloading all the necessary input.</textarea> <div class="patternSigLine"><span class="twikiRight twikiMakeVisible" style="text-align:left;"><span class="twikiLeft patternTextareaButton patternButtonFontSelector" title="Switch to monotype or propotional font">&nbsp;</span><span class="twikiLeft patternTextareaButton patternButtonEnlarge" title="Enlarge edit box">&nbsp;</span><span class="twikiLeft patternTextareaButton patternButtonShrink" title="Shrink edit box">&nbsp;</span></span><br class="twikiClear" /></div><!-- /patternSigLine--></div><!-- /patternTopic-->
<div class="twikiContentFooter"></div></div><!-- /patternContent-->
<a name="topic-actions"></a><div class="twikinetRounded twikinetRoundedTopicActions"><div class="rCRounded"><div class="rCTR"><div class="rCTL"></div><!--/rCTL--><div class="patternTopicActions"><div class="patternTopicAction"><span class="patternActionButtons"><span class="patternButton"><a href='https://twiki.opensciencegrid.org/bin/edit/Education/OSGSS2011StorageEx3?t=1487213295;nowysiwyg=1' rel='nofollow' title='Edit this topic text' accesskey='e'><span class='twikiAccessKey'>E</span>dit</a></span><span class='twikiSeparator'>&nbsp;|&nbsp;</span><span class='patternButton'><a href='/bin/attach/Education/OSGSS2011StorageEx3' rel='nofollow' title='Attach an image or document to this topic' accesskey='a'><span class='twikiAccessKey'>A</span>ttach</a></span><span class='twikiSeparator'>&nbsp;|&nbsp;</span><span class='patternButton'><a href='/bin/view/Education/OSGSS2011StorageEx3?cover=print;raw=on' rel='nofollow' title='Printable version of this topic' accesskey='p'><span class='twikiAccessKey'>P</span>rint version</a></span><span class='twikiSeparator'>&nbsp;|&nbsp;</span><span><span><a href='/bin/rdiff/Education/OSGSS2011StorageEx3?type=history' rel='nofollow' title='View total topic history' accesskey='h'><span class='twikiAccessKey'>H</span>istory</a></span>: r5&nbsp;<a rel="nofollow" href="/bin/rdiff/Education/OSGSS2011StorageEx3?rev1=5;rev2=4">&lt;</a>&nbsp;<a rel="nofollow" href="/bin/view/Education/OSGSS2011StorageEx3?rev=4">r4</a>&nbsp;<a rel="nofollow" href="/bin/rdiff/Education/OSGSS2011StorageEx3?rev1=4;rev2=3">&lt;</a>&nbsp;<a rel="nofollow" href="/bin/view/Education/OSGSS2011StorageEx3?rev=3">r3</a>&nbsp;<a rel="nofollow" href="/bin/rdiff/Education/OSGSS2011StorageEx3?rev1=3;rev2=2">&lt;</a>&nbsp;<a rel="nofollow" href="/bin/view/Education/OSGSS2011StorageEx3?rev=2">r2</a>&nbsp;<a rel="nofollow" href="/bin/rdiff/Education/OSGSS2011StorageEx3?rev1=2;rev2=1">&lt;</a>&nbsp;<a rel="nofollow" href="/bin/view/Education/OSGSS2011StorageEx3?rev=1">r1</a></span><span class='twikiSeparator'>&nbsp;|&nbsp;</span><span><a href='/bin/oops/Education/OSGSS2011StorageEx3?template=backlinksweb' rel='nofollow' title='Search the Education Web for topics that link to here' accesskey='b'><span class='twikiAccessKey'>B</span>acklinks</a></span><span class='twikiSeparator'>&nbsp;|&nbsp;</span><span><a href='https://twiki.opensciencegrid.org/bin/view/Education/OSGSS2011StorageEx3' rel='nofollow' title='View topic' accesskey='v'><span class='twikiAccessKey'>V</span>iew topic</a></span><span class='twikiSeparator'>&nbsp;|&nbsp;</span><span><a href='/bin/oops/Education/OSGSS2011StorageEx3?template=oopsmore&amp;param1=5&amp;param2=5' rel='nofollow' title='Delete or rename this topic; set parent topic; view and compare revisions' accesskey='m'><span class='twikiAccessKey'>M</span>ore topic actions</a></span></span></div><!--/patternTopicAction--></div><!--/patternTopicActions--></div><!--/rCTR--><div class="rCBR"><div class="rCBL"></div><!--/rCBL--></div><!--/rCBR--></div><!--/rCRounded--></div><!--/twikinetRounded--><div class="patternInfo twikiGrayText"><div class="patternRevInfo">Topic revision: r5 - 19 Jun 2012 - 22:10:27 - <a href="/bin/view/Main/DerekWeitzel" class="twikiLink">DerekWeitzel</a></div><!-- /patternRevInfo--></div><!-- /patternInfo-->
</div><!-- /patternMainContents-->
</div><!-- /patternMain--><div id="patternLeftBar"><div id="patternClearHeaderLeft"></div>
<div id="patternLeftBarContents">
<head>
	<style type="text/css" media="all">
	
		.float-left {
			float:	left;
		}

		.float-right {
			float:	right;
		}

		.rounded {
      		border-radius:	 		8px;
			-moz-border-radius: 	8px;
			-webkit-border-radius:	8px;		
		}
		
		.rounded-top {
      		border-radius:	 		8px 8px 0px 0px;
			-moz-border-radius: 	8px 8px 0px 0px;
			-webkit-border-radius:	8px 8px 0px 0px;		
		}
		
		.bordered {
			border:	1px solid #AAAAAA;
		}

		.bordered-bottom {
			border-bottom:	1px solid #AAAAAA;
		}

		.high-contrast {
			color:		#FF6600;
			background: #000060;		
		}

                .low-contrast {
			color:		#FF6600;
			background: #ADD8E6;		
		}

	
		.container {
display: inline-block;
			margin:		0;
			padding:	0;
		}
		
		.box {
			display:				block;
			margin:			 0;
			padding:		0;
		}

                #head-block {
                        color:               #FF6600;	
                        background:    #333380;
                }
							
		#menu {
			font-family:	"Lucida Grande", sans-serif;
			font-size:		small;
			margin:		0px 0px 10px 0px;
			padding:	0px 0px 0.3em 0px;
			background: #EAEDF2;
		}
							
		#menul {
			font-family:	"Lucida Grande", sans-serif;
			font-size:		small;
			margin:		0px 0px 10px 0px;
			padding:	0px 0px 0.3em 0px;
			background: #F4F6F9

		}		
		#head {
			margin:		0px;
			padding:	0.2em 5px 0.2em 10px;
			font-size:	normal;
			font-weight:	bold;
			color:			#FF6600;	
		}
		
		#head a {
			text-decoration:	none;
			color:			#FF6600;	
		}

		#head a:hover {
			background: 		#EAEDF2;
			text-decoration:	none;
			color:			#FFBB00;	
		}

		#head a:visited {
			text-decoration:	none;
			color:			#FF6600;	
		}

		#head a:active {
			text-decoration:	none;
			color:			#FF6600;	
		}

		#head a:link {
			text-decoration:	none;
			color:			#FF6600;	
		}

                #iteml {
			padding:	0.1em 5px 0.0em 10px;
                }

		#iteml a {
			background: 		#F4F6F9
			text-decoration:	none;
			color:			#000044;			
		}

		#iteml a:hover {
			background: 		#F4F6F9
			text-decoration:	none;
			color:			#FF6600;			
		}
		#item {
			padding: 0.1em 5px 0.0em 10px;
		}
		
		#item a {
			background: 		#EAEDF2;
			text-decoration:	none;
			color:			#000044;			
		}

		#item a:hover {
			background: 		#EAEDF2;	
			text-decoration:	none;
			color:			#FF6600;			
		}
</style>
</head>
Hello, <a href="/bin/view/Main/TWikiGuest" class="twikiLink">TWikiGuest</a>
<a href="https://twiki.grid.iu.edu/bin/view/TWiki/TWikiRegistration" target="_top"><br/>Register</a>
<p />
<p />
<!-- Google CSE Search Box Ends
<h5><a name="Common_links"></a> Common links </h5> <ul>
<li> <a href="/bin/view/Main/WebHome" class="twikiLink">OSG TWiki home</a>
</li> <li> <a href="/bin/view/Documentation/Release3/WebHome" class="twikiLink">RPM Install guides - OSG 3.0</a>
</li> <li> <a href="/bin/view/ReleaseDocumentation/WebHome" class="twikiLink">Pacman Install guides OSG 1.2</a>
</li> <li> <a href="/bin/view/Documentation/WebHome" class="twikiLink">Technical Documentation</a>
</li> <li> <a href="/bin/view/Documentation/SiteAdminResources" class="twikiLink">Contact Info</a> 
</li> <li> <strong><a href="/bin/view/Main/ICantFindItForm" class="twikiLink">I can't find it!</a></strong>  -->
</li></ul> 
<div class="container">
<p />
    <div class="box rounded bordered" id="menu">
        <div class="box rounded-top high-contrast" id="head"><a  style="" href="/bin/view/Main/WebHome" class="twikiLink" title="Home">About the OSG</a></div>
        <div id="item"><a  style="" href="/bin/view/Documentation/UsingTheGrid" class="twikiLink" title="Instructions for Using OSG">New Users</a></div>
        <div id="item"><a href="http://myosg.grid.iu.edu/map?map_attrs_shownr=on&amp;all_sites=on&amp;active=on&amp;active_value=1&amp;disable_value=1&amp;gridtype=on&amp;gridtype_1=on" target="_top">OSG Sites</a></div>
        <div id="item"><a  style="" href="http://myosg.grid.iu.edu/vosummary?all_vos=on&amp;active=on&amp;active_value=1&amp;datasource=summary" target="_top" title="List of Virtual Organizations">OSG VOs</a></div>
        <div id="item"><a href="http://display.grid.iu.edu/" target="_top">OSG Usage Graphs</a></div>
        <div id="item"><a  style="" href="https://indico.fnal.gov/categoryDisplay.py?categId=86" target="_top" title="OSG Event Calendar">Events</a></div>
       <div id="item"><a href="/bin/view/Management/OSGOrganizationInformation" class="twikiLink">OSG Organization</a></div>
<p />
    </div>
<p />
<p />
    <div class="box rounded bordered" id="menu">
        <div class="box rounded-top high-contrast" id="head">OSG at Work</div>
        <div id="item"><a  style="" href="/bin/view/Documentation/WebHome" class="twikiLink" title="Official Documentation Home">Technical Documentation</a></div>
        <div id="item"><a href="/bin/view/Security/WebHome" class="twikiLink">Security</a></div>
        <div id="item"><a href="/bin/view/SoftwareTeam/WebHome" class="twikiLink">Software Team</a></div>
        <div id="item"><a href="/bin/view/Education/WebHome" class="twikiCurrentWebHomeLink twikiLink">Education</a></div>
        <div id="item"><a href="/bin/view/Management/WebHome" class="twikiLink">Management</a></div>
        <div id="item"><a  style="" href="/bin/view/Management/ScientificPublications" class="twikiLink" title="Scientific Publications and Citing OSG">Scientific Publications</a></div>
        <div id="item"><a href="/bin/view/Management/OSGResearchHighlights" class="twikiLink">Research Highlights</a></div>
    </div>
<p />
<p />
		<div class="box rounded bordered" id="menu">
			<div class="box rounded-top high-contrast" id="head"><a  style="" href="/bin/view/Main/WebHome" class="twikiLink" title="TWiki Main Web">Documentation Links</a></div>
			<div id="item"><a  style="" href="/bin/view/Documentation/Release3/NavContributeDocumentation" class="twikiLink" title="OSG Documentation System Information">How To Write Documents</a></div>
			<div id="item"><a  style="" href="/bin/view/Documentation/DocFormattingRules" class="twikiLink" title="Formatting OSG Documents">Formatting Documents</a></div>
                        <div id="item"><a  style="" href="/bin/view/Education/WebTopicCreator" class="twikiLink" title="Create a New TWiki Page"> <img width="16" alt="newtopic" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/newtopic.gif" height="16" border="0" /> Create New Topic</a></div>
                        <div id="item"><a  style="" href="/bin/view/Main/WebList" class="twikiLink" title="List of Webs"> <img width="16" alt="index" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/index.gif" height="16" border="0" /> List of Webs</a></div>
                        <div id="item"><a  style="" href="/bin/view/Education/WebIndex" class="twikiLink" title="Index of Topics"> <img width="16" alt="index" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/index.gif" height="16" border="0" /> Topic Index</a></div>
                        <div id="item"><a href="/bin/view/Documentation/WebTopicList" class="twikiLink"> <img width="16" alt="index" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/index.gif" height="16" border="0" /> Topic List</a></div>
                        <div id="item"><a  style="" href="/bin/view/Education/WebChanges" class="twikiLink" title="List of Pages that have Changed by Change Date"> <img width="16" alt="changes" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/changes.gif" height="16" border="0" /> Changes</a></div>
                        <div id="item"><a  style="" href="/bin/view/Main/TWikiUsers" class="twikiLink" title="Alphabetized List of TWiki Users"> <img width="16" alt="person" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/person.gif" height="16" border="0" /> TWiki Users</a></div>
		</div>
<p />
</div>
</div><!-- /patternLeftBarContents--></div><!-- /patternLeftBar-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--></div><!-- /patternWrapper--><div id="patternTopBar"><div id="twikinetLogo"><a href="http://www.twiki.net/"><span>TWIKI.NET</span></a></div><div id="patternTopBarContents"><div class="twikiLeft"><span id="twikiLogo" class="twikiImage"><a href="http://www.opensciencegrid.org    "><img src="/twiki/pub/Main/WebHome/osg-logo.png    " border="0" alt="OpenScience Grid Website    " style="border:none;" /></a></span></div>
<div class="twikiRight">
<table cellpadding="0" cellspacing="0" border="0"><tr><td class="twikinetSearchJump twikinetSearchJumpLeft">
 <ul>
<li> <form name="jumpForm" action="/bin/view/Education/OSGSS2011StorageEx3"><input id="jumpFormField" type="text" class="twikiInputField" name="topic" value="" size="16" /><input type="submit" class="twikinetJumpButton" name="submit" value="" /></form>
</li> <li> <form name="quickSearchForm" action="/bin/view/Education/WebSearch"><input type="text" class="twikiInputField" id="quickSearchBox" name="search" value="" size="18" /><input type="hidden" name="scope" value="all" /><input type="hidden" name="web" value="Education" /><input type="submit" size="5" class="twikinetSearchButton" name="submit" value="" /></form>
</li> <li> </li></ul> 
</td>
<td class="twikinetSearchJumpRight"></td>
</tr></table><br class="twikiClear" /></div></div></div><!-- /patternTopBar--><div id="twikinetTopToolBar"><div id="twikinetTopToolBarContents"><div class="twikinetWebName twikiLeft">
<table cellpadding="0" cellspacing="0" border="0"><tr><td style="vertical-align:middle;">
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Education"></a>  <a href="/bin/view/Education/WebHome" class="twikiCurrentWebHomeLink twikiLink">Education</a> </span></h2>
</td></tr></table>
</div><!--/twikinetWebName-->
<div class="twikinetToolBar twikiRight">
<table cellpadding="0" cellspacing="0" border="0"><tr><td><a href="https://twiki.opensciencegrid.org/bin/edit/Education/OSGSS2011StorageEx3?t=1487213295;nowysiwyg=1" rel="nofollow">
<span class="rCRounded"><span class="rCTR"><span class="rCTL"></span><!--/rCTL-->
<span class="twikiLinkLabel twikinetEditIcon"><span class='twikiAccessKey'>E</span>dit</span>
</span><!--/rCTR--><span class="rCBR"><span class="rCBL"></span></span><!--/rCBR--></span><!--/rCRounded-->
</a></td><td><a href="/bin/attach/Education/OSGSS2011StorageEx3" rel="nofollow">
<span class="rCRounded"><span class="rCTR"><span class="rCTL"></span><!--/rCTL-->
<span class="twikiLinkLabel"><span class='twikiAccessKey'>A</span>ttach</span>
</span><!--/rCTR--><span class="rCBR"><span class="rCBL"></span></span><!--/rCBR--></span><!--/rCRounded-->
</a></td><td><a href="/bin/genpdf/Education/OSGSS2011StorageEx3?pdftitle=OSGSS2011StorageEx3" rel="nofollow">
<span class="rCRounded"><span class="rCTR"><span class="rCTL"></span><!--/rCTL-->
<span class="twikiLinkLabel">PDF</span>
</span><!--/rCTR--><span class="rCBR"><span class="rCBL"></span></span><!--/rCBR--></span><!--/rCRounded-->
</a></td></tr></table>
<br class="twikiClear" /></div><!--/patternToolBar--></div><!--/twikinetTopToolBarContents--></div><!--/twikinetTopToolBar--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>