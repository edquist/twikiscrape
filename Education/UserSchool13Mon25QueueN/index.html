<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> UserSchool13Mon25QueueN &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/UserSchool13Mon25QueueN?_T=16 Feb 2017" type="application/x-wiki" title="edit UserSchool13Mon25QueueN" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/UserSchool13Mon25QueueN"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <style type="text/css">
pre em { font-style: normal; background-color: yellow; }
pre strong { font-style: normal; font-weight: bold; color: #008; }
</style>
<p />
<h1><a name="Monday_Exercise_2_5_Use_queue_N"></a> Monday Exercise 2.5: Use queue <em>N</em>, $(Cluster), and $(Process) </h1>
<p />
The goal of this exercise is to learn to submit many jobs from a single <code>queue</code> statement, and then to control filenames and arguments per job.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Running_Many_Jobs_With_One_queue"></a> Running Many Jobs With One queue Statement </span></h2>
<p />
It turns out, the <code>queue</code> statement in an HTCondor submit file takes an optional argument: the number of jobs to queue. You can easily see this version of <code>queue</code> in action.
<p /> <ol>
<li> From earlier this morning, find and copy a submit file that runs the <code>sleep</code> command
</li> <li> In the submit file, change the <code>queue</code> statement to run many jobs instead:       <pre class="file">queue 10</pre>       <p>You do not need to change any other statements, although you may wish to leave out the <code>output</code> and <code>error</code> statements (<code>sleep</code> produces no output).</p>
</li> <li> Submit the file; note the message from <code>condor_q</code>
</li> <li> Look at your jobs in the queue; do you see all 10? Did they appear right away?
</li> <li> When the jobs have finished, look through the resulting log file
</li></ol> 
<p />
Easy, right?
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Using_queue_N_With_Output"></a> Using queue <em>N</em> With Output </span></h2>
<p />
What happens if you queue many jobs with a single <code>queue</code> statement, and those jobs produce output? There is no way to change the name of the output or error files between <code>queue</code> statements. You can probably guess what happens by now, but in case you want to experiment…
<p />
Here is a very simple Perl script (just to show another scripting language) that prints out a single random number.
<p />
<pre class="file">
#!/usr/bin/env perl
use strict;
use warnings;
print "Random number: " . rand() . "\n";
</pre>
<p /> <ol>
<li> Save the Perl script to a file named <code>random.py</code>
</li> <li> Create a simple submit file that runs this Perl program once
</li> <li> Test your submit file to make sure it works — do you get the output?
</li> <li> Change the submit file to run the program many times, say 10–20
</li> <li> Submit it again, wait for all jobs to finish, then look at the output file
</li></ol> 
<p />
Not quite what you want, right?
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Using_Process_to_Separate_Files"></a> Using $(Process) to Separate Files </span></h2>
<p />
When processing a submit file, HTCondor defines and uses a special variable for the process number of each job. If you write <code>$(Process)</code> in a submit file, HTCondor will replace it with the process number of the job, independently for each job added to the queue. Using this variable allows you, for example, to define an output file per process. For example, suppose the following two lines occur in a submit file:
<p />
<pre class="file">
output = my-output-file-$(Process).out
queue 10
</pre>
<p />
Even though the <code>output</code> is the “same” for each job created by the <code>queue 10</code> statement, the actual output filename will be different for each job:
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> First job </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <code>my-output-file-0.out</code> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Second job </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> <code>my-output-file-1.out</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Third job </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <code>my-output-file-2.out</code> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" colspan="2" valign="top" class="twikiTableCol0 twikiFirstCol"> ... </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Last (tenth) job </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> <code>my-output-file-9.out</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
Let’s try this in a real example.
<p /> <ol>
<li> If not done above, save the Perl script from the previous exercise to a file named <code>random.py</code>
</li> <li> Create a submit file that runs the Perl script 10 times; use <code>$(Process)</code> to name each output and error file uniquely
</li> <li> Submit your jobs, wait for them to finish, then look at the output
</li></ol> 
<p />
Did you get 10 output files, each named differently? Each with a different random number?
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Using_Cluster_to_Separate_Files"></a> Using $(Cluster) to Separate Files Across Runs </span></h2>
<p />
As it stands now, you can get separate output (and error) filenames for each job within a run. However, the next time you submit the same file, all of the output and error files are overwritten by new ones created by the new jobs. Maybe this is the behavior that you want. But sometimes, you may want to separate files by run, as well.
<p />
In addition to <code>$(Process)</code>, there is also a <code>$(Cluster)</code> variable that you can use in your submit files. It works just like <code>$(Process)</code>, except it is replaced with the cluster number of the entire submission. Obviously, the cluster number is the same for all jobs within a single submission, so it does not help separate files by job. But when used <strong>with</strong> <code>$(Process)</code>, it can be used to separate files by run. For example, consider this <code>output</code> statement:
<p />
<pre class="file">
output = my-output-file-$(Cluster)-$(Process).out
</pre>
<p />
For one particular run, it might result in output filenames like this:
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> First job </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <code>my-output-file-2444-0.out</code> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Second job </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> <code>my-output-file-2444-1.out</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Third job </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <code>my-output-file-2444-2.out</code> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" colspan="2" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> ... </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
If you like, change your submit file from the previous exercise to use both <code>$(Cluster)</code> and <code>$(Process)</code>. Submit your file twice to see the separate files for each run. Be careful how many jobs you run total, as the number of output files grows quickly!
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Using_Process_and_Cluster_in_Oth"></a> Using $(Process) and $(Cluster) in Other Statements </span></h2>
<p />
The <code>$(Cluster)</code> and <code>$(Process)</code> variables can be used in any submit file statement, although they seem to be useful in some kinds of statements more than others. For instance, it is hard to imagine a truly good reason to use the <code>$(Process)</code> variable in a <code>rank</code> statement (i.e., for preferring some execute slots over others), and in general the <code>$(Cluster)</code> variable often makes little sense to use.
<p />
But in some situations, the <code>$(Process)</code> variable can be very helpful. Common uses are in the following kinds of statements — can you think of a scenario in which each use might be helpful?
<p /> <ul>
<li> <code>log</code>
</li> <li> <code>transfer_input_files</code>
</li> <li> <code>transfer_output_files</code>
</li> <li> <code>arguments</code>
</li></ul> 
<p />
The first three of those statements define filenames, which we have already seen above. The last possibility, the command <code>arguments</code>, is interesting in a different way. If your program accepts arguments, you may want to run it differently for each job. We saw this scenario earlier with the <code>fibonacci</code> program. You can use the <code>$(Process)</code> variable (or <code>$(Cluster)</code>, or both) anywhere in an <code>arguments</code> statement: as part of a filename, as a bare number, or for another reason.
<p />
Unfortunately, HTCondor does not let you perform math on the <code>$(Process)</code> number when using it. So, for example, if you use <code>$(Process)</code> as a numeric argument to a command, it will always result in jobs getting the arguments 0, 1, 2, and so on. If you have control over your program and the way in which it uses command-line arguments, then you are fine. Otherwise, you might need to transform the <code>$(Process)</code> numbers into something more appropriate using a <strong><em>wrapper script</em></strong>, which will be discussed on Thursday.
<p />
Let’s change the Perl random-number generator to use a numeric argument. It turns out that Perl can initialize its random number generator with a “seed” integer; given the same initial seed, Perl will produce the same series of random numbers thereafter. Different seeds yield different random number sequences. Here is a version of the Perl script that accepts a command-line argument and uses it to seed the random-number generator:
<p />
<pre class="file">
#!/usr/bin/env perl
use strict;
use warnings;
if (scalar(@ARGV) != 1) {
    print "Usage: $0 SEED\n";
    exit 1;
}
srand($ARGV[0]);
print "Random number: " . rand() . "\n";
</pre>
<p /> <ol>
<li> Save this version of the script to a file named <code>random-seed.pl</code>
</li> <li> Write a submit file to run this script many times (10–20) <ul>
<li> Use a separate numeric argument for each job
</li> <li> Write separate output files per job
</li> <li> Leave out the error file, if you like
</li></ul> 
</li></ol> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Optional_Defining_Extra_Attribut"></a> (Optional) Defining Extra Attributes for Tracking </span></h2>
<p />
During the lecture, it was mentioned that you can define arbitrary attributes in your submit file, and that one purpose of such attributes is to track or report on different jobs separately. In this optional exercise, you will see how this technique can be used.
<p />
Once again, we will use <code>sleep</code> jobs, so that your jobs remain in the queue long enough to experiment on.
<p /> <ol>
<li> Create a basic submit file that runs <code>sleep 120</code> (or some reasonable duration)
</li> <li> Instead of a single <code>queue</code> statement, write this:       <pre class="file">
<em>+MyJobAttribute = 1</em>
queue 5
<em>+MyJobAttribute = 2</em>
queue 5
</pre>       <p>The highlighted statements give the extra attribute <code>MyJobAttribute</code> to your jobs; the first 5 jobs have one value, and the second 5 have another.
</li> <li> Submit the file
</li></ol> 
<p />
Check on the submissions using a normal <code>condor_q</code>. Of course, your special attribute does not appear in the standard <code>condor_q</code> output, but it is present in each job’s ClassAd. You can see the effect of the attribute by limiting your <code>condor_q</code> output to one type of job or another. First, run this command:
<p />
<pre class="screen">
$> <strong>condor_q -constraint 'Owner == "<em>userid</em>" && MyJobAttribute == 1'</strong>
</pre>
<p />
Use your own <code>userid</code>, of course. Do you get the output that you expected?
<p />
Using the example command above, how would you list your other five jobs?</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/UserSchool13Materials" class="twikiLink">UserSchool13Materials</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>UserSchool13Mon25QueueN</span> <br />    
Topic revision: r2 - 23 Jun 2013 - 02:02:21 - <a href="/bin/view/Main/TimCartwright" class="twikiLink">TimCartwright</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />