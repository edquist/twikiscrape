<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> UserSchool15Tue41Connect &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/UserSchool15Tue41Connect?_T=16 Feb 2017" type="application/x-wiki" title="edit UserSchool15Tue41Connect" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/UserSchool15Tue41Connect"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Tuesday_Exercise_4_1_OSG_Connect"></a> Tuesday Exercise 4.1: OSG Connect </h1>
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Background"> Background</a>
</li> <li> <a href="?cover=print#Signing_up_for_OSG_Connect"> Signing up for OSG Connect</a>
</li> <li> <a href="?cover=print#Getting_started"> Getting started</a> <ul>
<li> <a href="?cover=print#Creating_the_Python_sandbox"> Creating the Python sandbox</a>
</li> <li> <a href="?cover=print#Creating_the_job_wrapper"> Creating the job wrapper</a>
</li> <li> <a href="?cover=print#Create_the_submit_file"> Create the submit file</a>
</li> <li> <a href="?cover=print#Post_job_Analysis"> Post-job Analysis</a>
</li></ul> 
</li> <li> <a href="?cover=print#Run_under_Connect_Client"> Run under Connect Client</a>
</li></ul> 
</div> 
<p />
For exercises we'll point you to the official tutorials, since these have been developed specifically with OSG Connect in mind.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Background"></a> Background </span></h2>
For this exercise, we thought it might be interesting to analyze a set of images from the University of Chicago Photographic Archive (<a href="http://photoarchive.lib.uchicago.edu/" target="_top">http://photoarchive.lib.uchicago.edu/</a>). Our motivation is that it's a common claim that older photographs look much darker than recent ones. With our job, we'll analyze the luminance of photographs in the archive and compare that to the date of the photograph. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Signing_up_for_OSG_Connect"></a> Signing up for OSG Connect </span></h2>
Hopefully you've already signed up for OSG Connect, if not please visit this page: <a href="http://osgconnect.net/signup" target="_top">http://osgconnect.net/signup</a>
<p />
Once you've signed up, SSH to <code>username@login.osgconnect.net</code> with the username and password you created. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Getting_started"></a> Getting started </span></h2>
We've conveniently made the tutorial data and software available to you by simply typing <code>tutorial photodemo</code>. It should create a directory with the necessary files at <code>~/tutorial-photodemo</code>.
<p />
The input dataset is a file called <code>manifest.txt</code>. This file contains a list of JPEG images stored on our Stash server and the date of each image.
<p />
The <code>luminance2</code> python script does most of the heavy lifting for us here. Since we want to use Python 2.7, we will be loading Python from the OSG Distributed Environment Modules and use a Python sandboxing tool called <span class="twikiNewLink">VirtualEnv<a href="/bin/edit/Education/VirtualEnv?topicparent=Education.UserSchool15Tue41Connect" rel="nofollow" title="VirtualEnv (this topic does not yet exist; you can create it)">?</a></span>.
<p />
<h3><a name="Creating_the_Python_sandbox"></a> Creating the Python sandbox </h3>
We've provided a script that will create a Python sandbox with the necessary dependencies already installed. It's not too important to understand how the sandbox works -- just know that it will be compressed and sent with the job.
<p />
To create the sandbox, run:
<pre class="screen">
$> ./create_pillow.bash
</pre>
<p />
Once complete, you should see a new file called <code>pillow.tar</code> in your tutorial directory.
<p />
<h3><a name="Creating_the_job_wrapper"></a> Creating the job wrapper </h3>
In order the run the <code>luminance2</code> program, we need to create a wrapper script that does the following: <ol>
<li> Load the Python module
</li> <li> Unpack the <code>pillow.tar</code> Python environment
</li> <li> Run <code>virtualenv pillow</code>
</li> <li> Activate the environment with:    <code>source pillow/bin/activate</code> 
</li> <li> Finally, run the <code>luminance2</code> program like so:    <code>python luminance2 "$@"</code>
</li></ol> 
<p />
Try creating this wrapper. If you get stuck, you can refer to the file <code>run.sh</code> where we've done this for you. 
<p />
<h3><a name="Create_the_submit_file"></a> Create the submit file </h3>
For this exercise, we want to analyze about 5500 photos. However, each photo takes a very short amount of time to analyze, and creating 5500 jobs for this task would be excessive. To reduce overhead, we would like to analyze about 200 photos per job. To do this, run <code>mksubmit</code>:
<p />
<pre class="screen">
$> ./mksubmit > luminance.sub
</pre>
<p />
Otherwise, If you are comfortable with your scripting skills, you can try creating your own script that generates a submit file to do this. The <code>luminance2</code> program takes parameters of the form <code>results-$i.json $i $chunk</code> where <code>$i</code> is the starting point for the chunk, and <code>$chunk</code> is the number of photos that you want to analyze per job. Here's a sample of what the final result should contain:
<p />
<pre class="file">
Transfer_Output_Files = results-0.json
Arguments = results-0.json 0 200
Queue 1

Transfer_Output_Files = results-200.json
Arguments = results-200.json 200 200
Queue 1

Transfer_Output_Files = results-400.json
Arguments = results-400.json 400 200
Queue 1

[...and so on]
</pre>
<p />
Once you have created the submit file, go ahead and submit it:
<pre class="screen">
$> condor_submit luminance.sub
</pre>
<p />
<h3><a name="Post_job_Analysis"></a> Post-job Analysis </h3>
After a few minutes, you should see a bunch of JSON files appear. We can make a HTML plot of our results with the <code>aggregate.sh</code> script:
<pre class="screen">
$> ./aggregate.sh >$HOME/stash/public/scatter.html
</pre>
<p />
You can view the results at <a href="http://stash.osgconnect.net/+your_username/scatter.html" target="_top">http://stash.osgconnect.net/+your_username/scatter.html</a> 
<p />
Compare to: <a href="http://stash.osgconnect.net/+lincolnb/scatter.html" target="_top">http://stash.osgconnect.net/+lincolnb/scatter.html</a>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Run_under_Connect_Client"></a> Run under Connect Client </span></h2>
<p />
Try to adapt a regular condor workflow to run under Connect Client.  The client is already installed on <code>osg-ss-submit.chtc.wisc.edu</code>. You will simply need to:
<p />
<pre class="screen">
$> <strong>module load connect-client</strong>
$> <strong>connect setup <em>your-osg-connect-username</em></strong>
$> <strong>connect test</strong>
$> <strong>tutorial quickstart</strong>
$> <strong>cd tutorial-quickstart</strong>
$> <strong>connect submit tutorial01.sub</strong>
$> <strong>connect watch</strong>
....
$> <strong>connect pull</strong>
</pre>
<p />
<p />
-- <a href="/bin/view/Main/DavidChampion" class="twikiLink">DavidChampion</a> - 28 Jul 2015</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/OSGUserSchool2015" class="twikiLink">OSGUserSchool2015</a> &gt; <a href="/bin/view/Education/UserSchool15Materials" class="twikiLink">UserSchool15Materials</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>UserSchool15Tue41Connect</span> <br />    
Topic revision: r4 - 19 Jul 2016 - 14:40:22 - <a href="/bin/view/Main/LaurenMichael" class="twikiLink">LaurenMichael</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />