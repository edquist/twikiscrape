---+ Getting a Certificate 

---++ 1.0 Introduction

We&#39;d like you to get a certificate on your own time before Tuesday morning. For now, we&#39;re asking you to walk through this process without much explanation of the background. We want you to have the certificate ready to use, and various aspects will be explained as needed throughout the school. 

Your certificate (really, your combination of a public certificate and private key) are needed for security purposes. They are used to uniquely identify you when you access computing or storage resources in Open Science Grid. 

Your certificate is based on the underlying Public Key Infrastructure ([[http://en.wikipedia.org/wiki/Public_key_infrastructure][background from Wikipedia]]). 

---++ 2.0 Getting your certificate

---+++ 2.1 If you already have a certificate from DOEGrids

If you already have a certificate from DOEGrids, email the DN to Scot Kronenfeld, kronenfe@cs.wisc.edu. 

---+++ 2.2 If you don&#39;t have a certificate

If you don&#39;t already have a certificate from DOEGrids (and this is probably most of you.)

_Step 1:_ Log into =osg-ss-glidein.chtc.wisc.edu=. You should have been provided with the user name and password when you arrived at the school. Let us know if you cannot log in.

_Step 2:_ Run the following =cert-request= command, changing the text in red:
&lt;pre style=&quot;margin-left:4em&quot; class=&quot;screen&quot;&gt;
&gt; cert-request -ou p -agree \
     -name %RED% &quot;Firstname Lastname&quot;%ENDCOLOR% \
     -email %RED%your@email.address%ENDCOLOR%  \
     -phone %RED%123456789%ENDCOLOR% \
     -reason &quot;Student at Africa Grid School 2012&quot; \
     -affiliation osg \
     -vo OSGEDU \
     -sponsor_name &quot;Scot Kronenfeld&quot; -sponsor_email kronenfe@cs.wisc.edu -sponsor_phone 6082650774  \
     -label certrequest 
&lt;/pre&gt;

_Step 3:_ You&#39;ll be prompted for a password (a.k.a PEM pass prhase). Use a good one and don&#39;t forget it. Also, look at the output. Notice that there is a serial number in it. Tell Scot what the serial number is.
&lt;pre style=&quot;margin-left:4em&quot; class=&quot;screen&quot;&gt;
checking CertLib version, V2-7,  This is the latest version, released 18 May 2009.
Processing OU=People request.
you will be  prompted for a passphrase to encyrpt the private key that is being generated.
Generating a 2048 bit RSA private key
................+++
.......................................+++
writing new private key to &#39;/home/roy/.globus/certrequestkey.pem&#39;
Enter PEM pass phrase: %RED%Type a good password here %ENDCOLOR%
Verifying - Enter PEM pass phrase:
-----
osg
OSG
OSG:OSGEDU

Your Certificate Request has been successfully submitted
Your Certificate Request id: %RED%99999%ENDCOLOR%

	You will receive a notification email from the CA when your certificate
	has been issued. Please disregard the instructions to download your
	certificate though a web browser and use the cert-retrieve script instead.
&lt;/pre&gt;

_Step 4:_ Once Scot tells you that you&#39;ve gotten a certificate, you can download it with the =cert-retrieve= script. You&#39;ll get an automated email, and it will contain a _certificate serial number_. Change the serial number (in red) to match the serial number in the email. It is *not* the same as the certificate request id above.
&lt;pre style=&quot;margin-left:4em&quot; class=&quot;screen&quot;&gt;
&gt; cert-retrieve -serialnum %RED%99999%ENDCOLOR% \
     -label certrequest \
     -p12 mycert.p12
checking CertLib version, V2-7,  This is the latest version, released 18 May 2009.
 using CA doegrids
Using URL https://pki1.doegrids.org/displayBySerial?op=displayBySerial&amp;serialNumber=0xdff5
Checking that the certificate and /home/roy/.globus/certrequestkey.pem match
Enter pass phrase for /home/roy/.globus/certrequestkey.pem:
writing RSA key
/home/roy/.globus/usercert.pem and /home/roy/.globus/userkey.pem now contain your new credential
Generating PKCS12 file
Enter pass phrase for /home/roy/.globus/userkey.pem:
Enter Export Password:
Verifying - Enter Export Password:
Your PKCS12 file mycert.p12 credential with your certificate and
private key was generated.  For information on how to import it
into your favorite browser or email application
  Google  import certificate &lt;application name&gt;
and you will get lots of examples.
&lt;/pre&gt;

_Step 5:_ Try out your new certificate:
&lt;pre style=&quot;margin-left:4em&quot; class=&quot;screen&quot;&gt;
% voms-proxy-init -voms osgedu
Enter GRID pass phrase:
Your identity: /DC=org/DC=doegrids/OU=People/CN=Alain Roy 424511
Creating temporary proxy ...................................................... Done
Contacting  voms.grid.iu.edu:15003 [/DC=org/DC=doegrids/OU=Services/CN=http/voms.grid.iu.edu] &quot;osgedu&quot; Done
Creating proxy ......................................................................... Done

Your proxy is valid until Sun Jun 24 00:24:21 2012
&lt;/pre&gt;

---++ 3.0 Converting .p12 to .pem

To convert a single =.p12= file into two =.pem= files:

&lt;pre style=&quot;margin-left:4em&quot; class=&quot;screen&quot;&gt;
openssl pkcs12 -in &lt;em&gt;cert&lt;/em&gt;.p12 -clcerts -nokeys -out $HOME/.globus/usercert.pem
openssl pkcs12 -in &lt;em&gt;cert&lt;/em&gt;.p12 -nocerts -out $HOME/.globus/userkey.pem
&lt;/pre&gt;
