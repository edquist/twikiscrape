<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> OSGSS2012CondorR &lt; Education/ASP2016 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/ASP2016/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/ASP2016/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/ASP2016/OSGSS2012CondorR?_T=16 Feb 2017" type="application/x-wiki" title="edit OSGSS2012CondorR" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/ASP2016/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/ASP2016/OSGSS2012CondorR"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TWISTYPLUGIN_TWISTY--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.css");
</style>
<script type='text/javascript' src='https://twiki.opensciencegrid.org/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js'></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiPref.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.compressed.js"></script>
<script type="text/javascript">
// <![CDATA[
var styleText = '<style type="text/css" media="all">.twikiMakeVisible{display:inline;}.twikiMakeVisibleInline{display:inline;}.twikiMakeVisibleBlock{display:block;}.twikiMakeHidden{display:none;}</style>';
document.write(styleText);
// ]]>
</script>

<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Running_a_job_with_R"></a> Running a job with R </h1>
<p />
<div style="margin-left: 1em; margin-right: 1em; border: 1px solid black; padding: 0.5em;">
<h3><a name="Objective_of_this_exercise"></a> Objective of this exercise </h3>
The objective of this exercise is to learn how to run a program that depends on a larger run-time environment that isn't already available on your cluster.
</div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="The_Problem"></a> The Problem </span></h2>
<p />
Sometimes you want to run a program that depends on a larger run-time environment. For example, perhaps you wrote your program in Perl, but there is no Perl installed on the cluster. (That's an unlikely example, intended just to give you feel for what I mean by "run-time environment".) This is a common problem distributed computing users encounter. For example, many people like to use <a href="http://www.mathworks.com/" target="_top">Matlab</a> (or it's open-source cousin, <a href="http://www.gnu.org/software/octave/" target="_top">Octave</a>) or <a href="http://www.r-project.org/" target="_top">R</a> for doing calculations. These require a fair amount of run-time environment to run the programs you write. What do you do if they aren't installed?
<p />
There are at least two possibilities:
<p /> <ol>
<li> Ask your kindly system administrator to install it for you on all of the computers you might run on. 
</li> <li> Bring the environment (Such as Octave or R) along with your job. 
</li></ol> 
<p />
Before you read any further, please step for a moment, and think about the tradeoffs between these two methodologies. They both have benefits and drawbacks. Why would you choose each of them? Why not? 
<p />
Here are some of my answers... <div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2012CondorR1show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show Alain's answers...</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2012CondorR1hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2012CondorR1toggle" class="twistyContent twikiMakeHidden twistyInited">
<p />
<div style="margin-left: 1em; margin-right: 1em; border: 1px solid black; padding: 0.5em;">
<h3><a name="Pros_and_cons_of_having_your_sys"></a> Pros and cons of having your system administrator do it for you </h3>
<p /> <ul>
<li> It's a lot easier for you.
</li> <li> You have to transfer less data with each job.
</li> <li> You have to wait for the system administrator to install them.
</li> <li> If you want upgrades (or downgrades), you have to ask again and wait for them.
</li></ul> 
<p />
<h3><a name="Pros_and_cons_of_bringing_it_alo"></a> Pros and cons of bringing it along </h3> <ul>
<li> It's more complex for you.
</li> <li> You have to transfer the application and data with each job (or have a job that pre-stages it for you.)
</li> <li> You are in complete control: when you need a tweak, an upgrade, or a downgrade, you can make it happen.
</li></ul> 
</div>
</div></div> <!--/twistyPlugin-->
<p />
Clearly, there is a choice here. I'd like to enable you to be able to bring along your run-time environment with you. In my experience, if you are capable of bringing it with you, you can take advantage of more computers: you don't have to wait for someone to build and install the environment for you. 
<p />
We'd like to demonstrate how to install one run-time environment called <a href="http://www.r-project.org/" target="_top">R</a>. Don't worry if you have no experience with it: neither do I. It's a package for doing math and statistics and it lets you write programs in the R language. (Actually, it's the S language. Who chose names like this that are hard to Google?) We've built a minimal version of R that won't do graphical output, which makes it much less interesting, but it's good enough for our purposes.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Setup"></a> Setup </span></h2>
<p />
I've provided you with R as a tarball. You can find it in /opt/r.tar.gz:
<p />
<pre style="margin-left:4em" class="screen">
% ls -lh /opt/r.tar.gz
-rw-r--r-- 1 root root 33M Jun 20 18:32 /opt/r.tar.gz
</pre>
<p />
It's only 33 megabytes! That's not so much. 
<p />
You'll need an R program. After hours of <strike>combing the internet</strike> coding, I present to you my first R program. Save it in a file called demo.r:
<p />
<pre style="margin-left:4em" class="screen">
len <- 100
fibvals <- numeric(len)
fibvals[1] <- 1
fibvals[2] <- 1
for (i in 3:len) { 
   fibvals[i] <- fibvals[i-1]+fibvals[i-2]
} 
print("First 100 Fibonacci numbers:")
for (i in 1:len) { 
    print(fibvals[i], digits = 21)
}
print("Number of possible combinations of cards in a 52 card deck:")
comb <- factorial(52)
print(comb, digits = 21)

library(lattice)
library(ggplot2)
data(Oats, package = "MEMSS")
tp1.oats <- xyplot(yield ~ nitro | Variety + Block, data = Oats, type = "o")
print(tp1.oats)
</pre>
<p />
This program prints the first 100 <a href="http://en.wikipedia.org/wiki/Fibonacci_number" target="_top">Fibonacci numbers</a>. These are the numbers that show up in the weirdest places, like pineapples and sunflowers. It's a sequence of numbers beginning with 0, 1, 1, 2, 3, 5, 8... where each successive number is the sum of the previous two numbers. It also prints 52 factorial, which is the number of possible combinations of a standard 52-card deck (not including the jokers, of course). Why would Alain find this number particularly interesting? Hmmm... 
<p />
Finally, it makes a very scientific looking plot as a PDF file named <code>Rplots.pdf</code>. <a href="http://learnr.wordpress.com/2009/06/29/ggplot2-version-of-figures-in-lattice-multivariate-data-visualization-with-r-part-2/" target="_top">source</a>
<p />
R is a bit fussy about where it's been installed on disk, so I had to write a wrapper program so it will happily run wherever it lands in our cluster. I could make you work it out, but that seems unfair. Save this program in run-r.sh. If you're curious about exactly why it's needed, ask Alain. There are two important parts to it, and you should know what they are, at least conceptually because this is the magic you would need to do for any run-time environment you want to bring along.
<p /> <ol>
<li> Unpack the R environment. In our case, this is just running the <code>tar</code> command to extract R. In general you might have to do more work. 
</li> <li> Invoke R, using whatever magic is needed. In our case, I set up some environment variables and invoke the right executable.
</li></ol> 
<p />
<pre style="margin-left:4em" class="screen">
#!/bin/sh -x

if [ $# -ne 1 ]; then
    echo "Usage: run-r <r-script>"
    exit 1
fi

# Step 1: Unpack our environment, the R tarball.
tar xzf r.tar.gz

# Step 2, Invoke R with the proper environment
export LD_LIBRARY_PATH=`pwd`/r/lib64/R/lib
export R_HOME=`pwd`/r/lib64/R
r/lib64/R/bin/exec/R --slave --vanilla < $1
</pre>
<p />
If you were on the execute machine, you could run this easily: just make sure that r.tar.gz and demo.r are in the same directory, and run:
<p />
<pre style="margin-left:4em" class="screen">
./run-r.sh demo.r
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_your_own"></a> On your own </span></h2>
Write a Condor submit file that will use R to run the demo.r program. Make sure you get back the output. Make sure you transfer the tarball and the program. 
<p />
To see the resulting graphic, do the following
<p /> <ol>
<li> Make a subdirectory in your home directory called <code>public_html</code>
</li> <li> Copy Rplots.pdf into it. 
</li> <li> Edit the following URL to have your username, then look at it in your web browser. <code>http://osg-ss-submit.chtc.wisc.edu/~<font color="#ff0000">USER</font>/Rplots.pdf</code>
</li></ol> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="The_answer"></a> The answer </span></h2>
<p />
This should be easy for you now, but if it's not, here's the answer, just in case it's hard.
<p />
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2012CondorR2show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show the answers...</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2012CondorR2hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2012CondorR2toggle" class="twistyContent twikiMakeHidden twistyInited">
<p />
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2012CondorR3show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Really show the answer...</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2012CondorR3hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2012CondorR3toggle" class="twistyContent twikiMakeHidden twistyInited">
<p />
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2012CondorR4show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Really really show the answer...</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2012CondorR4hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2012CondorR4toggle" class="twistyContent twikiMakeHidden twistyInited">
<p />
<pre style="margin-left:4em" class="screen">
Universe             = vanilla
Executable           = run-r.sh
Arguments            = demo.r
Output               = r.out
Error                = r.error
Log                  = r.log
transfer_input_files = /opt/r.tar.gz, demo.r
ShouldTransferFiles  = Yes
WhenToTransferOutput = ON_EXIT
queue 
</pre>
<p />
</div></div> <!--/twistyPlugin-->
</div></div> <!--/twistyPlugin-->
</div></div> <!--/twistyPlugin--></div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education/ASP2016<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/ASP2016/OSGUserSchool2012" class="twikiLink">OSGUserSchool2012</a> &gt; <a href="/bin/view/Education/ASP2016/UserSchool12Materials" class="twikiLink">UserSchool12Materials</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>OSGSS2012CondorR</span> <br />    
Topic revision: r5 - 25 Jun 2012 - 20:24:05 - <a href="/bin/view/Main/DerekWeitzel" class="twikiLink">DerekWeitzel</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />