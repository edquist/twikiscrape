<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> AGWWorkflowExercises &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/AGWWorkflowExercises?_T=16 Feb 2017" type="application/x-wiki" title="edit AGWWorkflowExercises" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/AGWWorkflowExercises"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> 
<p />
<h1><a name="Tutorial_Grid_Workflow"></a>  Tutorial: Grid Workflow </h1>
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#A_simple_DAG"> A simple DAG</a>
</li> <li> <a href="?cover=print#Dependencies_in_a_DAG"> Dependencies in a DAG</a>
</li> <li> <a href="?cover=print#An_FMRI_application_in_DAGman"> An FMRI application in DAGman</a> <ul>
<li> <a href="?cover=print#Exercise_Process_an_input_pair_o"> Exercise: Process an input pair on the command line</a>
</li> <li> <a href="?cover=print#Exercise_Process_an_input_pair_u"> Exercise: Process an input pair using Condor</a>
</li> <li> <a href="?cover=print#Exercise_Submit_files_for_each_j"> Exercise: Submit files for each job</a> <ul>
<li> <a href="?cover=print#softmean"> softmean</a>
</li> <li> <a href="?cover=print#slicer"> slicer</a>
</li> <li> <a href="?cover=print#convert"> convert</a>
</li></ul> 
</li> <li> <a href="?cover=print#Build_a_dag_file"> Build a .dag file</a>
</li> <li> <a href="?cover=print#Run_your_DAG"> Run your DAG</a>
</li></ul> 
</li></ul> 
</div>
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="A_simple_DAG"></a> A simple DAG </span></h2>
<p />
First, we will make a simple one-node dag.
<p />
First make a simple condor submission file:
<p />
<p />
<pre class="screen">
$ <userinput>cat &gt; myjob.submit
executable=/bin/echo
arguments=hello world
output=results.output
error=results.error
log=results.log
notification=never
universe=vanilla
queue
<em>Ctrl+D</em></userinput>
</pre>
<p />
and a simple DAG file:
<p />
<pre class="screen">
$ <userinput>cat &gt; mydag.dag
Job HelloWorld myjob.submit
<em>Ctrl+D</em></userinput>
$ <userinput>cat mydag.dag</userinput>
Job HelloWorld myjob.submit
</pre>
<p />
This DAG file defines a single job.
<p />
We can run the DAG like this:
<p />
<pre class="screen">
condor_submit_dag mydag.dag
</pre>
<p />
and then you can watch your dag execute with:
<p />
<pre class="screen">
condor_q -dag
</pre>
<p />
There will be one condor job for the dag, and then another condor job for the Hello World job.
<p />
When the DAG has run, you should see the output file:
<p />
<pre class="screen">
$ <userinput>cat results.output</userinput>
Hello World
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Dependencies_in_a_DAG"></a> Dependencies in a DAG </span></h2>
<p />
A DAG file can contain many jobs and information about which order to run the jobs.
<p />
Make two more submit files, job2.sub and job3.sub by copying mydag.dag and changing the "hello world" message and the
output=, error= and log= files to new names.
<p />
Then make a new DAG file like this:
<p />
<pre class="screen">
$ <userinput>cat &gt; mydag.dag
Job HelloWorld myjob.submit
Job SecondJob job2.sub
Job ThirdJob job3.sub
PARENT HelloWorld CHILD SecondJob
PARENT HelloWorld CHILD ThirdJob
<em>Ctrl+D</em></userinput>
</pre>
<p />
This means that HelloWorld must run before SecondJob and ThirdJob. But it does not matter which order SecondJob and ThirdJob execute.
<p />
Submit your dag:
<p />
<pre class="screen">
$ <userinput> condor_submit_dag mydag.dag </userinput>
</pre>
<p />
Now you can watch your jobs in the queue. <span class="twikiNewLink">HelloWorld<a href="/bin/edit/Education/HelloWorld?topicparent=Education.AGWWorkflowExercises" rel="nofollow" title="HelloWorld (this topic does not yet exist; you can create it)">?</a></span> should run first, then <span class="twikiNewLink">SecondJob<a href="/bin/edit/Education/SecondJob?topicparent=Education.AGWWorkflowExercises" rel="nofollow" title="SecondJob (this topic does not yet exist; you can create it)">?</a></span> and <span class="twikiNewLink">ThirdJob<a href="/bin/edit/Education/ThirdJob?topicparent=Education.AGWWorkflowExercises" rel="nofollow" title="ThirdJob (this topic does not yet exist; you can create it)">?</a></span>.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="An_FMRI_application_in_DAGman"></a> An FMRI application in DAGman </span></h2>
<p />
In the following exercises, we will implement the FMRI workflow shown in the presentation.
<p />
There are five applications:  <ul>
<li> align_warp
</li> <li> reslice
</li> <li> softmean
</li> <li> slicer
</li> <li> convert
</li></ul> 
<p />
There are ten input data files, in pairs: <ul>
<li> anatomy1.img anatomy1.hdr
</li> <li> anatomy2.img anatomy2.hdr
</li> <li> anatomy3.img anatomy3.hdr
</li> <li> anatomy4.img anatomy4.hdr
</li> <li> reference.img reference.hdr
</li></ul> 
<p /> <ol>
<li> Align each anatomy pair with the reference pair, using <code>align_warp</code>.
</li> <li> Slice the results using <code>reslice</code>, giving two output files per pair.
</li> <li> Average the files  into a single data file (<code>atlas.l</code>) using <code>softmean</code> 
</li></ol> 
<p />
<h3><a name="Exercise_Process_an_input_pair_o"></a> Exercise: Process an input pair on the command line </h3>
<p />
On the command line, process one pair of input files using align_warp:
<pre class="screen">
$ <userinput>align_warp reference.img anatomy1.img warp1.warp -m 12 -q </userinput>
</pre>
<p />
This will produce the output file <code>warp1.warp</code>.
<p />
<h3><a name="Exercise_Process_an_input_pair_u"></a> Exercise: Process an input pair using Condor </h3>
<p /> <ol>
<li> Write a condor <em>.sub</em> file named <code>align_warp2.sub</code> that will process <code>anatomy2.img</code> and output to <code>warp2.warp</code>
</li> <li> Use <code>condor_submit</code> to run the job.
</li> <li> Check that the file <code>warp2.warp</code> was created.
</li></ol> 
<p />
<h3><a name="Exercise_Submit_files_for_each_j"></a> Exercise: Submit files for each job </h3>
Now write <em>.sub</em> files for: <ul>
<li> <strong>align_warp</strong>: to run align_warp on the four input files <ul>
<li> <code>align_warp1.sub</code>
</li> <li> <code>align_warp2.sub</code>
</li> <li> <code>align_warp3.sub</code>
</li> <li> <code>align_warp4.sub</code>
</li></ul> 
</li> <li> <strong>reslice</strong>: these must run reslice and generate corresponding resliced files <ul>
<li> <code>reslice1.sub</code>
</li> <li> <code>reslice2.sub</code>
</li> <li> <code>reslice3.sub</code>
</li> <li> <code>reslice4.sub</code>
</li></ul> 
</li></ul> 
<p />
For example:
<pre class="screen">
$ <userinput>reslice warp1.warp resliced1.img </userinput>
</pre>
<p />
This will output two files, <code>resliced1.hdr</code> and <code>resliced1.img</code>.
<p />
<h4><a name="softmean"></a> softmean </h4>
softmean runs only once, to combine each reslice file into a brain atlas. Write a submit file called softmean.sub to run the following
<p />
<pre class="screen">
$ <userinput>softmean atlas.img y null resliced1.img resliced2.img resliced3.img resliced4.img </userinput>
</pre>
<p />
This will generate a output files (the brain atlas) called <code>atlas.img</code> and <code>atlas.hdr</code>.
<p />
<h4><a name="slicer"></a> slicer </h4>
slicer will slice the brain atlas in three different ways, to give a view of the brain from three different directions. The output images will be in pgm format.
<p />
Write three .sub files: <ul>
<li> <code>slicerx.sub</code>
</li> <li> <code>slicery.sub</code>
</li> <li> <code>slicerz.sub</code>
</li></ul> 
<p />
Here is a commandline for slicerx.sub:
<p />
<pre class="screen">
$ <userinput>slicer atlas.img -x .5 atlas-x.pgm </userinput>
</pre>
<p />
<h4><a name="convert"></a> convert </h4>
Finally, you need to convert the PGM images into GIF format for viewing. Make three .sub files to convert the pgm images. Here is an example command line:
<p />
<pre class="screen">
$ <userinput>convert atlas-x.pgm atlas-x.gif </userinput>
</pre>
<p />
Now you should have 15 submit files.
<p />
<h3><a name="Build_a_dag_file"></a> Build a .dag file </h3>
<p />
Now write a DAGman .dag file that tells DAGman about each of the 15 dag files. You must make sure the jobs are executed in the correct order by specifying PARENT and CHILD relationships.
<p />
<h3><a name="Run_your_DAG"></a> Run your DAG </h3>
<p />
<pre class="screen">
$ <userinput>condor_submit_dag fmri.dag </userinput>
</pre>
<p />
You can use condor_q to see if your jobs are running. When your DAG is finished, you should see the following files in your working directory: <ul>
<li> <code>atlas-x.gif</code>
</li> <li> <code>atlas-y.gif</code>
</li> <li> <code>atlas-z.gif</code>
</li></ul> </div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/GridWorkshops" class="twikiLink">GridWorkshops</a> &gt; <a href="/bin/view/Education/ArgentinaGridWorkshop" class="twikiLink">ArgentinaGridWorkshop</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>AGWWorkflowExercises</span> <br />    
Topic revision: r4 - 02 May 2007 - 15:56:59 - <span class="twikiNewLink">ForrestChristian<a href="/bin/edit/Education/ForrestChristian?topicparent=Education.AGWWorkflowExercises" rel="nofollow" title="ForrestChristian (this topic does not yet exist; you can create it)">?</a></span>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />