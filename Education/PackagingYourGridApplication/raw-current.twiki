%LINKCSS%

---+!! Packaging Your Grid Application

%TOC%

%STARTINCLUDE%
%EDITTHIS%

We will use [[http://physics.bu.edu/pacman/][pacman]] (Package Manager) for this part of the exercise. It&#39;s a handy packaging tool that has many useful features including fetching, installing and updating software packages with simple commands.


&lt;a name=&quot;download&quot; /&gt;
---+++ Download and Install Pacman
&lt;pre class=&quot;screen&quot;&gt;
[%LOGINNAME%@%LOGINHOST% ~]$ &lt;userinput&gt;wget http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-latest.tar.gz&lt;/userinput&gt;
--13:51:27--  http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-latest.tar.gz
           =&amp;gt; `pacman-latest.tar.gz&#39;
Resolving physics.bu.edu... done.
Connecting to physics.bu.edu[128.197.41.42]:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 77,154 [application/x-gzip]
                                                                                
100%[====================================&amp;gt;] 77,154       159.97K/s    ETA 00:00
                                                                                
13:51:28 (159.97 KB/s) - `pacman-latest.tar.gz&#39; saved [77154/77154]

[%LOGINNAME%@%LOGINHOST% ~]$ &lt;userinput&gt;tar zxvf pacman-latest.tar.gz&lt;/userinput&gt;
pacman-3.18.4/
pacman-3.18.4/caches_starter
pacman-3.18.4/CVS/
pacman-3.18.4/CVS/Entries
pacman-3.18.4/CVS/Repository
pacman-3.18.4/CVS/Root
pacman-3.18.4/doc/
.
.
.

[%LOGINNAME%@%LOGINHOST% pacman-3.18.4]$ &lt;userinput&gt;cd pacman-3.18.4/&lt;/userinput&gt;
[%LOGINNAME%@%LOGINHOST% pacman-3.18.4]$ &lt;userinput&gt;source setup.sh&lt;/userinput&gt;
[%LOGINNAME%@%LOGINHOST% ~]$ &lt;userinput&gt;pacman -version&lt;/userinput&gt;
Pacman version:  3.18.4
Python version:  2.2.2 (#1, Feb 24 2003, 19:13:11) 
[GCC 3.2.2 20030222 (Red Hat Linux 3.2.2-4)]
Your platform [RedHat-9] satisfies { *, linux, Linux, linux-redhat-8, linux-redhat-9, redhat, Redhat, RedHat, RedHat-6, Redhat-6, RedHat-7, Redhat-7, RedHat-8, Redhat-8, RedHat-9, Redhat-9, unix, Unix }
&lt;/pre&gt;

After these steps, pacman is ready to use. You can download the whole VDT package with a single command:

%WARNING% Do not start the installation now. Installing the VDT require a great deal of time. 
   
&lt;pre class=&quot;screen&quot;&gt;
[%LOGINNAME%@%LOGINHOST% ~]$ &lt;userinput&gt;pacman -get VDT:VDT&lt;/userinput&gt;
&lt;/pre&gt;

&lt;a name=&quot;caches&quot; /&gt;
---+++ Pacman caches
From pacman documentation:

&lt;blockquote&gt;

A Pacman cache is a just a URL or location in a local file system containing  files with the .pacman extension. Each such file defines how a package is  fetched, installed and set up.

&lt;/blockquote&gt;

---+++ Example pacman file

&lt;pre class=&quot;programlisting&quot;&gt;
description = &#39;Text Editor&#39;
url = &#39;http://www.nedit.org/&#39;
download = {&#39;*&#39;: &#39;nedit-5.1.1-linux-glibc.tar.gz&#39; }
paths = [[&#39;PATH&#39;,&#39;&#39;]]
&lt;/pre&gt; 

---+++ Exercise
In this part of the exercise, we will create a localcache and package our application with pacman. Then, we will install the application in a seperate directory using this cache.

Create a directory for the cache and temporary directory for installing your dprime application.

&lt;pre class=&quot;screen&quot;&gt;
[%LOGINNAME%@%LOGINHOST% ~]$ &lt;userinput&gt;mkdir localcache&lt;/userinput&gt;
[%LOGINNAME%@%LOGINHOST% ~]$ &lt;userinput&gt;mkdir installs&lt;/userinput&gt;
&lt;/pre&gt;

Create a directory for your application and copy =prime.c= to the directory:

&lt;pre class=&quot;screen&quot;&gt;
[%LOGINNAME%@%LOGINHOST% ~] &lt;userinput&gt;mkdir dprime&lt;/userinput&gt;
[%LOGINNAME%@%LOGINHOST% ~] &lt;userinput&gt;cp prime.c dprime&lt;/userinput&gt;
&lt;/pre&gt;

Create a Makefile in the application directory to compile your application. You can use the following Makefile. Copy it to the =dprime= directory.

&lt;pre class=&quot;programlisting&quot;&gt;
CC=gcc
EXES=prime
all: $(EXES)

prime: prime.c
   gcc -w -o $@ $&amp;lt;

clean:
   rm -f $(EXES)
&lt;/pre&gt;

%NOTE% Make sure that the spaces before =gcc= and =rm= in the above file are actually tabs!

Tar and gzip the files.

Copy the zipped file to =localcache= directory:

&lt;pre class=&quot;screen&quot;&gt;
[%LOGINNAME%@%LOGINHOST% ~]$ &lt;userinput&gt;tar zcvf dprime.tar.gz dprime/prime.c dprime/Makefile&lt;/userinput&gt;

[%LOGINNAME%@%LOGINHOST% ~]$ &lt;userinput&gt;mv dprime.tar.gz localcache/&lt;/userinput&gt;
[%LOGINNAME%@%LOGINHOST% ~]$ &lt;userinput&gt;cd localcache&lt;/userinput&gt;
[%LOGINNAME%@%LOGINHOST% localcache]$ 
&lt;/pre&gt;

Create a file named =dprime.pacman= in the localcache directory. The file should contain:

&lt;pre class=&quot;programlisting&quot;&gt;
# Descprtion of the package
description = &#39;Prime Number Finder&#39;
# What to download?
download    = {&#39;unix&#39; : &#39;dprime.tar.gz&#39;}
# How to install
install     = {&#39;*&#39;:[&#39;make&#39;]}
&lt;/pre&gt;

Go to =installs= directory and run pacman:

&lt;pre class=&quot;screen&quot;&gt;
[%LOGINNAME%@%LOGINHOST% localcache]$ &lt;userinput&gt;cd ../installs&lt;/userinput&gt;
[%LOGINNAME%@%LOGINHOST% installs]$ &lt;userinput&gt;pacman -get ../localcache:dprime&lt;/userinput&gt;

Do you want to add [../localcache] to [trusted.caches]? (y or n): y
Package [dprime] found in [../localcache]...
Downloading [dprime.tar.gz] from [localcache]...
Untarring [dprime.tar.gz]...
gcc -o prime prime.c 
&lt;/pre&gt;

&lt;!--
You can look the information about the packages using the following command
&lt;pre class=&quot;screen&quot;&gt;
&lt;b&gt;[%LOGINNAME%@%LOGINHOST% installs]$ pacman -info&lt;/b&gt;
&lt;/pre&gt;
&lt;img src=&quot;pacman-info.png&quot; /&gt;
&lt;p&gt;
--&gt;

You can make changes to the =dprime.pacman= file, maybe simply changing the description. Update the software with =pacman -update-check=.

&lt;pre class=&quot;screen&quot;&gt;
[%LOGINNAME%@%LOGINHOST% installs]$ &lt;userinput&gt;pacman -update-check&lt;/userinput&gt;
Package [dprime] found in [../localcache]...
Update of [../localcache:dprime] found...

[%LOGINNAME%@%LOGINHOST% installs]$ &lt;userinput&gt;pacman -l&lt;/userinput&gt;
[*] dprime, in cache [/home/%LOGINNAME%/test-lab6/installs] ==&gt; UPDATE AVAILABLE 

[%LOGINNAME%@%LOGINHOST% installs]$ &lt;userinput&gt;pacman -d src ups 0 -l&lt;/userinput&gt;
.
.
[%LOGINNAME%@%LOGINHOST% installs]$ &lt;userinput&gt;pacman -update&lt;/userinput&gt;
&lt;/pre&gt;

&lt;!-- ***  Comments plugin to create comments table for section   ***    --&gt;

&lt;span class=&quot;educationWebAddComment&quot;&gt;ADD A COMMENT&lt;/span&gt;
%STARTMore%

%TABLE{ }%
|  *COMMENT*  |  *NAME*  |  *DATE*  |
%COMMENT{ type=&quot;tableappend&quot; }%

%ENDMore%
&lt;!-- ***  End Comment                                    ***********    --&gt;




%STOPINCLUDE%
&lt;!--                                                                            
      * Set LOGINHOST = workshop1.lac.uic.edu
      * Set LOGINIP = 131.193.181.56
      * Set GRIDHOST = tg-login.sdsc.teragrid.org
      * Set OTHERHOST = workshop2.lac.uic.edu
      * Set CERTSUBJECT = /O=Grid/OU=OSG/CN=Training User 99
      * Set LOGINNAME = train99
      * Set HOMEDIR = /home/%LOGINNAME%
--&gt; 


%BOTTOMMATTER% 

-- Main.ForrestChrisitan - 2007 Jan 28: pulled from original %BR% 
-- Main.ForrestChristian - 24 Mar 2007 - Added VARIABLES   %BR%
