---+ Thursday Exercise 1.3: Try an OSG Connect Software Module
%TOC% 

In this exercise, you&#39;ll repeat a previous job using the Gromacs software, but using the OSG Connect software module for Gromacs instead of bringing a pre-packaged installation along with the job.

---++ Setup

   * Make sure you are logged into =login.osgconnect.net=
   * Navigate to your =stash= directory within the home directory, and create a directory for this exercise named =thur-gromacs-module=.
   * Copy the contents of your directory for Exercise 1.3 from yesterday into the directory. These need to include the submit file, run_gromacs.sh wrapper script, and gromacs input files. (You won&#39;t actually need the =gromacs.tar.gz= file, since you&#39;ll rely on the OSG Connect module for the Gromacs software.)

---++ Practice Loading the Gromacs Module on OSG Connect

Before proceeding, make sure to read over the OSG Connect helpdesk guide on [[https://support.opensciencegrid.org/support/solutions/articles/5000634394-accessing-software-using-distributed-environment-modules][Accessing Software using Distributed Environment Modules]].

1. Run the =module avail= command to see available modules and determine which =gromacs= version will be the default (designated by a =(D)=). Is this the same version of Gromacs used in yesterday&#39;s Exercise 3.1?

2. Before loading the =gromacs= module, check your &quot;PATH&quot; variable with:

&lt;pre class=&quot;screen&quot;&gt;
%UCL_PROMPT_SHORT% &lt;strong&gt;echo $PATH&lt;/strong&gt;
&lt;/pre&gt;

3. Now load the =gromacs= module, which will give you the default version, and check your list of modules:

&lt;pre class=&quot;screen&quot;&gt;
%UCL_PROMPT_SHORT% &lt;strong&gt;module load gromacs&lt;/strong&gt;
%UCL_PROMPT_SHORT% &lt;strong&gt;module list&lt;/strong&gt;
&lt;/pre&gt;

4. Recheck your &quot;PATH&quot; variable. What has changed? Is the default version of =gromacs= visible?

5. When you&#39;re done, unload the module and check that you no longer have the module loaded:

&lt;pre class=&quot;screen&quot;&gt;
%UCL_PROMPT_SHORT% &lt;strong&gt;module unload gromacs&lt;/strong&gt;
%UCL_PROMPT_SHORT% &lt;strong&gt;module list&lt;/strong&gt;
%UCL_PROMPT_SHORT% &lt;strong&gt;echo $PATH&lt;/strong&gt;
&lt;/pre&gt;

---++ Modify the Submit and Wrapper Files

Now, you&#39;ll prepare the job files to rely on the =gromacs= module.

1. In the submit file, remove the =gromacs.tar.gz= file from the list of =transfer_input_files=, add your project name, and add the line necessary for using the OSG Connect modules:

&lt;pre class=&quot;file&quot;&gt;
+ProjectName = &quot;UserSchool2016&quot;
requirements = (HAS_MODULES =?= true)
&lt;/pre&gt;

2. In the =run_gromacs.sh= file, replace the =tar= and =export= commands with the below, since you&#39;ll be relying on the OSG Connect module to set up the =gromacs= software and environment variables. The first command will engage the module capabilities so that the second command can load the appropriate =gromacs= module. In the job, you&#39;ll generally want to be specific about which =gromacs= module version you want, so that even if the default changes, you&#39;ll always know for sure which version was used!

&lt;pre class=&quot;file&quot;&gt;
. /cvmfs/oasis.opensciencegrid.org/osg/modules/lmod/current/init/bash
module load gromacs/5.0.0
&lt;/pre&gt;

---++ Submit the Job

After you&#39;ve made the above changes, submit the job and monitor it so you can later check the output against the output from yesterday&#39;s Exercise 1.3. The job may take a while, so once you&#39;ve confirmed that it&#39;s been running a few minutes (in which case, it should be running correctly!), you can move on with the next step.

---++ Software Modules from Anywhere!

Now copy the entire =thur-gromacs-module= directory to =osg-learn.chtc.wisc.edu= and resubmit the job, again, after removing the &quot;+ProjectName&quot; line from the submit file. (You don&#39;t _have_ to submit from =login.osgconnect.net= in order to use OSG Connect modules!)

---++ Compare Results
Were the results of this new Gromacs job (regardless of where you submitted) the same as for yesterday&#39;s Exercise 1.3? If they&#39;re different, why might they be?

-- Main.LaurenMichael - 25 Jul 2016
