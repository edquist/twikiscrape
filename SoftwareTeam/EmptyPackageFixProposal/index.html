<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> EmptyPackageFixProposal &lt; SoftwareTeam &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/SoftwareTeam/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/SoftwareTeam/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/SoftwareTeam/EmptyPackageFixProposal?_T=16 Feb 2017" type="application/x-wiki" title="edit EmptyPackageFixProposal" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/SoftwareTeam/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/SoftwareTeam/EmptyPackageFixProposal"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#DDDDDD;
	}
	.patternBookView {
		border-color:#DDDDDD;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Design_Doc_for_Fixing_empty_Pack"></a> Design Doc for Fixing empty-* Packages </h1>
<p />
Main ticket: <a href="https://jira.opensciencegrid.org/browse/SOFTWARE-1237" target="_top">SOFTWARE-1237</a>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Rationale"></a> Rationale </span></h2>
<p />
We have several packages in our repos called empty-*; examples are empty-condor and empty-ca-certs.
These packages are intended for users that want to install their own versions of components to satisfy certain dependencies.
(These versions may be from tarballs or other non-RPM-based distribution mechanisms;
RPM does not know about components installed this way, and so does not believe that the dependencies are satisfied.
The empty-* packages do nothing but claim to provide these dependencies).
<p />
If multiple packages satisfy (or claim to satisfy) a dependency, the YUM dependency solver (depsolver) goes through a set of heuristics to pick one.
These heuristics prefer the empty-* packages over "real" packages.
(The depsolver's heuristics try to minimize the number of additional dependencies a package brings in,
and the empty-* packages do not have dependencies of their own).
<p />
This is undesired behavior:
when a typical user installs <code>osg-ce-condor</code>, they expect to end up with Condor installed;
but the empty-condor package gets installed instead, violating their expectations.
Furthermore, replacing <code>empty-condor</code> with <code>condor</code> requires the user to either uninstall packages that depend on condor, or use yum magic.
<p />
Installing the real Condor should be the default behavior.
A user shouldn't get <code>empty-condor</code> unless they ask for it.
<p />
There is no good way to influence the depsolver to pick <code>condor</code> over <code>empty-condor</code> by default.
The only way to get this behavior is to hide the empty-* packages from yum,
and provide a user the ability to explicitly unhide them.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="New_Proposal"></a> New Proposal </span></h2>
<p />
We will create new repositories and move the empty-* packages into them.
<p />
<h3><a name="Koji_Build_Infrastructure_Change"></a> Koji / Build Infrastructure Changes </h3>
<p />
We'll need to make the following koji tags:
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/SoftwareTeam/EmptyPackageFixProposal?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Repository</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1 twikiLastCol"> <a rel="nofollow" href="/bin/view/SoftwareTeam/EmptyPackageFixProposal?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Koji Tag</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" rowspan="2" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> osg-empty </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> osg-3.2-el5-empty </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> osg-3.2-el6-empty </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<h3><a name="Package_Changes"></a> Package Changes </h3>
<p />
We will create a new repo definition file called <code>osg-empty.repo</code> that contains a repo called <code>osg-empty</code>.
It will point to the URLs for the new repos we create, and will be disabled by default.
<p />
<h3><a name="Initial_Deployment"></a> Initial Deployment </h3>
<p />
Before release day, we can tag (or rebuild) the empty packages for the new osg-3.2-el*-empty repos.
<p />
Also before release day, the mash scripts need to be updated to recognize the -empty repos.  This is a minor change to <code>map-osg-tags.pl</code>.  The updated script can be first tested on repo-itb, then pushed to repo1/repo2.
<p />
On release day, we will remove the empty packages from the 3.2 release tags.
<p />
<h3><a name="Update_Deployment"></a> Update Deployment </h3>
<p />
We will update our documentation on how to cut releases to mention
For any release in which we update one of the empty-* packages, we will have to explicitly mention in the release notes that said update is only available if the user enables an osg-empty repo.
<p />
<h3><a name="Documentation_Changes"></a> Documentation Changes </h3>
<p />
Our documentation states that to install a CE with Condor, the user must install the <code>condor</code> package first and then <code>osg-ce-condor</code>.
We will remove the requirement to install <code>condor</code> first.
Our documentation states that if a user has their own non-RPM condor install and they wish to install a CE with Condor, they must install <code>empty-condor</code> first and then <code>osg-ce-condor</code>.
We will change the line from saying "yum install empty-condor" to "yum install --enablerepo=osg-empty empty-condor".
We will make similar changes for documentation relating to the other empty-* packages.
We will not need to say anything about *.rpmnew files.
<p />
<h3><a name="Effect_on_Users"></a> Effect on Users </h3>
<p />
None of these changes will affect empty-* packages that are already installed.
Unless they enable the one of the empty repos, users will not be able to install or update any of the empty-* packages.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Old_Proposal"></a> Old Proposal </span></h2>
<p />
To hide a package but let users unhide it if they wish to, we can put the packages in a separate repository.
However, creating a separate repository for only the four empty-* packages we have is overkill --
it would involve creating new koji tags, updating mash scripts to mirror them on repo.grid.iu.edu and adjusting mirror scripts (which might have to be propagated to mirror sites as well).
Therefore, it is better to "fake" the creation of a new repo by using yum includes/excludes.
<p />
<h3><a name="Package_Changes_AN1"></a> Package Changes </h3>
<p />
We would modify our existing repo definition files (in the osg-release and osg-release-itb packages) to add the following line to each repo definition:
<pre>exclude=empty-*</pre>
This keeps the empty-* packages from showing up in those repos.
We will create a new repo definition file called <code>osg-empty.repo</code> that contains three repos called <code>osg-empty</code>, <code>osg-testing-empty</code>, and <code>osg-development-empty</code>.
They will point to the same URLs as the non-empty repos they correspond to (<code>osg</code>, <code>osg-testing</code>, and <code>osg-development</code>), but with two differences:
they will be disabled by default, and they will have the following line:
<pre>includepkg=empty-*</pre>
That line causes yum to <em>only</em> consider the empty-* packages from those repos.
<p />
<h3><a name="Documentation_Changes_AN1"></a> Documentation Changes </h3>
<p />
Our documentation states that to install a CE with Condor, the user must install the <code>condor</code> package first and then <code>osg-ce-condor</code>.
We will remove the requirement to install <code>condor</code> first.
Our documentation states that if a user has their own non-RPM condor install and they wish to install a CE with Condor, they must install <code>empty-condor</code> first and then <code>osg-ce-condor</code>.
We will change the line from saying "yum install empty-condor" to "yum install --enablerepo=osg-empty empty-condor".
We will make similar changes for documentation relating to the other empty-* packages.
We will add a line stating that post-install, the user should look for *.rpmnew files in <code>/etc/yum.repos.d</code> and merge them if they exist (for reasons described below).
<p />
<h3><a name="Effect_on_Users_AN1"></a> Effect on Users </h3>
<p />
None of these changes will affect empty-* packages that are already installed.
<p />
If the user has customized one of their OSG .repo files (to enable or disable them, for example), they will not pick up the new change to that .repo file.
This means that the repo that file references will still contain the empty-* packages.
The osg-empty repos will still exist, but will not conflict with the main repos.
Therefore, the user will not notice any difference.
<p />
Any .repo file that the user has not modified will get the changes.
Likewise, users making fresh installs will get the changes.
These users will be unable to install or upgrade empty-* packages without explicitly enabling one of the osg-empty repos.
<p />
Updates to empty-* packages are rare but not unknown.
(The latest update to an empty-* package was to empty-condor in August 2013.
The other empty-* packages have not been updated since May 2012, when they were merely bumped to rebuild with new %dist tags).
<p />
<h3><a name="Release_Announcement_Changes"></a> Release Announcement Changes </h3>
<p />
For any release in which we update one of the empty-* packages, we will have to explicitly mention that said update is only available if the user enables an osg-empty repo.
For any release in which we update osg-release, we will tell users to be on the lookout for *.rpmnew files in <code>/etc/yum.repos.d</code> and merge them if they exist.</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: SoftwareTeam<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/SoftwareTeam/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a> &gt; <a href="/bin/view/SoftwareTeam/InternalDocs" class="twikiLink">InternalDocs</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>EmptyPackageFixProposal</span> <br />    
Topic revision: r5 - 09 Dec 2013 - 23:09:53 - <a href="/bin/view/Main/CarlEdquist" class="twikiLink">CarlEdquist</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />