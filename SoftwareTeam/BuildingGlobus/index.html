<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> BuildingGlobus &lt; SoftwareTeam &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/SoftwareTeam/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/SoftwareTeam/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/SoftwareTeam/BuildingGlobus?_T=16 Feb 2017" type="application/x-wiki" title="edit BuildingGlobus" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/SoftwareTeam/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/SoftwareTeam/BuildingGlobus"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#DDDDDD;
	}
	.patternBookView {
		border-color:#DDDDDD;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> %LINKCSS%
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Building_Globus"> Building Globus</a> <ul>
<li> <a href="?cover=print#Finding_dependencies"> Finding dependencies</a>
</li> <li> <a href="?cover=print#Note_1_Fulfilling_build_prereqs"> Note 1: Fulfilling build prereqs</a>
</li> <li> <a href="?cover=print#Note_2_Rebuilding_packages_that"> Note 2: Rebuilding packages that depend on Globus</a>
</li> <li> <a href="?cover=print#Notes_for_specific_packages"> Notes for specific packages:</a> <ul>
<li> <a href="?cover=print#CGSI_gSOAP"> CGSI-gSOAP</a>
</li> <li> <a href="?cover=print#dcap_tunnel_gsi"> dcap-tunnel-gsi</a>
</li> <li> <a href="?cover=print#globus_gridmap_callout_error"> globus-gridmap-callout-error</a>
</li> <li> <a href="?cover=print#gratia_probe"> gratia-probe</a>
</li> <li> <a href="?cover=print#voms"> voms</a>
</li> <li> <a href="?cover=print#java_errors"> java errors</a>
</li></ul> 
</li></ul> 
</li></ul> 
</div>
<p />
<h1><a name="Building_Globus"></a> Building Globus </h1>
<p />
These are notes meant for the Software Team. 
<p />
In September 2011, we added Globus 5.2 to the VDT. Unfortunately, it is not a drop-in replacement for Globus 5.0 from EPEL. Due to changes in how threading was implemented, Globus shared libraries versions were incremented. (Globus maintained source code compatibility, so it's just a matter of rebuilding software that depends on Globus.) We hope that this will propagate neatly into EPEL, but until it does, we have done two things:
<p /> <ol>
<li> Adding Globus 5.2 to our repository and rebuilt all software we ship that depends on Globus. 
</li> <li> Copied packages from EPEL that we use that depend on Globus into our repository, and rebuilt them against Globus 5.2. 
</li></ol> 
<p />
A couple of notes from Matyas Selmeci, who did this work are below. These are mostly copied from <a href="https://jira.opensciencegrid.org/browse/SOFTWARE-200" target="_top">JIRA SOFTWARE-200</a>.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Finding_dependencies"></a> Finding dependencies </span></h2>
<p />
A quick and dirty shell script to find packages that depend on Globus (run this inside a yum repository):
<pre>
for i in `ls *.rpm | grep -vP '^globus|grid-packaging'`; do
  yum -q deplist $i | grep -Psq 'globus|grid-packaging' && \
    rpm -qp $i --queryformat '%{sourcerpm}\n'
done|sort|uniq
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Note_1_Fulfilling_build_prereqs"></a> Note 1: Fulfilling build prereqs </span></h2>
<p />
The following packages had to be retagged into el5-gt52b to fulfill build prereqs:
<p /> <ul>
<li> glite-data-build
</li> <li> glite-data-transfer-interface
</li> <li> glite-service-discovery-api-c
</li> <li> glite-service-discovery-build-common-cpp
</li> <li> gridsite
</li> <li> lcmaps-plugins-basic
</li> <li> lcmaps-plugins-glexec-tracking
</li> <li> lcmaps-plugins-gums-client
</li> <li> lcmaps-plugins-saz-client
</li> <li> lcmaps-plugins-scas-client
</li> <li> lcmaps-plugins-verify-proxy
</li> <li> saml2-xacml2-c-lib
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Note_2_Rebuilding_packages_that"></a> Note 2: Rebuilding packages that depend on Globus </span></h2>
<p />
The following packages needed to be rebuilt: (arrows point from dependencies)
<p /> <ul>
<li> CGSI-gSOAP * &lt;- voms
</li> <li> condor
</li> <li> dcache-srmclient
</li> <li> dcap-tunnel-gsi *
</li> <li> edg-gridftp-client
</li> <li> gfal &lt;- CGSI-gSOAP, lfc-client (part of lcgdm), voms
</li> <li> glite-build-common-cpp
</li> <li> glite-data-delegation-api-c &lt;- glite-security-delegation-interface, glite-data-build, CGSI-gSOAP
</li> <li> glite-data-delegation-cli &lt;- glite-data-delegation-api-c, glite-data-util-c-devel
</li> <li> glite-data-util-c &lt;- glite-service-discovery-api-c, glite-service-discovery-build-common-cpp, gridsite
</li> <li> glite-fts-client &lt;- glite-build-common-cpp, glite-data-delegation-cli-devel, glite-data-transfer-interface
</li> <li> glite-security-delegation-interface
</li> <li> globus-gridmap-callout-error *
</li> <li> gratia-probe *
</li> <li> lcas
</li> <li> lcas-lcmaps-gt4-interface &lt;- lcmaps-plugins-*, globus-gridmap-callout-error, saml2-xacml2-c-lib
</li> <li> lcas-plugins-basic &lt;- lcas
</li> <li> lcg-utils &lt;- CGSI-gSOAP, gfal, voms
</li> <li> lcgdm &lt;- voms, CGSI-gSOAP
</li> <li> lcmaps
</li> <li> myproxy &lt;- voms
</li> <li> uberftp
</li> <li> voms *
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Notes_for_specific_packages"></a> Notes for specific packages: </span></h2>
<p />
<h3><a name="CGSI_gSOAP"></a> CGSI-gSOAP </h3>
<p />
needed to import this one so I could bump it
<p />
<h3><a name="dcap_tunnel_gsi"></a> dcap-tunnel-gsi </h3>
<p />
needed to import this one so I could bump it
<p />
<h3><a name="globus_gridmap_callout_error"></a> globus-gridmap-callout-error </h3>
<p />
Had to import this one from EPEL.
Got a 'flavor gcc64pthr has not been installed' error from configure. Fixed that in spec file.
<p />
Next error I got was this:
<p />
<pre class="screen">
 + /usr/share/globus/globus-gpt2pkg-config pkgdata/pkg_data_gcc64_dev.gpt
 /var/tmp/rpm-tmp.95712: line 47: /usr/share/globus/globus-gpt2pkg-config: No such file or directory
</pre>
<p />
that file is found only in epel's package of globus-core-5.17-3.el5, not in any of our packages (both old and new). I haven't found anything comparable in our globus-core, either.
<p />
Got a new globus-gridmap-callout-error srpm from Joe Bester by email. (globus-gridmap-callout-error-1.1-1.src.rpm)
Passed it through (no osg dir)
<p />
<h3><a name="gratia_probe"></a> gratia-probe </h3>
<p />
this needed to be imported, and I don't really know where the original RPM comes from.
<p />
TODO add a README file
<p />
<h3><a name="voms"></a> voms </h3>
<p />
globus_thread_h.patch
<p />
The error:
<pre class="screen">
    ../../src/include/gssapi_compat.h:76: error: conflicting declaration 'typedef int globus_mutex_t'
    /usr/include/globus/globus_thread.h:117: error: 'globus_mutex_t' has a previous declaration as 'typedef union globus_mutex_t globus_mutex_t'
</pre>
The typedef in gssapi_compat.h is surrounded by an ifdef, and the name of the macro being tested had changed in 5.2. Created a patch against the ifdef.
<p />
N.B.: there are two src/include/gssapi_compat.h files, one for the compat version (1.9.19.2) and one for the new version.
<p />
TODO patch should be sent upstream
<p />
<h3><a name="java_errors"></a> java errors </h3>
<p />
The errors followed this general pattern:
<p />
<pre class="screen">
    Foo.java: cannot access Bar
    bad class file: Bar.class
    class file contains wrong class: (some completely unrelated class)
    Please remove or make sure it appears in the correct subdirectory of the classpath.
</pre>
The problem was due to parallel make ( <code>make %{?_smp_mflags}</code> ). Replaced all of those with make -j1 in the spec file.
<p />
Note when bumping voms that there are two macros, <code>%release1</code> and <code>%release2</code>. One of these is used for the compat version, one for the current. Both have to be bumped.</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: SoftwareTeam<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/SoftwareTeam/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a> &gt; <a href="/bin/view/SoftwareTeam/InternalDocs" class="twikiLink">InternalDocs</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>BuildingGlobus</span> <br />    
Topic revision: r3 - 04 Oct 2011 - 20:00:57 - <span class="twikiNewLink">AlainRoy<a href="/bin/edit/SoftwareTeam/AlainRoy?topicparent=SoftwareTeam.BuildingGlobus" rel="nofollow" title="AlainRoy (this topic does not yet exist; you can create it)">?</a></span>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />