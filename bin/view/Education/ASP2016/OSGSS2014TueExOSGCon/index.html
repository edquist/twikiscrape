<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> OSGSS2014TueExOSGCon &lt; Education/ASP2016 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/ASP2016/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/ASP2016/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/ASP2016/OSGSS2014TueExOSGCon?_T=16 Feb 2017" type="application/x-wiki" title="edit OSGSS2014TueExOSGCon" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/ASP2016/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/ASP2016/OSGSS2014TueExOSGCon"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TWISTYPLUGIN_TWISTY--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.css");
</style>
<script type='text/javascript' src='https://twiki.opensciencegrid.org/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js'></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiPref.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.compressed.js"></script>
<script type="text/javascript">
// <![CDATA[
var styleText = '<style type="text/css" media="all">.twikiMakeVisible{display:inline;}.twikiMakeVisibleInline{display:inline;}.twikiMakeVisibleBlock{display:block;}.twikiMakeHidden{display:none;}</style>';
document.write(styleText);
// ]]>
</script>

<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="OSG_Connect_Exercise"></a> OSG Connect Exercise </h1>
<p />
<div style="margin-left: 1em; margin-right: 1em; border: 1px solid black; padding: 0.5em;">
<h3><a name="Objective_of_this_exercise"></a> Objective of this exercise </h3>
Learn to submit jobs through OSG Connect, optionally use OSG OASIS.
</div>
<p />
For this exercise, we thought it might be interesting to analyze a set of images from the University of Chicago Photographic Archive (<a href="http://photoarchive.lib.uchicago.edu/" target="_top">http://photoarchive.lib.uchicago.edu/</a>). Our motivation is that it's a common claim that older photographs look much darker than recent ones. With our job, we'll analyze the luminance of photographs in the archive and compare that to the date of the photograph. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Signing_up_for_OSG_Connect"></a> Signing up for OSG Connect </span></h2>
Hopefully you've already signed up for OSG Connect, if not please visit this page: <a href="/bin/view/Education/ASP2016/UserSchool14Connect" class="twikiLink">UserSchool14Connect</a>
<p />
Once you've signed up, SSH to <code>login.osgconnect.net</code> with the username and password you created. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Getting_the_data_and_software"></a> Getting the data and software. </span></h2>
We've conveniently made the tutorial data and software available to you by simply typing <code>tutorial userschool2014</code>. It should create a directory with the necessary files at <code>~/osg-userschool2014</code>.
<p />
The input dataset is a file called <code>manifest.txt</code>. This file contains a list of JPEG images stored on our Stash server and the date of each image.
<p />
The <code>luminance</code> python script does most of the heavy lifting for us, but in order to our analysis we must first decompess the JPEG images. To take care of that, we've provided a version of the <code>djpeg</code> tool that you can send along with your jobs. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Determining_the_job_requirements"></a> Determining the job requirements. </span></h2>
The subset of the archive that we want to analyze is about 5600 files, and the task is pleasingly parallel.
<p />
How long should the job run for? If our job runs too long, then we might be preempted and kicked off of opportunistic resources. If our jobs are too short, then we add a lot of unnecessary overhead and load on the scheduler. Let's find out how long a single image takes to analyze:
<p />
<pre>./luminance 0 1 < manifest.txt</pre>
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2014TueExOSGCon1show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show output</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2014TueExOSGCon1hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide output</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2014TueExOSGCon1toggle" class="twistyContent twikiMakeHidden twistyInited">
<pre class="screen">
[lincolnb@login01 osg-userschool2014]$ ./luminance 0 1 < manifest.txt
/* Running on host: login01.osgconnect.net */
[1880, 0.525493],
/* 1 photos analyzed in 1.11s (1.11/s) */
</pre>
</div></div> <!--/twistyPlugin-->
<p />
Notice that <code>luminance</code> takes two arguments. The first argument is the line in the file where you want to start processing, and the second argument is where you want to end processing (noninclusive).  I choose to do about 200 images per job. This way they're long enough to see them run via <code>condor_q</code>, but not so long that we have to wait around forever to move on with the exercise. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Creating_the_submit_file"></a> Creating the submit file </span></h2>
If we have 5600 files, chunked into 200 files per job, we'll need to create about 28 different jobs. Remember that <code>luminance</code> takes input as chunks of the file, so our submit file will look something like this:
<pre>
Universe = vanilla

Error = log/job.error.$(Cluster)-$(Process)
Output = log/job.output.$(Cluster)-$(Process)
Log = job.log.$(Cluster)

Executable = luminance
Input = manifest.txt
Transfer_input_files = djpeg

Arguments = 0 200
Queue

Arguments = 200 400
Queue

(and so on and so on)
</pre> 
<p />
You're free to copy and paste to create the submit file -- but why not write it via script? Try writing a script to generate your submit file that creates the queue and arguments lines via a loop.
<p />
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2014TueExOSGCon2show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">You may use my solution if you get stuck</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2014TueExOSGCon2hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide output</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2014TueExOSGCon2toggle" class="twistyContent twikiMakeHidden twistyInited">
<pre class="screen">
#!/bin/sh

cat <<'EOF'
Universe = vanilla

Error = log/job.error.$(Cluster)-$(Process)
Output = log/job.output.$(Cluster)-$(Process)
Log = job.log.$(Cluster)

Executable = luminance
Input = manifest.txt
Transfer_input_files = djpeg
EOF

# We have about 5600 photos to analyze. Block them off by 200s and
# submit enough jobs to handle.
chunk=${1-200}
max=${2-5600}

i=0
while [ $i -lt $max ]; do
	echo Arguments = $i $chunk
	echo Queue 1
	echo
	i=$(($i + $chunk))
done
</pre>
</div></div> <!--/twistyPlugin-->
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Post_processing_the_output"></a> Post-processing the output </span></h2>
<p />
When we wrote this example, we already had a pretty good idea of how we wanted to visualize the results -- you may have noticed that the output format of the job is JSON (Javascript Object Notation) with comments. This lets us simply concatinate the output files together, embed them in an HTML page, and view the output with Google Charts. 
<p />
We've provided two files to help you accomplish this, "scatter_pre.html" and "scatter_post.html". These contain all of the HTML boilerplate to visualize the output. You can join all of the files together like so:
<p />
<pre>cat scatter_pre.html log/job.output.* scatter_post.html > scatter.html</pre>
<p />
To view the output, you can move scatter.html to your public HTML area (~/public) and view it from the web (<a href="http://stash.osgconnect.net/+YOURUSERNAMEHERE/scatter.html" target="_top">http://stash.osgconnect.net/+YOURUSERNAMEHERE/scatter.html</a>) or transfer the resulting HTML file back to your laptop via Globus Connect Personal (see below)
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Globus_transfer_optional"></a> Globus transfer (optional) </span></h2>
You can get Globus Connect Personal from here: <a href="https://www.globus.org/globus-connect-personal" target="_top">https://www.globus.org/globus-connect-personal</a>
<p />
Once you've installed Globus Connect Personal, you can start a transfer here: <a href="https://portal.osgconnect.net/xfer/StartTransfer" target="_top">https://portal.osgconnect.net/xfer/StartTransfer</a>
<p />
One endpoint will be your laptop, as configured in the Globus Connect Personal installation; the other endpoint will be called "osgconnect#stash". 
<p />
You should be able to transfer the "scatter.html" file to your laptop and view it locally. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Challenge_Rewrite_the_job_to_use"></a> Challenge - Rewrite the job to use djpeg from OASIS </span></h2>
If you have time, try rewriting the exercise such that your HTCondor job loads the <code>djpeg</code> program from OASIS. Some hints: <ol>
<li> Write a wrapper script that loads the 'module' tool as in the lecture.
</li> <li> Load the tool via <code>module load jpeg</code>
</li> <li> Edit line 78 of the <code>luminance</code> program to be <code>tmpfp = os.popen('djpeg &gt;tmp.x', 'w')</code>
</li> <li> Change the HTCondor submit file to contain the following:
</li></ol> 
<pre>
Executable = wrapper.sh
Transfer_input_files = luminance, manifest.txt
Requirements = HAS_CVMFS_oasis_opensciencegrid_org =?= True
</pre>
<p />
-- <a href="/bin/view/Main/LincolnBryant" class="twikiLink">LincolnBryant</a> - 05 Jul 2014</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education/ASP2016<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>OSGSS2014TueExOSGCon</span> <br />    
Topic revision: r5 - 08 Jul 2014 - 17:23:25 - <a href="/bin/view/Main/LincolnBryant" class="twikiLink">LincolnBryant</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />