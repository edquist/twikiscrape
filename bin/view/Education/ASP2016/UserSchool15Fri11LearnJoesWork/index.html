<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> UserSchool15Fri11LearnJoesWork &lt; Education/ASP2016 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/ASP2016/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/ASP2016/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/ASP2016/UserSchool15Fri11LearnJoesWork?_T=16 Feb 2017" type="application/x-wiki" title="edit UserSchool15Fri11LearnJoesWork" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/ASP2016/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/ASP2016/UserSchool15Fri11LearnJoesWork"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <style type="text/css">
pre em { font-style: normal; background-color: yellow; }
pre strong { font-style: normal; font-weight: bold; color: #008; }
</style>
<p />
<h1><a name="Friday_Exercise_1_1_Learn_about"></a> Friday Exercise 1.1: Learn about Joe's Desired Computing Work </h1>
<p />
Joe Biologist studies the influence of genetic differences (genotypes) on the growth traits (phenotypes) of a common crop. Joe has come to you with some computing work he’d like to automate as a workflow, so that he can scale out his research and run it on a much larger HTC compute system. He has used HTCondor to manually submit individual jobs (never used a DAG), but has only run jobs on a smaller, dedicated HTCondor cluster where he doesn’t have to request CPU, disk, or RAM, and he’s not familiar with DAGman. He's getting annoyed by how many manual job submissions and summary scripts he has to run, especially as he's thinking of scaling out his work in a way that would be much more cumbersome - so he's asking you to help him organize all the steps into an optimized DAG workflow. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="After_asking_Joe_many_questions"></a> After asking Joe many questions, you realize the following things: </span></h2>
<p />
<strong>A) Joe starts with a file called <code>input.csv</code> that was made on his desktop.</strong> When you open this file in excel, Joe shows you that each row corresponds to an individual plant. For each individual, the first three columns are phenotype measurements for each of three different growth <em>traits</em> (T240, T300, T360), and the remaining columns contain the genotype (A or B) of that individual across multiple genes (columns).
<p />
<strong>B) At present, Joe does the following manual steps (for each of the three traits!)</strong> to achieve a meaningful result from the data in <code>input.csv</code>: <ul>
<li> 1. Joe first submits a job that calculates a large number of hypothetical permutations of phenotype-genotype combinations for the trait.
</li> <li> 2. Joe then runs a script for each trait, to create a gzipped tar file of the results of the <em>permutation</em> job to be used in the next "QTL mapping" job.
</li> <li> 3. Joe submits a second job for each trait, which performs a <em>QTL mapping</em> calculation to determine which genes were most important for the phenotype, relative to other possible genes exemplified in the random permutations.
</li> <li> 4. As a final step for each trait, Joe runs a script that creates a gzipped tar file of all of the <em>permutation</em> and <em>QTL mapping</em> data, so that he can take it back to his desktop computer for final processing.
</li></ul> 
<p />
<strong>C) Joe uses a special <em>wrapper</em> to run the <em>permutation</em> and <em>QTL mapping</em> calculations, which are otherwise written as R scripts.</strong> For each step this perl script, <code>runR.pl</code>, first installs R using files from Joe's proxy server and then sets up the R environment before running whatever R script has been indicated as an argument to <code>runR.pl</code>. Therefore, the <code>runR.pl</code> wrapper script is run as the HTCondor executable with the name of either R program indicated as an argument to the wrapper (along with arguments to the R program, itself).
<p />
<strong>D) The two tar steps are shell scripts simply containing a relevant <code>tar</code> command,</strong> and can be run on the submit server because they create little CPU load and finish very quickly.
<p />
<strong>E) When Joe has previously run all 10,000 permutations as one condor job, the job runs for hours on his own small cluster.</strong> He has cut the permutations of a single condor job up into multiple, shorter HTCondor processes of fewer permutations before, but he doesn’t remember the details how many jobs of how many total permutations worked well. Furthermore, Joe would like to scale up to <strong>100,000</strong> permutations per trait this time. Even with 10,000 permutations completed for each trait, the <em>QTL</em> step completes within several minutes.
<p />
<h3><a name="View_Joe_s_files"></a> View Joe's files </h3>
<strong>(but don't do anything with them until the next Exercise, where you'll plan necessary developments of a workflow for Joe.)</strong>
<p />
Log in to osg-ss-submit.chtc.wisc.edu and move to a desired location in your home directory. Enter the following commands to copy and decompress/untar Joe’s job ingredients, which Lauren has stored in her home directory.
<p />
<pre class="screen">
$> <strong>cp /home/lmichael/WorkflowExercise.tar.gz ./</strong>
$> <strong>tar xvzf WorkflowExercise.tar.gz</strong>
</pre>
<p />
You can now navigate into the <code>WorkflowExercise</code> directory to view the full ingredients for Joe’s Computing work. Review all of these files based upon the information below and refer back to it as you proceed through the remaining exercises (1.2-1.4).
<p />
<p />
<h3><a name="Joe_s_Job_Summaries"></a> Joe’s Job Summaries </h3>
<p />
Based upon Joe’s description and submit files you determine the following details for each step:
<p />
<h4><a name="Permutation_Step_explanation_for"></a> <strong>Permutation Step</strong> (explanation for <code>permutation1.submit</code>) </h4>
<p />
Execution: 	 <ul>
<li> <code>./runR.pl 1_$(Process) run_perm.R 1 $(Process) 10000</code>
</li></ul> 
<p />
Argument descriptions:	 <ul>
<li> <code>1_$(Process)</code>, used by <code>runR.pl</code> to name its log file
</li> <li> <code>1</code>, trait column in <code>input.csv</code> (i.e. this is 3 for permutation3.submit)
</li> <li> <code>$(Process)</code>,	used by <code>run_perm.R</code> for naming the permutation output
</li> <li> <code>10000</code>,	indicates that 10,000 permutations should be done for this single job process
</li></ul> 
<p />
input: 		 <ul>
<li> <code>run_perm.R</code>, <code>input.csv</code>, <code>RLIBS.tar.gz</code>
</li></ul> 
<p />
 output: 	 <ul>
<li> <code>runR.1_0.out</code>, log file for <code>runR.pl</code>, where "1_0" is from arg
</li> <li> <code>perm_part.1_0.Rdat</code>, output from <code>run_perm.R</code>, "1" and "0" are from args
</li></ul> 
<p />
<strong>Note:</strong> <code>tarit.sh</code> is run after each trait's Permutation step (with the column number as an argument) to compress <code>perm_part.1_0.Rdat</code> (or potentially multiple such files named according to "perm_part.1_*.Rdat") for the QTL step. Execution: <code>tarit.sh 1</code>, where "1" is the trait column number.
<p />
<h4><a name="QTL_Mapping_Step_explanation_for"></a> <strong>QTL Mapping Step</strong> (explanation for <code>qtl1.submit</code>) </h4>
<p />
execution:	 <ul>
<li> <code>./runR.pl qtl_1 qtl.R 1</code>
</li></ul> 
<p />
arg descriptions:	 <ul>
<li> <code>qtl_1</code>, used by <code>runR.pl</code> to name its log file
</li> <li> <code>1</code>, trait column in <code>input.csv</code>
</li></ul> 
<p />
input:  <ul>
<li> <code>qtl.R</code>, <code>input.csv</code>, <code>RLIBS.tar.gz</code>, <code>perm_combined.tar.gz</code> (created by <code>tarit.sh</code>)
</li></ul> 
<p />
output:	 <ul>
<li> <code>runR.qtl_1.out</code>, log file for <code>runR.pl</code>, where "qtl_1" is from arg
</li> <li> <code>perm_combined_1.Rdat</code>, <code>perm_summary_1.txt</code>, <code>sim_geno_results_1.Rdat</code>, <code>qtl_1.Rdat</code>,	<code>refined_qtl_summary_1.txt</code>, <code>refined qtl_1.Rdat</code>, and <code>fit_qtl_results_1.Rdat</code>,  where "1" is from <code>qtl.R</code> arg
</li></ul> 
<p />
<strong>Note:</strong> <code>results_1.tar.gz</code> is made by running <code>taritall.sh</code> (with the column number as an argument) after the QTL step for each trait finishes, where "1" reflects the trait column number in the output above. Execution: <code>taritall.sh 1</code>, where "1" is the trait column number.
<p />
<p />
<p />
-- <a href="/bin/view/Main/LaurenMichael" class="twikiLink">LaurenMichael</a> - 27 Jul 2015</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education/ASP2016<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/ASP2016/OSGUserSchool2015" class="twikiLink">OSGUserSchool2015</a> &gt; <a href="/bin/view/Education/ASP2016/UserSchool15Materials" class="twikiLink">UserSchool15Materials</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>UserSchool15Fri11LearnJoesWork</span> <br />    
Topic revision: r7 - 31 Jul 2015 - 10:44:31 - <a href="/bin/view/Main/LaurenMichael" class="twikiLink">LaurenMichael</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />