<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> UserSchool13Mon21Queue &lt; Education/ASP2016 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/ASP2016/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/ASP2016/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/ASP2016/UserSchool13Mon21Queue?_T=16 Feb 2017" type="application/x-wiki" title="edit UserSchool13Mon21Queue" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/ASP2016/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/ASP2016/UserSchool13Mon21Queue"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <style type="text/css">
pre em { font-style: normal; background-color: yellow; }
pre strong { font-style: normal; font-weight: bold; color: #008; }
</style>
<p />
<h1><a name="Monday_Exercise_2_1_Explore_cond"></a> Monday Exercise 2.1: Explore condor_q </h1>
<p />
The goal of this exercise is try out some of the most common options to the <code>condor_q</code> command, so that you can view jobs effectively.
<p />
The main part of this exercise should take just a few minutes, but if you have more time later, come back and work on the extension ideas at the end to become a <code>condor_q</code> expert!
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Selecting_Jobs"></a> Selecting Jobs </span></h2>
<p />
The <code>condor_q</code> program has many options for selecting which jobs are listed. You have already seen that you filter the list to show only one user’s jobs:
<p />
<pre class="screen">
$> <strong>condor_q <em>userid</em></strong>
</pre>
<p />
<strong>Note:</strong> You can name more than one user on the command line, in which case jobs for <strong>all</strong> of the named users are listed.
<p />
There are two other, simple selection criteria that you can use. To list just the jobs associated with a single cluster number:
<p />
<pre class="screen">
$> <strong>condor_q <em>cluster</em></strong>
</pre>
<p />
For example, if you want to see the jobs in cluster 5678 (i.e., <code>5678.0</code>, <code>5678.1</code>, etc.), you use <code>condor_q 5678</code>.
<p />
To list a specific job ID (i.e., cluster <strong>and</strong> process):
<p />
<pre class="screen">
$> <strong>condor_q <em>job-id</em></strong>
</pre>
<p />
For example, to see job ID 5678.1, you use <code>condor_q 5678.1</code>.
<p />
<strong>Note:</strong> You can name more than one cluster, job ID, or combination thereof on the command line, in which case jobs for <strong>all</strong> of the named clusters and/or job IDs are listed.
<p />
Let’s get some practice using <code>condor_q</code> selections!
<p /> <ol>
<li> Using a previous exercise, submit several <code>sleep</code> jobs
</li> <li> List all jobs in the queue — are there others besides your own?
</li> <li> Practice using all forms of <code>condor_q</code> that you have learned: <ul>
<li> List just your jobs
</li> <li> List a specific cluster
</li> <li> List a specific job ID
</li> <li> Try listing several (but not all) users’ jobs at once
</li> <li> Try listing several clusters and job IDs at once
</li></ul> 
</li> <li> When there are a variety of jobs in the queue, try combining a user ID and a cluster or job ID in the same command — what happens?
</li></ol> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Viewing_a_Job_ClassAd"></a> Viewing a Job ClassAd </span></h2>
<p />
You may have wondered why it is useful to be able to list a single job ID using <code>condor_q</code>. By itself, it may not be that useful. But, in combination with another option, it is very useful!
<p />
If you add the <code>-long</code> option to <code>condor_q</code> (or its short form, <code>-l</code>), it will show the complete ClassAd for each selected job, instead of the one-line summary that you have seen so far. Because job ClassAds may have 80&ndash;90 attributes (or more!), it probably makes the most sense to show the ClassAd for a single job at a time. And you know how to show just one job! Here is what the command looks like:
<p />
<pre class="screen">
$> <strong>condor_q -long <em>job-id</em></strong>
</pre>
<p />
The output from this command is long and complex. Most of the attributes that HTCondor adds to a job are arcane and uninteresting for us now. But here are some examples of common, interesting attributes taken directly from <code>condor_q</code> output (except with some line breaks added to the <code>Requirements</code> attribute):
<p />
<pre class="file">
MyType = "Job"
Err = "sleep.err"
UserLog = "/home/cat/exercise-3/sleep.log"
JobUniverse = 5
Requirements = ( IsOSGSchoolSlot =?= true ) &&
        ( TARGET.Arch == "X86_64" ) &&
        ( TARGET.OpSys == "LINUX" ) &&
        ( TARGET.Disk >= RequestDisk ) &&
        ( TARGET.Memory >= RequestMemory ) &&
        ( TARGET.HasFileTransfer )
ClusterId = 2420
WhenToTransferOutput = "ON_EXIT"
Owner = "cat"
CondorVersion = "$CondorVersion: 8.0.0 May 29 2013 BuildID: 133173 $"
Out = "sleep.out"
Cmd = "/bin/sleep"
Arguments = "120"
</pre>
<p />
<strong>Note:</strong> Attributes are listed in no particular order and may change from time to time. Do not assume anything about the order of attributes in <code>condor_q</code> output.
<p />
See what you can find in a job ClassAd from your own job.
<p /> <ol>
<li> Using a previous exercise, submit a <code>sleep</code> job
</li> <li> Before the job executes, capture its ClassAd and save to a file:       <pre class="screen">$> <strong>condor_q -l <em>job-id</em> &gt; classad-1.txt</strong></pre>
</li> <li> After the job starts execution but before it finishes, capture its ClassAd again and save to a file:       <pre class="screen">$> <strong>condor_q -l <em>job-id</em> &gt; classad-2.txt</strong></pre>
</li></ol> 
<p />
Now examine each saved ClassAd file. Here are a few things to look for:
<p /> <ul>
<li> Can you find attributes that came from your submit file? (E.g., JobUniverse, Cmd, Arguments, Out, Err, UserLog, and so forth)
</li> <li> Can you find attributes that could have come from your submit file, but that HTCondor added for you? (E.g., Requirements)
</li> <li> How many of the following attributes can you guess the meaning of? <ul>
<li> DiskUsage
</li> <li> ImageSize
</li> <li> BytesSent
</li> <li> JobStartDate — what format is the value in? (Hint: The HTCondor developers are primarily trained in the Unix way of doing things.)
</li> <li> JobStatus
</li></ul> 
</li></ul> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Why_Is_My_Job_Not_Running"></a> Why Is My Job Not Running? </span></h2>
<p />
Sometimes, you submit a job and it just sits in the queue in Idle state, never running. It can be difficult to figure out why a job never matches and runs. Fortunately, HTCondor can give you some help.
<p />
To ask HTCondor why you job is not running, add the <code>-analyze</code> option to <code>condor_q</code> for the specific job. For example, for job ID 2423.0, the command is:
<p />
<pre class="screen">
$> <strong>condor_q -analyze <em>2423.0</em></strong>
</pre>
<p />
Of course, replace the job ID with your own.
<p />
Let’s submit a job that will never run and see what happens. Here is the submit file to use:
<p />
<pre class="file">
universe = vanilla
executable = /bin/hostname
output = norun.out
error = norun.err
log = norun.log
should_transfer_files = YES
when_to_transfer_output = ON_EXIT
request_memory = 2TB
queue
</pre>
<p />
(Do you see what I did?)
<p /> <ol>
<li> Save and submit this file
</li> <li> Run <code>condor_q -analyze</code> on the job ID
</li></ol> 
<p />
There is a lot of output, but a few items are worth highlighting. Here is a sample from my own job (with many lines left out):
<p />
<pre class="file">
-- Submitter: osg-ss-submit.chtc.wisc.edu : ....
...
---
2423.000:  Run analysis summary.  <em>Of 5616 machines,</em>
<em>   5616 are rejected by your job's requirements </em>
...
WARNING:  Be advised:
<em>   No resources matched request's constraints</em>

The Requirements expression for your job is:
...

Suggestions:

    Condition                         Machines Matched    Suggestion
    ---------                         ----------------    ----------
<em>1   ( TARGET.Memory >= 2097152 )      0                   MODIFY TO 16050</em>
2   ( target.IsOSGSchoolSlot is true )8                    
3   ( TARGET.Arch == "X86_64" )       5551                 
4   ( TARGET.OpSys == "LINUX" )       5602                 
5   ( TARGET.Disk >= 17 )             5616                 
6   ( TARGET.HasFileTransfer )        5616                 
</pre>
<p />
Toward the top, <code>condor_q</code> said that it considered 5616 “machines” (really, slots) and <strong>all</strong> 5616 of them were rejected by <strong>my job’s requirements</strong>. In other words, I am asking for something that is not available. But what?
<p />
The real clue comes from the breakdown of the Requirements expression, at the end of the output. Note the highlighted line: My job asked for <strong>2 terabytes</strong> of memory (2,097,152 MB) and <strong>no</strong> machines matched that part of the expression. Well, of course! 2 TB is a crazy amount of memory on today’s machines. And finally, note the suggestion: If I reduce my memory request to 16,060 MB (= 16 GB), there will be at least one slot in the pool that will match that expression.
<p />
The output from <code>condor_q -analyze</code> (and <code>condor_q -better-analyze</code>) may be helpful or it may not be, depending on your exact case. The example above was constructed so that it would be obvious what the problem was. But in many cases, this is a good place to start looking if you are having problems matching.
<p />
<strong>Bonus question:</strong> Note the <code>target.IsOSGSchoolSlot is true</code> part of the requirements and the fact that only 8 slots match? What is going on there? Any guesses?
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Formatting_Output_Optional"></a> Formatting Output (Optional) </span></h2>
<p />
By default, the <code>condor_q</code> lists jobs in the 8-column format that you learned about earlier and have seen many times. But, you can format the output any way that you like! This is a somewhat advanced feature, so you may wish to skip this exercise now and come back to it later.
<p />
For each attribute that you want to see in the list output, you provide a single <code>-format</code> option and its two arguments. Here is an example format option:
<p />
<pre class="screen">-format "..%s.." Owner</pre>
<p />
The first argument to a format option is the format string to apply to the attribute’s value. In this case, all of the dot characters are printed exactly as written, and the <code>%s</code> part is a placeholder for a <strong>S</strong>tring value. The attribute itself is named as the second argument. So this format option means to print a job owner name (e.g., <code>cat</code>) like this:
<p />
<pre class="file">..cat..</pre>
<p />
The syntax of the format strings are based on the C-language <code>printf</code> functions. For complete information about format strings, check the <code>condor_q</code> section of the HTCondor Manual, but here are the most common placeholders and their meanings:
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <code>%s</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> For strings, such as Owner </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> <code>%d</code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> For integers such as ClusterId </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <code>%f</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> For floating point numbers such as RemoteWallClockTime </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
Also, you will need to know the names of the attributes that you wish to display. Read the HTCondor Manual (Appendix A) for ClassAd attribute names, or just look through a job ClassAd for ideas.
<p />
<strong>Remember:</strong> Write one <code>-format</code> option with its 2 arguments for <strong>each</strong> attribute that you wish to display per job. Also, your format strings must include all extra whitespace, even the end-of-line newline (written <code>\n</code>).
<p />
Here is an example of a <code>condor_q</code> command with format options and some possible output:
<p />
<pre class="screen">
$> <strong>condor_q -format '%10s' Owner -format '%8d' ClusterId -format '  %s\n' Cmd</strong>
     moate    2418  /share/test.sh
       cat    2421  /bin/sleep
       cat    2422  /bin/sleep
</pre>
<p />
If you like, spend a few minutes now or later experimenting with <code>condor_q</code> formatting.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="References"></a> References </span></h2>
<p />
As suggested above, if you want to learn more about <code>condor_q</code>, you can do some reading:
<p /> <ul>
<li> Read the <code>condor_q</code> man page or HTCondor Manual section (same text) to learn about more options
</li> <li> Read about ClassAd attributes in Appendix A of the HTCondor Manual
</li></ul> </div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education/ASP2016<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/ASP2016/UserSchool13Materials" class="twikiLink">UserSchool13Materials</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>UserSchool13Mon21Queue</span> <br />    
Topic revision: r2 - 23 Jun 2013 - 02:08:40 - <a href="/bin/view/Main/TimCartwright" class="twikiLink">TimCartwright</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />