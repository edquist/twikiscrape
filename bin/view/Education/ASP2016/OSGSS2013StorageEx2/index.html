<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> OSGSS2013StorageEx2 &lt; Education/ASP2016 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/ASP2016/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/ASP2016/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/ASP2016/OSGSS2013StorageEx2?_T=16 Feb 2017" type="application/x-wiki" title="edit OSGSS2013StorageEx2" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/ASP2016/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/ASP2016/OSGSS2013StorageEx2"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TWISTYPLUGIN_TWISTY--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.css");
</style>
<script type='text/javascript' src='https://twiki.opensciencegrid.org/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js'></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiPref.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.compressed.js"></script>
<script type="text/javascript">
// <![CDATA[
var styleText = '<style type="text/css" media="all">.twikiMakeVisible{display:inline;}.twikiMakeVisibleInline{display:inline;}.twikiMakeVisibleBlock{display:block;}.twikiMakeHidden{display:none;}</style>';
document.write(styleText);
// ]]>
</script>

<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Data_Management_Exercises_Part_I"></a> Data Management Exercises (Part II) </h1>
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Introduction"> Introduction</a>
</li> <li> <a href="?cover=print#Customize_this_Document"> Customize this Document</a>
</li> <li> <a href="?cover=print#Exercises"> Exercises </a> <ul>
<li> <a href="?cover=print#Prerequisite"> Prerequisite </a>
</li> <li> <a href="?cover=print#Hands_on_with_SRM_and_GridFTP"> Hands-on with SRM and GridFTP</a> <ul>
<li> <a href="?cover=print#File_Movement_Upload"> File Movement: Upload</a>
</li> <li> <a href="?cover=print#File_Movement_Download"> File Movement: Download</a>
</li> <li> <a href="?cover=print#File_Movement_GridFTP"> File Movement: GridFTP</a>
</li> <li> <a href="?cover=print#List_Files"> List Files</a>
</li> <li> <a href="?cover=print#Remove_files"> Remove files</a>
</li> <li> <a href="?cover=print#On_your_own"> On your own</a>
</li></ul> 
</li> <li> <a href="?cover=print#Running_BLAST"> Running BLAST </a> <ul>
<li> <a href="?cover=print#Serving_files_from_a_single_SE"> Serving files from a single SE</a>
</li> <li> <a href="?cover=print#More_realistic_BLAST_jobs"> More realistic BLAST jobs</a>
</li> <li> <a href="?cover=print#Running_on_Several_SEs"> Running on Several SEs</a>
</li> <li> <a href="?cover=print#Extra_Credit_BLAST_Workflows"> Extra Credit: BLAST Workflows</a>
</li></ul> 
</li> <li> <a href="?cover=print#Extra_Credit_Storage_Discovery"> Extra Credit: Storage Discovery</a> <ul>
<li> <a href="?cover=print#On_your_own_AN1"> On your own</a>
</li></ul> 
</li></ul> 
</li></ul> 
</div>
<p />
<h1><a name="Introduction"></a> Introduction </h1>
In the second part of our exercises we will continue to work with BLAST application, now adding storage into the picture.
<p />
<h1><a name="Customize_this_Document"></a> Customize this Document </h1>
<p />
<!-- OSG Summer School 2011 Defaults <ul>
<li> Local VO= osgedu
</li> <li> Local UCL_HOST = osg-ss-submit
</li> <li> Local UCL_USER = user
</li> <li> Local UCL_DOMAIN = chtc.wisc.edu
</li> <li> Local GATEKEEPER = red.unl.edu
</li> <li> Local UCL_CWD= /home/user/dm_part_2
</li> <li> Local BATCH_SYSTEM = condor
</li> <li> Local REMOTE_ROOT = /mnt/hadoop/user
</li> <li> Local REMOTE_SRM = red-srm1.unl.edu:8443
</li> <li> Local REMOTE_GRIDFTP= red-gridftp.unl.edu
</li> <li> Local SURL = srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user
</li> <li> Local TURL= gsiftp://red-gridftp.unl.edu//mnt/hadoop/user
</li> <li> Local OSG_DATA=/osg/data
</li> <li> Local BLAST_DB_SUBMIT=/share/blast
</li> <li> Local VDT_LOCATION=/opt/osg-client
</li></ul> 
-->
<p />
<img width="16" alt="warning" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/warning.gif" height="16" border="0" /> <font color="#ff0000"> Please change your user name and click on the Customize button!</font>
<form action="/bin/view/Education/ASP2016/OSGSS2013StorageEx2">
<table>
  <tr>
    <td>
      <font color="#ff0000">Login Name</font>
    </td>
    <td>
      <input size=100 type="text" name="INPUT_USER" value="user"/>
    </td>
  </tr>
  <tr>
    <td>
      VO
    </td>
    <td>
      <input size=100 type="text" name="INPUT_VO" value="osgedu"/>
    </td>
  <tr>
    <td>
      Host Name
    </td>
    <td>
      <input size=100 type="text" name="INPUT_HOST" value="osg-ss-submit"/>
    </td>
  </tr>
  <tr>
    <td>
      Domain Name
    </td>
    <td>
      <input size=100 type="text" name="INPUT_DOMAIN" value="chtc.wisc.edu"/>
    </td>
  </tr>
<!-- <tr>
    <td>
      Exercise Path
    </td>
    <td>
      <input size=100 type="text" name="INPUT_CWD" value="/home/user/dm_part_2"/>
    </td>
  </tr>
-->
<!--  <tr>
    <td>
      Remote SE root directory
    </td>
    <td>
      <input size=100 type="text" name="INPUT_REMOTE_ROOT" value="/mnt/hadoop/user"/>
    </td>
  </tr> -->
  <tr>
    <td>
      SRM host endpoint
    </td>
    <td>
      <input size=100 type="text" name="INPUT_SRM" value="red-srm1.unl.edu:8443"/>
    </td>
  </tr>
  <tr>
    <td>
 GridFTP host endpoint
    </td>
    <td>
      <input size=100 type="text" name="INPUT_GRIDFTP" value="red-gridftp.unl.edu"/>
    </td>
  </tr>
  <tr>
    <td>
     &nbsp;
     <input type="submit" class="twikiSubmit" value="Customize" />
    </td>
  </tr>
</table>
</form>
<p />
<h1><a name="Exercises"></a> Exercises </h1>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Prerequisite"></a> Prerequisite </span></h2>
<p /> <ul>
<li> Login on submission node <pre class="screen">
ssh user@osg-ss-submit.chtc.wisc.edu
</pre>
</li></ul> 
<!--   * Initialize the OSG client environment <pre class="screen">
source /opt/osg-client/setup.sh
</pre>
--> <ul>
<li> Obtain proxy certificate, if you have not done so already <pre class="screen">
voms-proxy-init -voms osgedu:/osgedu
</pre>
</li> <li> Make a directory for this exercise<pre class="screen">
mkdir -p /home/user/dm_part_2
cd /home/user/dm_part_2
</pre>
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Hands_on_with_SRM_and_GridFTP"></a> Hands-on with SRM and GridFTP </span></h2>
<p />
As discussed in the lecture, the primary protocol for accessing storage on the OSG is SRM.  SRM is an XML-based protocol that provides users with the ability to: <ol>
<li> Invoke Unix-like metadata commands on the storage (ls, rm, mkdir).
</li> <li> Load-balance file transfers done via other "transfer" protocols.  The most common transfer protocol on the OSG is GridFTP.
</li> <li> Manage storage reservations.
</li></ol> 
<p />
<div style="margin-left: 1em; margin-right: 1em; background-color: #ffff66; border: 1px solid black; padding: 0.5em;">
Food for thought: GridFTP, being built on top of the venerable FTP protocol, also can invoke metadata commands.  Why is SRM necessary?
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx21show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show the answer!</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx21hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Ok, move on...</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2013StorageEx21toggle" class="twistyContent twikiMakeHidden twistyInited">
While GridFTP <strong>can</strong> perform metadata commands, SRM still retains some advantages: <ol>
<li> Ability to perform load-balancing, including across more common protocols such as HTTP.
</li> <li> Ability to queue some metadata commands.  Listing a directory, in particular, can cause heavy loads on the remote system if enough clients do it at once.  SRM has the ability to ask clients to back off and perform the request later.
</li> <li> GridFTP has no ability to manage space reservations.  This is used heavily by some VOs on grids that interoperate with the OSG, although it's not common in smaller OSG VOs.
</li></ol> 
</div></div> <!--/twistyPlugin-->
</div>
<p />
For the school, and in this exercise, you will utilize a suite of SRM clients called <code>lcg-utils</code>.  <code>lcg-utils</code> is a mature, multi-protocol package originally written for the LHC Computing Grid (LCG).  Because of this, all of the commands we will perform will have a few extra flags necessary to have the client work on OSG.
<p />
<h3><a name="File_Movement_Upload"></a> File Movement: Upload </h3>
We'll need the BLAST databases on the remote endpoint SE for our later exercises.  Let's copy them over.
<p />
Let's start with one file with <code>lcg-cp</code>.  <code>lcg-cp</code> has the following usage syntax:
<pre class="screen">
lcg-cp [OPTIONS] SOURCE_URL DEST_URL
</pre>
A local file has a URL starting with <code>file:/</code>, followed by the filename.  A SRM-based file has a URL of the following form:
<pre>
srm://$ENDPOINT/$URL_PREFIX?SFN=$FILENAME
</pre>
For our class, we'll use the following values: <ul>
<li> <code>ENDPOINT=red-srm1.unl.edu:8443</code>
</li> <li> <code>URL_PREFIX=srm/v2/server</code>
</li> <li> <code>FILENAME=/mnt/hadoop/user/osgedu/user</code>
</li></ul> 
<p />
So, the SRM URLs in our example will be of the following form:
<pre>
srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user
</pre>
<p />
Try the following invocation of <code>lcg-cp</code>
<pre class="screen">
lcg-cp -v -b -D srmv2 file:/share/blast/data/drosoph.aa srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/drosoph.aa
</pre>
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx22show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show output</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx22hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide output</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2013StorageEx22toggle" class="twistyContent twikiMakeHidden twistyInited">
<pre class="screen">
[user@osg-ss-submit ~]$ lcg-cp -v -b -D srmv2 file:/share/blast/data/drosoph.aa srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/drosoph.aa
Using grid catalog type: UNKNOWN
Using grid catalog : (null)
VO name: osgedu
Checksum type: None
Destination SE type: SRMv2
Destination SRM Request Token: put:53178
Source URL: file:/share/blast/data/drosoph.aa
File size: 8498541
Source URL for copy: file:/share/blast/data/drosoph.aa
Destination URL: gsiftp://red-gridftp.unl.edu//mnt/hadoop/user/osgedu/user/drosoph.aa
# streams: 1
      1048576 bytes    620.62 KB/sec avg    620.62 KB/sec inst
Transfer took 3050 ms
</pre>
Note that the "Destination URL" refers to the actual GridFTP server used, and will vary from site-to-site.
</div></div> <!--/twistyPlugin-->
<p />
Now, let's do multiple files.  Unfortunately, none of the common SRM clients support recursive copying, so we have to resort to a bit of shell scripting to copy over all the BLAST DB files.  Using the above single-invocation as a starter, try to write a simple bash for-loop yourself (or see the posted solution).
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx23show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show solution</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx23hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide solution</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2013StorageEx23toggle" class="twistyContent twikiMakeHidden twistyInited">
<pre class="screen">
for i in `ls -1 /share/blast/data/drosoph*`; do
filename=`basename $i`
lcg-cp -b -D srmv2 -v file:/share/blast/data/$filename srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/$filename
done
</pre>
</div></div> <!--/twistyPlugin-->
<p />
<h3><a name="File_Movement_Download"></a> File Movement: Download </h3>
<p />
Writing files to storage is only half the solution - we need to read them back out!  With <code>lcg-cp</code>, we can do this by making the source URL SRM and the destination the local filesystem.  Let's do this for the drosoph.aa file:
<p />
<pre class="screen">
lcg-cp -v -b -D srmv2 srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/drosoph.aa file:/tmp/drosoph.aa.user
</pre>
<p />
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx24show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show output</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx24hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide output</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2013StorageEx24toggle" class="twistyContent twikiMakeHidden twistyInited">
<pre class="screen">
[user@osg-ss-submit ~]$ lcg-cp -v -b -D srmv2 srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/drosoph.aa file:/tmp/drosoph.aa.user
Using grid catalog type: UNKNOWN
Using grid catalog : (null)
VO name: osgedu
Checksum type: None
Trying SURL srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/drosoph.aa ...
Source SE type: SRMv2
Source SRM Request Token: get:55177
Source URL: srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/drosoph.aa
File size: 8498541
Source URL for copy: gsiftp://red-gridftp.unl.edu//mnt/hadoop/user/osgedu/user/drosoph.aa
Destination URL: file:/tmp/drosoph.aa.user
# streams: 1
      1048576 bytes    511.82 KB/sec avg    511.82 KB/sec inst
Transfer took 3030 ms
</pre>
</div></div> <!--/twistyPlugin-->
<p />
<strong>On your own</strong> (or with your buddy): Write a small shell script to download all of the drosoph files into a directory named <code>/tmp/drosoph.user</code>.
<p />
<h3><a name="File_Movement_GridFTP"></a> File Movement: GridFTP </h3>
On other grids, GridFTP may be more common than SRM.  Let's take a moment to use the most common GridFTP client, <code>globus-url-copy</code> directly.
<p />
<code>globus-url-copy</code> has a simple usage syntax of <code>globus-url-copy [OPTIONS] SOURCE_URL DEST_URL</code>.  The source and destination must be either be prefixed with <code>file://</code> (designating a file on the local disk) or <code>gsiftp://</code> (designating a file on a remote server).  You can see what the various OPTIONS are by looking at the output of <code>-help</code>; we'll be using <code>-vb</code> in the examples to increase the verbosity of the client.
<p />
First, let's copy a file to the remote GridFTP server:
<pre class="screen">
globus-url-copy -cd -vb file:/share/blast/data/drosoph.aa gsiftp://red-gridftp.unl.edu//mnt/hadoop/user/osgedu/user.gridftp/drosoph.aa
</pre>
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx25show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show output</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx25hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide output</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2013StorageEx25toggle" class="twistyContent twikiMakeHidden twistyInited">
<pre class="screen">
[user@osg-ss-submit ~]$ globus-url-copy -cd -vb file:/share/blast/data/drosoph.aa gsiftp://red-gridftp.unl.edu//mnt/hadoop/user/osgedu/user.gridftp/drosoph.aa
Source: file:/opt/workshop/dm_exercises/part2/
Dest:   gsiftp://red-gridftp.unl.edu//mnt/hadoop/user/osgedu/user.gridftp/
  drosoph.aa
      1048576 bytes         2.67 MB/sec avg         2.67 MB/sec inst
</pre>
Note that the <code>-cd</code> command line flag is required to create the destination directory.
</div></div> <!--/twistyPlugin-->
<p />
Next, let's copy it back to the local disk:
<pre class="screen">
globus-url-copy -vb gsiftp://red-gridftp.unl.edu//mnt/hadoop/user/osgedu/user.gridftp/drosoph.aa file:/tmp/drosoph.aa.user
</pre>
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx26show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show output</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx26hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide output</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2013StorageEx26toggle" class="twistyContent twikiMakeHidden twistyInited">
<pre class="screen">
[user@osg-ss-submit ~]$ globus-url-copy -vb gsiftp://red-gridftp.unl.edu//mnt/hadoop/user/osgedu/user.gridftp/drosoph.aa file:/tmp/drosoph.aa.user
Source: gsiftp://red-gridftp.unl.edu//mnt/hadoop/user/osgedu/user.gridftp/
Dest:   file:/tmp/
  drosoph.aa  ->  drosoph.aa.user
      4194304 bytes         2.00 MB/sec avg         2.00 MB/sec inst
</pre>
</div></div> <!--/twistyPlugin-->
<p />
Finally, we can use <code>md5sum</code> to verify the contents:
<pre class="screen">
[user@osg-ss-submit ~]$ md5sum /share/blast/data/drosoph.aa /tmp/drosoph.aa.user 
a0689a9b03257c1be05fe555bd6e1d3c  /share/blast/data/drosoph.aa
a0689a9b03257c1be05fe555bd6e1d3c  /tmp/drosoph.aa.user
</pre>
As long as the hash results are the same for both files, they should be identical!
<p />
<h3><a name="List_Files"></a> List Files </h3>
<p />
Listing of a single file or the contents of a directory can be done with <code>lcg-ls</code>.  If you pass the <code>-l</code> flag, it will print out some additional information (analogous to <code>ls -l</code>).
<p />
<pre class="screen">
lcg-ls -b -D srmv2 -l srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user
</pre>
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx27show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show output</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx27hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide output</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2013StorageEx27toggle" class="twistyContent twikiMakeHidden twistyInited">
<pre class="screen">
[user@osg-ss-submit ~]$ lcg-ls -b -D srmv2 -l srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user
----------   1     2     2 8498541              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.aa
----------   1     2     2 1781790              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.aa.phr
----------   1     2     2  114720              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.aa.pin
----------   1     2     2  114648              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.aa.pnd
----------   1     2     2     492              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.aa.pni
----------   1     2     2  436372              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.aa.psd
----------   1     2     2   10001              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.aa.psi
----------   1     2     2 7193188              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.aa.psq
----------   1     2     2 124327488              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.nt
----------   1     2     2  190733              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.nt.nhr
----------   1     2     2   14116              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.nt.nin
----------   1     2     2    9360              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.nt.nnd
----------   1     2     2      84              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.nt.nni
----------   1     2     2   32880              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.nt.nsd
----------   1     2     2     822              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.nt.nsi
----------   1     2     2 31368306              UNKNOWN /mnt/hadoop/user/osgedu/user/drosoph.nt.nsq
----------   1     2     2 3399727              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.aa
----------   1     2     2  624891              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.aa.phr
----------   1     2     2   50456              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.aa.pin
----------   1     2     2   50384              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.aa.pnd
----------   1     2     2     244              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.aa.pni
----------   1     2     2  199316              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.aa.psd
----------   1     2     2    4538              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.aa.psi
----------   1     2     2 2980337              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.aa.psq
----------   1     2     2 12308631              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.nt
----------   1     2     2    2305              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.nt.nhr
----------   1     2     2     280              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.nt.nin
----------   1     2     2     136              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.nt.nnd
----------   1     2     2      52              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.nt.nni
----------   1     2     2     456              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.nt.nsd
----------   1     2     2      64              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.nt.nsi
----------   1     2     2 3038769              UNKNOWN /mnt/hadoop/user/osgedu/user/yeast.nt.nsq
</pre>
</div></div> <!--/twistyPlugin-->
<p />
<h3><a name="Remove_files"></a> Remove files </h3>
<p />
We won't actually need the file we uploaded directly to the gridftp server.  Let's delete it using <code>lcg-del</code>.  After going through the previous <code>lcg-cp</code> examples, you can probably guess the command line invocation; the only hiccup is the need for the <code>-l</code> flag.
<p />
<pre class="screen">
lcg-del -l -b -D srmv2 -v srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/drosoph.aa
</pre>
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx28show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show output</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx28hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide output</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2013StorageEx28toggle" class="twistyContent twikiMakeHidden twistyInited">
<pre class="screen">
[user@osg-ss-submit ~]$ lcg-del -l -b -D srmv2 -v srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/drosoph.aa
VO name: osgedu
SE type: SRMv2
srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user.gridftp/drosoph.aa - DELETED
</pre>
</div></div> <!--/twistyPlugin-->
<p />
Notice the same filename (<code>/mnt/hadoop/user/osgedu/user/drosoph.aa</code>) is used for both GridFTP and SRM.
<p />
<h3><a name="On_your_own"></a> On your own </h3>
<p />
It's always a good idea to keep only the minimal set of files on a remote SE, especially if you are using it opportunistically.  We won't be using the drosoph database for the next exercise.  Instead, we'll be using the yeast database. <ol>
<li> Remove all the drosoph files you just transferred
</li> <li> Copy over the yeast database.
</li> <li> Verify all the remote files are of the correct size.
</li></ol> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Running_BLAST"></a> Running BLAST </span></h2>
We will try to build on exercises you have been doing for the last two days. You have already submitted a simple script to the grid that ran BLAST (<a href="/bin/view/Education/OSGSS2012CondorBLAST" class="twikiLink">see exercise</a>). In this case, the BLAST application and databases were already pre-deployed on the remote cluster.  However, these exercises depended on the BLAST database being accessible on the shared file system.
<p />
<div style="margin-left: 1em; margin-right: 1em; background-color: #ffff66; border: 1px solid black; padding: 0.5em;">
Food for thought: Why is this a bad idea?
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx29show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show the answer!</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx29hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Ok, move on...</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2013StorageEx29toggle" class="twistyContent twikiMakeHidden twistyInited">
Shared file systems such as NFS are not highly scalable, especially on the OSG.  The actions of one user can deteriorate the system for all others.  The shared file system from one site is not present at other sites and, on the OSG, might not even be present uniformly at a site.  Thus, uniform deployment and access of a dataset onto a shared file system can be a nightmare.
</div></div> <!--/twistyPlugin-->
</div>
<p />
In this exercise, we will improve on the situation by replacing the shared file system with an OSG storage element.
<p />
<h3><a name="Serving_files_from_a_single_SE"></a> Serving files from a single SE </h3>
First, copy a sequence query you will need to use as input to blast executable (copy <code><b>query1</b></code> from <code><b>/share/blast/queries/</b></code> to your working directory).  Do a <code><b>lcg-ls</b></code> on the remote SE (<code>srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user</code>) and verify that the yeast database files are actually there; if not, return to the previous set of exercises and copy them over.
<p />
Then, write a simple script that will do the following: <ol>
<li> Find all the files related to the database you want to search (<code><b>yeast</b></code>)  at the SE (<code><b>srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user</b></code>)
</li> <li> Download all the files associated with <code><b>yeast</b></code> to the worker node.
</li> <li> Run BLAST executable with required parameters (database name, sequence query and log file).
</li></ol> 
The Condor submit file should describe input and output files you want to transfer for the job.
<p />
You can try to solve this problem on your own. If you need help you can try the solution below.
<p /> <ul>
<li> Copy the wrapper script <code><b>/share/blast/bin/blast_wrapper.sh</b></code> to <code><b>/home/user/dm_part_2</b></code>.<pre class="file">
more blast_wrapper.sh
<span class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx210show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><span class="twikiLinkLabel twikiUnvisited">More...</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx210hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><span class="twikiLinkLabel twikiUnvisited">Close</span></a> </span>  </span><!--/twistyPlugin twikiMakeVisibleInline--> <span class="twistyPlugin"><span id="twistyIdEducation/ASP2016OSGSS2013StorageEx210toggle" class="twistyContent twikiMakeHidden twistyInited">
#!/bin/bash
################################################################################
#  blast_wrapper - download specific blast databases from a particular Storage Element  #
#          execute blast query for a particular query                           #
#          do cleanup                                                           #
#################################################################################
usage ()
{
     log "Usage: ./blast_wrapper.sh surl db_name query_file [logfile]"
     log "Sample: ./blast_wrapper.sh srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user yeast query.fasta"
}
log ()
{
if [ "x$logname" == x ]
then
        echo $1
else
        echo $1 >>$logfile
fi
}
# test if we have four arguments on the command line
if [ $# -lt  3 ]
then
    usage
    exit 1
fi
surl=$1
dbname=$2
query=$3
logname=""
if [ $# -eq 4 ]
then
        logname=$4
        logfile=$PWD/$logname
        #just in case create a logfile
        touch $logfile
fi
retVal=0
log "Start blast_wrapper.sh on $HOSTNAME"

downloadFiles=0

mkdir -p db-1
#get all the databases we need to download
log "Executing: lcg-ls -b -D srmv2 $surl | grep ${dbname}.aa."
for name in `lcg-ls -b -D srmv2 $surl | grep ${dbname}.aa. | xargs -L 1 basename`
do
        downloadFiles=1

        if [ -e $PWD/db-1/$name ]
        then
                log "Not downloading $name as it is already present."
        else
                log "Executing: lcg-cp -b -D srmv2 $surl/$name file:/$PWD/db-1/$name "
                lcg-cp -b -D srmv2 $surl/$name file:/$PWD/db-1/$name
                curRetVal=$?
                log "Return value $curRetVal"
                if [ $curRetVal -ne 0 ]
                then
                        retVal=$curRetVal
                        log "New Return value $curRetVal"
                        break
                fi
        fi
done

if [ $downloadFiles = 0 ]
then
        retVal=111
        log "Unable to perform lcg-ls or no source files present."
fi

log "Return value $retVal"
if [ $retVal -eq 0 ]
then
        option=""
        log "Executing: ./blastp -db db-1/${dbname}.aa -query $query"
        if [ "x$logname" != x ]
        then
                ./blastp -db db-1/${dbname}.aa -query $query  >>$logfile  2>&1
        else
                ./blastp -db db-1/${dbname}.aa -query $query 2>&1
        fi
        retVal=$?
        log "Return value $retVal"
fi
log "End blast_wrapper.sh"
exit $retVal
</span></span> <!--/twistyPlugin-->
</pre>
</li> <li> Copy <code><b>/share/blast/queries/query1</b></code> and <code><b>/share/blast/bin/blastp</b></code> to /home/user/dm_part_2
</li> <li> Create Condor submission file <code><b>test.submit</b></code>: <pre class="file">
universe=vanilla
Executable = blast_wrapper.sh
Log = test.$(Cluster).$(Process).log
Output = test.$(Cluster).$(Process).out
Error = test.$(Cluster).$(Process).err
transfer_executable = true
query_input_name=query1
transfer_input_files = blastp,$(query_input_name)
WhenToTransferOutput = ON_EXIT_OR_EVICT
transfer_output_files = blast_results.$(Cluster).$(Process)
should_transfer_files   = YES
<font color="#ff0000">x509userproxy = /tmp/x509up_u38001</font>
use_x509userproxy = True
Arguments =  srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user yeast $(query_input_name) blast_results.$(Cluster).$(Process)
queue
</pre>
</li> <li> The line <code>x509userproxy</code> directory is obtained from the command <code>voms-proxy-info</code>: <pre class="screen">
[user@osg-ss-submit /home/user/dm_part_2]$ voms-proxy-info 
subject   : /DC=org/DC=doegrids/OU=People/CN=Derek Weitzel 285345/CN=proxy
issuer    : /DC=org/DC=doegrids/OU=People/CN=Derek Weitzel 285345
identity  : /DC=org/DC=doegrids/OU=People/CN=Derek Weitzel 285345
type      : proxy
strength  : 1024 bits
path      : <font color="#ff0000">/tmp/x509up_u38001</font>
timeleft  : 1:52:56
</pre>
</li> <li> Submit this Condor job. The logfile should look similar to this: <pre class="file">
more  blast_results.<font color="#0000ff">12.0</font>
<span class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx211show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><span class="twikiLinkLabel twikiUnvisited">More...</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx211hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><span class="twikiLinkLabel twikiUnvisited">Close</span></a> </span>  </span><!--/twistyPlugin twikiMakeVisibleInline--> <span class="twistyPlugin"><span id="twistyIdEducation/ASP2016OSGSS2013StorageEx211toggle" class="twistyContent twikiMakeHidden twistyInited">
[user@osg-ss-submit ~]$ ./blast_wrapper.sh srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user yeast query1
Start blast_wrapper.sh
Executing: lcg-ls -b -D srmv2 srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user | grep yeast.aa.
Executing: lcg-cp -b -D srmv2 srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/yeast.aa.phr file://var/lib/condor/execute/dir_15067/glide_O15332/execute/dir_21745/db-1/yeast.aa.phr
Return value 0
Executing: lcg-cp -b -D srmv2 srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/yeast.aa.pin file://var/lib/condor/execute/dir_15067/glide_O15332/execute/dir_21745/db-1/yeast.aa.pin
Return value 0
Executing: lcg-cp -b -D srmv2 srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/yeast.aa.pnd file://var/lib/condor/execute/dir_15067/glide_O15332/execute/dir_21745/db-1/yeast.aa.pnd
Return value 0
Executing: lcg-cp -b -D srmv2 srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/yeast.aa.pni file://var/lib/condor/execute/dir_15067/glide_O15332/execute/dir_21745/db-1/yeast.aa.pni
Return value 0
Executing: lcg-cp -b -D srmv2 srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/yeast.aa.psd file://var/lib/condor/execute/dir_15067/glide_O15332/execute/dir_21745/db-1/yeast.aa.psd
Return value 0
Executing: lcg-cp -b -D srmv2 srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/yeast.aa.psi file://var/lib/condor/execute/dir_15067/glide_O15332/execute/dir_21745/db-1/yeast.aa.psi
Return value 0
Executing: lcg-cp -b -D srmv2 srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/user/yeast.aa.psq file://var/lib/condor/execute/dir_15067/glide_O15332/execute/dir_21745/db-1/yeast.aa.psq
Return value 0
Return value 0
Executing: ./blastp -db db-1/yeast.aa -query query1
BLASTP 2.2.23+


Reference: Stephen F. Altschul, Thomas L. Madden, Alejandro A.
Schaffer, Jinghui Zhang, Zheng Zhang, Webb Miller, and David J.
Lipman (1997), "Gapped BLAST and PSI-BLAST: a new generation of
protein database search programs", Nucleic Acids Res. 25:3389-3402.



Reference for composition-based statistics: Alejandro A. Schaffer,
L. Aravind, Thomas L. Madden, Sergei Shavirin, John L. Spouge, Yuri
I. Wolf, Eugene V. Koonin, and Stephen F. Altschul (2001),
"Improving the accuracy of PSI-BLAST protein database searches with
composition-based statistics and other refinements", Nucleic Acids
Res. 29:2994-3005.



Database: yeast.aa
           6,298 sequences; 2,974,038 total letters



Query=  Brian's first query!
Length=80
                                                                      Score     E
Sequences producing significant alignments:                          (Bits)  Value

ref|NP_009511.1|  uridine permease; Fui1p                              170    4e-44
ref|NP_012677.1|  dolichyl phosphate-D-mannose:protein O-D-mannos...  23.9    4.6  
ref|NP_015305.1|  Smt3-processing enzyme; Ulp1p                       23.9    4.8  
ref|NP_011691.1|  Squalene monooxygenase; Erg1p                       23.9    5.1  
ref|NP_009545.1|  putative repressor protein homologous to yeast ...  23.1    7.3  


>ref|NP_009511.1| uridine permease; Fui1p
Length=639

 Score =  170 bits (430),  Expect = 4e-44, Method: Composition-based stats.
 Identities = 80/80 (100%), Positives = 80/80 (100%), Gaps = 0/80 (0%)

Query  1   MPVSDSGFDNSSKTMKDDTIPTEDYEEITKESEMGDATKITSKIDANVIEKKDTDSENNI  60
           MPVSDSGFDNSSKTMKDDTIPTEDYEEITKESEMGDATKITSKIDANVIEKKDTDSENNI
Sbjct  1   MPVSDSGFDNSSKTMKDDTIPTEDYEEITKESEMGDATKITSKIDANVIEKKDTDSENNI  60

Query  61  TIAQDDEKVSWLQRVVEFFE  80
           TIAQDDEKVSWLQRVVEFFE
Sbjct  61  TIAQDDEKVSWLQRVVEFFE  80


>ref|NP_012677.1| dolichyl phosphate-D-mannose:protein O-D-mannosyltransferase; 
Pmt4p
Length=762

 Score = 23.9 bits (50),  Expect = 4.6, Method: Composition-based stats.
 Identities = 10/39 (25%), Positives = 21/39 (53%), Gaps = 0/39 (0%)

Query  18   DTIPTEDYEEITKESEMGDATKITSKIDANVIEKKDTDS  56
            D   + +++E  K+S +   +K  +  D   I+ +DTD+
Sbjct  311  DAFMSAEFQETLKDSPLSVDSKTVNYFDIITIKHQDTDA  349


>ref|NP_015305.1| Smt3-processing enzyme; Ulp1p
Length=621

 Score = 23.9 bits (50),  Expect = 4.8, Method: Compositional matrix adjust.
 Identities = 15/35 (42%), Positives = 22/35 (62%), Gaps = 1/35 (2%)

Query  31   ESEMGDATKITSKIDANVIEKKDTDSENNITIAQD  65
            ESE G  T  TS I +   +K + DS+N+IT ++D
Sbjct  173  ESE-GVGTPSTSPISSLASQKSNCDSDNSITFSRD  206


>ref|NP_011691.1| Squalene monooxygenase; Erg1p
Length=496

 Score = 23.9 bits (50),  Expect = 5.1, Method: Composition-based stats.
 Identities = 9/23 (39%), Positives = 15/23 (65%), Gaps = 0/23 (0%)

Query  9    DNSSKTMKDDTIPTEDYEEITKE  31
            D + K ++D TI  +DYE+  +E
Sbjct  121  DGNDKVLEDSTIHIKDYEDDERE  143


>ref|NP_009545.1| putative repressor protein homologous to yeast Tup1p and mammalian 
retinal transducin; contains nuclear targeting signal; 
Hir1p
Length=840

 Score = 23.1 bits (48),  Expect = 7.3, Method: Compositional matrix adjust.
 Identities = 12/25 (48%), Positives = 18/25 (72%), Gaps = 1/25 (4%)

Query  45   DANVIEKKDTDSENNITIAQDDEKV  69
            +A V +KKD D EN + + Q+D+KV
Sbjct  294  NAGVKQKKDDDPENAL-VGQNDDKV  317



Lambda     K      H
   0.304    0.123    0.327 

Gapped
Lambda     K      H
   0.267   0.0410    0.140 

Effective search space used: 74103176


  Database: yeast.aa
    Posted date:  May 4, 2010  9:00 PM
  Number of letters in database: 2,974,038
  Number of sequences in database:  6,298



Matrix: BLOSUM62
Gap Penalties: Existence: 11, Extension: 1
Neighboring words threshold: 11
Window for multiple hits: 40
Return value 0
End blast_wrapper.sh
</span></span> <!--/twistyPlugin-->
</pre>
</li></ul> 
<p />
<p />
<h3><a name="More_realistic_BLAST_jobs"></a> More realistic BLAST jobs </h3>
The previous example covered running one query against the yeast database.  As the yeast DB is very small, one query less than a second. <ol>
<li> Generate many queries and place them all in the <code>query1</code> file.  I wrote a small script to generate random queries (biologists hopefully don't need to generate random queries!); you can do the following: <pre class="screen"> /share/blast/data/query_generator.py query.fasta</pre>
</li> <li> Replace the yeast database with the human genome.
</li></ol> 
<p />
<!--
<h3><a name="Running_on_Several_SEs"></a> Running on Several SEs </h3>
<p />
Let's extend the exercises to be a bit more realistic.  Because most of the resources osgedu can access are opportunistic, we really shouldn't hard-code one storage element and site into our submit scripts.  Instead, we ought to build a system that can use multiple SEs and sites at once. <ol>
<li> Upload the human genome DB to two storage elements.
</li> <li> Generate more queries!  Do 100 queries per job, and about 100 jobs.
</li></ol> 
-->
<!--
<h3><a name="Extra_Credit_BLAST_Workflows"></a> Extra Credit: BLAST Workflows </h3>
<p />
After the last exercise, you likely have more output data than you care for!  Write a DAG script that automates the whole procedure: <ol>
<li> Upload the human genome to Nebraska.
</li> <li> Execute all the queries from the previous exercise.
</li> <li> Aggregate all returned results into a single tarball and upload the result to the osgedu-dedicated storage element.
</li></ol> 
-->
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Extra_Credit_Storage_Discovery"></a> Extra Credit: Storage Discovery </span></h2>
<p />
You should know by now enough about storage to be able to try to figure out how to use it on your own. The problem is that we didn't give any tools to figure out what Storage Element will support your VO. Also, how you would find the surl of a SE. You can always use <code><b>condor_status</b></code> and various constraints to try to figure out this information, but it is not a trivial task. The OSG has a  <a href="http://is.grid.iu.edu/cgi-bin/status.cgi" target="_top">BDII service</a> which aggregates LDAP information provided by sites. The information reported by each site describes static and dynamic resources available at that site and VOs that are authorized to use these resources. The <a href="https://twiki.grid.iu.edu/bin/view/Trash/ReleaseDocumentationOSGStorageDiscoveryTool" target="_top">OSG Discovery Tools</a> allow users to discover what SE supports thier VO and how to access it.
<p /> <ol>
<li> See all the <code><b>get_</b></code> commands available for information discovery: <pre class="screen">
[user@osg-ss-submit /home/user/dm_part_2]$ ls /usr/bin/get_*
/usr/bin/get_gridftp_storage_element_id  /usr/bin/get_site_name		     /usr/bin/get_srm_storage_element_id
/usr/bin/get_gridftp_url		 /usr/bin/get_site_name_for_seid     /usr/bin/get_storage_area
/usr/bin/get_module			 /usr/bin/get_srm_copy_cmd	     /usr/bin/get_storage_element_id
/usr/bin/get_mount_path			 /usr/bin/get_srmcp_cmd		     /usr/bin/get_surl
/usr/bin/get_os_versions		 /usr/bin/get_srm_reserve_space_cmd
/usr/bin/get_runtime_versions		 /usr/bin/get_srm_sp_reserve_cmd

</pre>
</li> <li>  Check what SEs are available for <code><b>osgedu</b></code> and the corresponding endpoints: <pre class="screen">
[user@osg-ss-submit ~]$ get_surl --vo osgedu --show_storage_element_id
STORAGE ELEMENT ID            SURL                                                                                                
bsrm-1.t2.ucsd.edu            srm://bsrm-1.t2.ucsd.edu:8443/srm/v2/server?SFN=/hadoop/osgedu/TESTFILE                             
cit-se.ultralight.org         srm://cit-se.ultralight.org:8443/srm/v2/server?SFN=/mnt/hadoop/osg/osgedu/TESTFILE                  
dcache07.unl.edu              srm://dcache07.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/TESTFILE                      
dcsrm.usatlas.bnl.gov         srm://dcsrm.usatlas.bnl.gov:8443/srm/managerv2?SFN=/pnfs/usatlas.bnl.gov/osg/osgedu/TESTFILE        
ff-se.unl.edu                 srm://ff-se.unl.edu:8443/srm/v2/server?SFN=/panfs/panasas/CMS/data/osgedu/TESTFILE                  
osg-se.sprace.org.br          srm://osg-se.sprace.org.br:8443/srm/managerv2?SFN=/pnfs/sprace.org.br/data//TESTFILE                
se.grid.unesp.br              srm://se.grid.unesp.br:8443/srm/v2/server?SFN=/store/osgedu/TESTFILE                                
se-dcache.hepgrid.uerj.br     srm://se-dcache.hepgrid.uerj.br:8443/srm/managerv2?SFN=/pnfs/hepgrid.uerj.br/data/osgedu/TESTFILE   
sigmorgh.hpcc.ttu.edu         srm://sigmorgh.hpcc.ttu.edu:49443/srm/v2/server?SFN=/lustre/hep/osg/osgedu/TESTFILE                 
srm.unl.edu                   srm://srm.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/TESTFILE                           
uct2-dc1.uchicago.edu         srm://uct2-dc1.uchicago.edu:8443/srm/managerv2?SFN=/pnfs/uchicago.edu/TESTFILE                      
red-srm1.unl.edu:8443         srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/TESTFILE                      
</pre>
</li></ol> 
The above output implies you can use <code><b>srm://red-srm1.unl.edu:8443/srm/v2/server?SFN=/mnt/hadoop/user/osgedu/<font color="#0000ff">TESTFILE</font></b></code> to upload a file named <font color="#0000ff">TESTFILE</font> to the storage element <code><b>red-srm1.unl.edu:8443</b></code>.
<p />
<div style="margin-left: 1em; margin-right: 1em; background-color: #ffff66; border: 1px solid black; padding: 0.5em;">
Food for thought: How do the URLs returned above compare with the URLs we used for the BLAST examples.  Why are they different?
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx212show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show the answer!</span></a> </span> <span id="twistyIdEducation/ASP2016OSGSS2013StorageEx212hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Ok, move on...</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdEducation/ASP2016OSGSS2013StorageEx212toggle" class="twistyContent twikiMakeHidden twistyInited">
You should notice that, in the previous examples, we added on a directory named user.  The <code>get_surl</code> tool returns the top-level directory a <strong>VO</strong> may use at a storage element.  However, within the VO such as osgedu, we need a mechanism to avoid two users writing different files to the remote SE.  By adding the extra subdirectory that is unique to your user name, we are able to guarantee no one else in the OSGEDU accidentally overwrites your working files!
</div></div> <!--/twistyPlugin-->
</div>
<p />
<h3><a name="On_your_own_AN1"></a> On your own </h3>
Try other commands and see if they are useful.</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education/ASP2016<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/ASP2016/UserSchool13Materials" class="twikiLink">UserSchool13Materials</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>OSGSS2013StorageEx2</span> <br />    
Topic revision: r7 - 07 Feb 2017 - 18:20:18 - <a href="/bin/view/Main/BrianBockelman" class="twikiLink">BrianBockelman</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />