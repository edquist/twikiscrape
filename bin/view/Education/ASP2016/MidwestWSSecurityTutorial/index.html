<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> MidwestWSSecurityTutorial &lt; Education/ASP2016 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/ASP2016/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/ASP2016/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/ASP2016/MidwestWSSecurityTutorial?_T=16 Feb 2017" type="application/x-wiki" title="edit MidwestWSSecurityTutorial" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/ASP2016/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/ASP2016/MidwestWSSecurityTutorial"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <!-- deprecated -->
<p />
<h1><a name="Tutorial_Security_and_Certificat"></a>  Tutorial: Security and Certificates on the Grid </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Introduction"> Introduction</a>
</li> <li> <a href="?cover=print#Notes_information"> Notes information</a>
</li> <li> <a href="?cover=print#Basic_steps"> Basic steps</a> <ul>
<li> <a href="?cover=print#Checking_GLOBUS_LOCATION_setup"> Checking GLOBUS_LOCATION setup</a>
</li></ul> 
</li> <li> <a href="?cover=print#Using_Certificates"> Using Certificates</a> <ul>
<li> <a href="?cover=print#Default_Credential_Location"> Default Credential Location</a>
</li> <li> <a href="?cover=print#Certificate_Contents"> Certificate Contents</a>
</li> <li> <a href="?cover=print#Using_certificates_to_transfer_f"> Using certificates to transfer file </h4></a>
</li></ul> 
</li> <li> <a href="?cover=print#Using_Grid_Proxy_certificates"> Using Grid Proxy certificates</a> <ul>
<li> <a href="?cover=print#Creating_Proxy_Certificates"> Creating Proxy Certificates</a>
</li> <li> <a href="?cover=print#Contents_of_a_Grid_Proxy"> Contents of a Grid Proxy</a>
</li> <li> <a href="?cover=print#Using_a_proxy_certificate_to_tra"> Using a proxy certificate to transfer a file</a>
</li> <li> <a href="?cover=print#Proxy_lifetime_implications"> Proxy lifetime implications</a>
</li> <li> <a href="?cover=print#Attempting_to_use_expired_proxy"> Attempting to use expired proxy</a>
</li></ul> 
</li> <li> <a href="?cover=print#Obtaining_a_new_certificate_with"> Obtaining a new certificate with cacl</a> <ul>
<li> <a href="?cover=print#Log_into_SDSC_login_host"> Log into SDSC login host</a>
</li> <li> <a href="?cover=print#Request_credential_from_cacl"> Request credential from cacl</a>
</li> <li> <a href="?cover=print#Copy_credentials_from_SDSC_to_lo"> Copy credentials from SDSC to login host</a>
</li> <li> <a href="?cover=print#Proxy_certificate_using_CACL_Cer"> Proxy certificate using CACL Certificates</a>
</li></ul> 
</li> <li> <a href="?cover=print#Using_SDSC_credentials"> Using SDSC credentials</a> <ul>
<li> <a href="?cover=print#Setting_up_clients_to_use_SDSC_p"> Setting up clients to use SDSC proxy</a>
</li> <li> <a href="?cover=print#Using_SDSC_credentials_to_transf"> Using SDSC credentials to transfer file to remote server</a>
</li> <li> <a href="?cover=print#Using_SDSC_credentials_to_tr_AN1"> Using SDSC credentials to transfer file  with in local cluster</a>
</li></ul> 
</li> <li> <a href="?cover=print#Contents_of_GridMap_file"> Contents of GridMap file</a>
</li> <li> <a href="?cover=print#Using_gx_gridmap_to_add_SDSC_cer"> Using gx-gridmap to add SDSC certificate DN to gridmap</a> <ul>
<li> <a href="?cover=print#Using_SDSC_trusted_credentials_t"> Using SDSC trusted credentials to transfer file with in local server</h4></a>
</li></ul> 
</li></ul> 
</div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Introduction"></a> Introduction </span></h2>
<p />
This exercise will provide hands-on experience in using various tools to setup and use GSI for working on the grid. The first few sections delve into certificates and proxies and demonstarate how pre-configured credentials can be used to run some grid enable programs. The later sections discuss steps involved in obtaining a new certificate and using them on the grid. 
<p />
The exercise uses tools like <em>globus-job-run</em> and <em>globus-url-copy</em> to execute jobs on the grid and move files across machines respectively. This exercise does not deal in detail with those tools, but focuses more on the security aspects. These tools and related technology will be discussed in lectures and exercises later.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Notes_information"></a> Notes information </span></h2>
<p />
These notes have been written to lead you through the exercises on your own and provide commands to type, expected output and notes highlighting the key aspects of a particular step. Feel free to ask the TAs for help if you have any problems or have any questions.
<p />
These notes have transcripts from runs on machine <strong>workshop2.lac.uic.edu</strong>. Replace that with your machine name wherever appropriate.
<p />
The exercise notes was prepared by running as user <strong>train99</strong>. Replace that with your username in all command line parameters.
<p />
You will see two styles of machine text here:
<p />
<pre class="screen">
<userinput>Text like this is input that you should type.</userinput>
Text like this is the output you should get.
</pre>
<p />
For example:
<p />
<pre class="screen">
$ <userinput>date</userinput>
Wed May 31 11:54:58 BST 2006
</pre>
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Basic_steps"></a> Basic steps </span></h2>
<p />
<p />
<h3><a name="Checking_GLOBUS_LOCATION_setup"></a> Checking GLOBUS_LOCATION setup </h3>
The machine is set up with Globus Toolkit install and an environment variable <code>GLOBUS_LOCATION</code> pointing to the install should be set up.
<p />
<pre class="screen">
[train99@workshop1 ~]$ <userinput>echo $GLOBUS_LOCATION</userinput>
/sw/gt-4.0.4
[train99@workshop1 ~]$ 
</pre>
<p />
The command line clients that are installed as part of Globus Toolkit have already been added to your PATH.
<p />
<!-- <strong>*</strong>  Comments plugin to create comments table for section   <strong>*</strong>    -->
<span style="text-align:center; font-weight:bold; font-size:1.2em;">ADD A COMMENT</span>
<span id="twid_1show" class="twistyMakeVisible">
       <a href="#" class="twistyTrigger"><em><strong>Show...</strong></em></a>
     </span>
     <span id="twid_1hide" class="twistyHidden">
       <a href="#" class="twistyTrigger"><em><strong>Hide</strong></em></a>
     </span>
     <div id="twid_1toggle" class="twistyMakeHidden">
<p />
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">COMMENT</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1 twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">NAME</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=2;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">DATE</font></a> </th>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Education/ASP2016/MidwestWSSecurityTutorial" enctype="multipart/form-data" name="tableappend0" id="tableappend0">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="0"  /></form>
<p />
</div>
<!-- <strong>*</strong>  End Comment                                            <strong>*</strong>    -->
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Using_Certificates"></a> Using Certificates </span></h2>
<p />
<p />
<form name="EDITTHIS" action="/bin/edit/Education/ASP2016/UsingCertificates" method="get"><input type="submit" value="Edit section" alt="Edit this section" title="Click to edit this section" class="twikiButton" style="font-size:.5em;"><input type="hidden" value="1487215509" name="t"></form>
<p />
<h3><a name="Default_Credential_Location"></a> Default Credential Location </h3>
<p />
By default the user certificate and user key are installed in <code>~/.globus</code>. Unless overriden explicitly on command line, the clients use these credentials.
<p />
<pre class="screen">
[train99 ~]$ <userinput>ls -lt ~/.globus/</userinput>
total 12
-rw-------  1 train99 train99 1743 Jun 22 16:45 userkey.pem
-rw-------  1 train99 train99 5011 Jun 22 16:37 usercert.pem
[train99 ~]$ 
</pre>
<p />
<h4><a name="Notes"></a> Notes </h4>
<p />
The userkey.pem is the file containing encrypted private key. The permissions on that file are restrictive, such that only the owner can read or write to that file.
<p />
The usercert.pem is the certificate, containting the public key. This file is not encrypted and can be distributed freely.
<p />
<h3><a name="Certificate_Contents"></a> Certificate Contents </h3>
This shows the an example of a certificate's contents. You can show the contents of your certificate using the <code><userinput>grid-cert-info</userinput></code> command. <span id="twid_2show" class="twistyMakeVisible">
       <a href="#" class="twistyTrigger"><em><strong>Show...</strong></em></a>
     </span>
     <span id="twid_2hide" class="twistyHidden">
       <a href="#" class="twistyTrigger"><em><strong>Hide</strong></em></a>
     </span>
     <div id="twid_2toggle" class="twistyMakeHidden">
<p />
<pre class="programlisting">
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 923 (0x39b)
        Signature Algorithm: md5WithRSAEncryption
        Issuer: C=US, O=SDSC, OU=SDSC-CA, CN=Certificate Authority/UID=certman
        Validity
            Not Before: Jun 22 00:46:02 2006 GMT
            Not After : Jul  2 00:46:02 2006 GMT
        Subject: C=US, O=SDSC, OU=SDSC, CN=Account Train99/UID=train99
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
            RSA Public Key: (2048 bit)
                Modulus (2048 bit):
                    00:af:93:40:80:ce:14:68:d6:6c:67:89:45:0c:3e:
                    30:98:38:35:c9:bd:b5:08:00:17:4c:e1:fb:38:50:
                    bd:97:f5:41:92:e7:6e:c4:6f:dc:ad:52:2c:e0:2a:
                    54:83:79:45:fb:5d:e2:f5:a5:cf:42:94:45:98:22:
                    d9:5b:81:93:e2:46:5f:e0:7f:71:5f:2d:b0:4a:82:
                    21:7d:f2:41:f7:b6:33:eb:59:93:f1:71:e3:79:ea:
                    c0:1b:5e:07:c6:d5:c2:67:41:56:73:d8:1f:a3:fb:
                    32:4b:f5:96:9f:65:f5:0a:f0:28:d5:90:d6:b0:dc:
                    4b:29:85:aa:8b:b7:d5:c0:f3:45:28:f9:af:80:7a:
                    88:40:40:21:60:ea:14:cd:8a:8e:53:40:67:c5:47:
                    51:bc:95:76:1e:90:b0:ee:ee:41:5a:ec:d4:4c:3c:
                    ea:eb:2f:f1:55:82:d8:b2:36:d9:92:88:bd:b6:93:
                    eb:46:69:3b:3a:e2:15:54:82:c0:30:4b:a9:54:3c:
                    af:52:4e:a5:71:40:a1:58:21:2e:ab:6d:c4:7c:59:
                    5d:68:b6:95:80:0e:12:91:51:90:0e:38:84:3f:de:
                    07:99:43:86:a1:0f:70:01:2f:3c:bf:e3:47:b2:16:
                    67:eb:00:6b:c4:7d:d8:e5:39:77:ac:29:cc:76:94:
                    2b:d3
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Basic Constraints: 
                CA:FALSE
            Netscape Cert Type: 
                SSL Client, S/MIME, Object Signing
            Netscape Comment: 
                OpenSSL Generated Certificate
            Netscape CA Revocation Url: 
                http://www.sdsc.edu/CA/SDSC_CRL.pem
            X509v3 Subject Key Identifier: 
                E1:E3:C9:6E:A6:CF:2C:FC:D3:B7:51:F6:03:66:98:C5:18:71:60:F8
            X509v3 Authority Key Identifier: 
                keyid:BF:A3:87:2C:F6:0D:74:BD:48:6C:0E:27:BF:01:E4:F2:4F:46:BA:27
                DirName:/C=US/O=SDSC/OU=SDSC-CA/CN=Certificate Authority/UID=certman
                serial:00

    Signature Algorithm: md5WithRSAEncryption
        93:b2:78:07:d9:72:e2:71:d7:66:83:0c:d3:97:0c:9e:24:33:
        4e:e3:48:28:9c:44:7e:31:13:70:cc:f8:4a:5d:bc:64:84:3e:
        aa:fa:da:86:3f:5e:f8:4a:72:a1:59:57:5a:89:49:5a:2d:c9:
        09:5c:a5:69:6e:65:f7:85:8b:07:57:f1:6a:cb:6e:e5:00:17:
        5d:02:0a:b5:52:6f:92:93:5b:94:c3:84:59:66:f4:29:f1:6a:
        a2:ff:eb:5d:6a:89:43:1a:82:cf:d7:66:d3:f6:f6:b6:ba:45:
        02:ec:60:86:88:00:4d:09:53:fc:7e:a7:cd:71:d8:ff:72:4f:
        36:1f:15:b1:af:ca:d3:8c:ac:4c:1b:99:5a:de:98:7a:81:22:
        c3:c3:3f:65:04:06:b7:5b:de:1a:65:f1:69:74:51:67:bc:0d:
        d2:00:cd:f0:c1:b2:c1:12:ba:6a:30:01:4c:98:fe:7a:bb:a8:
        d8:1e:61:39:9f:c4:c3:f4:f5:ba:be:43:13:75:84:fe:82:93:
        a9:00:3e:35:75:60:f7:8c:68:58:74:ed:27:c6:99:49:a8:e4:
        c0:27:32:1f:5c:b0:06:ed:63:d7:f7:79:89:11:d2:4e:5d:31:
        33:6e:d4:fd:90:51:4b:65:29:c6:6c:68:55:e6:2d:41:6a:c1:
        58:2b:f4:d3
</pre>
<p />
</div>
<p />
<h4><a name="Notes_AN1"></a> Notes </h4>
<p />
Since no parameters were specified on command line, the default credentials were used. Try the same command with <code>-help</code> to look at other options. We will use some later in the exercise.
<p />
The <em>Issuer DN</em> is the distinguished name (DN) of the Certificate Authority who issues the certificate.
<p />
Note that the certificate has validity that determines valid from and valid until.
<p />
<em>Subject:</em> is the distinguished name that this certificate is bound to.
<p />
<em>Key information</em> is the public key.
<p />
The CA generates a digest of the key and other binding information (validity, DN and so on) and signs it. The signature is included at the end of the cerificate.
<p />
The algorithm used to generate digest and sign is important information, since the same algorithms should be applied at verification.
<p />
<h3><a name="Using_certificates_to_transfer_f"></a> Using certificates to transfer file </h4> </h3>
<p />
The client <em>globus-url-copy</em> can be used to transfer files on the grid. It uses the <span class="twikiNewLink">GridFTP<a href="/bin/edit/Education/ASP2016/GridFTP?topicparent=Education/ASP2016.MidwestWSSecurityTutorial" rel="nofollow" title="GridFTP (this topic does not yet exist; you can create it)">?</a></span> server to transfer the files. This requires that the client who is requesting transfer have valid credentials and be authorized to the transfer. We will go into authorization step later, for now you are already authorized, so lets try the  client.
<p />
<ol>
  <li>Run <code><userinput>grid-proxy-destroy</userinput></code>. Ignore any errors.</li>
  <li>Run the following commands to set the environment variables. This will ensure that the certificate and key are used, since by default <em>globus-url-copy</em> uses proxy certificates. <ul>
 <li>
 <ul>
<li> <userinput>export X509_USER_CERT=.globus/usercert.pem</userinput>
</li> <li> <userinput>export X509_USER_KEY=.globus/userkey.pem</userinput>   </li>   <li>Create a temporary file to move using <em>globus-url-copy</em>. You can use some text editor (e.g., vi) to create it and add some contents. For example:
</li></ul> 
</li></ul> 
<pre class="screen">
[train99 ~]$ <userinput>cat tempFile</userinput>
Temporary file for testing globus-url-copy
[train99 ~]$ 
</pre></li>
   <li> Use <em>globus-url-copy</em> to move the file. 
<pre class="screen">
[train99@gridlab1 ~]$ <userinput>globus-url-copy gsiftp://localhost:2811/home/train99/tempFile  
     gsiftp://localhost:2811/home/train99/destFile</userinput>

error: globus_ftp_control: gss_init_sec_context failed
globus_gsi_gssapi: Error with gss credential handle
globus_credential: Valid credentials could not be found in any of the possible locations 
  specified by the credential search order.
Valid credentials could not be found in any of the possible locations specified by the 
  credential search order.

Attempt 1

globus_credential: Error reading host credential
globus_sysconfig: Error with certificate filename
globus_sysconfig: Error with certificate filename
globus_sysconfig: File is not owned by current user: /etc/grid-security/hostcert.pem is not 
  owned by current user

Attempt 2

globus_credential: Error reading proxy credential
globus_sysconfig: Could not find a valid proxy certificate file location
globus_sysconfig: Error with key filename
globus_sysconfig: File does not exist: /tmp/x509up_u502 is not a valid file

Attempt 3

globus_credential: Error reading user credential
globus_credential: Key is password protected: GSI does not currently support password 
  protected private keys.
OpenSSL Error: pem_lib.c:401: in library: PEM routines, function PEM_do_header: bad 
  password read

[train99 ~]$
</pre>
<p />
The client first attempts to authenticate with the server, to prove its identity. To do that it needs valid credentials. The command attempts to use host credentials. Second, it attempts to use a proxy, which does not exist. Last, it attempts to use your user credentials. The command failed since the private key is encrypted.
<p />
A real, live person will be required each time to enter the passphrase. To alleviate the problems associated with this, that is to sign on once and run numerous time, we use proxies.
<p />
</li>
   <li> Unset variables to use default locations
<pre class="screen">
[train99 ~]$ <userinput>unset X509_USER_CERT</userinput>
[train99 ~]$ <userinput>unset X509_USER_KEY</userinput>
[train99 ~]$ 
</pre></li>
</ol>
<p />
<!-- <strong>*</strong>  Comments plugin to create comments table for section   <strong>*</strong>    -->
<span style="text-align:center; font-weight:bold; font-size:1.2em;">ADD A COMMENT</span>
<span id="twid_3show" class="twistyMakeVisible">
       <a href="#" class="twistyTrigger"><em><strong>Show...</strong></em></a>
     </span>
     <span id="twid_3hide" class="twistyHidden">
       <a href="#" class="twistyTrigger"><em><strong>Hide</strong></em></a>
     </span>
     <div id="twid_3toggle" class="twistyMakeHidden">
<p />
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=0;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">COMMENT</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1 twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=1;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">NAME</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=2;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">DATE</font></a> </th>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Education/ASP2016/UsingCertificates" enctype="multipart/form-data" name="tableappend0" id="tableappend0">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="0"  /></form>
<p />
</div>
<!-- <strong>*</strong>  End Comment                                            <strong>*</strong>    -->
<p />
<p />
<p />
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Using_Grid_Proxy_certificates"></a> Using Grid Proxy certificates </span></h2>
<p />
<p />
<form name="EDITTHIS" action="/bin/edit/Education/ASP2016/GridProxyCertificates" method="get"><input type="submit" value="Edit section" alt="Edit this section" title="Click to edit this section" class="twikiButton" style="font-size:.5em;"><input type="hidden" value="1487215509" name="t"></form>
<p />
<p />
<h3><a name="Creating_Proxy_Certificates"></a> Creating Proxy Certificates </h3>
<p />
Use the <code>grid-proxy-init</code> command to create proxies.
<p />
<pre class="screen">
[train99 ~]$ <userinput>grid-proxy-init</userinput>
our identity: /O=Grid/OU=OSG/CN=Training User 99
Enter GRID pass phrase for this identity:
phrase is too short, needs to be at least 4 chars
Enter GRID pass phrase for this identity:
Creating proxy .......................................... Done
Your proxy is valid until: Fri Jun 23 22:00:10 2006
[train99 ~]$
</pre>
<p />
<p />
The proxy is created using the user certificate and the key.
<p />
The passphrase entered is used to decrypt the private key file.
<p />
<h3><a name="Contents_of_a_Grid_Proxy"></a> Contents of a Grid Proxy </h3>
Use <code><span class="command">grid-proxy-info</span></code> to list the contents of your proxy. To do that, you will first need to know where your proxy is stored. We can use <code>grid-proxy-info</code> to do that, too.
<p />
Run <code><userinput>grid-proxy-info -all</userinput></code> to display information about grid proxies in use on your system:
<p />
<p />
<pre class="screen">
[train99 ~]$ <userinput>grid-proxy-info -all</userinput>
subject  : /O=Grid/OU=OSG/CN=Training User 99/CN=203360020
issuer   : /O=Grid/OU=OSG/CN=Training User 99
identity : /O=Grid/OU=OSG/CN=Training User 99
type     : Proxy draft (pre-RFC) compliant impersonation proxy
strength : 512 bits
path     : /tmp/x509up_u539
timeleft : 11:58:58
</pre>
<p />
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table3" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=0;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Variable</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1 twikiLastCol"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=1;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Description</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <code>subject</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> The distingushed name (DN) from the certificate, appended with a uniqe string of numbers. </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> <code>issuer</code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> The user certificate itself. </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <code>path</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> Where the your proxy is stored. </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <code>timeleft</code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> How much longer the proxy will be valid. </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
As you can see, the issuer of the grid certificate is the user certificate. This shows the chain of trust:  <em>CA &rarr; user certificate &rarr; proxy certificate</em>.
<p />
The proxy certificate contains the private key generated for proxy, correspnding public key and is signed like a certificate by the user certificate. 
<p />
Now list the contents of the proxy, using the path displayed from running <code><userinput>grid-proxy-info -all</userinput></code> by running <code>grid-cert-info</code>, specifying the full path to your proxy:
<p />
<pre>   grid-cert-info -file </em>[/path/to/proxy/proxyFileName]</em> </pre>
<p />
For example, in our case our proxy path is <code>/tmp/x509up_u539</code>, so:
<p />
<pre class="screen">
[train99 ~]$ <userinput>grid-cert-info -file /tmp/x509up_u539</userinput>
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 203360020 (0xc1f0714)
        Signature Algorithm: md5WithRSAEncryption
        Issuer: C=US, O=SDSC, OU=SDSC, CN=Account Train31/UID=train31
        Validity
            Not Before: Jun 23 14:55:10 2006 GMT
            Not After : Jun 24 03:00:10 2006 GMT
        Subject: C=US, O=SDSC, OU=SDSC, CN=Account Train31/UID=train31, CN=203360020
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
            RSA Public Key: (512 bit)
                Modulus (512 bit):
                    00:b8:75:e3:a4:3c:31:9e:b9:71:e8:b0:4e:fc:18:
                    69:e6:79:15:90:f4:0f:49:20:f0:e3:62:9f:e2:92:
                    d0:96:4c:9b:b5:97:12:b3:bd:87:c7:8c:2f:bb:b0:
                    fe:79:8c:3d:61:5e:49:f6:c1:46:e1:1e:08:d1:d7:
                    89:a0:e3:8a:f3
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            1.3.6.1.4.1.3536.1.222: critical
                0.0
..+.......
    Signature Algorithm: md5WithRSAEncryption
        45:05:52:c7:9f:a7:35:32:d9:a8:be:58:92:a7:b0:61:e4:7a:
        2a:a2:36:0f:eb:65:0e:0f:ca:40:3d:0e:27:8b:38:14:a6:af:
        51:7d:28:2f:ac:3e:3e:05:7b:ea:d6:0e:fc:78:7d:eb:60:80:
        6a:74:43:64:ef:ca:e8:25:fe:d3:07:a9:4d:e0:54:4a:75:9f:
        c9:8e:9a:1e:82:19:a4:fc:72:a3:6f:0d:de:33:57:d8:f8:cd:
        da:d2:bc:8a:ee:48:34:4b:00:3e:7e:b7:5e:66:fa:2e:5c:22:
        4a:50:98:02:32:c6:e3:a9:07:b7:bb:e6:4d:02:e8:6c:d4:48:
        5e:55:ec:ed:a9:38:ee:b8:33:60:88:c1:ab:38:ce:d8:53:a3:
        ac:c3:a2:c1:d8:1e:95:5b:e5:3a:3f:d1:e0:51:c2:5e:82:e0:
        a4:48:d3:e6:82:66:56:d9:6b:e0:a5:1e:85:4d:3d:d7:e0:4e:
        03:ce:f7:5a:63:cd:5c:9a:38:96:59:0f:92:11:6b:eb:ed:34:
        1a:55:73:e1:c0:b0:91:ea:b4:1e:3b:8d:0f:2d:53:83:10:98:
        44:19:ac:39:6d:1a:6b:37:90:60:6a:35:9b:c6:41:2e:5a:ef:
        ae:54:6c:9e:51:b8:68:c2:97:83:2f:72:25:df:90:b9:bc:31:
        92:23:45:77
[train99 ~]$ 
</pre>
<p />
<p />
The contents are similar to the certificate, but the issuer is the DN of the user certificate.
<p />
<code>grid-cert-info</code> is useful to see how long your proxy certificate will last (the <strong>Not Before</strong> and <strong>Not After</strong> lines under <strong>Validity</strong>). 
<p />
<p />
<p />
<h3><a name="Using_a_proxy_certificate_to_tra"></a> Using a proxy certificate to transfer a file </h3>
<p />
<pre class="screen">
[train99 ~]$ <userinput>globus-url-copy gsiftp://localhost:2811/home/train99/tempFile gsiftp://localhost:2811/home/train99/destFile</userinput>
[train99 ~]$ <userinput>ls -lt destFile</userinput>
rw-r--r--  1 train99 train99 43 Jun 23 10:04 destFile
[train99 ~]$ <userinput>more destFile</userinput>
Temporary file for testing globus-url-copy
[train99 ~]$ 
</pre>
<p />
<code>globus-url-copy</code> picks up the proxy from the default location and uses that to authenticate with the <span class="twikiNewLink">GridFTP<a href="/bin/edit/Education/ASP2016/GridFTP?topicparent=Education/ASP2016.MidwestWSSecurityTutorial" rel="nofollow" title="GridFTP (this topic does not yet exist; you can create it)">?</a></span> server. Authentication establishes your identity. Note that the identity in proxy certificate is still your certificate's identity. 
<p />
Upon successful authentication, the server knows the client is who it claims to be. It then checks to see if the identity to authorized to transfer files and uses Grid Map Authorization to determine this. We have already set up the gridmap to allow your identity. We will learn more about this later in the exercise.
<p />
<h3><a name="Proxy_lifetime_implications"></a> Proxy lifetime implications </h3>
By default, a proxy valid for 12 hours is created, but the validity of proxy can be specified on command line.
<p />
<pre class="screen">
[train99 ~]$ <userinput>date</userinput>
Fri Jun 23 10:06:01 CDT 2006
[train99 ~]$
</pre>
<p />
<pre class="screen">
[train99 ~]$ <userinput> grid-proxy-init -valid 0:1</userinput>
Your identity: /O=Grid/OU=OSG/CN=Training User 99
Enter GRID pass phrase for this identity:
Creating proxy ........................................ Done
Your proxy is valid until: Fri Jun 23 10:07:10 2006
[train99 ~]$ 
</pre>
<p />
<pre class="screen">
[train99 ~]$ <userinput>grid-proxy-info</userinput>
subject  : /O=Grid/OU=OSG/CN=Training User 99/CN=24915772
issuer   : /O=Grid/OU=OSG/CN=Training User 99
identity : /O=Grid/OU=OSG/CN=Training User 99
type     : Proxy draft (pre-RFC) compliant impersonation proxy
strength : 512 bits
path     : /tmp/x509up_u539
timeleft : 0:00:52
[train99 ~]$ 
</pre>
<p />
The proxy requested was for 1 minute and <em>grid-proxy-info</em> shows the valid time left.
<p />
on      The proxy lifetime cannot be greater than the certificate that issues it.
<p />
<h3><a name="Attempting_to_use_expired_proxy"></a> Attempting to use expired proxy </h3>
Wait for a minute after the previous <em>grid-proxy-init</em> run before you try this step. The proxy file will exist, but would have expired.
<p />
<pre class="screen">
[train99 ~]$ <userinput>date</userinput>
Fri Jun 23 10:07:35 CDT 2006
[train99 ~]$ 
</pre>
<p />
<pre class="screen">
[train99 ~]$ <userinput>grid-proxy-info</userinput>
subject  : /O=Grid/OU=OSG/CN=Training User 99/CN=24915772
issuer   : /O=Grid/OU=OSG/CN=Training User 99
identity : /O=Grid/OU=OSG/CN=Training User 99
type     : Proxy draft (pre-RFC) compliant impersonation proxy
strength : 512 bits
path     : /tmp/x509up_u539
timeleft : 0:00:00
[train99 ~]$ 
</pre>
<p />
<pre class="screen">
[train99 ~]$ <userinput>globus-url-copy gsiftp://localhost:2811/home/train99/tempFile gsiftp://localhost:2811/home/train99/expiredTest</userinput>
error: globus_ftp_control: gss_init_sec_context failed
globus_gsi_gssapi: Error with GSI credential
globus_gsi_gssapi: Error with gss credential handle
globus_credential: Error with credential: The proxy credential: /tmp/x509up_u539
      with subject: /O=Grid/OU=OSG/CN=Training User 99/CN=24915772
      expired 1 minutes ago.
[train99 ~]$ 
</pre>
<p />
<pre class="screen">
[train99 ~]$ <userinput> ls -lt expiredTest</userinput>
ls: expiredTest: No such file or directory
[train99 ~]$ 
</pre>
<p />
The error indicates that the proxy file has expired. So the client was not able to successfully authenticate with server and the file was not transfered.
<p />
<!-- <strong>*</strong>  Comments plugin to create comments table for section   <strong>*</strong>    -->
<span style="text-align:center; font-weight:bold; font-size:1.2em;">ADD A COMMENT</span>
<span id="twid_4show" class="twistyMakeVisible">
       <a href="#" class="twistyTrigger"><em><strong>Show...</strong></em></a>
     </span>
     <span id="twid_4hide" class="twistyHidden">
       <a href="#" class="twistyTrigger"><em><strong>Hide</strong></em></a>
     </span>
     <div id="twid_4toggle" class="twistyMakeHidden">
<p />
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table4" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=0;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">COMMENT</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1 twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=1;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">NAME</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=2;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">DATE</font></a> </th>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Education/ASP2016/GridProxyCertificates" enctype="multipart/form-data" name="tableappend0" id="tableappend0">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="0"  /></form>
<p />
</div>
<!-- <strong>*</strong>  End Comment                                            <strong>*</strong>    -->
<p />
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Obtaining_a_new_certificate_with"></a> Obtaining a new certificate with cacl </span></h2>
<p />
<p />
<form name="EDITTHIS" action="/bin/edit/Education/ASP2016/ObtainingANewCertificateWithCacl" method="get"><input type="submit" value="Edit section" alt="Edit this section" title="Click to edit this section" class="twikiButton" style="font-size:.5em;"><input type="hidden" value="1487215509" name="t"></form>
<p />
A valid certificate was already installed for you and configuration was set up to use it. In this step we will attempt to get a new certificate from the San Diego Supercomputer Center certificate authority (SDSC CA) using a command-line tool called cacl.
<p />
Certificates issued by the SDSC CA will be valid on many grid resources, as it is a widely trusted certificate authority.
<p />
<h3><a name="Log_into_SDSC_login_host"></a> Log into SDSC login host </h3>
<p />
<pre class="screen">
$ <userinput>ssh tg-login.sdsc.teragrid.org</userinput>
Enter password: <userinput>[SDSC password from instructors]</userinput>
Last login: Mon Mar 19 16:05:02 2007 from h-66-134-156-130.chcgilgm.covad.net
Welcome to the TeraGrid Itanium2 Linux Cluster
San Diego Supercomputer Center

---
This system may be used by authorized persons only.
 
Unauthorized individuals' activity may be monitored 
and/or recorded by administrative personnel.  In 
the course of such monitoring or system maintenance, 
the activities of authorized users may also be monitored.
 
Use of this system expressly implies consent to such 
monitoring and is advised that evidence of criminal 
activity may be provided to law enforcement officials. 
---

Email help@teragrid.org for assistance.

Check http://clumon.sdsc.edu for cluster status.

Please visit http://news.teragrid.org and add your email address under "Manage Subscriptions" to receive email updates about the status of the system. 

Please use the parallel filesystem /gpfs for output from batch jobs, not your home directory.

*** NOTICE *** The /gpfs filesystem is being regularly purged.  Any files older than 4 days not associated with a queued or active batch job may be purged.  Please be sure to back up your data to a long-term archive.  ***

If you have questions, send them to SDSC consultants - send email to
help@teragrid.org or use the webpage at: www.sdsc.edu/user_services/consulting .

Directory: /users/train99
Tue Mar 20 08:29:58 PDT 2007
tg-login1 /users/train99> 

</pre>
<p />
<!-- <strong>*</strong>  Comments plugin to create comments table for section   <strong>*</strong>    -->
<span style="text-align:center; font-weight:bold; font-size:1.2em;">ADD A COMMENT</span>
<span id="twid_5show" class="twistyMakeVisible">
       <a href="#" class="twistyTrigger"><em><strong>Show...</strong></em></a>
     </span>
     <span id="twid_5hide" class="twistyHidden">
       <a href="#" class="twistyTrigger"><em><strong>Hide</strong></em></a>
     </span>
     <div id="twid_5toggle" class="twistyMakeHidden">
<p />
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table5" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=0;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">COMMENT</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1 twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=1;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">NAME</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=2;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">DATE</font></a> </th>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Education/ASP2016/ObtainingANewCertificateWithCacl" enctype="multipart/form-data" name="tableappend0" id="tableappend0">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="0"  /></form>
<p />
</div>
<!-- <strong>*</strong>  End Comment                                            <strong>*</strong>    -->
<p />
<p />
<h3><a name="Request_credential_from_cacl"></a> Request credential from cacl </h3>
<p />
<pre class="screen">
tg-login1 /users/train99> <userinput>cacl</userinput>

You already have a .globus directory.  It will be moved to 
.globus.old and a new .globus directory will be created. 

Please enter your login password: <userinput>SDSC password from instructors</userinput>
 
Next you will be prompted to enter a password which will serve as both
the encryption key for your certificate's private key and as the 
'export password' for your PKCS#12 converted certificate.  Please choose 
a password that you can remember, you will need to use it in the future.


Please enter your private key encryption password: <userinput>choose your own password and remember it!</userinput>
Verifying private key password, please reenter password: <userinput>same again</userinput>



You already have a certificate issued by this CA.  If you have forgotten 
your private key encryption password, lost your certificate or key,
or suspect that your certificate and key may have been compromised you
can request that your current certificate be revoked.  This will make
current certifcate invalid and unuseable.  It will also allow you to
immediately get a new certificate to replace your current certificate.



Would you like your current certificate to be revoked? [yes/no]: <userinput>yes</userinput>



You now have a .globus directory containing the following files: 

usercert.p12 - Your digital certificate and private key in 
               a PKCS#12 format certificate 

usercert.pem - Your digital certificate, signed by the CA 
               daemon 

userkey.pem  - Your encrypted private key matching the 
               public key contained in your usercert.pem 


********************************************************** 

 YOUR CERTIFICATE IS VALID FOR FOUR YEARS, DO NOT FORGET 
 YOUR PRIVATE KEY ENCRYPTION PASSWORD AND, DO NOT DELETE 
 YOUR .globus DIRECTORY. 

********************************************************** 

tg-login1 /users/train99> 
</pre>
<p />
<h3><a name="Copy_credentials_from_SDSC_to_lo"></a> Copy credentials from SDSC to login host </h3>
<p />
<p />
<pre class="screen">
tg-login1 /users/train99> <userinput>logout</userinput>
Connection to tg-login.sdsc.teragrid.org closed.

$ <userinput>mkdir ~/sdsccert</userinput>

$ <userinput>scp tg-login.sdsc.teragrid.org:.globus/* ~/sdsccert/</userinput>
Enter password:
usercert.p12                                  100% 2878     2.8KB/s   00:00    
usercert.pem                                  100% 4998     4.9KB/s   00:00    
userkey.pem                                   100% 1743     1.7KB/s   00:00    
$ 

</pre>
<p />
<h3><a name="Proxy_certificate_using_CACL_Cer"></a> Proxy certificate using CACL Certificates </h3>
First we need to ensure the SDSC certificates have been installed correctly and a proxy can be generated.
<p />
<pre class="screen">
[train99 ~]$ <userinput>grid-proxy-init -cert sdsccert/usercert.pem -key sdsccert/userkey.pem -out sdscProxy -verify</userinput>
Your identity: /O=Grid/OU=OSG/CN=Training User 99
Enter GRID pass phrase for this identity: <em><strong># not echoed!</strong></em>
Creating proxy ............................................ Done
Proxy Verify OK
Your proxy is valid until: Fri Jun 23 22:14:26 2006
[train99 ~]$ 
</pre>
<p />
There are several grid-proxy-init options used: <ul>
<li> <code>-cert</code> and <code>-key</code> allow you to specify non-default certificate and key file locations.
</li> <li> <code>-out</code> allows you to specify a non-default location for the proxy file.
</li> <li> <code>-verify</code> ensures that both the certificates used to create proxy and the CA are installed correctly and valid.
</li></ul> 
<p />
The contents of this proxy can be viewed using the <em>grid-proxy-info</em>.
<p />
<pre class="screen">
[train99 ~]$ <userinput>grid-proxy-info -file sdscProxy </userinput>
subject  : /C=US/O=Globus Alliance/OU=User/CN=10c00791bfb.54294d53/CN=1488313937
issuer   : /C=US/O=Globus Alliance/OU=User/CN=10c00791bfb.54294d53
identity : /C=US/O=Globus Alliance/OU=User/CN=10c00791bfb.54294d53
type     : Proxy draft (pre-RFC) compliant impersonation proxy
strength : 512 bits
path     : sdscProxy
timeleft : 11:58:33
[train99 ~]$ 
</pre>
<p />
The <code>-file</code> allows you to specify a non-default location for the proxy file.
<p />
The environment variable <em>X509_USER_PROXY</em> can be set to the proxy location. These tools will use that rather than default location. 
<p />
on      The issuer of the proxy is the DN from your SDSC certificate.
<p />
<!-- <strong>*</strong>  Comments plugin to create comments table for section   <strong>*</strong>    -->
<span style="text-align:center; font-weight:bold; font-size:1.2em;">ADD A COMMENT</span>
<span id="twid_6show" class="twistyMakeVisible">
       <a href="#" class="twistyTrigger"><em><strong>Show...</strong></em></a>
     </span>
     <span id="twid_6hide" class="twistyHidden">
       <a href="#" class="twistyTrigger"><em><strong>Hide</strong></em></a>
     </span>
     <div id="twid_6toggle" class="twistyMakeHidden">
<p />
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table6" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=0;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">COMMENT</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1 twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=1;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">NAME</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=2;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">DATE</font></a> </th>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Education/ASP2016/ObtainingANewCertificateWithCacl" enctype="multipart/form-data" name="tableappend1" id="tableappend1">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="1"  /></form>
<p />
</div>
<!-- <strong>*</strong>  End Comment                                            <strong>*</strong>    -->
<p />
<p />
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Using_SDSC_credentials"></a> Using SDSC credentials </span></h2>
<p />
<h3><a name="Setting_up_clients_to_use_SDSC_p"></a> Setting up clients to use SDSC proxy </h3>
To use the proxy genrated from your new credentials from SDSC, set the environment variable <code>X509_USER_PROXY</code> to point to your proxy file.
<p />
<pre class="screen">
[train99@workshop1 ~]$ <userinput>export X509_USER_PROXY=sdscProxy</userinput>
[train99@workshop1 ~]$ 
</pre>
<p />
<p />
<h3><a name="Using_SDSC_credentials_to_transf"></a> Using SDSC credentials to transfer file to remote server </h3>
<p />
<pre class="screen">
[train99@workshop2.lac.uic.edu ~]$ <userinput>globus-url-copy gsiftp://localhost:2811/home/train99/tempFile gsiftp://workshop2.lac.uic.edu:2811/tmp/train99TestFile</userinput>
error: globus_ftp_client: the server responded with an error
535 535-FTPD GSSAPI error: GSS Major Status: Authentication Failed
535-FTPD GSSAPI error: GSS Minor Status Error Chain:
535-FTPD GSSAPI error: 
535-FTPD GSSAPI error: accept_sec_context.c:170: gss_accept_sec_context: SSLv3 handshake problems
535-FTPD GSSAPI error: globus_i_gsi_gss_utils.c:881: globus_i_gsi_gss_handshake: Unable to verify remote side's credentials
535-FTPD GSSAPI error: globus_i_gsi_gss_utils.c:854: globus_i_gsi_gss_handshake: SSLv3 handshake problems: Couldn't do ssl handshake
535-FTPD GSSAPI error: OpenSSL Error: s3_srvr.c:1816: in library: SSL routines, function SSL3_GET_CLIENT_CERTIFICATE: no certificate returned
535-FTPD GSSAPI error: globus_gsi_callback.c:351: globus_i_gsi_callback_handshake_callback: Could not verify credential
535-FTPD GSSAPI error: globus_gsi_callback.c:443: globus_i_gsi_callback_cred_verify: Could not verify credential: self signed certificate in certificate chain
535 FTPD GSSAPI error: accepting context
[train99@workshop2.lac.uic.edu ~]$ 
</pre>
<p />
The above error indicates that the authentication failed because the CA who signed the certificate from which the proxy was created is not trusted on that machine. 
<p />
Note that the lifetime of proxy and certificates is valid. But since the chain of trust starts from the CA and the CA is not trusted, authentication fails.
<p />
Just to make sure your command is accurate, unset the <code>X509_USER_PROXY</code> variable: 
<p />
<p />
<pre class="screen">[train99@workshop2.lac.uic.edu ~]$ <userinput>unset X509_USER_PROXY</userinput></pre>
<p />
Submit using your locally issued certificate. 
<p />
<pre class="screen">[train99@workshop2.lac.uic.edu ~]$ <userinput>globus-url-copy gsiftp://localhost:2811/home/train99/tempFile gsiftp://workshop2.lac.uic.edu.lac.uic.edu:2811/tmp/train99TestFile</userinput></pre>
<p />
You'll see that you are able to transfer, because that CA is trusted on that server.
<p />
<h3><a name="Using_SDSC_credentials_to_tr_AN1"></a> Using SDSC credentials to transfer file  with in local cluster </h3>
Now lets try running the same command using the SDSC Proxy to transfer file with in local cluster. This cluster has been set up to trust SDSC CA. In this example workshop2.lac.uic.edu is local machine and gridlab2 is remote machine. Please use appropriate machines in your run.
<p />
<pre class="screen">
[train99@workshop2.lac.uic.edu ~]$ <userinput>export X509_USER_PROXY=gcsProxy</userinput>
[train99@workshop2.lac.uic.edu ~]$ <userinput>globus-url-copy gsiftp://localhost:2811/home/train99/tempFile gsiftp://gridlab2.phys.utb.edu:2811/tmp/train99Test</userinput>
error: globus_ftp_client: the server responded with an error
530 530-Login incorrect. :
 globus_gss_assist: Gridmap lookup failure: 
Could not map /C=US/O=Globus Alliance/OU=User/CN=10c00791bfb.54294d53
530-
530 End.
[train99@workshop2.lac.uic.edu ~]$ 
</pre>
<p />
The transfer fails here with authorization exceptions. 
<p />
The client authenticated with the server and the server established your identity as the DN specified in the error message. In this case:
<p />
<pre>/C&#61;US/O&#61;Globus Alliance/OU&#61;User/CN&#61;10c00791bfb.54294d53</pre>
<p />
But the identity established in authentication is not authorized to use the service. The service uses GridMap authorization, where a mapping of of authorized identities (DNs) is mapped to local user names.
<p />
<!-- <strong>*</strong>  Comments plugin to create comments table for section   <strong>*</strong>    -->
<span style="text-align:center; font-weight:bold; font-size:1.2em;">ADD A COMMENT</span>
<span id="twid_7show" class="twistyMakeVisible">
       <a href="#" class="twistyTrigger"><em><strong>Show...</strong></em></a>
     </span>
     <span id="twid_7hide" class="twistyHidden">
       <a href="#" class="twistyTrigger"><em><strong>Hide</strong></em></a>
     </span>
     <div id="twid_7toggle" class="twistyMakeHidden">
<p />
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table7" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" align="right" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=0;table=7;up=0#sorted_table" title="Sort by this column"><font color="#252b37">COMMENT</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1 twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=1;table=7;up=0#sorted_table" title="Sort by this column"><font color="#252b37">NAME</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=2;table=7;up=0#sorted_table" title="Sort by this column"><font color="#252b37">DATE</font></a> </th>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Education/ASP2016/MidwestWSSecurityTutorial" enctype="multipart/form-data" name="tableappend1" id="tableappend1">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="1"  /></form>
<p />
</div>
<!-- <strong>*</strong>  End Comment                                            <strong>*</strong>    -->
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Contents_of_GridMap_file"></a> Contents of GridMap file </span></h2>
The local GridFTP service and the one on remote machine is configured to use a gridmap file located in <code>etc/grid-security/gridmap-file</code>. This file is write protected so only administrators can change it to give access. But the file can be read by anyone.
<p />
For example:
<p />
<pre class="screen">
[train99@workshop2.lac.uic.edu ~]$ <userinput>more /etc/grid-security/grid-mapfile </userinput>
#
# Automatically generated by gx-gen-mapfile (gx-map 0.5.1)
# at Fri 2006-06-23 15:26:02 UTC on workshop2.lac.uic.edu.
# DO NOT EDIT THIS FILE.  ANY CHANGES YOU MAKE WILL BE LOST ON THE NEXT UPDATE.
#
"/C=US/O=Globus Alliance/OU=User/CN=101497d3dcd.3dcd5aef" ranantha
"/C=US/O=Globus Alliance/OU=User/CN=10bd8f410f6.5f0086b4" benc
"/C=US/O=Globus Alliance/OU=User/CN=10bf234e01a.ac286cfa" ranantha
"/C=US/O=SDSC/OU=SDSC/CN=Account Train10/UID=train10" train10
"/C=US/O=SDSC/OU=SDSC/CN=Account Train11/UID=train11" train11
"/C=US/O=SDSC/OU=SDSC/CN=Account Train12/UID=train12" train12
...
"/C=US/O=SDSC/OU=SDSC/CN=Account Train58/UID=train58" train58
"/C=US/O=SDSC/OU=SDSC/CN=Account Train59/UID=train59" train59
"/C=US/O=SDSC/OU=SDSC/CN=Account Train60/UID=train60" train60
"/DC=org/DC=doegrids/OU=People/CN=Gaurang Mehta 998137" gmehta
[train99@workshop2.lac.uic.edu ~]$ 
</pre>
<p />
This gridmap file has been created using a tool (it can also be hand written).
<p />
Only the listed DNs are allowed to access the GRAM server.
<p />
Each entry is a mapping from DN to username. For example, DN <tt>/O=Grid/OU=OSG/CN=Training User 99</tt> is mapped to usename <code>train99</code>.
<p />
on      The identity presented by credenitals you used in previous step is not in the gridmap file. 
<p />
<!-- <strong>*</strong>  Comments plugin to create comments table for section   <strong>*</strong>    -->
<span style="text-align:center; font-weight:bold; font-size:1.2em;">ADD A COMMENT</span>
<span id="twid_8show" class="twistyMakeVisible">
       <a href="#" class="twistyTrigger"><em><strong>Show...</strong></em></a>
     </span>
     <span id="twid_8hide" class="twistyHidden">
       <a href="#" class="twistyTrigger"><em><strong>Hide</strong></em></a>
     </span>
     <div id="twid_8toggle" class="twistyMakeHidden">
<p />
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table8" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=0;table=8;up=0#sorted_table" title="Sort by this column"><font color="#252b37">COMMENT</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1 twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=1;table=8;up=0#sorted_table" title="Sort by this column"><font color="#252b37">NAME</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=2;table=8;up=0#sorted_table" title="Sort by this column"><font color="#252b37">DATE</font></a> </th>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Education/ASP2016/MidwestWSSecurityTutorial" enctype="multipart/form-data" name="tableappend2" id="tableappend2">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="2"  /></form>
<p />
</div>
<!-- <strong>*</strong>  End Comment                                            <strong>*</strong>    -->
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Using_gx_gridmap_to_add_SDSC_cer"></a> Using gx-gridmap to add SDSC certificate DN to gridmap </span></h2>
Typically an administrator is required to add users to the gridmap file and is an out of band activity. The tool <code>gx-gridmap</code>, if set up by the admnistator, can be used by anyone who has access to a machine to add an identity to the gridmap file. The actual addition is not instant and it will take a few minutes to reflect on the gridmap file.
<p />
<pre class="screen">
[train99@workshop2.lac.uic.edu ~]$ <userinput>gx-request -quick-add</userinput>
About to map distinguished name
    "/C=US/O=SDSC/OU=SDSC/CN=Account Train55/UID=train99"
to user
    train99
Proceed? [yn] <userinput>y</userinput>
Mapping request submitted.
The grid-mapfile should be updated in a few minutes
[train99@workshop2.lac.uic.edu ~]$ 
</pre>
<p />
This update may take a few minutes. You can look for the update by searching the gridmap file for your DN.
<p />
<pre class="screen">
[train99@workshop2.lac.uic.edu ~]$ <userinput>grep "/O=Grid/OU=OSG/CN=Training User 99" /etc/grid-security/grid-mapfile </userinput>
[train99@workshop2.lac.uic.edu ~]$ <userinput>grep "/O=Grid/OU=OSG/CN=Training User 99" /etc/grid-security/grid-mapfile </userinput>
"/O=Grid/OU=OSG/CN=Training User 99" train99
[train99@workshop2.lac.uic.edu ~]$ 
</pre>
<p />
You have to do a similar step in the remote machine (i.e workshop2.lac.uic.edu in this example).
<p />
First, let us get the DN we want mapped on the remote machine.
<p />
<pre class="screen">
[train99@workshop2.lac.uic.edu ~]$ <userinput>grid-proxy-info -subject</userinput>
/O=Grid/OU=OSG/CN=Training User 99/CN=1488313937
</pre>
<p />
The output needs to be pasted in the command you run on remote machine. In a second terminal, ssh to the remote machine.
<p />
<pre class="screen">
[train99@workshop2.lac.uic.edu ~]$ <userinput>ssh workshop2.lac.uic.edu</userinput>
[train99@workshop2.lac.uic.edu ~]$ <userinput>gx-request -interactive</userinput>
The gx-request command lets you submit a request to modify the
Globus grid-mapfile(s) on one or more machines.  Once the request
is submitted, the updates should occur within a few minutes.

A grid-mapfile entry maps a DN (Distinguished Name) to a Unix
user name.  For example, an entry like
    "/O=Big University/OU=Small Department/CN=John Doe" jdoe
allows a user holding a Globus certificate with the specified
DN to run Globus jobs under the Unix account "jdoe".

gx-request can be run interactively or with command-line arguments.

In this interactive mode, you will be asked a series of questions.
Enter your responses followed by &gt;return>.

Single-letter menu responses are case-insensitive; other responses
must be entered exactly.

If there is a default response indicated by the prompt, you can
enter it by just typing &gt;return>.

(a) Add a grid-mapfile entry
(r) Remove a grid-mapfile entry
(u) Request an update of the grid-mapfiles
(x) Exit
(The "set" operation is not currently available in interactive mode.)
What do you want to do? [arux] <userinput>a</userinput>
You can specify the DN in one of the following ways:
(c) Certificate, extract from /home/train99/.globus/usercert.pem
(f) File, extract from a specified certificate file
(i) Input the DN directly
(x) Exit
How do you want to specify the DN? [cfix]<userinput>i</userinput>
Enter distinguished name: <userinput>/O=Grid/OU=OSG/CN=Training User 99</userinput>
You may provide your e-mail address if you wish.
It will be recorded in the request log, and may be used
to contact you if there is a problem with your certificate.
E-mail address (&gt;return> for none): 

You may provide an optional comment.
If you do, it will be recorded in the request log.
Press return if you don't wish to provide a comment.
Comment: 

About to map distinguished name
    "/O=Grid/OU=OSG/CN=Training User 99"
to user
    train99
Proceed? [yn]<userinput>y</userinput>
Mapping request submitted.
The grid-mapfile should be updated in a few minutes
[train99@workshop2.lac.uic.edu ~]$ 
</pre>
<p />
The update takes a few minutes.
<p />
<!-- <strong>*</strong>  Comments plugin to create comments table for section   <strong>*</strong>    -->
<span style="text-align:center; font-weight:bold; font-size:1.2em;">ADD A COMMENT</span>
<span id="twid_9show" class="twistyMakeVisible">
       <a href="#" class="twistyTrigger"><em><strong>Show...</strong></em></a>
     </span>
     <span id="twid_9hide" class="twistyHidden">
       <a href="#" class="twistyTrigger"><em><strong>Hide</strong></em></a>
     </span>
     <div id="twid_9toggle" class="twistyMakeHidden">
<p />
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table9" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=0;table=9;up=0#sorted_table" title="Sort by this column"><font color="#252b37">COMMENT</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1 twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=1;table=9;up=0#sorted_table" title="Sort by this column"><font color="#252b37">NAME</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=2;table=9;up=0#sorted_table" title="Sort by this column"><font color="#252b37">DATE</font></a> </th>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Education/ASP2016/MidwestWSSecurityTutorial" enctype="multipart/form-data" name="tableappend3" id="tableappend3">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="3"  /></form>
<p />
</div>
<!-- <strong>*</strong>  End Comment                                            <strong>*</strong>    -->
<p />
<p />
<p />
<h3><a name="Using_SDSC_trusted_credentials_t"></a> Using SDSC trusted credentials to transfer file with in local server</h4> </h3>
Now that the gridmap file has been updated such that your identity is authorized to submit jobs, lets try the command again.
<p />
<pre class="screen">
[train99@workshop1 ~]$ <userinput>globus-url-copy gsiftp://localhost:2811/home/train99/tempFile gsiftp://workshop2.lac.uic.edu.:2811/tmp/train99Test 
</userinput>
[train99@workshop1 ~]$ 
</pre>
<p />
The client authenticated succesfully with the server. So the server knows the identity of the client. A handshake occured between the client and server to establish a &quot;context&quot;, which is a secret key used to secure the message.
<p />
The request and response was then signed using that context, so that it cannot be tampered with.
<p />
We can explicitly request for this message to be encrypted, so that no one else can read it. Then the same context is used to encrypt the message.
<p />
To ensure the transfer occured, lets ssh to remote machine and look for file:
<p />
<pre class="screen">
[train99@workshop1 ~]$ <userinput>ssh workshop2.lac.uic.edu</userinput>
[train99@workshop2 ~]$ <userinput>ls -lt /tmp/train99Test</userinput>
-rw-r--r--  1 train99 train99 43 Jun 23 12:07 /tmp/train99Test
[train99@workshop2 ~]$ 
</pre>
<p />
<!-- <strong>*</strong>  Comments plugin to create comments table for section   <strong>*</strong>    -->
<span style="text-align:center; font-weight:bold; font-size:1.2em;">ADD A COMMENT</span>
<span id="twid_10show" class="twistyMakeVisible">
       <a href="#" class="twistyTrigger"><em><strong>Show...</strong></em></a>
     </span>
     <span id="twid_10hide" class="twistyHidden">
       <a href="#" class="twistyTrigger"><em><strong>Hide</strong></em></a>
     </span>
     <div id="twid_10toggle" class="twistyMakeHidden">
<p />
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table10" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=0;table=10;up=0#sorted_table" title="Sort by this column"><font color="#252b37">COMMENT</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1 twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=1;table=10;up=0#sorted_table" title="Sort by this column"><font color="#252b37">NAME</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <a rel="nofollow" href="/bin/view/Education/ASP2016/MidwestWSSecurityTutorial?cover=print;sortcol=2;table=10;up=0#sorted_table" title="Sort by this column"><font color="#252b37">DATE</font></a> </th>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Education/ASP2016/MidwestWSSecurityTutorial" enctype="multipart/form-data" name="tableappend4" id="tableappend4">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="4"  /></form>
<p />
<p />
</div>
<!-- <strong>*</strong>  End Comment                                            <strong>*</strong>    -->
<p />
<p />
<!--
<a href="/bin/view/Main/ForrestChristian" class="twikiLink">ForrestChristian</a> - 24 Mar 2007 - Added VARIABLES
-->
<!--                                                                             <ul>
 <li>
 <ul>
<li> Set LOGINHOST = workshop2.lac.uic.edu
</li> <li> Set LOGINHOSTSHORT = workshop1
</li> <li> Set LOGINIP = 131.193.181.56
</li> <li> Set GRIDHOST = tg-login.sdsc.teragrid.org
</li> <li> Set OTHERHOST = workshop2.lac.uic.edu
</li> <li> Set OTHERHOSTSHORT = workshop2
</li> <li> Set CERTSUBJECT = /O=Grid/OU=OSG/CN=Training User 99
</li> <li> Set LOGINNAME = train99
</li> <li> Set HOMEDIR = /home/train99
</li></ul> 
</li></ul> 
-->
<p />
<p /></div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education/ASP2016<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/ASP2016/GridWorkshops" class="twikiLink">GridWorkshops</a> &gt; <a href="/bin/view/Education/ASP2016/MidwestGridWorkshop" class="twikiLink">MidwestGridWorkshop</a> &gt; <a href="/bin/view/Education/ASP2016/MidwestSyllabus" class="twikiLink">MidwestSyllabus</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>MidwestWSSecurityTutorial</span> <br />    
Topic revision: r10 - 06 Dec 2016 - 18:12:47 - <a href="/bin/view/Main/KyleGross" class="twikiLink">KyleGross</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />