<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> CondorStandardOSS2010 &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/CondorStandardOSS2010?_T=16 Feb 2017" type="application/x-wiki" title="edit CondorStandardOSS2010" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/CondorStandardOSS2010"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TWISTYPLUGIN_TWISTY--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.css");
</style>
<script type='text/javascript' src='https://twiki.opensciencegrid.org/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js'></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiPref.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.compressed.js"></script>
<script type="text/javascript">
// <![CDATA[
var styleText = '<style type="text/css" media="all">.twikiMakeVisible{display:inline;}.twikiMakeVisibleInline{display:inline;}.twikiMakeVisibleBlock{display:block;}.twikiMakeHidden{display:none;}</style>';
document.write(styleText);
// ]]>
</script>

<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Submitting_a_standard_universe_j"></a> Submitting a standard universe job </h1>
<p />
<div style="margin-left: 1em; margin-right: 1em; border: 1px solid black; padding: 0.5em;">
<h3><a name="Objective_of_this_exercise"></a> Objective of this exercise </h3>
The objective of this exercise is to teach you about Condor's standard universe, which provides checkpointing.
</div>
<p />
<p />
Your first job was considered a vanilla universe job. This meant that it was a plain old job. Condor also supports standard universe jobs. If you have the source code for your program and if it meets certain requirements, you can re-link your program and Condor will provide two major features for you: 
<p /> <ul>
<li> Your job can be checkpointed and restarted. When a job is checkpointed, its complete state is saved. When it is restarted, it restarts from where it was checkpointed. If your job is checkpointed periodically, you can recover if there is some sort of failure or interruption. This is incredibly useful for long-running jobs--wouldn't you hate to lose hours or days of work due to a power outage? When Condor restarts, it can restart your job from the last checkpoint, saving you lots of time.
</li> <li> Your job can use remote I/O. This means that every file operation the job makes is performed on the submission computer, so it appears as though the job is running on the submission computer, not the execution computer. If you have files that are not on a shared filesystem, this can be very useful. Note: This means that file transfer options are not relevant to standard universe jobs. You do not need to specify file transfer, whether submitting from a local disk or a shared filesystem.
</li></ul> 
<p />
Your tutorial leader will give you more details about standard universe before the 2nd-half of Monday morning, or you can read about them <a href="http://www.cs.wisc.edu/condor/manual/v7.4/1_3Exceptional_Features.html" target="_top">online</a>. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="But_first"></a> But first </span></h2>
For this example (and this example only), please log into <code>osg-edu.cs.wisc.edu</code>. While we prefer you to use <code>vdt-itb</code> for all the other exercises, you'll need to use osg-edu instead for just this exercises, due to complexities of the standard universe. If you're curious about the details, ask your instructor.  Your login and password will be the same as on <code>vdt-itb.cs.wisc.edu</code> (note that if you changed your password on <code>vdt-itb</code> you should use the original password given to you).
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Linking_a_program_for_standard_u"></a> Linking a program for standard universe </span></h2>
First, you need a job to run. We'll use the same job as before. In case you don't have it, here it is. Save it in simple.c: 
<p />
<pre style="margin-left:4em" class="screen">
#include &lt;stdio.h&gt;

main(int argc, char **argv)
{
    int sleep_time;
    int input;
    int failure;

    if (argc != 3) {
        printf("Usage: simple &lt;sleep-time&gt; &lt;integer&gt;\n");
        failure = 1;
    } else {
        sleep_time = atoi(argv[1]);
        input      = atoi(argv[2]);

        printf("Thinking really hard for %d seconds...\n", sleep_time);
        sleep(sleep_time);
        printf("We calculated: %d\n", input * 2);
        failure = 0;
    }
    return failure;
}
</pre>
<p />
Now compile the program using condor_compile. This doesn't change how the program is compiled, just how it is linked. Take note that the executable is named differently. 
<p />
<pre style="margin-left:4em" class="screen">
% condor_compile gcc -m32 -o simple.std simple.c

LINKING FOR CONDOR : /usr/bin/ld -L/usr/lib/condor -Bstatic --eh-frame-hdr -m elf_i386 -dynamic-linker /lib/ld-linux.so.2 \
    -o simple.std /usr/lib/condor/condor_rt0.o \
    /usr/lib/gcc/i386-redhat-linux/3.4.6/../../../crti.o 
    /usr/lib/gcc/i386-redhat-linux/3.4.6/crtbeginT.o 
    -L/usr/lib/condor -L/usr/lib/gcc/i386-redhat-linux/3.4.6 
    -L/usr/lib/gcc/i386-redhat-linux/3.4.6 
    -L/usr/lib/gcc/i386-redhat-linux/3.4.6/../../.. /tmp/ccWfWUNy.o 
    /usr/lib/condor/libcondorzsyscall.a 
    /usr/lib/condor/libcondor_z.a 
    /usr/lib/condor/libcomp_libstdc++.a 
    /usr/lib/condor/libcomp_libgcc.a 
    /usr/lib/condor/libcomp_libgcc_eh.a 
    --as-needed --no-as-needed 
    -lcondor_c -lcondor_nss_files -lcondor_nss_dns -lcondor_resolv -lcondor_c 
    -lcondor_nss_files -lcondor_nss_dns -lcondor_resolv -lcondor_c 
    /usr/lib/condor/libcomp_libgcc.a 
    /usr/lib/condor/libcomp_libgcc_eh.a 
    --as-needed --no-as-needed 
    /usr/lib/gcc/i386-redhat-linux/3.4.6/crtend.o 
    /usr/lib/gcc/i386-redhat-linux/3.4.6/../../../crtn.o
/usr/lib/condor/libcondorzsyscall.a(condor_file_agent.o)(.text+0x35d): In function `CondorFileAgent::open(char const*, int, int)':
: warning: the use of `tmpnam' is dangerous, better use `mkstemp'
/usr/lib/condor/libcondorzsyscall.a(switches.o)(.text+0x618d): In function `__gets_chk':
: warning: the `gets' function is dangerous and should not be used.

% ls -lh simple.std
-rwxr-xr-x  1 root root 1.4M Jul  8 17:10 simple.std
</pre>
<p />
There are some warnings there--you can safely ignore those warnings. You can also see just how many libraries we link the program against. It's a lot! And yes, the executable is much bigger now. Partly that's the price of having checkpointing and partly it is because the program is now statically linked, but you can make it slightly smaller if you want by getting rid of debugging symbols: 
<p />
<pre style="margin-left:4em" class="screen">
% strip simple.std

% ls -lh simple.std
-rwxr-xr-x  1 root root 1.2M Jul  8 17:17 simple.std*
</pre>
<p />
Note the extra output when you run the program by hand now: 
<p />
<pre style="margin-left:4em" class="screen">
% ./simple.std 4 10
Condor: Notice: Will checkpoint to ./simple.std.ckpt
Condor: Notice: Remote system calls disabled.
Thinking really hard for 4 seconds...
We calculated: 20
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Submitting_a_standard_universe_p"></a> Submitting a standard universe program </span></h2>
Submitting a standard universe job is almost the same as a vanilla universe job. Just change the universe to standard. Here is a sample submit file. I suggest making it run for a longer time, so we can experiment with the checkpointing while it runs. Also, get rid of the multiple queue commands that we had. Here is the complete submit file, I suggest naming it submit.std. 
<p />
<pre style="margin-left:4em" class="screen">
Universe   = <font color="#ff0000">standard</font>
Executable = simple.std
Arguments  = 120 10
Log        = simple.log
Output     = simple.out
Error      = simple.error
Queue
</pre>
<p />
Notice that we are not transferring files this time. This is because standard universe provides remote I/O: all I/O for a job behaves as if it actually is being performed at the submission computer. This is convenient for complex jobs that access lots of files on the file system including shared libraries, input, and output.
<p />
Then submit it as you did before, with condor_submit: 
<p />
<pre style="margin-left:4em" class="screen">
% rm -f simple.log

% condor_submit submit.std
Submitting job(s).
Logging submit event(s).
1 job(s) submitted to cluster 10588.

% condor_q
-- Submitter: osg-edu.cs.wisc.edu : <192.168.0.1:32786> : osg-edu.cs.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               
10588.0   roy             7/8  17:20   0+00:00:00 I  0   1.2  simple.std 120 10 

1 jobs; 1 idle, 0 running, 0 held

% condor_q
-- Submitter: osg-edu.cs.wisc.edu : <192.168.0.1:32786> : osg-edu.cs.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               
10588.0   roy             7/8  17:20   0+00:00:02 R  0   1.2  simple.std 120 10 

1 jobs; 0 idle, 1 running, 0 held

% condor_q
-- Submitter: osg-edu.cs.wisc.edu : <192.168.0.1:32786> : osg-edu.cs.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               

0 jobs; 0 idle, 0 running, 0 held

% cat simple.log
000 (10588.000.000) 07/08 17:20:47 Job submitted from host: <192.168.0.1:32786>
...
001 (10588.000.000) 07/08 17:20:48 Job executing on host: <192.168.0.15:32771>
...
005 (10588.000.000) 07/08 17:22:48 Job terminated.
	(1) Normal termination (return value 0)
		Usr 0 00:00:00, Sys 0 00:00:00  -  Run Remote Usage
		Usr 0 00:00:00, Sys 0 00:00:00  -  Run Local Usage
		Usr 0 00:00:00, Sys 0 00:00:00  -  Total Remote Usage
		Usr 0 00:00:00, Sys 0 00:00:00  -  Total Local Usage
	1046  -  Run Bytes Sent By Job
	1210125  -  Run Bytes Received By Job
	1046  -  Total Bytes Sent By Job
</pre>
<p />
Notice that the log file has a bit more information this time: we can see how much data was transfered to and from the job because it's in the standard universe. The remote usage was not very interesting because the job just slept, but a real job would have some interesting numbers there. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Advanced_tricks_in_the_standard"></a> Advanced tricks in the standard universe </span></h2>
At this point in the tutorial, I will demonstrate how you can force your job to be checkpointed and what it will look like. We will use a command called condor_checkpoint that you normally never to use, so we can demonstrate. One reason that it normally isn't used is because it checkpoints all jobs running on a computer, not just the job you want to checkpoint. Be warned.
<p />
Begin by submitting your job, and figuring out where it is running: 
<p />
<pre style="margin-left:4em" class="screen">
% rm -f simple.log

% condor_submit submit.std
Submitting job(s).
Logging submit event(s).
1 job(s) submitted to cluster 10591.

% condor_q
-- Submitter: osg-edu.cs.wisc.edu : <192.168.0.1:32786> : osg-edu.cs.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               
10591.0   roy             7/8  17:24   0+00:00:08 R  0   1.2  simple.std 120 10 

1 jobs; 0 idle, 1 running, 0 held

% condor_q -run
-- Submitter: osg-edu.cs.wisc.edu : <192.168.0.1:32786> : osg-edu.cs.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME HOST(S)         
10591.0   roy             7/8  17:24   0+00:00:11 slot1@miniosg-c04.cs.wisc.edu
</pre>
<p />
Now let's tell Condor to checkpoint and see what happens. <font color="#ff0000">Update this to be appropriate for your job!</font>
<p />
<pre style="margin-left:4em" class="screen">
% condor_checkpoint <font color="#ff0000">miniosg-c04</font>
Sent "Checkpoint-All-Jobs" command to startd miniosg-c04.cs.wisc.edu

% cat simple.log
000 (10591.000.000) 07/08 17:24:19 Job submitted from host: <192.168.0.1:32786>
...
001 (10591.000.000) 07/08 17:24:39 Job executing on host: <192.168.0.15:32771>
...
006 (10591.000.000) 07/08 17:25:00 Image size of job updated: 1935
...
003 (10591.000.000) 07/08 17:25:00 Job was checkpointed.
	Usr 0 00:00:00, Sys 0 00:00:00  -  Run Remote Usage
	Usr 0 00:00:00, Sys 0 00:00:00  -  Run Local Usage
	0  -  Run Bytes Sent By Job For Checkpoint
...
005 (10591.000.000) 07/08 17:25:00 Job terminated.
	(1) Normal termination (return value 0)
		Usr 0 00:00:00, Sys 0 00:00:00  -  Run Remote Usage
		Usr 0 00:00:00, Sys 0 00:00:00  -  Run Local Usage
		Usr 0 00:00:00, Sys 0 00:00:00  -  Total Remote Usage
		Usr 0 00:00:00, Sys 0 00:00:00  -  Total Local Usage
	703173  -  Run Bytes Sent By Job
	1210458  -  Run Bytes Received By Job
	703173  -  Total Bytes Sent By Job
	1210458  -  Total Bytes Received By Job
...
</pre>
<p />
Voila! We checkpointed our job correctly. 
<p />
<div style="margin-left: 1em; margin-right: 1em; background-color: #ffff66; border: 1px solid black; padding: 0.5em;">
<strong>Advanced note:</strong>
<p />
<span class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdEducationCondorStandardOSS20101show" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">More...</span></a> </span> <span id="twistyIdEducationCondorStandardOSS20101hide" class="twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide</span></a> </span>  </span><!--/twistyPlugin twikiMakeVisibleInline--> <span class="twistyPlugin"><span id="twistyIdEducationCondorStandardOSS20101toggle" class="twistyContent twikiMakeHidden twistyInited">
<p />
You might notice that the job finished right after it was checkpointed. Why? The job was checkpointed while executing sleep(), then essentially restarted from the checkpoint (though Condor doesn't consider this to be a restart since the job didn't leave the computer). Condor didn't keep track of how much time had elapsed in the sleep call, so the job finished right away. Don't worry--Condor handles other system calls just fine. It's not clear how to handle checkpointing sleep()--if your job is interrupted during the sleep and restarted sometime later, how much time should Condor force the job to sleep for? Do we rely on wall clock time? Run time? 
</span></span> <!--/twistyPlugin-->
</div>
<p />
Normally, you <em>never</em> need to use condor_checkpoint: we just used it as a demonstration. Condor will checkpoint your jobs periodically (the default is every three hours) or when your job is forced to leave a computer to give time to another user. So you should never need to use condor_checkpoint. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Challenges_if_you_have_extra_tim"></a> Challenges (if you have extra time) </span></h2>
<p />
You can customize the behavior of the standard universe quite a bit. For instance, you can force some files to be accesssed locally instead of via remote I/O. You can change the buffering of remote I/O to get better performance. You can disable checkpointing. You can kill a job that has been restarted from its checkpoint more than three times. How do you do these things? 
<p />
Hint: Look at the <a href="http://www.cs.wisc.edu/condor/manual/v7.4/condor_submit.html" target="_top">condor_submit manual page</a>.</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/GridWorkshops" class="twikiLink">GridWorkshops</a> &gt; <a href="/bin/view/Education/OSGSummerSchool2010" class="twikiLink">OSGSummerSchool2010</a> &gt; <a href="/bin/view/Education/MaterialsOSS2010" class="twikiLink">MaterialsOSS2010</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>CondorStandardOSS2010</span> <br />    
Topic revision: r6 - 18 Jul 2010 - 20:12:25 - <span class="twikiNewLink">AlainRoy<a href="/bin/edit/Education/AlainRoy?topicparent=Education.CondorStandardOSS2010" rel="nofollow" title="AlainRoy (this topic does not yet exist; you can create it)">?</a></span>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />