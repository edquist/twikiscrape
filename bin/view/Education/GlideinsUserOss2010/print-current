<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GlideinsUserOss2010 &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/GlideinsUserOss2010?_T=16 Feb 2017" type="application/x-wiki" title="edit GlideinsUserOss2010" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/GlideinsUserOss2010"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Glidein_for_the_users_Hands_on_S"></a> Glidein for the users - Hands-on Session, Wednesday July 21st, 2010 </h1>
<p />
This session will give you hands-on experience in using the glideinWMS as a user.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Local_setup"></a> Local setup </span></h2>
<p />
As with all the other hands-on exercises, we will be using <br>
<tt>vdt-itb.cs.wisc.edu</tt><br>
to submit and monitor our jobs.
<p />
However, we will use <b>a different Condor instance running on that same machine</b>.<br>
The reason for having a different instance is due to the security requirements
of having a Condor pool spread across the WAN (see also the <a href="https://twiki.grid.iu.edu/twiki/pub/Education/MaterialsOSS2010/pilots_and_glideinwms_lecture.pdf" target="_top">lecture</a>).
Interested students can talk to me to get a more detailed information,
for all the others, you just need to make sure you point to the right Condor installation.
<p />
To use the proper Condor instance, please run:
<pre>
[sfiligoi@vdt-itb ~]$ source /opt/glidecondor/condor.sh 
</pre>
<p />
At any given point, you can check you are using the right one by using:
<pre>
[sfiligoi@vdt-itb ~]$ which condor_submit
/opt/glidecondor/bin/condor_submit
[sfiligoi@vdt-itb ~]$ echo $CONDOR_CONFIG
/opt/glidecondor/etc/condor_config
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="The_work_environment"></a> The work environment </span></h2>
<p />
As mentioned in the <a href="https://twiki.grid.iu.edu/twiki/pub/Education/MaterialsOSS2010/pilots_and_glideinwms_lecture.pdf" target="_top">lecture</a>,
the glideinWMS environment looks almost exactly like a regular, local Condor pool.
<p />
It just does not have any resources attached unless you ask for them;
try
<pre>
condor_status
</pre>
<p />
The glideinWMS will submit glideins on your behalf when you will need them.
But you may need to tell it what are your needs (but more on this later on).
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Generic_jobs"></a> Generic jobs </span></h2>
<p />
Let's start with a very generic job;<br>
a variation of the basic Condor jobs Alain introduced you to.
<p />
Let us <a href="http://www.stealthcopter.com/blog/2009/09/python-calculating-pi-using-random-numbers/" target="_top">calculate Pi using the monte carlo method</a>;<br>
create a file called
<pre>
pi.py
</pre>
containing
<pre>
#!/bin/env python
from random import *  
from math import sqrt,pi  
from sys import argv
inside=0  
n=int(argv[1])
for i in range(0,n):  
    x=random()  
    y=random()  
    if sqrt(x*x+y*y)<=1:  
        inside+=1  
pi_prime=4.0*inside/n  
print pi_prime, pi-pi_prime
</pre>
and make it executable.
<p />
Try to run it:
<pre>
./pi.py 1000000
</pre>
The first number is the approximation of pi, while the second one is how far from the real Pi it is.
<p />
Repeat a couple of times.
As you can see, the result changes every time.
<p />
Now, lets submit it as a Condor job;
or better to say, as a bunch of Condor jobs.
<p />
These jobs should run everywhere, so no need to specify any requirement:
<pre>
Universe   = vanilla
Executable = pi.py
Arguments  = 10000000
Requirements = (Arch=!="")
Log        = pi.$(Cluster).log
Output   = pi.$(Cluster).$(Process).out
Error      = pi.$(Cluster).$(Process).err
should_transfer_files   = YES
when_to_transfer_output = ON_EXIT
Queue 100
</pre>
<p />
Submit the above.
<p />
Now sit back and relax... Condor+glideinWMS will take care of everything else... 
after a few minutes we just look at the outputs and see who got the most precise Pi.
<p />
Well... you would do that if you were a seasoned user.
As a student, you are supposed to see what is going on.
<p />
So run <tt>condor_q</tt> and <tt>condor_status</tt> from time to time, until the jobs are done.
<p />
What do you see?
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Understanding_where_jobs_are_run"></a> Understanding where jobs are running </span></h2>
<p />
While your jobs can run everywhere, you may still want to know where they actually ran;
either becuase you want to know who to thank for the CPUs you were consuming,
or to debug problems you had with your program (unlikely in this case... but one never knows).
<p />
So let us add a couple additional attributes to the submit file:
<pre>
Universe   = vanilla
Executable = pi.py
Arguments  = 50000000
Requirements = (Arch=!="")
Log        = pi.$(Cluster).log
Output   = pi.$(Cluster).$(Process).out
Error      = pi.$(Cluster).$(Process).err
should_transfer_files   = YES
when_to_transfer_output = ON_EXIT
+JOB_Site = "$$(GLIDEIN_Site:Unknown)"
+JOB_Gatekeeper = "$$(GLIDEIN_Gatekeeper:Unknown)"
Queue 100
</pre>
<p />
Now submit the job cluster.
<p />
Now monitor the running jobs with
<pre>
condor_q `id -un` -const 'JobStatus==2' -format '%d.' ClusterId -format '%d ' ProcId -format '%s\n' MATCH_EXP_JOB_Site
</pre>
<p />
What do you see?
<p />
For completed jobs, you can use
<pre>
condor_history JOB_ID -format '%d.' ClusterId -format '%d ' ProcId -format '%s\n' MATCH_EXP_JOB_Site
</pre>
<p />
Similarly, you can monitor where the available resources are by using:
<pre>
condor_status -format "%-40s\t" Name -format "%s\t" GLIDEIN_Site -format "%s\n" State
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="BLAST_jobs"></a> BLAST jobs </span></h2>
<p />
Let us now run a set of BLAST jobs, similarly the way <a href="https://twiki.grid.iu.edu/bin/view/Education/CondorBLASTOSS2010" target="_top">you did Monday</a>.
<p />
BLAST jobs will however not run everywhere... only a subset of Grid site have BLAST installed.
<p />
So we need to tell the glideinWMS backend we want to run only on sites with BLAS installed.
In this particular glideinWMS installation, we do this by adding this attribute:
<pre>
+NeedBLAST=True
</pre>
<p />
Moreover, we have to tell the Negotiator that we want the jobs only to run on sites that support BLAST;
while we may not be requesting glideins on sites without BLAST, someone else might, and we do not want to run there.
<p />
The glideins in this setup will be publishing the <span class="twikiNewLink">HasBLAST<a href="/bin/edit/Education/HasBLAST?topicparent=Education.GlideinsUserOss2010" rel="nofollow" title="HasBLAST (this topic does not yet exist; you can create it)">?</a></span> attribute.
So let's add these requirements to your submit file:
<pre>
Requirements=(Arch=!="") && (HasBLAST=?=True)
</pre>
<p />
Finally, the BLAS software and data may be located in different directories on different sites.
This glideinWMS installation defines two environment variables you can use:
<pre>
BLAST_SRC
BLAST_DATA
</pre>
<p />
Use them in your startup scripts; for example:
<pre>
source $BLAST_SRC/setup.sh
blastp -db $BLAST_DATA/yeast.aa -query query1
</pre>
<p />
Now submit a job cluster and monitor it as before.
<p />
Where did they run?
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="File_transfer"></a> File transfer </span></h2>
<p />
As with a regular pool, you can have Condor do the file transfer for you;<br>
please try to run a few <a href="https://twiki.grid.iu.edu/bin/view/Education/CondorROSS2010" target="_top">R jobs, as you did on Monday</a>.
<p />
What are requirements?
<p />
Where did they run?
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Mixing_them_up"></a> Mixing them up </span></h2>
<p />
Let's now consider what happens when you have jobs with different requirements.
<p />
Submit a few clusters of BLAST jobs, a few of the Pi and a few R jobs, possibly intermixing them.
<p />
Where did they run?
<p />
In which order?
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Doing_Grid_file_transfers"></a> Doing Grid file transfers </span></h2>
<p />
Having Condor do all the file transfer may not be appropriate if you have very large data sizes.
So let's try some <a href="https://twiki.grid.iu.edu/bin/view/Education/DataManagement2Oss2010" target="_top">Grid Data Transfer, as you did yesterday</a>.
<p />
But before you start, remember you need a <a href="https://twiki.grid.iu.edu/bin/view/Education/DataManagement2Oss2010#Prerequisite" target="_top">Grid proxy</a> for that.
<p />
You may not have thought about it, but you were not using a proxy until now. 
The Grid resources you got were requested in the glidein name.
<p />
For storage, instead, you will need to use your own proxy; glideinWMS does not help you there.
<p />
Using the Condor vanilla universe, Condor will transfer your proxy to the execution side only if you explicitly ask it to do it;<br>
i.e. you need to add 
<pre>
x509userproxy = &lt;path_to_your_proxy&gt;
</pre>
<p />
Try it out and let me know how it goes.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="You_are_done_already"></a> You are done already? </span></h2>
<p />
Time for the other exercises of the session: <ul>
<li> <a href="/bin/view/Education/GlideinsVoOss2010" class="twikiLink">glideinWMS for the VO administrator</a>
</li> <li> <a href="/bin/view/Education/GlideinsFactoryOss2010" class="twikiLink">glideinWMS for the factory administrator</a>
</li></ul> 
<p />
<p />
-- <a href="/bin/view/Main/IgorSfiligoi" class="twikiLink">IgorSfiligoi</a> - 14 Jul 2010</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/GridWorkshops" class="twikiLink">GridWorkshops</a> &gt; <a href="/bin/view/Education/OSGSummerSchool2010" class="twikiLink">OSGSummerSchool2010</a> &gt; <a href="/bin/view/Education/MaterialsOSS2010" class="twikiLink">MaterialsOSS2010</a> &gt; <a href="/bin/view/Education/GlideinsOss2010" class="twikiLink">GlideinsOss2010</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GlideinsUserOss2010</span> <br />    
Topic revision: r5 - 21 Jul 2010 - 20:31:52 - <a href="/bin/view/Main/IgorSfiligoi" class="twikiLink">IgorSfiligoi</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />