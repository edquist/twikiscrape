<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> UserSchool14Mon24ManyQueue &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/UserSchool14Mon24ManyQueue?_T=16 Feb 2017" type="application/x-wiki" title="edit UserSchool14Mon24ManyQueue" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/UserSchool14Mon24ManyQueue"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TABLEPLUGIN_table1--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
</style>
<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <style type="text/css">
pre em { font-style: normal; background-color: yellow; }
pre strong { font-style: normal; font-weight: bold; color: #008; }
</style>
<p />
<h1><a name="Monday_Exercise_2_4_Submit_With"></a> Monday Exercise 2.4: Submit With Many queue Statements </h1>
<p />
The goal of this exercise is to submit many jobs with a single submit file by using multiple <code>queue</code> statements. With this change, it is important to understand how HTCondor carries over values from previous <code>queue</code> statements unless overridden.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Submitting_Many_Jobs_With_One_Su"></a> Submitting Many Jobs With One Submit File </span></h2>
<p />
Suppose you have a program that you want to run many times. The program takes an argument, and you want to change the argument for each run of the program. With what you know so far, you have a couple of choices (assuming that you cannot change the job itself to work this way):
<p /> <ul>
<li> Write one submit file; submit one job, change the argument in the submit file, submit another job, change the submit file, …
</li> <li> Write many submit files that are nearly identical except for the program argument
</li></ul> 
<p />
Neither of these options seems very satisfying. Fortunately, we can do better with HTCondor.
<p />
Here is a simple Python script that calculates the greatest number of <a href="http://en.wikipedia.org/wiki/Fibonacci_number" target="_top">the Fibonacci sequence</a> up to the given numeric command-line argument:
<p />
<pre class="file">
#!/usr/bin/env python

import sys
if len(sys.argv) != 2:
    print 'Usage: %s MAXIMUM' % (os.path.basename(sys.argv[0]))
    sys.exit(1)
maximum = int(sys.argv[1])
n1 = n2 = 1
while n2 &lt;= maximum:
    n1, n2 = n2, n1 + n2
print 'The greatest Fibonacci number up to %d is %d' % (maximum, n1)
</pre>
<p />
Now suppose that you want to run this program for a variety of arguments: 1, 10, 100, 1000, 10000, etc. (Why you would want to do this is not clear to me, so we will just pretend.) Here is a single HTCondor submit file that will run three of these jobs:
<p />
<pre class="file">
universe = vanilla
executable = fibonacci.py
log = fibonacci.log
should_transfer_files = YES
when_to_transfer_output = ON_EXIT

arguments = "100"
output = fibonacci-100.out
error  = fibonacci-100.err
<em>queue</em>

arguments = "1000"
output = fibonacci-1000.out
error  = fibonacci-1000.err
<em>queue</em>

arguments = "10000"
output = fibonacci-10000.out
error  = fibonacci-10000.err
<em>queue</em>
</pre>
<p />
Note the repeated <code>queue</code> statements. Each <code>queue</code> statement will cause HTCondor to create another job (called a <strong>process</strong> in HTCondor terminology). Up until now, you have used a single <code>queue</code> statement per submit file, so each time that you run <code>condor_submit</code>, it created exactly one job.
<p />
Let’s see exactly what happens when you submit a file with multiple <code>queue</code> statements.
<p /> <ol>
<li> Save the Python program to a file named <code>fibonacci.py</code>
</li> <li> Save the submit file
</li> <li> Submit the submit file       <p>Note the slightly different message from <code>condor_submit</code>:</p>       <pre class="screen"><em>3 job(s)</em> submitted to cluster <i>NNNN</i>.</pre>
</li> <li> Before the jobs execute, run <code>condor_q</code> (or <code>condor_q <em>userid</em></code>) to see your jobs in the queue
</li></ol> 
<p />
Here is some sample <code>condor_q</code> output from my test run:
<p />
<pre class="file">
2441<em>.0</em>   cat             6/24 11:57   0+00:00:00 I  0   0.0  fibonacci.py      
2441<em>.1</em>   cat             6/24 11:57   0+00:00:00 I  0   0.0  fibonacci.py      
2441<em>.2</em>   cat             6/24 11:57   0+00:00:00 I  0   0.0  fibonacci.py      
</pre>
<p />
In this sample, all three jobs are part of cluster <code>2441</code>. The first <code>queue</code> statement resulted in process <code>0</code>, the second <code>queue</code> statement resulting in process <code>1</code>, and the third one resulted in process <code>2</code>. (Historical note: Programmers like to start counting from 0, hence the odd numbering scheme.)
<p />
At this time, it is worth reviewing the definition of a <strong><em>job ID</em></strong>. It is a job’s cluster number, a dot, and the job’s process number. So in the example above, the job ID that corresponds to the second <code>queue</code> statement is <code>2441.1</code>.
<p />
<strong>Pop Quiz:</strong> Do you remember how to ask HTCondor to list all of the jobs from one cluster? How about a particular job ID?
<p />
While you wait for your jobs to finish, keep reading the next section.
<p />
<h3><a name="Submit_File_Statements_and_Other"></a> Submit File Statements and Other queue Statements </h3>
<p />
In the submit file above, did you notice how some of the statements were given just once (e.g., <code>executable</code>, <code>log</code>), and others were repeated (e.g., <code>output</code>, <code>error</code>)? It is important to understand the meaning of repeated statements within a submit file.
<p />
Any statement that occurs <strong>between</strong> two consecutive <code>queue</code> statements changes that value of that attribute for the following <code>queue</code> statement. Otherwise, all attributes defined earlier continue to have the same value for every remaining <code>queue</code> statement. Here is a simplified submit file, with line numbers, to consider:
<p />
<pre class="file">
1. executable = fibonacci.py
2. log = fibonacci.log
3. arguments = "10"
4. output = fibonacci-10.out
5. queue
6. arguments = "100"
7. output = fibonacci-100.out
8. queue
</pre>
<p />
Line 1 defines the executable. As it turns out, you may define the executable <strong>only once</strong> in a submit file, regardless of the number of <code>queue</code> statements. Line 2–4 define the remaining parameters for the first job, which is created in Line 5. Now things get interesting. Lines 6 and 7 redefine the <code>arguments</code> and <code>output</code> attributes. Doing so has no effect on the first job, because its <code>queue</code> statement is earlier in the file. However, the changed attributes apply to the second job, created by the next <code>queue</code> statement in Line 8. Because the <code>executable</code> and <code>log</code> attribute were <strong>not</strong> redefined, their values remain the same for the second job. So, this simple submit file results in the following two jobs:
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <font color="#252b37">Attribute</font> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1"> <font color="#252b37">Job (= Process) 0</font> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <font color="#252b37">Job (= Process) 1</font> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <code>executable</code> </td>
			<td bgcolor="#ffffff" align="center" colspan="2" valign="top" class="twikiTableCol1"> <code>fibonacci.py</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> <code>log</code> </td>
			<td bgcolor="#f2f3f6" align="center" colspan="2" valign="top" class="twikiTableCol1"> <code>fibonacci.log</code> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <code>arguments</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> <code>"10"</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> <code>"100"</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <code>output</code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLast"> <code>fibonacci-10.out</code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <code>fibonacci-100.out</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
You can change (or not) <strong>any</strong> attributes between <code>queue</code> statements, except for the <code>executable</code> as noted above.
<p />
<strong>Question:</strong> Going back to the submit file that you used above, which attributes changed for each job and which attributes stayed the same?
<p />
When the three jobs finish, look at the files that resulted. Do they match your expectations? There should be a single log file, but three separate output files and three separate (and hopefully empty) error files, one for each job.
<p />
Take a minute to read the log file. Look carefully at the sequence of events, and the process number for each event.
<p /> <ul>
<li> Were all three jobs submitted in numeric order?
</li> <li> Did all three jobs begin executing in numeric order?
</li> <li> Did all three jobs complete in numeric order?
</li></ul> 
<p />
Essentially, once a set of jobs have been submitted from a single submit file, they act independently. HTCondor decides when to run each job separately, and so they may run at the same time on separate slots, one after another on the same slot, or in some other order. Depending on how busy the pool is, your priority, and other factors, some of your jobs may finish quickly, and others may take a long time to get their turn.
<p />
<h3><a name="Extra_Challenge_1"></a> Extra Challenge 1 </h3>
<p />
In the example above, you used a single log file for all three jobs. HTCondor handles this situation with no problem; each job writes its events into the log file without getting in the way of other events and other jobs. But as you may have seen, it can be difficult for a person to understand the events for any particular job in the combined log file.
<p />
Create a new submit file that works just like the one above, except that each job writes its own log file.
<p />
<h3><a name="Extra_Challenge_2"></a> Extra Challenge 2 </h3>
<p />
Going back to the original submit file above, it gave different names to the output and error files for each job. What happens if multiple jobs name the same output and error files? Does HTCondor write the output from every job into the same output and error files, or something else?
<p />
Create a new submit file that works just like the first one, except that <strong>only</strong> the arguments change for each job. That is, the output and error filenames stay the same for each job. There is more than one way to do this, but one way results in the simplest submit file. Submit the jobs and observe the resulting output. What happened? It may take a few separate submissions, one after the other, to figure out exactly what happened. Also, the sequence information in the log file may be helpful.
<p />
<h3><a name="Extra_Challenge_3"></a> Extra Challenge 3 </h3>
<p />
<strong>Note:</strong> This challenge requires basic programming skills. If you are not a programmer, that is OK; skip ahead to the next exercise.
<p />
Writing a submit file with many <code>queue</code> statements and corresponding changes to <code>output</code>, <code>error</code>, and <code>arguments</code> statements is easy… up to a point. What if we wanted to write a submit file for 10 jobs? 100? 1000? In the next exercise, we will learn a new technique to improve the situation, but the repetition never goes away completely. So, if you can program, it is possible to write a program that <strong>outputs</strong> a submit file, with all the repetition handled by the code.
<p />
Try writing a simple program that outputs one HTCondor submit file to run a set of Fibonacci jobs, varying the argument, output, error parameters for each job. Pick an interesting range of arguments — perhaps counting up by 10 or something like that. For example, if your program is given the argument <code>4</code>, it could prepare a Fibonacci job for each of the following arguments: <code>10</code>, <code>20</code>, <code>30</code>, and <code>40</code>.
<p />
Ideally, your program would get the unchanging parts of the submit file from a template file, instead of from within the code itself. That way, it is easy to change the submit file without modifying code.
<p />
Once your program outputs a valid submit file for 3–4 jobs, try having it create a submit file for 100 jobs. Submit the resulting file. Did it work?</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a> &gt; <a href="/bin/view/Education/OSGUserSchool2014" class="twikiLink">OSGUserSchool2014</a> &gt; <a href="/bin/view/Education/UserSchool14Materials" class="twikiLink">UserSchool14Materials</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>UserSchool14Mon24ManyQueue</span> <br />    
Topic revision: r1 - 03 Jul 2014 - 16:43:31 - <a href="/bin/view/Main/TimCartwright" class="twikiLink">TimCartwright</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />