<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> UserSchool16Mon31JobRetry1 &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/UserSchool16Mon31JobRetry1?_T=16 Feb 2017" type="application/x-wiki" title="edit UserSchool16Mon31JobRetry1" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/UserSchool16Mon31JobRetry1"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <style type="text/css">
pre em { font-style: normal; background-color: yellow; }
pre strong { font-style: normal; font-weight: bold; color: #008; }
</style>
<p />
<h1><a name="Monday_Exercise_3_1_Retries"></a> Monday Exercise 3.1: Retries </h1>
<p />
The goal of this exercise is to demonstrate running a job that intermittently fails and thus could benefit from having HTCondor automatically retry it.
<p />
This first part of the exercise should take only a few minutes, and is designed to setup the next exercises.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Bad_Job"></a> Bad Job </span></h2>
<p />
Let’s assume that a colleague has shared with you a program, and it fails once and a while. In the real world, we would probably just fix the program, but what if you cannot change the software? Unfortunately, this situation happens more often than we would like.
<p />
Below is a simple Python script that fails once and a while. We will not fix it, but use it to simulate a program that can fail and that we <strong>cannot</strong> fix.
<p />
<pre class="file">
#!/usr/bin/env python

# murphy.py simulates a real program with real problems
import random
import sys
import time

# Create a random number seeded by system entropy
r = random.SystemRandom()

# One time in three, simulate a runtime error
if (r.randint(0,2) == 0):
	# intentionally print no output
	sys.exit(15)
else:
	time.sleep(3)
	print "All work done correctly"

# By convention, zero exit code means success
sys.exit(0)
</pre>
<p />
Even if you are not a Python expert, you may be able to figure out what this program does.
<p />
Let’s see what happens when a program like this one is run in HTCondor.
<p /> <ol>
<li> In a new directory for this exercise, save the script above as <code>murphy.py</code>
</li> <li> Write a submit file for the script; run 20 instances of the job and be sure to ask for 20&nbsp;MB of memory
</li> <li> Submit the file and wait for the jobs to finish
</li></ol> 
<p />
What output do you expect? What output did you get? If you are curious about the exit code from the job, it is saved in completed jobs in <code>condor_history</code> in the <code>ExitCode</code> attribute. The following command will show the <code>ExitCode</code> for a given cluster of jobs:
<p />
<pre class="screen">
$> <strong>condor_history <em>CLUSTERID</em> -af ClusterId ExitCode</strong>
</pre>
<p />
(Be sure to replace <code>CLUSTERID</code> with your actual cluster ID!)
<p />
How many of the jobs succeeded? How many failed?
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Retrying_Failed_Jobs"></a> Retrying Failed Jobs </span></h2>
<p />
Now let’s see if we can solve the problem of jobs that fail once and a while. In this particular case, if HTCondor runs a failed job again, it has a good chance of succeeding. Not all failing jobs are like this, but in this case it is a reasonable assumption.
<p />
Try to find a way to change the submit file to tell HTCondor to re-run any job whose <span class="twikiNewLink">ExitCode<a href="/bin/edit/Education/ExitCode?topicparent=Education.UserSchool16Mon31JobRetry1" rel="nofollow" title="ExitCode (this topic does not yet exist; you can create it)">?</a></span> attribute is non-zero. After changing your submit file, submit it again, and wait for all the jobs to exit. Did your change work?
<p />
After the jobs have finished, examine the log file to see what happened in detail. Did any jobs need to be restarted? Another way to see how many restarts there were is to look at the <code>NumJobStarts</code> attribute in a completed job with the <code>condor_history</code> command, in the same way you looked at the <code>ExitCode</code> attribute earlier. Does the number of retries seem correct? For those jobs which did need to be retried, what is their <code>ExitCode=&nbsp;mdash; and what about the =ExitCode</code> from earlier execution attempts?
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="A_Too_Long_Running_Job"></a> A (Too) Long Running Job </span></h2>
<p />
Sometimes, an ill-behaved job will get stuck in a loop and run forever, instead of exiting with a failure code. We can modify our Python program to simulate this kind of bad job with the following file:
<p />
<pre class="file">
#!/usr/bin/env python

# murphy.py simulate a real program with real problems
import random
import sys
import time

# Create a random number seeded by system entropy
r = random.SystemRandom()

# One time in three, simulate an infinite loop
if (r.randint(0,2) == 0):
        # intentionally print no output
        time.sleep(3600)
        sys.exit(15)
else:
        time.sleep(3)
        print "All work done correctly"

# By convention, zero exit code means success
sys.exit(0)
</pre>
<p />
Again, you may be able to figure out what this new program does.
<p /> <ol>
<li> Save the script to a new file named <code>murphy2.py</code>
</li> <li> Copy your previous submit file to a new name and change the <code>executable</code> to <code>murphy2.py</code>
</li> <li> If you like, submit the new file&nbsp;&mdash; but after a while be sure to remove the whole cluster to clear out the “hung” jobs
</li> <li> Now try to change the submit file to automatically remove any jobs that <strong>run</strong> for more than one minute. You can make this change with just a single line in your submit file!
</li> <li> Submit the new file. Do the long running jobs get removed? What does <code>condor_history</code> show for the cluster after all jobs are done?
</li></ol> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Bonus_Exercise"></a> Bonus Exercise </span></h2>
<p />
If you have time, edit your submit file so that instead of removing long running jobs, have HTCondor automatically put the long-running job on hold, and then automatically release it.</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/OSGUserSchool2016" class="twikiLink">OSGUserSchool2016</a> &gt; <a href="/bin/view/Education/UserSchool16Materials" class="twikiLink">UserSchool16Materials</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>UserSchool16Mon31JobRetry1</span> <br />    
Topic revision: r5 - 25 Jul 2016 - 20:21:07 - <a href="/bin/view/Main/TimCartwright" class="twikiLink">TimCartwright</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />