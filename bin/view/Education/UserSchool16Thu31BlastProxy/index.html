<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> UserSchool16Thu31BlastProxy &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/UserSchool16Thu31BlastProxy?_T=16 Feb 2017" type="application/x-wiki" title="edit UserSchool16Thu31BlastProxy" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/UserSchool16Thu31BlastProxy"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Thursday_Exercise_3_1_Using_a_We"></a> Thursday Exercise 3.1: Using a Web Proxy for Large Shared Input </h1>
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Thursday_Exercise_3_1_Using_a_We"> Thursday Exercise 3.1: Using a Web Proxy for Large Shared Input</a> <ul>
<li> <a href="?cover=print#Setup"> Setup</a>
</li> <li> <a href="?cover=print#Place_the_Large_File_on_the_Prox"> Place the Large File on the Proxy</a> <ul>
<li> <a href="?cover=print#Test_a_download_of_the_file"> Test a download of the file</a>
</li></ul> 
</li> <li> <a href="?cover=print#Run_a_New_Test_Job"> Run a New Test Job</a> <ul>
<li> <a href="?cover=print#Modify_the_submit_file"> Modify the submit file</a>
</li> <li> <a href="?cover=print#Submit_the_test_job"> Submit the test job</a>
</li></ul> 
</li> <li> <a href="?cover=print#Run_all_100_Jobs"> Run all 100 Jobs!</a>
</li> <li> <a href="?cover=print#Note_Keeping_a_Web_Proxy_Clean"> Note: Keeping a Web Proxy 'Clean'</a>
</li></ul> 
</li></ul> 
</div>
<p />
Continuing the series of exercises blasting mouse genetic sequences, the objective of this exercise is to use a web proxy to stage the large database, which will be downloaded into each of many jobs that use the split input files from the last exercise (Exercise 2.3).
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Setup"></a> Setup </span></h2>
<p /> <ul>
<li> Make sure you are logged into <code>osg-learn.chtc.wisc.edu</code>
</li> <li> Make sure you are in the directory named <code>thur-blast-data</code>.
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Place_the_Large_File_on_the_Prox"></a> Place the Large File on the Proxy </span></h2>
<p />
First, you'll need to put the <code>pdbaa_files.tar.gz</code> file onto CHTC's local web proxy.
<p />
For easy placement of files by users at CHTC, we have the filesystem of the web proxy mounted to our local submit servers, like <code>learn.chtc.wisc.edu</code>. From <code>osg-learn.chtc.wisc.edu</code>, you can use a command like the following to place the applicable file onto our "squid" web proxy, making sure to indicate your own username:
<p />
<pre class="screen">
$> <strong>scp pdbaa_files.tar.gz <font color="#ff0000">username</font>@learn.chtc.wisc.edu:/squid/<font color="#ff0000">username</font></strong>
</pre>
<p />
You'll be prompted, as usual, to enter your password for the <code>learn.chtc.wisc.edu</code> in order for the <code>scp</code> command to complete.
<p />
<h3><a name="Test_a_download_of_the_file"></a> Test a download of the file </h3>
<p />
Once a file is placed in the <code>/squid</code> location, it can be downloaded from a corresponding URL such as <code>http://proxy.chtc.wisc.edu/SQUID/username/filename</code>, where the capitalized <code>/SQUID</code> holds the place of <code>/squid</code> on the <code>learn.chtc.wisc.edu</code> server.
<p />
Using the above convention (and from a different directory on <code>osg-learn.chtc.wisc.edu</code>), you can test the download of your <code>pdbaa_files.tar.gz</code> file with a command like the following:
<p />
<pre class="screen">
$> <strong>wget http://proxy.chtc.wisc.edu/SQUID/<font color="#ff0000">username</font>/pdbaa_files.tar.gz</strong>
</pre>
<p />
You may realize that you've been using <code>wget</code> to download files from our web proxy for many of the previous exercises at the school!
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Run_a_New_Test_Job"></a> Run a New Test Job </span></h2>
<p />
Now, you'll repeat the last exercise (with a single input query file) but have HTCondor download the <code>pdbaa_files.tar.gz</code> file from the web proxy, instead of having the file transferred from the submit server.
<p />
<h3><a name="Modify_the_submit_file"></a> Modify the submit file </h3>
<p />
Replace the instance of <code>pdbaa_files.tar.gz</code> in the <code>transfer_input_files</code> list with the appropriate HTTP address from above. You will not need to modify the <code>blast_wrapper.sh</code> file, as it should already have the necessary commands to unpack the <code>pdbaa_files.tar.gz</code> file and to delete the unpacked <code>pdbaa</code> files at the end of the job.
<p />
<h3><a name="Submit_the_test_job"></a> Submit the test job </h3>
<p />
You may wish to first remove the log file from the previous test, which will be appended to (while other files will be replaced when the new test job completes).
<p />
When the job starts, HTCondor will download the <code>pdbaa_files.tar.gz</code> file from the web proxy. If the jobs takes longer than two minutes, you can assume that it will complete successfully, and then continue with the rest of the exercise.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Run_all_100_Jobs"></a> Run all 100 Jobs! </span></h2>
<p />
If all of the previous tests have gone okay, you can prepare to run all 100 jobs that will use the split input files. You have just a couple of steps left:
<p />
1. To make sure you're not going to generate too much data, use the size of files from the previous test to calculate how much total data you're going to add to the <code>thur-blast-data</code> directory for 100 jobs.
<p />
2. Update the list.txt file to include all of the split <code>mouse_rna.fa</code> input files. Instead of creating this file manually, you can create it by redirecting the <code>ls</code> command output to a file. First, check that your <code>ls</code> command only lists the split input files:
<p />
<pre class="screen">
$> <strong>ls mouse_rna.fa.*</strong>
</pre>
<p />
If there are still <code>out</code>, <code>err</code>, and <code>log</code> files from the last test that are showing up, make sure to remove those so they don't end up in list.txt. After re-checking the above command, you can create the <code>list.txt</code> file with:
<p />
<pre class="screen">
$> <strong>ls mouse_rna.fa.* > list.txt</strong>
</pre>
<p />
Check the contents of the <code>list.txt</code> file to be sure, and then submit all 100 jobs! They may take a while to all complete, but it will still be faster than the many hours it would have taken to blast the single, large <code>mouse_rna.fa</code> file without splitting it up. In the meantime, as long as the first several jobs are running for longer than two minutes, you can move on to the next exercise.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Note_Keeping_a_Web_Proxy_Clean"></a> Note: Keeping a Web Proxy 'Clean' </span></h2>
<p />
At CHTC and most submission points with web proxy access, it is VERY important to remove old files from the web proxy when you no longer need them, especially so that you'll have plenty of space for such files in the future. For example, you would delete (<code>rm</code>) files from CHTC's <code>/squid/username</code> submit server location when you're done using them, but only after all jobs have finished. The next time you use the web proxy after the school, remember to first check for old files that you can delete.
<p />
-- <a href="/bin/view/Main/LaurenMichael" class="twikiLink">LaurenMichael</a> - 22 Jul 2016</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/OSGUserSchool2016" class="twikiLink">OSGUserSchool2016</a> &gt; <a href="/bin/view/Education/UserSchool16Materials" class="twikiLink">UserSchool16Materials</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>UserSchool16Thu31BlastProxy</span> <br />    
Topic revision: r3 - 25 Jul 2016 - 15:42:28 - <a href="/bin/view/Main/LaurenMichael" class="twikiLink">LaurenMichael</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />