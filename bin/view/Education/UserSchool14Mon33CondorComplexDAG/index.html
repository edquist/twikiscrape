<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> UserSchool14Mon33CondorComplexDAG &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/UserSchool14Mon33CondorComplexDAG?_T=16 Feb 2017" type="application/x-wiki" title="edit UserSchool14Mon33CondorComplexDAG" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/UserSchool14Mon33CondorComplexDAG"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> 
<h1><a name="A_More_Complex_DAG"></a> A More Complex DAG </h1>
<p />
<div style="margin-left: 1em; margin-right: 1em; border: 1px solid black; padding: 0.5em;">
<h3><a name="Objective_of_this_exercise"></a> Objective of this exercise </h3>
The objective of this exercise is to run a real set of jobs with DAGMan.
</div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Make_your_job_submission_files"></a> Make your job submission files </span></h2>
<p />
We'll run our <code>goatbrot</code> example. If you didn't read about it yet, <a href="/bin/view/Education/OSGSS2011Mandlebrot" class="twikiLink">please do so now</a>. We are going to make a DAG with four simultaneous jobs (<code>goatbrot</code>) and one final node to stitch them together (<code>montage</code>). This means we have five jobs. We're going to run <code>goatbrot</code> with more iterations (100,000) so it will take longer to run. 
<p />
You can create your five jobs. The goatbrot jobs very similar to each other, but they have slightly different parameters and output files. 
<p />
<h3><a name="goatbrot1_sub"></a> goatbrot1.sub </h3>
<p />
<pre style="margin-left:4em" class="screen">
executable              = /share/goatbrot/goatbrot
arguments               = -i 100000 -c -0.75,0.75 -w 1.5 -s 500,500 -o tile_0_0.ppm
log                     = goatbrot.log
output                  = goatbrot.out.0.0
error                   = goatbrot.err.0.0
should_transfer_files   = YES
when_to_transfer_output = ONEXIT
queue
</pre>
<p />
<h3><a name="goatbrot2_sub"></a> goatbrot2.sub </h3>
<p />
<pre style="margin-left:4em" class="screen">
executable              = /share/goatbrot/goatbrot
arguments               = -i 100000 -c 0.75,0.75 -w 1.5 -s 500,500 -o tile_0_1.ppm
log                     = goatbrot.log
output                  = goatbrot.out.0.1
error                   = goatbrot.err.0.1
should_transfer_files   = YES
when_to_transfer_output = ONEXIT
queue
</pre>
<p />
<h3><a name="goatbrot3_sub"></a> goatbrot3.sub </h3>
<p />
<pre style="margin-left:4em" class="screen">
executable              = /share/goatbrot/goatbrot
arguments               = -i 100000 -c -0.75,-0.75 -w 1.5 -s 500,500 -o tile_1_0.ppm
log                     = goatbrot.log
output                  = goatbrot.out.1.0
error                   = goatbrot.err.1.0
should_transfer_files   = YES
when_to_transfer_output = ONEXIT
queue
</pre>
<p />
<h3><a name="goatbrot4_sub"></a> goatbrot4.sub </h3>
<p />
<pre style="margin-left:4em" class="screen">
executable              = /share/goatbrot/goatbrot
arguments               = -i 100000 -c 0.75,-0.75 -w 1.5 -s 500,500 -o tile_1_1.ppm
log                     = goatbrot.log
output                  = goatbrot.out.1.1
error                   = goatbrot.err.1.1
should_transfer_files   = YES
when_to_transfer_output = ONEXIT
queue
</pre>
<p />
<h3><a name="montage_sub"></a> montage.sub </h3>
<p />
You should notice a few things about the montage submission file:
<p /> <ol>
<li> The <code>transfer_input_files</code> statement refers to the files created by the other jobs. 
</li> <li> We do <strong>not</strong> transfer the montage program because it is pre-installed on the Condor pool. How do we avoid transferring it, and how do we specify where it is installed?
</li></ol> 
<p />
<pre style="margin-left:4em" class="screen">
universe                = vanilla
executable              = /usr/bin/montage
arguments               = tile_0_0.ppm tile_0_1.ppm tile_1_0.ppm tile_1_1.ppm -mode Concatenate -tile 2x2 mandle.jpg
should_transfer_files   = YES
when_to_transfer_output = ONEXIT
transfer_input_files    = tile_0_0.ppm,tile_0_1.ppm,tile_1_0.ppm,tile_1_1.ppm
transfer_executable     = false
output                  = montage.out
error                   = montage.err
log                     = montage.log
queue
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Make_your_DAG"></a> Make your DAG </span></h2>
<p />
In a file called <code>goatbrot.dag</code>, you have your DAG specification:
<p />
<pre style="margin-left:4em" class="screen">
JOB g1 goatbrot1.sub
JOB g2 goatbrot2.sub
JOB g3 goatbrot3.sub
JOB g4 goatbrot4.sub
JOB montage montage.sub
PARENT g1 g2 g3 g4 CHILD montage
</pre>
<p />
Ask yourself: do you know how we ensure that all the <code>goatbrot</code> commands can run simultaneously and all of them will complete before we run the montage job?
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Running_the_DAG"></a> Running the DAG </span></h2>
<p />
Submit your DAG:
<p />
<pre style="margin-left:4em" class="screen">
% condor_submit_dag goatbrot.dag
-----------------------------------------------------------------------
File for submitting this DAG to Condor           : goatbrot.dag.condor.sub
Log of DAGMan debugging messages                 : goatbrot.dag.dagman.out
Log of Condor library output                     : goatbrot.dag.lib.out
Log of Condor library error messages             : goatbrot.dag.lib.err
Log of the life of condor_dagman itself          : goatbrot.dag.dagman.log

Submitting job(s).
1 job(s) submitted to cluster 71.

-----------------------------------------------------------------------
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Watch_your_DAG"></a> Watch your DAG </span></h2>
<p />
Watch with condor_q:
<p />
<pre style="margin-left:4em" class="screen">
% watch -n 10 condor_q -sub <font color="#ff0000">YOUR-USER-NAME</font>

<font color="#ff0000">Here we see DAGMan running:</font>
-- Submitter: osg-ss-submit.chtc.wisc.edu : <128.104.100.55:9618?sock=28867_10e4_2> : osg-ss-submit.chtc.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               
  71.0   roy             6/22 17:39   0+00:00:03 R  0   0.3  condor_dagman     

1 jobs; 0 completed, 0 removed, 0 idle, 1 running, 0 held, 0 suspended


<font color="#ff0000">DAGMan has submitted the goatbrot jobs, but they haven't started running yet:</font>
-- Submitter: osg-ss-submit.chtc.wisc.edu : <128.104.100.55:9618?sock=28867_10e4_2> : osg-ss-submit.chtc.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               
  71.0   roy             6/22 17:39   0+00:00:17 R  0   0.3  condor_dagman     
  72.0   roy             6/22 17:39   0+00:00:00 I  0   0.0  goatbrot -i 100000
  73.0   roy             6/22 17:39   0+00:00:00 I  0   0.0  goatbrot -i 100000
  74.0   roy             6/22 17:39   0+00:00:00 I  0   0.0  goatbrot -i 100000
  75.0   roy             6/22 17:39   0+00:00:00 I  0   0.0  goatbrot -i 100000

5 jobs; 0 completed, 0 removed, 4 idle, 1 running, 0 held, 0 suspended

<font color="#ff0000">They're running!</font>
-- Submitter: osg-ss-submit.chtc.wisc.edu : <128.104.100.55:9618?sock=28867_10e4_2> : osg-ss-submit.chtc.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               
  71.0   roy             6/22 17:39   0+00:07:15 R  0   0.3  condor_dagman     
  72.0   roy             6/22 17:39   0+00:00:03 R  0   0.0  goatbrot -i 100000
  73.0   roy             6/22 17:39   0+00:00:03 R  0   0.0  goatbrot -i 100000
  74.0   roy             6/22 17:39   0+00:00:03 R  0   0.0  goatbrot -i 100000
  75.0   roy             6/22 17:39   0+00:00:03 R  0   0.0  goatbrot -i 100000

5 jobs; 0 completed, 0 removed, 0 idle, 5 running, 0 held, 0 suspended

<font color="#ff0000">Two of the jobs have finished, while the others are still running:</font>
-- Submitter: osg-ss-submit.chtc.wisc.edu : <128.104.100.55:9618?sock=28867_10e4_2> : osg-ss-submit.chtc.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               
  71.0   roy             6/22 17:39   0+00:07:51 R  0   0.3  condor_dagman     
  72.0   roy             6/22 17:39   0+00:00:39 R  0   0.0  goatbrot -i 100000
  74.0   roy             6/22 17:39   0+00:00:39 R  0   0.0  goatbrot -i 100000

3 jobs; 0 completed, 0 removed, 0 idle, 3 running, 0 held, 0 suspended

<font color="#ff0000">They finished, but DAGMan hasn't noticed yet. It only checks periodically:</font>
-- Submitter: osg-ss-submit.chtc.wisc.edu : <128.104.100.55:9618?sock=28867_10e4_2> : osg-ss-submit.chtc.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               
  71.0   roy             6/22 17:39   0+00:08:46 R  0   0.3  condor_dagman     

1 jobs; 0 completed, 0 removed, 0 idle, 1 running, 0 held, 0 suspended

<font color="#ff0000">DAGMan submitted and ran the montage job. It ran so fast I didn't capture it running. DAGMan will finish up soon </font>
-- Submitter: osg-ss-submit.chtc.wisc.edu : <128.104.100.55:9618?sock=28867_10e4_2> : osg-ss-submit.chtc.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               
  71.0   roy             6/22 17:39   0+00:08:55 R  0   0.3  condor_dagman     

1 jobs; 0 completed, 0 removed, 0 idle, 1 running, 0 held, 0 suspended

<font color="#ff0000">Now it's all done:</font>
-- Submitter: osg-ss-submit.chtc.wisc.edu : <128.104.100.55:9618?sock=28867_10e4_2> : osg-ss-submit.chtc.wisc.edu
 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD               

0 jobs; 0 completed, 0 removed, 0 idle, 0 running, 0 held, 0 suspended
</pre>
<p />
Examine your results. For some reason, goatbrot prints everything to stderr, not stdout. 
<p />
<pre style="margin-left:4em" class="screen">
% cat goatbrot.err.0.0
Complex image:
            Center: -0.75 + 0.75i
             Width: 1.5
            Height: 1.5
        Upper Left: -1.5 + 1.5i
       Lower Right: 0 + 0i

Output image:
          Filename: tile_0_0.ppm
     Width, Height: 500, 500
             Theme: beej
       Antialiased: no

Mandelbrot:
    Max Iterations: 100000
        Continuous: no

Goatbrot:
    Multithreading: not supported in this build

Completed: 100.0%  
</pre>
<p />
Examine your log files (<code>goatbrot.log</code> and <code>montage.log</code>) and DAGMan output file (<code>goatbrot.dag.dagman.out</code>). Do they look as you expect? Can you see the progress of the DAG in the DAGMan output file?
<p />
Does your final Mandlebrot image (<code>mandle.jpg</code>) look correct?
<p />
Clean up your results. Be careful about deleting the goatbrot.dag.* files, you do not want to delete the goatbrot.dag file, just goatbrot.dag.* . 
<p />
<pre style="margin-left:4em" class="screen">
% rm goatbrot.dag.*
% rm goatbrot.out.*
% rm goatbrot.err.*
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_your_own"></a> On your own. </span></h2>
<p /> <ul>
<li> Re-run your DAG. When jobs are running, try <code>condor_q -dag</code>. What does it do differently?
</li> <li> Challenge, if you have time: Make a bigger DAG by making more tiles in the same area. 
</li></ul> 
<p />
<p />
-- <a href="/bin/view/Main/GregThain" class="twikiLink">GregThain</a> - 07 Jul 2014</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a> &gt; <a href="/bin/view/Education/OSGUserSchool2014" class="twikiLink">OSGUserSchool2014</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>UserSchool14Mon33CondorComplexDAG</span> <br />    
Topic revision: r1 - 07 Jul 2014 - 05:55:00 - <a href="/bin/view/Main/GregThain" class="twikiLink">GregThain</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />