<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> UserSchool16Fri12PlanFlow &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/UserSchool16Fri12PlanFlow?_T=16 Feb 2017" type="application/x-wiki" title="edit UserSchool16Fri12PlanFlow" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/UserSchool16Fri12PlanFlow"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <style type="text/css">
pre em { font-style: normal; background-color: yellow; }
pre strong { font-style: normal; font-weight: bold; color: #008; }
</style>
<p />
<h1><a name="Friday_Exercise_1_2_Plan_Joe_s_W"></a> Friday Exercise 1.2: Plan Joe's Workflow </h1>
<p />
This exercise outlines our goal (creating a production workflow) and the steps needed to achieve it.  Before starting this section, make sure to first read <a href="/bin/view/Education/UserSchool16Fri11LearnJoesWork" class="twikiLink">Exercise 1.1</a>, which has important background information about Joe's intended work and how he has submitted jobs so far.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Your_mission"></a> Your mission </span></h2>
<p />
Your goal is to plan out Joe’s workflow based upon small-scale test jobs and, later, to write a full-scale DAG to actually run his workflow in production. In particular, you will need to do the following: 
<p /> <ul>
<li> <strong>Optimize the submit files for the <em>permutation</em> jobs of each trait,</strong> such that each trait takes advantage of high-throughput parallelization with some number of job <em>processes</em>. Each process should calculate a portion of the new total of 100,000 permutations (versus the 10,000 permutations per trait that Joe has been working with previously).
</li></ul> 
<p /> <ul>
<li> <strong>Optimize submit file values for "request_memory" and "request_cpus"</strong> for each <em>permutation</em> and <em>QTL mapping</em> step, for each trait of the three traits.
</li></ul> 
<p /> <ul>
<li> <strong>Create a single DAG file, with <em>permutation</em> and <em>QTL mapping</em> jobs for each of the three traits,</strong> including PRE and/or POST scripts for the <code>tar</code> scripts that need to be run.
</li></ul> 
<p />
We'll be working on the first two optimization steps during this session, and the second optimization step and DAG creation after the break, in <a href="/bin/view/Education/UserSchool16Fri13ExecFlow" class="twikiLink">Exercise 1.3</a>.
<p />
<h3><a name="NOTE_In_what_follows_the_only_fi"></a> *NOTE: In what follows, the only files you will need to modify are the submit files (and as specifically instructed). You will not need to modify any of the input files, output files, or scripts/programs. It is advisable that you split up some of the work within your pair or group in order to be time-efficient. </h3>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Draw_a_diagram"></a> Draw a diagram </span></h2>
<p />
Based upon what you <a href="https://www.opensciencegrid.org/bin/view/Education/UserSchool15Fri11LearnJoe'sWork" target="_top">learned from Joe</a>, <strong>draw the <em>general workflow</em> that you would make</strong> for Joe (on paper), keeping in mind that there are 3 traits for which the <em>permutation</em> and <em>QTL mapping</em> steps need to be completed. (If you started drawing a diagram while reading the previous page, just extend it here).  The tar steps will probably need to be PRE or POST scripts (you decide which is best). Think about what Joe's intended workflow means for the shape of the DAG, including PARENT-CHILD dependencies for JOBs in the DAG and the fact that the <em>permutation</em> step could be broken up into multiple processes of fewer total permutations, each.  We'll come back to this diagram in the <a href="/bin/view/Education/UserSchool16Fri13ExecFlow" class="twikiLink">next exercise</a> after the break, when it's time to construct the full DAG.  
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Optimize_job_components"></a> Optimize job components </span></h2>
<p />
Before we assemble the full DAG, we want to optimize each component of the workflow.  This will include 3 optimization steps: 
<p />
<h3><a name="1_Test_the_HTC_optimization_of_t"></a> 1. Test the HTC optimization of the <em>permutation</em> step. </h3>
<p />
You will need to determine the number of permutations that could be batched in a single job process, if each process needs to run in ~30 minutes for good HTC scaling. To do this, you will need to run some test jobs, to see how long it takes a single job process to run, say, 10, 100, or 1000 permutations.  
<p />
To run these test jobs:  <ol>
<li> Modify one of the permutation submit files to “queue” 10 processes (so that you can average time between the 10 test processes)
</li> <li> Add "request_cpus = 1" according to Joe's indication
</li> <li> Add reasonable first guesses for "request_memory" and "request_disk" (say, 1 GB?). 
</li> <li> Make a few copies of this submit file so that you can change the last argument (the number of permutations) from "10000" to "10", "100", or "1000". For time's sake, a member of your group should test all three of these variations at the same time! 
</li></ol> 
<p />
Getting ready for the next step:  <ol>
<li> After each set of <em>permutation</em> tests finishes, you’ll need to use <code>tarit.sh</code> (with the correct argument!) before running the test jobs for the QTL step.
</li></ol> 
<p />
<h3><a name="2_Test_each_of_the_QTL_mapping_j"></a> 2. Test each of the <em>QTL mapping</em> jobs </h3>
<p />
Submit the three submit files after simply adding lines for "request_memory", "request_disk", and "request_cpus". The resource needs (RAM and disk space) and execution time of each <em>QTL mapping</em> job will likely increase with the total number of permutations from the previous <em>permutation</em> step, though the execution time will likely still be short (according to Joe). You'll test optimized <em>permutation</em> and <em>QTL mapping</em> steps later on.
<p />
<h3><a name="3_Optimization_planning"></a> 3. Optimization planning </h3>
<p />
In order to optimize Joe's overall workflow, we can optimize the following values, based on our test jobs from steps 1 and 2: 
<p />
<strong>Permutation throughput:</strong> Calculate the number of permutations that should be run <em>per job process</em>, such that the runtimes per process will be about 30 minutes (not exact, but closer to 30 than to 5 or 60). You can then calculate the number of processes that should be queued such that 100,000 permutations are calculated for each trait.  Essentially, you want <em>job processes</em> X <em>permutations</em> to equal 100,000 total permutations for each of the three phenotype traits.
*Hint: You can use the "condor_history" feature (similar to condor_q, but for completed jobs) to easily view and compare the "RUNTIME" for jobs in a "cluster" (using the cluster value as an argument to <code>condor_history</code>.
<p />
<strong>Memory and disk for both steps:</strong> Make sure to examine the log files of your <em>permutation</em> and <em>QTL</em> test jobs, so that you can extrapolate how much memory and disk should be requested in the submit files for the full-scale DAG.
<p />
<h3><a name="When_you_re_done_with_3_move_on"></a> <strong>When you're done with #3, move on to <a href="/bin/view/Education/UserSchool16Fri13ExecFlow" class="twikiLink">Exercise 2.2</a></strong> </h3></div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/OSGUserSchool2016" class="twikiLink">OSGUserSchool2016</a> &gt; <a href="/bin/view/Education/UserSchool16Materials" class="twikiLink">UserSchool16Materials</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>UserSchool16Fri12PlanFlow</span> <br />    
Topic revision: r4 - 28 Jul 2016 - 05:15:20 - <a href="/bin/view/Main/ChristinaKoch" class="twikiLink">ChristinaKoch</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />