<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> UserSchool16Thu23BlastSplit &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/UserSchool16Thu23BlastSplit?_T=16 Feb 2017" type="application/x-wiki" title="edit UserSchool16Thu23BlastSplit" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/UserSchool16Thu23BlastSplit"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Thursday_Exercise_2_3_Splitting"></a> Thursday Exercise 2.3: Splitting Large Input for Better Throughput </h1>
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Thursday_Exercise_2_3_Splitting"> Thursday Exercise 2.3: Splitting Large Input for Better Throughput</a> <ul>
<li> <a href="?cover=print#Setup"> Setup</a> <ul>
<li> <a href="?cover=print#Obtain_the_large_input"> Obtain the large input</a>
</li> <li> <a href="?cover=print#Split_the_input_file"> Split the input file</a>
</li></ul> 
</li> <li> <a href="?cover=print#Test_a_split_job"> Test a split job</a> <ul>
<li> <a href="?cover=print#Modify_the_submit_file"> Modify the submit file</a>
</li> <li> <a href="?cover=print#Modify_the_wrapper_file"> Modify the wrapper file</a>
</li> <li> <a href="?cover=print#Submit_the_test_job"> Submit the test job</a>
</li></ul> 
</li> <li> <a href="?cover=print#Update_the_resource_requests"> Update the resource requests</a>
</li></ul> 
</li></ul> 
</div>
<p />
The objective of this exercise is to prepare for blasting a much larger input query file by splitting the input for greater throughput and lower memory and disk requirements. Splitting the input will also mean that we don't have to rely on additional large-data measures for the input query files.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Setup"></a> Setup </span></h2>
<p /> <ul>
<li> Make sure you are still logged into <code>osg-learn.chtc.wisc.edu</code>
</li> <li> Make sure you are in the directory named <code>thur-blast-data</code>.
</li></ul> 
<p />
<h3><a name="Obtain_the_large_input"></a> Obtain the large input </h3>
<p />
We've previously used <code>blastx</code> to analyze a relatively small input file of test data, <code>mouse.fa</code>, but let's imagine that you now need to blast a much larger dataset for your research. This dataset can be downloaded with the following command:
<p />
<pre class="screen">
$> <strong>wget http://proxy.chtc.wisc.edu/SQUID/osgschool16/mouse_rna.tar.gz</strong>
</pre>
<p />
After un-tar'ing the file, you should be able to confirm that it's size is roughly 100 MB. Not only is this a bit large for file transfer, but it would take hours to complete a single <code>blastx</code> analysis for it. Also, the single output file would be huge. Compare for yourself to the time and output file size for the mouse.fa input file, according to your test job in the last exercise.
<p />
<h3><a name="Split_the_input_file"></a> Split the input file </h3>
<p />
For <code>blast</code>, it's scientifically valid to split up the input query file, analyze the pieces, and then put the results back together at the end! (Importantly, blast databases should not be split, because the <code>blast</code> output includes a score value for each sequence that is calculated relative to the entire length of the database.)
<p />
Because genetic sequence data is used heavily across the life science, there are also tools for splitting up the data into smaller files. One of these is called <a href="http://genometools.org/" target="_top">genome tools</a>, and you can download a package of precompiled binaries (just like blast!) using the following command:
<p />
<pre class="screen">
$> <strong>wget http://genometools.org/pub/binary_distributions/gt-1.5.9-Linux_x86_64-64bit-complete.tar.gz</strong>
</pre>
<p />
Un-tar the gt package, then run it's sequence file splitter as follows, with the target file size of 1 MB:
<p />
<pre class="screen">
$> <strong>gt-1.5.9-Linux_x86_64-64bit-complete/bin/gt splitfasta -targetsize 1 mouse_rna.fa</strong>
</pre>
<p />
You'll notice that the result is a set of 100 files, all about the size of 1 MB, and numbered 1 through 100.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Test_a_split_job"></a> Test a split job </span></h2>
<p />
Now, you'll run a test job to prepare for submitting many jobs, later, where each will use a different input file.
<p />
<h3><a name="Modify_the_submit_file"></a> Modify the submit file </h3>
<p />
First, you'll create a new submit file that passes the input filename as an argument and use a list of applicable filenames. Follow the below steps:
<p />
1. Copy the submit file to a new file called <code>blast_split.sub</code> and modify the "queue" line of the submit file to the following:
<p />
<pre class="file">
queue inputfile from list.txt
</pre>
<p />
2. Create a <code>list.txt</code> file containing the filename of the first split file, <code>mouse_rna.fa.1</code>
<p />
3. Replace the <code>mouse.fa</code> instances in the submit file with <code>$(inputfile)</code>, and rename the output, log, and error files to use the same <code>inputfile</code> variable:
<p />
<pre class="file">
output = $(inputfile).out
error = $(inputfile).err
log = $(inputfile).log
</pre>
<p />
4.  Add an <code>arguments</code> line to the submit file so it will pass the name of the input file to the wrapper script
<p />
<pre class="file">
arguments = $(inputfile)
</pre>
<p />
5. Update the memory and disk requests, since the new input file is larger and will also produce larger output. It may be best to overestimate to something like 1 GB for each. (After completing this test, you'll be able to update them to a more accurate value.)
<p />
<h3><a name="Modify_the_wrapper_file"></a> Modify the wrapper file </h3>
Replace instances of the input file name in the <code>blast_wrapper.sh</code> script so that it will insert the first argument in place of the input filename, like so:
<p />
<pre class="file">
./blastx -db pdbaa -query $1 -out $1.result
</pre>
<p />
NOTE: bash shell scripts will use the first argument in place of <code>$1</code>, the second argument as <code>$2</code>, etc.
<p />
<h3><a name="Submit_the_test_job"></a> Submit the test job </h3>
<p />
This job will take a bit longer than the job in the last exercise, since the input file is larger (by about 3-fold). Again, make sure that only the desired <code>output</code>, <code>error</code>, and <code>result</code> files come back at the end of the job.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Update_the_resource_requests"></a> Update the resource requests </span></h2>
<p />
After the job finishes successfully, examine the <code>log</code> file for memory and disk usage, and update the requests in the submit file. In Exercise 3.1 (after the next lecture) you'll submit many jobs at once <em>and</em> use a different method for handling the <code>pdbaa_files.tar.gz</code> file, which is a bit too large to use regular file transfer when submitting many jobs.
<p />
-- <a href="/bin/view/Main/LaurenMichael" class="twikiLink">LaurenMichael</a> - 21 Jul 2016</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/OSGUserSchool2016" class="twikiLink">OSGUserSchool2016</a> &gt; <a href="/bin/view/Education/UserSchool16Materials" class="twikiLink">UserSchool16Materials</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>UserSchool16Thu23BlastSplit</span> <br />    
Topic revision: r7 - 28 Jul 2016 - 19:17:47 - <a href="/bin/view/Main/LaurenMichael" class="twikiLink">LaurenMichael</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />