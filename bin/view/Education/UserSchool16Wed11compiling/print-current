<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> UserSchool16Wed11compiling &lt; Education &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Education/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Education/UserSchool16Wed11compiling?_T=16 Feb 2017" type="application/x-wiki" title="edit UserSchool16Wed11compiling" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Education/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Education/UserSchool16Wed11compiling"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('/pub/Documentation/Tools/exercises.css ');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <style type="text/css">
pre em { font-style: normal; background-color: yellow; }
pre strong { font-style: normal; font-weight: bold; color: #008; }
</style>
<p />
<h1><a name="Wednesday_Exercise_1_1_Compiling"></a> Wednesday Exercise 1.1: Compiling Programs for Portability </h1>
<p />
The goal of this exercise is to statically compile a piece of code and then submit it as a job.  This exercise should take 5-10 minutes.  
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Background"></a> Background </span></h2>
<p />
There is a large amount of scientific software that is available as source code.  
Source code is usually a group of text files (code) meant to be downloaded and then compiled into 
a <em>binary file</em> which a computer can understand.  Sometimes the source code depends on other pieces 
of code called libraries.  If the source code is compiled <em>statically</em>, these libraries are bundled into 
the compilation with the source code, creating a <em>static binary</em> which can be run on any computer 
with the same operating system.  
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Our_Software_Example"></a> Our Software Example </span></h2>
<p />
For this compiling example, we will use a script written in C.  C code depends 
on libraries and therefore will benefit from being statically compiled. 
<p />
Our C code prints 7 rows of Pascal's triangle.  
<p /> <ol>
<li> Log into the OSG submit node <code>osg-learn.chtc.wisc.edu</code>.  Create a directory for this exercise and <code>cd</code> into it.  
</li> <li> Copy and paste the following code into a file named <code>pascal.c</code>.  <pre class="file">
#include &ltstdio.h&gt
 
long factorial(int);
 
int main()
{
   int i, n, c;
   n=7;
   for (i = 0; i < n; i++){
      for (c = 0; c <= (n - i - 2); c++)
         printf(" ");
      for (c = 0 ; c <= i; c++)
         printf("%ld ",factorial(i)/(factorial(c)*factorial(i-c)));
      printf("\n");
   }
   return 0;
}

long factorial(int n)
{
   int c;
   long result = 1;
   for (c = 1; c <= n; c++)
         result = result*c;
   return result;
}
</pre>
</li></ol> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Compiling"></a> Compiling </span></h2>
<p />
In order to use this code in a job, we will first need to statically compile the code.  Recall the 
slide from the lecture - where <em>can</em> we compile and where <em>should</em> we compile?  In particular: 
<p /> <ul>
<li> Where is the compiler available? 
</li> <li> How computationally intensive will this compilation be?  
</li></ul> 
<p /> <ol>
<li> Think about these questions before moving on.  Where do you think we should compile?  
</li> <li> Most linux servers (including our submit node) have the <code>gcc</code> (GNU compiler collection) installed, so we already have a compiler on the submit node.  Furthermore, this is a simple piece of C code, so the compilation will not be computationally intensive.  Thus, we should be able to compile directly on the submit node.  
</li> <li> Compile the code, using the command:    <pre class="screen">
$> <strong>gcc -static pascal.c -o pascal</strong> 
</pre>   Note that we have added the <code>-static</code> option to make sure that the compiled binary includes the necessary libraries. This will allow the code to run on any Linux machine, no matter where those libraries are located.  
</li> <li> Verify that the compiled binary was statically linked:       <pre class="screen">$> <strong>file pascal</strong></pre>       <p>The Linux <code>file</code> command provides information about the <em>type</em> or <em>kind</em> of file that is given as an argument. In this case, you should get output like this:</p>       <pre class="screen">pascal: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), <em>statically linked</em>, for GNU/Linux 2.6.18, not stripped</pre>       <p>Note the highlighted part, which clearly states that this executable (software) is statically linked. The same command run on a non-statically linked executable file would include the text <code>dynamically linked (uses shared libs)</code> instead. So with this simple verification step, which could even be run on files that you did not compile yourself, you have some further reassurance that it is safe to use on other Linux machines. (Bonus exercise: Try the <code>file</code> command on lots of other files!)</p>
</li></ol> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Submit_the_Job"></a> Submit the Job </span></h2>
<p />
Now that our code is compiled, we can use it to submit a job.  
<p /> <ol>
<li> Think about what submit file lines we need to use to run this job:  <ul>
<li> Are there input files?
</li> <li> Are there command line arguments?
</li> <li> Where is its output written? 
</li></ul> 
</li> <li> Based on what you thought about in 1., find a submit file from earlier in the week that you can modify to run our compiled <code>pascal</code> code.  Copy it to the directory with the <code>pascal</code> binary and make those changes.  
</li> <li> Submit the job using <code>condor_submit</code>.  
</li> <li>  Once the job has run and left the queue, you should be able to see the results (seven rows of Pascal's triangle) in the <code>.out</code> file created by the job.  
</li></ol> </div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Education<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Education/OSGUserSchool2016" class="twikiLink">OSGUserSchool2016</a> &gt; <a href="/bin/view/Education/UserSchool16Materials" class="twikiLink">UserSchool16Materials</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>UserSchool16Wed11compiling</span> <br />    
Topic revision: r1 - 13 Jul 2016 - 20:13:22 - <a href="/bin/view/Main/ChristinaKoch" class="twikiLink">ChristinaKoch</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />