<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> CollectorBuildRelease &lt; Accounting &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Accounting/CollectorBuildRelease?_T=16 Feb 2017" type="application/x-wiki" title="edit CollectorBuildRelease" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Accounting/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Accounting/CollectorBuildRelease"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Collector_build_and_release_cutt"></a>  Collector build and release-cutting procedure </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Build"></a> Build </span></h2>
<p />
<pre>
cd &#60;release-top&#62;/build-scripts
make release
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Install_and_test_collector"></a> Install and test collector </span></h2>
<p />
<ul>
<li>Create / edit a suitable collector configuration file. See <code>gratia/common/configuration/collector-dev.dat</code> or <code>gratia/common/configuration/collector-nbuild.dat</code> for examples.</li>
<li>Install with <code>gratia/build-scripts/install-release</code>. Example install from local:<br />    <pre>
VERSION&#95;OPT&#61;&#34;-L&#34;
VERSION&#95;ARG&#61;~greenc/gratia-BIGINT
INSTALL&#95;SCRIPT&#61;~greenc/gratia-BIGINT/build-scripts/install-release
CONFIG&#95;DIR&#61;~greenc/gratia-BIGINT/common/configuration
MAILTO&#61;MAILME&#64;fnal.gov
INSTANCE&#61;greenc&#95;test
service&#61;dev
${INSTALL&#95;SCRIPT} -t -p -a \
                  $VERSION&#95;OPT $VERSION&#95;ARG \
                  -C ${CONFIG&#95;DIR}/collector-$service.dat \
                  -c $INSTANCE -m $MAILTO
</pre>
Invoke <code>install-release --help</code> for an explanation of all the options.</li>
<li>Test as appropriate.</li>
</ul>
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Ensure_all_desired_code_is_commi"></a> Ensure all desired code is committed </span></h2>
<p />
<pre>
svn status
svn commit -m &#60;message&#62; &#60;files&#62; ...
</pre>
<p />
See this <a href="https://twiki.grid.iu.edu/bin/view/Accounting/SvnPrimer" target="_top">SVN primer</a> for more details on SVN use.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Port_desired_changes_to_branch"></a> Port desired changes to branch </span></h2>
<p />
If the current release stream is taking place on a branch, port desired changes from HEAD into the specified branch. For example:
<pre>
svn checkout https://gratia.svn.sourceforge.net/svnroot/gratia/branches/v1-06
svn merge -r&#60;version-range&#62; https://gratia.svn.sourceforge.net/svnroot/gratia/trunk .
svn commit -m&#60;message&#62; .
</pre>
<p />
Checking in changes to the whole tree is important because the directory attributes are all updated to reflect which revisions have been merged in from HEAD. This will make future merges simpler and less error-prone.
<p />
<p />
Then, perform a <a href="/bin/view/Accounting/CollectorBuildRelease#Build" class="twikiCurrentTopicLink twikiAnchorLink">build</a> and <a href="/bin/view/Accounting/CollectorBuildRelease#Install_and_test_collector" class="twikiCurrentTopicLink twikiAnchorLink">test install</a> of the merged code.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Cut_a_developer_tag"></a> Cut a developer tag </span></h2>
<p />
For example:
<pre>
svn copy https://gratia.svn.sourceforge.net/svnroot/gratia/{branches/v1-06,development-tags/v1-06-18-rc1}
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Export_to_Gratia_releases_area_a"></a> Export to Gratia releases area and build </span></h2>
<p />
<pre>
ssh gratia&#64;gr6x1.fnal.gov
cd ~/gratia-releases/
RELEASE&#61;v1.06.18-rc1
svn export http://gratia.svn.sourceforge.net/svnroot/gratia/development-tags/${RELEASE//./-} gratia-${RELEASE}
cd gratia-${RELEASE}/build-scripts
make release
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Perform_install_on_nightly_build"></a> Perform install on nightly build machines </span></h2>
<p />
<ol>
<li>If desired, disable the nightly install command in gratia's crontab on the <a href="http://fermigrid.fnal.gov/gratia-development-organization.html" target="_top">remote install host</a>:
<pre>
<font color="#ff0000">#</font>05 0 * * *  /home/gratia/cron-scripts/nightly-build.sh --mail gratia-builds@fnal.gov
</pre></li>
<li>Perform the install on all the nightly build collectors, for example:
<pre>
install-nightly-builds -- -R v1.06.18-rc1
</pre>
</li>
</ol>
<p />
Note: if invoked as root, the host credentials for the machine on which install-nightly-builds is executed are obtained before attempting to do the remote installs. Otherwise the user's credentials must be in root's .k5login file on the target install machines.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Copy_the_final_release_candidate"></a> Copy the final release candidate to the tags arm of the repository </span></h2>
<p />
After testing on the nightly install machines and creating as many release candidates as necessary, copy the final release candidate to the release arm:
<pre>
svn copy https://gratia.svn.sourceforge.net/svnroot/gratia/{development-tags/v1-06-18-rcX,tags/v1-06-18}
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Produce_the_final_build"></a> Produce the final build </span></h2>
<p />
<pre>
ssh gratia&#64;gr6x1.fnal.gov
cd ~/gratia-releases/
RELEASE&#61;v1.06.18
svn export http://gratia.svn.sourceforge.net/svnroot/gratia/tags/${RELEASE//./-} gratia-${RELEASE}
cd gratia-${RELEASE}/build-scripts
make release
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Export_tarballs_for_VDT"></a> Export tarballs for VDT </span></h2>
<p />
<pre>
cd ~/gratia-releases
RELEASE&#61;v1.06.18
cp -p gratia-${RELEASE}/target/gratia&#95;&#42;.tar tarballs/
scp -p gratia-${RELEASE}/target/gratia&#95;&#42;.tar fnalu.fnal.gov:/afs/fnal.gov/files/expwww/gratia/html/Files/
</pre>
<p />
Note: for the copy to FNALU, one should either have membership in the PTS group <code>nichols:wadmgratia</code> or be in the ACL for the <code>/afs/fnal.gov/files/expwww/gratia/html/</code> directory tree. Someone with admin privileges in this area can do:
<pre>
cd /afs/fnal.gov/files/expwww/gratia/html
find . -type d -exec fs sa -dir \{\} -acl &#60;user&#62; write -print\;
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Update_the_version_number_on_the"></a> Update the version number on the release page </span></h2>
<p />
Update the <a href="/bin/view/Accounting/InstallationGuideVDT" class="twikiLink">VDT-team packaging and installation instructions</a> as appropriate, including but not necessarily limited to the TWiki variable <code>ReleaseVersion</code>.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Make_sure_the_release_notes_are"></a> Make sure the release notes are current </span></h2>
<p />
Create and/or edit the correct page under the <a href="/bin/view/Accounting/WebHome#Production_Releases" class="twikiCurrentWebHomeLink twikiAnchorLink">releases section</a> of the main <a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">Accounting TWiki page</a>.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Update_the_ERD_if_necessary"></a> Update the ERD if necessary </span></h2>
<p />
See John Weigand's notes under the <a href="/bin/view/Accounting/WebHome#Entity_Relationship_Diagrams_ERD" class="twikiCurrentWebHomeLink twikiAnchorLink">ERD section</a> of the main <a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">Accounting TWiki page</a>.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Request_a_VDT_release"></a> Request a VDT release </span></h2>
<p />
Send email to <code>vdt-support@opensciencegrid.org</code> giving URLs from which to obtain the release.
<p />
<p />
-- <a href="/bin/view/Main/ChrisGreen" class="twikiLink">ChrisGreen</a> - 27 Jul 2010</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Accounting<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>CollectorBuildRelease</span> <br />    
Topic revision: r9 - 07 Feb 2017 - 20:23:03 - <a href="/bin/view/Main/BrianBockelman" class="twikiLink">BrianBockelman</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />