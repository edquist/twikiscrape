<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> ProbeBuildRelease &lt; Accounting &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Accounting/ProbeBuildRelease?_T=16 Feb 2017" type="application/x-wiki" title="edit ProbeBuildRelease" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Accounting/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Accounting/ProbeBuildRelease"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Probe_build_and_release_cutting"></a>  Probe build and release-cutting procedure </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Prepare_for_the_build"></a> Prepare for the build </span></h2>
<p />
For new probes only:
<ul>
<li>Add the subdirectory name to the invocation of <code>build/package-probe</code> in <code>gratia/build/build_all</code>.</li>
</ul>
<p />
Update the <code>gratia/probe/build/gratia-probe.spec</code> file:
<p />
<ol>
<li>Update the <code>Version</code> and <code>Release</code> attributes as appropriate.</li>
<li>Update <code>%files</code> clause as appropriate for updated probes.</li>
<li>Check the <code>%post</code> clause for updated probes, including the ProbeConfig changes if appropriate.</li>
<li>Update <code>%changelog</code>.</li>
<li>For new probes:
<ul>
<li>Add required <code>Source</code> lines as appropriate.</li>
<li>Add required <code>%setup</code> line to <code>%prep</code> section.</li>
<li>In the install section, update the correct side of the <code>%ifarch noarch</code> clause for the ProbeConfig copy and any required init script for daemon-type probes.</li>
<li>Put correct <code>%package</code>, <code>%description</code>, <code>%files</code>, <code>%post</code> and <code>%preun</code> sections: use glexec (noarch non-daemon), xrootd-transfer (noarch daemon), pbs-lsf (arch non-daemon) or dCache-transfer (arch daemon) probes as templates.</li>
</ul></li>
</ol>
<p />
[This needs to be done only once] Setup for the rpm build to succeed by creating the directory $HOME/rpmbuild/SOURCES
and setting up the rpm macro:
<pre>echo &#37;&#95;topdir $HOME/rpmbuild &#62;&#62; $HOME/.rpmmacros
mkdir -p $HOME/rpmbuild/SOURCES $HOME/rpmbuild/BUILD $HOME/rpmbuild/SRPMS $HOME/rpmbuild/RPMS $HOME/rpmbuild/SPECS</pre>
<p />
Note: the build is expected to be done as a regular user.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Build"></a> Build </span></h2>
<p />
<pre>
cd gratia/probe
build/build&#95;all
</pre>
<p />
The resulting rpm files will be located in $HOME/rpmbuild/RPMS and $HOME/rpmbuild/SRPMS.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Test"></a> Test </span></h2>
<p /> <ul>
<li> Test as appropriate on any one of the CEs mentioned on the <a href="http://fermigrid.fnal.gov/gratia-development-organization.html" target="_top">development machine allocation</a> page.
</li> <li> Some probes can be be tested to a large extent on pre-packaged log data. Examples of this are the pbs-lsf, SGE and glexec probes.
</li></ul> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Ensure_all_desired_code_is_commi"></a> Ensure all desired code is committed </span></h2>
<p />
<pre>
svn status
svn commit -m &#60;message&#62; &#60;files&#62; ...
</pre>
<p />
See this <a href="https://twiki.grid.iu.edu/bin/view/Accounting/SvnPrimer" target="_top">SVN primer</a> for more details on SVN use.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Port_desired_changes_to_branch"></a> Port desired changes to branch </span></h2>
<p />
If the current release stream is taking place on a branch, port desired changes from HEAD into the specified branch. For example:
<pre>
svn checkout https://gratia.svn.sourceforge.net/svnroot/gratia/branches/v1-06
svn merge -r&#60;version-range&#62; https://gratia.svn.sourceforge.net/svnroot/gratia/trunk .
svn commit -m&#60;message&#62; .
</pre>
<p />
Checking in changes to the whole tree is important because the directory attributes are all updated to reflect which revisions have been merged in from HEAD. This will make future merges simpler and less error-prone.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Cut_a_tag"></a> Cut a tag </span></h2>
<p />
For example, if cutting from the trunk.
<pre>
RELEASE&#61;v1.06.18b-1
svn copy https://gratia.svn.sourceforge.net/svnroot/gratia/{trunk,tags/${RELEASE//./-}}
</pre>
or if cutting from the patch branch:
<pre>
RELEASE&#61;v1.06.18b-1
svn copy https://gratia.svn.sourceforge.net/svnroot/gratia/{branches/v1-06,tags/${RELEASE//./-}}
</pre>
<p />
Note that the entire repository is tagged, not just the <code>probe</code> tree.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Export_for_a_final_tagged_build"></a> Export for a final tagged build </span></h2>
<p />
<pre>
RELEASE&#61;v1.06.18b-1
svn export http://gratia.svn.sourceforge.net/svnroot/gratia/tags/${RELEASE//./-}/probe gratia-probe-${RELEASE}
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Build_and_ship_RPMs"></a> Build and ship RPMs </span></h2>
<p />
<pre>
cd gratia-probe-${RELEASE}
build/build&#95;all -PY
</pre>
<p />
The <code>-P</code> option ships the RPMs to FNALU. See the <a href="/bin/view/Accounting/CollectorBuildRelease#Release_to_VDT" class="twikiAnchorLink">release transfer</a> section of the collector build and release instructions for required permissions. The <code>-Y</code> option will update the repository headers for yum installs.
<p />
The RPMs are sent to <code>/afs/fnal.gov/files/expwww/gratia/html/Files/probe/{S,}RPMS</code>.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Update_the_Probe_release_page"></a> Update the Probe release page. </span></h2>
<p />
Bring the <a href="/bin/view/Accounting/ProbeInstallation" class="twikiLink">probe installation</a> page up to date, including but not necessarily limited to the TWiki variable <code>ProbeVersion</code>.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Make_sure_the_release_notes_are"></a> Make sure the release notes are current </span></h2>
<p />
Create and/or edit the correct page under the <a href="/bin/view/Accounting/WebHome#Production_Releases" class="twikiCurrentWebHomeLink twikiAnchorLink">releases section</a> of the main <a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">Accounting TWiki page</a>.
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Request_a_VDT_release"></a> Request a VDT release </span></h2>
<p />
Send email to <code>vdt-support@opensciencegrid.org</code> giving URLs from which to obtain the release.
<p />
<p />
<p />
-- <a href="/bin/view/Main/ChrisGreen" class="twikiLink">ChrisGreen</a> - 28 Jul 2010</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Accounting<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>ProbeBuildRelease</span> <br />    
Topic revision: r7 - 07 Feb 2017 - 20:23:03 - <a href="/bin/view/Main/BrianBockelman" class="twikiLink">BrianBockelman</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />