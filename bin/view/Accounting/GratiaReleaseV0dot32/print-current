<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GratiaReleaseV0dot32 &lt; Accounting &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Accounting/GratiaReleaseV0dot32?_T=16 Feb 2017" type="application/x-wiki" title="edit GratiaReleaseV0dot32" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Accounting/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Accounting/GratiaReleaseV0dot32"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TABLEPLUGIN_table2--><style type="text/css" media="all">
.twikiTable#table2 th {background-color:#99CCCC;}
.twikiTable#table2 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table2 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table2 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table2 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table2 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--TABLEPLUGIN_table3--><style type="text/css" media="all">
.twikiTable#table3 th {background-color:#99CCCC;}
.twikiTable#table3 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table3 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table3 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table3 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table3 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--EDITTABLEPLUGIN--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/EditTablePlugin/edittable.css");
</style>

<!--TABLEPLUGIN_table1--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
.twikiTable#table1 th {background-color:#99CCCC;}
.twikiTable#table1 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table1 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table1 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <!--
These are general in nature and should be changed in the this template if the location changes: <ul>
<li> Set CURRENT_TOMCAT = <code><b>gratia09</b></code>
</li> <li> Set CURRENT_MYSQL = <strong><em>gratia06</em></strong>
</li> <li> Set NEW_TOMCAT = <code><b>gratia07</b></code>
</li> <li> Set NEW_MYSQL = <em>_ gratia07_</em>
</li> <li> Set TOMCAT_ALIAS = <code><b>gratia.opensciencegrid.org</b></code>
</li> <li> Set MYSQL_ALIAS = <code><b>gratia-db01.fnal.gov</b></code>
</li> <li> Set RELEASE_TAR_REPOSITORY = /afs/fnal.gov/files/expwww/gratia/html/Files
</li></ul> 
<p />
These are specific to a release and require changing: <ul>
<li> Set RELEASE_DATE = 2/1/2008
</li> <li> Set CURRENT_RELEASE = v0.32
</li> <li> Set RELEASE_TAG = v0-32
</li> <li> Set NEXT_DEVEL_VERSION = v0.33
</li> <li> Set BUILD_DIRECTORY = /home/weigand/cdcvs/gratia-v0.32
</li></ul> 
-->
<p />
<p />
<h1><a name="Gratia_Release_v0_32_2_1_2008"></a>  Gratia Release v0.32 (2/1/2008)<br /> </h1>
<p />
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Overview"> Overview</a> <ul>
<li> <a href="?cover=print#Main_New_Features"> Main New Features:</a>
</li> <li> <a href="?cover=print#Additional_Features"> Additional Features:</a>
</li> <li> <a href="?cover=print#Technical_changes_affecting_some"> Technical changes affecting some of the listed features</a>
</li></ul> 
</li> <li> <a href="?cover=print#Anticipated_downtime"> Anticipated downtime</a>
</li> <li> <a href="?cover=print#Collectors_and_Databases_Affecte"> Collectors and Databases Affected</a>
</li> <li> <a href="?cover=print#Build_the_v0_32_for_distribution"> Build the v0.32 for distribution</a>
</li> <li> <a href="?cover=print#Shutdown_and_database_backup"> Shutdown and database backup.</a> <ul>
<li> <a href="?cover=print#On_the_tomcat_collector_nodes"> On the tomcat/collector nodes</a>
</li> <li> <a href="?cover=print#On_the_MySql_server_node_gratia0"> On the MySql server node (  gratia06 )</a>
</li></ul> 
</li> <li> <a href="?cover=print#Upgrade_and_implementation"> Upgrade and implementation</a> <ul>
<li> <a href="?cover=print#On_the_tomcat_collector_node_AN1"> On the tomcat/collector nodes</a>
</li></ul> 
</li> <li> <a href="?cover=print#Activating_the_new_release"> Activating the new release</a> <ul>
<li> <a href="?cover=print#On_the_tomcat_collector_node_AN2"> On the tomcat/collector nodes</a>
</li> <li> <a href="?cover=print#On_the_MySql_server_node_gra_AN1"> On the MySql server node ( gratia06 )</a>
</li></ul> 
</li> <li> <a href="?cover=print#Post_mortem"> Post-mortem</a>
</li></ul> 
</div>
<p />
<p />
<h1><a name="Overview"></a> Overview </h1>
This release (v0.32) is a maintenance release.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Main_New_Features"></a> Main New Features: </span></h2> <ul>
<li> Improve performance of startup and shutdown of servers.
</li> <li> Improve performance of reports.
</li> <li> Improve UI and html compliance.
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Additional_Features"></a> Additional Features: </span></h2> <ul>
<li> Fix parsing bug in PBS and LSF probes that lead to upload of badly corrupted record and the omission of existing record.
</li> <li> Fix condor version detection in jobmanager patches.
</li> <li> Update to DCache (file transfer) probe
</li> <li> Added sparkline report.
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Technical_changes_affecting_some"></a> Technical changes affecting some of the listed features </span></h2> <ul>
<li> Modified stored procedures and other queries to no longer use the MySql <em>Date</em> function on date <em>where</em>  clause comparisons for <em>timestamp</em> data types.  A simple <i>EndTime &gt; '2008-01-02 00:00:00'</i> comparison is more efficient. 
</li> <li> Queries using the <em>VOProbeSummary</em> view have been changed to use the <em>VOProbeSummaryData</em> summary table. When the view was used a full join of all the tables involved was performed before any of the selection criteria was applied.  If the joins are performed explicitly in the query, the selection criteria (generally <em>EndTime</em>) can be applied before the tables are joined.  This makes the query more complex, but improves performance considerably.
</li> <li> On tomcat shutdown, the <em>collector update</em> services had to be manually performed before actually stopping the tomcat instance.  This service is now stopped in the initd script.  
</li></ul> 
<p />
<!--   -------------------------------------------- -->
<h1><a name="Anticipated_downtime"></a> Anticipated downtime </h1>
It is expected that this release will require the Gratia services and reporting to be unavailable beginning at: <ul>
<li> Start: 2/1/2008  17:00 CST
</li> <li> Available: 2/1/2008 20:00 CST
</li> <li> <font color="#008000"><b>Actual: Start - 2/1 17:56 CST  End -  2/2 10:00 CST (see the <a href="/bin/view/Accounting/GratiaReleaseV0dot32#Post_mortem" class="twikiCurrentTopicLink twikiAnchorLink">post-mortem section</a> for the reasons for the overnight delay.</b></font>
</li></ul> 
<p />
The changes affecting downtime  for this release are: <ol>
<li> Length of time to make a backup of the database to the backup area using <code>mysqlhotcopy</code>
</li> <li> Installation and validation on the 6 Gratia schemas
</li></ol> 
<p />
<p />
<!--   -------------------------------------------- -->
<h1><a name="Collectors_and_Databases_Affecte"></a> Collectors and Databases Affected </h1>
<p />
The following Gratia collectors and databases will be converted with this release:
<p />
<a name="edittable1"></a>
<div class="editTable">
<form name="edittable1" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV0dot32#edittable1" method="post">
<input type="hidden" name="ettablenr" value="1" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">MySql port</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=2;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector URL</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=3;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector host</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=4;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (bytes)</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=5;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (rows)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia-fermi.fnal.gov:8881 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> gratia08.fnal.gov: </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 1.3M </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 1 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_osg </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> gratia-fermi.fnal.gov:8880 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3"> gratia08.fnal.gov: </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 9.2G </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 4,830,618 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia.opensciencegrid.org:8880 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> gratia09.fnal.gov </td>
			<td bgcolor="#FFFFCC" align="center" valign="top" class="twikiTableCol4"> 62.0G </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 45,907,231 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> gratia.opensciencegrid.org:8881 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3"> gratia09.fnal.gov 3.5 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 11.0G </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 6,276,754 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_integration </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia.opensciencegrid.org:8885 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> gratia09.fnal.gov </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 4.0G </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 1,067,144 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia_qcd </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> gratia-fermi.fnal.gov:8883 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLast"> gratia08.fnal.gov: </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4 twikiLast"> 2.4G </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5 twikiLastCol twikiLast"> 893,891 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="7" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<br />    
The following Gratia collectors and databases will <strong><em>NOT</em></strong>  be converted with this release.  These repositories contained specialized reports that have not as yet been upgraded to the new Birt V2.2 software. <strong><em>However</em></strong>, they will be taken out-of-service while the other databases are being updated.<br />    
<p />
<p />
<a name="edittable2"></a>
<div class="editTable">
<form name="edittable2" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV0dot32#edittable2" method="post">
<input type="hidden" name="ettablenr" value="2" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=0;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=1;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">MySql port</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=2;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector URL</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=3;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector host</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=4;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (bytes)</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=5;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (rows)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_psacct </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia08.fnal.gov:8882 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> gratia08.fnal.gov: </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 8.4G </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 5,158,567 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia_osg_daily </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> gratia.opensciencegrid.org:8884 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLast"> gratia09.fnal.gov </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4 twikiLast"> .7G </td>
			<td bgcolor="#FFFFFF" align="center" valign="top" class="twikiTableCol5 twikiLastCol twikiLast"> 72,961 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="3" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<p />
<p />
<!-- BUILD DISTRIBUTION -------------------- -->
<h1><a name="Build_the_v0_32_for_distribution"></a> Build the v0.32 for distribution </h1>
<ol>
<li>Make sure your build area contains all <em>committed</em> changes.
<ul><li>cvs update</li></ul>
</li>
<p />
<li>In <em>gratia/build-scripts/Makefile</em> , change the <em>version_default</em> to:
<ul><li>version_default = v0.33</li>
       <li>commit the change</li>
</ul>
<p />
The reason for using a version number 1 more than the current release is so that all development that occurs after this release will have the odd numbered development release (v0.33).
<p />
The current release (v0.32) <strong><em>will</em></strong> get assigned  properly when the <em>cvs export</em> is performed after the tagging occurs.
</li>
<p />
<li>Tag the release:
<ul><li>cvs tag -R v0-32 gratia</li></ul>
       This tags everything that is in your build directory and presumably tested.
</li>
<p />
<li> <em>Into a <strong>new</strong> area</em>, export the tagged release:
<ul><li>cvs export -d gratia-v0.32 -r v0-32 gratia</li></ul>
</li>
<p />
<li>Build it for the release (this insures that tar files are produced for VDT):
<ul><li>cd gratia-v0.32/build-scripts</li>
<li>source setup-jdk15.sh</li>
<li>make release</li></ul>
</li>
<p />
<li>Copy the built tar files to the release area:
<ul><li>scp ../target/*_v0.32.tar   flxi07.fnal.gov:/afs/fnal.gov/files/expwww/gratia/html/Files/</li></ul> </li>
<p />
<li>Update the version number on the <a href="/bin/view/Accounting/InstallationGuideVDT" class="twikiLink">services release TWiki page</a>:</li>
<ul><li>Edit and update the TWiki variable <em>ReleaseVersion</em>.</li></ul>
</ol>
<p />
<font color="#008000"><b>Started: 18:50 CST  Ended: 19:15 CST</b></font>
<p />
<a name="build-changes" />
<font color="#0000ff"><b>
Build modifications made after initial cutover:
<p />
<ol>
  <li>Changes to the Gratia source code made after the initial implementations:
<ul>
<li>gratia/common/configuration/update-gratia-local<pre>
Modified because the gratia08 and gratia09 versions of 
java do not have the jar command available forcing the 
need for auto-deploy in tomcat.  I was trying to make 
the VDT and local installs similar but this put that on hold.</pre>
<p />
<li>gratia/reporting/gratia-reporting/WebContent/staticReports/staticReports.py<pre>
Resolved problems (too many leading spaces) in report 
generation for all except the 2007 report.</pre>
<p />
<li>gratia/reporting/gratia-reports/WebContent/MenuConfig/StaticReports.xml<pre>
Changed to remove the problem 2007 pdf report.</pre>
<p />
   </ul>
  <li>The 3 files where re-tagged  </li>
   <li>The export for v0.32 was redone.</li>
   <li>Gratia was re-made </li>
   <li>The release tar files re-copied to /afs/fnal.gov/files/expwww/gratia/html/Files </li>
</ol>
</font>
<font color="#008000">Done:4/6 10:00</font>
</b>
<p />
<p />
<p />
<p />
<p />
<!-- ----------------- SHUTDOWN AND DATABASE BACKUP ------------- -->
<h1><a name="Shutdown_and_database_backup"></a> Shutdown and database backup. </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_tomcat_collector_nodes"></a> On the tomcat/collector nodes </span></h2>
<ol>
<li> <strong><em>comment</em></strong> out the <strong><em>root</em></strong> user cron entry for the static reports:
<p />
On <strong><em>gratia08</em></strong> :
<pre class="screen">
42 0 * * * '/data/tomcat-fermi_itb/gratia/staticReports.py' '/data/tomcat-fermi_itb' 'http://gratia-fermi.fnal.gov:8881/gratia-reporting/' 
42 0 * * * '/data/tomcat-qcd/gratia/staticReports.py' '/data/tomcat-qcd' 'http://gratia-fermi.fnal.gov:8883/gratia-reporting/' >/dev/null 
42 0 * * * '/data/tomcat-fermi_osg/gratia/staticReports.py' '/data/tomcat-fermi_osg' 'http://gratia-fermi.fnal.gov:8880/gratia-reporting/' 
</pre>
<p />
On <strong><em>gratia09</em></strong> :
<pre class="screen">
42 0 * * * '/data/tomcat-osg_integration/gratia/staticReports.py' '/data/tomcat-osg_integration' 'http://gratia.opensciencegrid.org:8885/gratia-reporting/' 
42 0 * * * '/data/tomcat-itb/gratia/staticReports.py' '/data/tomcat-itb' 'http://gratia.opensciencegrid.org:8881/gratia-reporting/' 
42 0 * * * '/data/tomcat-gratia/gratia/staticReports.py' '/data/tomcat-gratia' 'http://gratia.opensciencegrid.org:8880/gratia-reporting/' 
</pre>
</li>
<p />
<font color="#008000"><b>Done: 17:59 CST</b></font>
<p />
    <li> Disable <em>init.d</em> services  as <strong><em>root</em></strong> user:
<p />
On <strong><em>gratia08</em></strong>: <ul>
<li> chkconfig tomcat-ps off
</li> <li> chkconfig tomcat-qcd   off
</li> <li> chkconfig tomcat-fermi_osg off
</li> <li> chkconfig tomcat-fermi_itb  off
</li></ul> 
<p />
On <strong><em>gratia09</em></strong> : <ul>
<li> chkconfig tomcat-gratia  off
</li> <li> chkconfig tomcat-osg_daily   off
</li> <li> chkconfig tomcat-osg_integration off
</li> <li> chkconfig tomcat-itb    off
</li></ul> 
<p />
<font color="#008000"><b>Done: 18:01 CST</b></font>
<p />
</li>
<p />
<p />
     <li> <strong><em>Stop</em></strong> the tomcat init.d service for <strong><em>ALL</em></strong> Gratia collectors.
<p />
The <em>update services</em> threads will be stopped during the <em>initd</em> shutdown process effective with v0.31.
<p />
On <strong><em>gratia08</em></strong>: <ul>
<li> service tomcat-fermi_itb  stop
</li> <li> service tomcat-fermi_osg stop
</li> <li> service tomcat-ps  stop
</li> <li> service tomcat-qcd stop
</li></ul> 
<p />
On <strong><em>gratia09</em></strong> : <ul>
<li> service tomcat-gratia  stop
</li> <li> service tomcat-itb  stop
</li> <li> service tomcat-osg_daily  stop
</li> <li> service tomcat-osg_integration stop
</li></ul> 
<p />
<font color="#008000"><b>Done: 18:10 CST</b></font>
<p />
</li>
<p />
<li>This is optional, but probably a good idea to save off the logs under each tomcat instance and empty the <em>log</em> directory.  It will facilitate catching any errors that may occur (of course there won't be any, but a good idea anyway).
<b>This can be performed while the database backups are being performed.</b>
<p />
On <strong><em>gratia09</em></strong> : <ul>
<li> date=`date '+%Y%m%d'`
</li> <li> cd /data/tomcat-osg_integration/logs
</li> <li> tar zcf  /data/gratia_tomcat_logs_backups/tomcat-osg_integration.$date.tgz     * 
</li> <li> rm -f *
</li> <li> 
</li> <li> cd     /data/tomcat-itb/logs/
</li> <li> tar zcf /data/gratia_tomcat_logs_backups/tomcat-itb.$date.tgz   *
</li> <li> rm -f *
</li> <li> 
</li> <li> cd  /data/tomcat-gratia/logs/
</li> <li> tar zcf /data/gratia_tomcat_logs_backups/tomcat-gratia.$date.tgz  *
</li> <li> rm -f *
</li></ul> 
<p />
On <strong><em>gratia08</em></strong> : <ul>
<li> date=`date '+%Y%m%d'`
</li> <li> cd        /data/tomcat-fermi_itb/logs/
</li> <li> tar zcf /data/gratia_tomcat_logs_backups/tomcat-fermi_itb.$date.tgz   *
</li> <li> rm -f *
</li> <li> 
</li> <li> cd  /data/tomcat-qcd/logs/
</li> <li> tar zcf /data/gratia_tomcat_logs_backups/tomcat-qcd.$date.tgz     *
</li> <li> rm -f *
</li> <li> 
</li> <li> cd     /data/tomcat-fermi_osg/logs/
</li> <li> tar zcf /data/gratia_tomcat_logs_backups/tomcat-fermi_osg.$date.tgz  *
</li> <li> rm -f *
</li></ul> 
<p />
<font color="#008000"><b>Done: 19:31 CST</b></font>
<p />
</li>
<p />
</ol>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_MySql_server_node_gratia0"></a> On the MySql server node (  <strong><em>gratia06</em></strong> ) </span></h2>
  <ol type="1">
    <li> <strong><em>comment</em></strong> out the cron entries for:
<p />
<strong><em>gratia</em></strong> user cron jobs.
<pre class="screen">
0 0 1-15 * *   dir=/home/gratia/interfaces/apel-lcg; cd $dir; ./lcg.sh --config=lcg.conf --date=previous --update
30 01 * * *   dir=/home/gratia/interfaces/apel-lcg; cd $dir; ./lcg.sh --config=lcg.conf --date=current --update
</pre>
<font color="#008000"><b>Done: 18:01 CST</b></font>
<p />
<strong><em>root</em></strong> user cron entry.
<pre class="screen">
43 2 * * * /usr/local/bin/mysqlhotcopy_cron.sh &gt; /var/log/mysqlhotcopy.out 2&gt; &1
</pre>
<font color="#008000"><b>Done: 18:13 CST</b></font>
</li>
<p />
<p />
<li>On the MySql server node ( <strong><em>gratia06</em></strong> ):
<p />
Take a back up the database instances (this will include all schema) using part of the <em>msqlhotcopy_cron</em> script from the command line as <em>root</em> user.
<br />    Backup will only being done to  <em>/backup/mysqldb</em> on <strong><em>gratia06</em></strong> in order to reduce the downtime. <ul>
<li> PSWD=xxxx (root passwd)
</li> <li> mysqlhotcopy -p $PSWD --addtodest fermi_itb /backup/mysqldb       
</li> <li> mysqlhotcopy -p $PSWD --addtodest gratia_osg_daily /backup/mysqldb    
</li> <li> mysqlhotcopy -p $PSWD --addtodest gratia_qcd /backup/mysqldb     
</li> <li> mysqlhotcopy -p $PSWD --addtodest gratia_osg_integration /backup/mysqldb  
</li> <li> mysqlhotcopy -p $PSWD --addtodest fermi_osg /backup/mysqldb   
</li> <li> mysqlhotcopy -p $PSWD --addtodest gratia_psacct /backup/mysqldb   
</li> <li> mysqlhotcopy -p $PSWD --addtodest gratia_itb /backup/mysqldb   
</li> <li> mysqlhotcopy -p $PSWD --addtodest gratia /backup/mysqldb    
</li></ul> 
<p />
<b>Problem: mysqlhotcopy no longer exists in /usr/bin where it used to be.
<p />
Temporary resolution: RPM for mysql server was removed on Jan 19 which had the hot copy script in it.  Chris restored it and we were able to resume the conversion. at 18:41 CST.  Problem is multiple mysql versions out there.</b>
<p />
Backup times:
<p />
<a name="edittable3"></a>
<div class="editTable">
<form name="edittable3" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV0dot32#edittable3" method="post">
<input type="hidden" name="ettablenr" value="3" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table3" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=0;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=1;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Duration - Last Release</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot32?cover=print;sortcol=2;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Actual Duration</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 1 sec </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> 45 tables (142 files) in 0 seconds (0 seconds overall) </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_daily </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 6 secs </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol"> 38 tables (109 files) in 1 second (1 seconds overall) </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_qcd </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 64 secs </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> 45 tables (142 files) in 80 seconds (80 seconds overall) </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_integration </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 99 secs </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol"> 46 tables (145 files) in 134 seconds (134 seconds overall) </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_osg </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 132 secs </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> 45 tables (142 files) in 301 seconds (302 seconds overall) </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_psacct </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 179 secs </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol"> 40 tables (115 files) in 269 seconds (269 seconds overall) </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 461 secs (8 min) </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> 46 tables (143 files) in 338 seconds (338 seconds overall) </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> 2900 secs (48+ min) </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> 47 tables (148 files) in 2358 seconds (2360 seconds overall) </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="9" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<font color="#008000"><b>Started: 18:35 CST Done: 17:54 CST </b></font>
<p />
     </li>
<p />
<p />
<p />
</ol>
<p />
<p />
<!-- ----------------- UPGRADE AND IMPLEMENTATION ------------- -->
<h1><a name="Upgrade_and_implementation"></a> Upgrade and implementation </h1>
The <strong><em>upgrades should be single-threaded</em></strong> , that is, performed for each database schema one at a time.  
<p />
We will perform these upgrades based on the size of the individual database schema, in ascending order.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_tomcat_collector_node_AN1"></a> On the tomcat/collector nodes </span></h2>
<ol>
  <li>Install the new software on a Gratia tomcat instance:
<br />     pswd=xxx
<br />     source=/home/weigand/cdcvs/gratia-v0.32
<br />     pgm=/home/weigand/cdcvs/gratia-v0.32/common/configuration/update-gratia-local 
<br />     On <strong><em>gratia08:</em></strong> <ul>
<li> $pgm  -d $pswd -S $source  fermi_itb
</li> <li> $pgm  -d $pswd -S $source qcd
</li> <li> $pgm  -d $pswd -S $source   fermi_osg
</li></ul> 
<br />     On <strong><em>gratia09:</em></strong> <ul>
<li> $pgm  -d $pswd -S $source  osg_integration
</li> <li> $pgm  -d $pswd -S $source  itb
</li> <li> $pgm  -d $pswd -S $source   gratia
</li></ul> 
<p />
</li>
<p />
<p />
<li>Start the gratia tomcat services: <ul>
<li> service &lt;tomcat service&gt; start
</li> <li> When the tomcat service initializes, it will detect any schema changes have been effected and a conversion process will begin. 
</li> <li> <em>tail</em> the  <em>catalina.out</em> log. When the conversion process completes the log will show the following message:<br />           "INFO: Server startup in _xxx_ms"
</li></ul> 
<p />
<li>Then, <em>start</em> the Gratia <em>update</em> services for the database schema just upgraded.<br />     <ul>
<li> In your browser, connect to the Gratia administrative services url for each of the databases.<br />    
</li> <li> Select the <em>System / Administration</em> menu option in the left menu<br />    
</li> <li> Then scroll down to the <em>Starting/Stopping Database Update Services</em> section and select the <em>Start Update Services</em> link.
</li> <li> As <strong><em>each</em></strong> collector/tomcat host update service is started, monitor the tomcat logs files for any errors.
</li> <li> Bring up the gratia <em>administration</em> web interface and verify that the collectors are processing the data.
</li> <li> Bring up the gratia <em>reporting</em> web interface and verify that the reports look reasonable while still <em>tail'ing</em> the log files.
</li></ul> 
<p />
<li>If all looks good, <em>stop</em> the Gratia <em>update</em> services for the database schema just upgraded.
<p />
<p />
<li> Run the static reports cron as <em>root</em> and verify these reports are generated: <ul>
<li> ./gratia-reports/reports-static/UsageByVOByDate-ranked.pdf
</li> <li> ./gratia-reports/reports-static/UsageBySiteByDate-ranked.pdf
</li> <li> ./gratia-reports/reports-static/WeeklyUsageByVO-ranked.pdf
</li></ul> 
<p />
On <strong><em>gratia08</em></strong> :
<pre class="screen">
42 0 * * * '/data/tomcat-fermi_itb/gratia/staticReports.py' '/data/tomcat-fermi_itb' 'http://gratia-fermi.fnal.gov:8881/gratia-reporting/' 
42 0 * * * '/data/tomcat-qcd/gratia/staticReports.py' '/data/tomcat-qcd' 'http://gratia-fermi.fnal.gov:8883/gratia-reporting/' 
42 0 * * * '/data/tomcat-fermi_osg/gratia/staticReports.py' '/data/tomcat-fermi_osg' 'http://gratia-fermi.fnal.gov:8880/gratia-reporting/' 
</pre>
<p />
On <strong><em>gratia09</em></strong> :
<pre class="screen">
42 0 * * * '/data/tomcat-osg_integration/gratia/staticReports.py' '/data/tomcat-osg_integration' 'http://gratia.opensciencegrid.org:8885/gratia-reporting/' 
42 0 * * * '/data/tomcat-itb/gratia/staticReports.py' '/data/tomcat-itb' 'http://gratia.opensciencegrid.org:8881/gratia-reporting/' 
42 0 * * * '/data/tomcat-gratia/gratia/staticReports.py' '/data/tomcat-gratia' 'http://gratia.opensciencegrid.org:8880/gratia-reporting/' 
</pre>
</li>
<p />
<li>If satisifed, <strong><em>stop</em></strong> the tomcat service for that tomcat database schema so you can proceed to the next one. <ul>
<li> service &lt;tomcat service&gt; stop
</li></ul> 
</li>
</ol>
<p />
<font color="#008000"><b>
gratia08:
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table4" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_itb </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> Done at 20:58 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> problem with staticReports.py </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> qcd </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1"> Done at 21:04 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol"> problem with staticReports.py </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> fermi_osg </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLast"> Done at 21:20 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> problem with staticReports.py <br />    something called a <span class="twikiNewLink">HistoryReaper<a href="/bin/edit/Accounting/HistoryReaper?topicparent=Accounting.GratiaReleaseV0dot32" rel="nofollow" title="HistoryReaper (this topic does not yet exist; you can create it)">?</a></span> went nuts </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
</b></font>
<p />
<font color="#008000"><b>
gratia09:
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table5" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> osg_integration </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> Done at 21:27 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> problem with staticReports.py <br />    something called a <span class="twikiNewLink">HistoryReaper<a href="/bin/edit/Accounting/HistoryReaper?topicparent=Accounting.GratiaReleaseV0dot32" rel="nofollow" title="HistoryReaper (this topic does not yet exist; you can create it)">?</a></span> went nuts </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> itb </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1"> Gave up at 21:54 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol"> problem with staticReports.py <br />    something called a <span class="twikiNewLink">HistoryReaper<a href="/bin/edit/Accounting/HistoryReaper?topicparent=Accounting.GratiaReleaseV0dot32" rel="nofollow" title="HistoryReaper (this topic does not yet exist; you can create it)">?</a></span> went nuts </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLast"> Started: 2/2 09:46 Ended: 2/2 09:54 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> problem with staticReports.py <br />    sHistoryReaper did not run since it is a timed thing and all went very well. </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
</b></font>
<p />
<p />
<!-- ----------------- ACTIVATING THE NEW RELEASE ------------- -->
<h1><a name="Activating_the_new_release"></a> Activating the new release </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_tomcat_collector_node_AN2"></a> On the tomcat/collector nodes </span></h2>
  <ol>
        <li> <strong><em>start</em></strong> the tomcat service for the Gratia collectors.<br />    
<p />
On <strong><em>gratia08:</em></strong> <ul>
<li> service tomcat-fermi_itb  start
</li> <li> service tomcat-fermi_osg start
</li> <li> service tomcat-ps start
</li> <li> service tomcat-qcd start
</li></ul> 
<p />
On <strong><em>gratia09:</em></strong> <ul>
<li> service tomcat-gratia start  
</li> <li> service tomcat-itb start
</li> <li> service tomcat-osg_daily start
</li> <li> service tomcat-osg_integration start
</li></ul> 
<p />
<font color="#008000"><b>Done: 2/2 10:00 CST</b></font>
</li>
<p />
<p />
<p />
   <li> As <strong><em>each</em></strong> collector/tomcat host service is started, monitor the tomcat logs files for any errors.
<p />
<font color="#008000"><b>Done: 2/2 10:00 CST</b></font>
<p />
</li>
<p />
   <li> Bring up the gratia administrative web interface and verify that the collectors are processing the data.<br />    
     If they are not processing any data,  <strong><em>verify</em></strong> the Gratia update services are active.
<ul><li>In your browser,  connect to the Gratia administrative services url for each of the databases.</li>
       <li>Select the <em>System / Administration</em> menu option in the left menu</li>
       <li>Then scroll down to the <em>Starting/Stopping Database Update Services</em> section and and view the status.</li>
</ul>
<p />
<font color="#008000"><b>Done: 2/2 10:00 CST</b></font>
<p />
      </li>
<p />
    <li> Enable <em>init.d</em> services for all tomcats as <strong><em>root</em></strong> user:
<p />
On <strong><em>gratia08:</em></strong> <ul>
<li> chkconfig tomcat-ps on
</li> <li> chkconfig tomcat-qcd   on
</li> <li> chkconfig tomcat-fermi_osg on
</li> <li> chkconfig tomcat-fermi_itb  on
</li></ul> 
<p />
On <strong><em>gratia09:</em></strong> <ul>
<li> chkconfig tomcat-gratia  on
</li> <li> chkconfig tomcat-osg_daily   on
</li> <li> chkconfig tomcat-osg_integration on
</li> <li> chkconfig tomcat-itb    on
</li></ul> 
<p />
<font color="#008000"><b>Done: 2/2 10:00 CST</b></font>
</li>
<p />
   <li> <strong><em>Uncomment/verify</em></strong>   the <strong><em>root</em></strong> user cron entry for the static reports:
<p />
On <strong><em>gratia08</em></strong> :
<pre class="screen">
42 0 * * * '/data/tomcat-fermi_itb/gratia/staticReports.py' '/data/tomcat-fermi_itb' 'http://gratia-fermi.fnal.gov:8881/gratia-reporting/' 
42 0 * * * '/data/tomcat-qcd/gratia/staticReports.py' '/data/tomcat-qcd' 'http://gratia-fermi.fnal.gov:8883/gratia-reporting/' 
42 0 * * * '/data/tomcat-fermi_osg/gratia/staticReports.py' '/data/tomcat-fermi_osg' 'http://gratia-fermi.fnal.gov:8880/gratia-reporting/' 
</pre>
<font color="#008000"><b>Done: 2/2 10:00 CST</b></font>
<p />
On <strong><em>gratia09</em></strong> :
<pre class="screen">
42 0 * * * '/data/tomcat-osg_integration/gratia/staticReports.py' '/data/tomcat-osg_integration' 'http://gratia.opensciencegrid.org:8885/gratia-reporting/' 
42 0 * * * '/data/tomcat-itb/gratia/staticReports.py' '/data/tomcat-itb' 'http://gratia.opensciencegrid.org:8881/gratia-reporting/' 
42 0 * * * '/data/tomcat-gratia/gratia/staticReports.py' '/data/tomcat-gratia' 'http://gratia.opensciencegrid.org:8880/gratia-reporting/' 
</pre>
<font color="#008000"><b>Done: 2/2 10:00 CST</b></font>
</li>
</ol>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_MySql_server_node_gra_AN1"></a> On the MySql server node ( <strong><em>gratia06</em></strong> ) </span></h2>
<ol>
<li> <strong><em>Uncomment</em></strong>   the <strong><em>root</em></strong> user cron job(s) for gratia backups
<pre class="screen">
43 2 * * * /usr/local/bin/mysqlhotcopy_cron.sh > /var/log/mysqlhotcopy.out 2>&1
</pre>
<font color="#ff0000"><b>Not done.  Will do it on Monday 2/4</b></font>
<font color="#008000"><b>Done: 2/5 08:210</b></font>
</li>
<li> <strong><em>Uncomment</em></strong>  the <strong><em>gratia</em></strong> user cron job(s).
<pre class="screen">
0 0 1-15 * *   dir=/home/gratia/interfaces/apel-lcg; cd $dir; ./lcg.sh --config=lcg.conf --date=previous --update
30 01 * * *   dir=/home/gratia/interfaces/apel-lcg; cd $dir; ./lcg.sh --config=lcg.conf --date=current --update
</pre>
<font color="#008000"><b>Done: 2/2 10:00 CST</b></font>
</li>
</ol>
<p />
<p />
<p />
<!-- ----------------- POST MORTEM  ------------- -->
<h1><a name="Post_mortem"></a> Post-mortem </h1>
At this time, this will appear to be random notes.  After the conversion, they may be organized.
<p />
<ol>
<li>On gratia06, the <em>mysqlhotcopy</em> root cron process appears to not have been working for a while. The /usr/log/mysqlhotcopy.out file looks like this:
<pre>
/usr/local/bin/mysqlhotcopy_cron.sh: line 4: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 5: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 6: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 7: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 8: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 9: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 10: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 11: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 15: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 16: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 17: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 18: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 19: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 20: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 21: mysqlhotcopy: command not found
/usr/local/bin/mysqlhotcopy_cron.sh: line 22: mysqlhotcopy: command not found
</pre>
The /backup/mysqldb directory on gratia06 shows:
<pre>
drwxr-x---  2 gratia gratia  4096 Oct 30 03:26 fermi_itb
drwxr-x---  2 gratia gratia  4096 Oct 30 03:26 fermi_osg
drwxr-xr-x  4 gratia gratia  4096 Oct 30 03:15 gratia
drwxr-x---  2 gratia gratia  4096 Jan 10 03:50 gratia_itb
drwxr-x---  2 gratia gratia  4096 Sep 13 03:35 gratia_osg_daily
drwxr-x---  2 gratia gratia  4096 Oct 27 04:08 gratia_osg_integration
drwxr-x---  2 gratia gratia  4096 Aug 19 03:39 gratia_psacct
drwxr-x---  2 gratia gratia  4096 Oct 30 03:23 gratia_qcd
</pre>
<b>Temporary resolution:</b> RPM for mysql server was removed on Jan 19 which had the hot copy script in it.  Chris restored it and we were able to resume the conversion. at 18:41 CST.  Problem is multiple mysql versions out there.
<p />
<li><b>crontab issue for staticReports.py:</b><br> It was adding new crontab entries for the staticReports even though I already had them commented out.  Baffling when I first saw it. <ul>
<li> if we don't adjust for this in the <em>configure-collector</em> script, then the instructions need to      be modified to fix manually.  This will apply to all uses of <em>install_gratia_local</em> .
</li> <li> the VDT <em>configure_gratia</em> script has to be changed, to create the cron service.  I do not believe this was done for v0.32.
</li></ul> 
</li>
<p />
<li><b>Cause of suspended installation</b><br>
When I (<a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a>) brought up the Gratia ITB installation, the admin and reports pages kept giving an "Unable to connect" error just as though the wrong url/port was specified.  I noticed the the log files however, that a HistoryReaper thread was running.  In turns out that the <span class="twikiNewLink">HistoryReaper<a href="/bin/edit/Accounting/HistoryReaper?topicparent=Accounting.GratiaReleaseV0dot32" rel="nofollow" title="HistoryReaper (this topic does not yet exist; you can create it)">?</a></span> is a new feature that is cleaning up and compressing the history and old directories in ./gratia/data.  At the time this occured, I was unaware of this new feature and decided something must be seriously wrong if I could not even render the admin or report menus.  
<p />
Discussion with Phillipe after I (<a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a>) got home and the fact that the ITB instance did come back up made me realize I just did not wait long enough. This HistoryReaper is set to go off on certain intervals and I must have  just got "lucky".  The next morning when I upgraded the <em>gratia</em> production instance, there HistoryReaper did not come up and the install worked in seconds.
<p />
Another factor affecting the slow startup, on the ITB instance, was the number of nodes that replication was <em>on</em> for.
<p />
<b>Thoughts:</b> There should be a means of turning all these threads off during a startup.  Something like a <em>chkconfig</em> for the Gratia services.   <ul>
<li> Turning off the replication services before shutting down can be done manually and I just forgot.  It was not that big a factor on the v0.30 cut, but may have been on this one.
</li></ul> 
</li>
<p />
<li><b> <em>staticReports.py</em> problems</b>
This was a failure on my (<a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a>) part when testing this past week and should have been detected prior to cut.  Penelope corrected the problem on all but one report by Sunday morning and I installed them around 14:00 on 2/3.
<p />
These are the errors encountered after the 14:00 updates:
<pre>
   * This is the only completely good one:
        fermi_osg -  http://gratia-fermi.fnal.gov:8880/gratia-reporting/

   * Problems in these with the  2007 Usage for All VOs. 
      Fails in adobe with a "File does not being with '%PDF-'." message
        fermi_itb - http://gratia-fermi.fnal.gov:8881/gratia-reporting/
        gratia_qcd - http://gratia-fermi.fnal.gov:8883/gratia-reporting/

   * Problems in these with the  2007 Usage for All VOs. 
      Fails in adobe with a "The file is damaged and could not be repaired."  message
         itb      - http://gratia.opensciencegrid.org:8881/gratia-reporting/
         gratia - http://gratia.opensciencegrid.org:8880/gratia-reporting/
         osg_integration - http://gratia.opensciencegrid.org:8885/gratia-reporting/ 
</pre>
It is thought that this may be a <em>birt</em> software issued and a bug ticket has been issued.
</li>
<p />
<li>Post-installation code updates
<pre>
See this section for some <a href="#build-changes">post-installation code updates</a> 
that were required during the installations.
</pre>
</li>
<p />
</ol>
<p />
<p />
<p />
<p />
<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Major_updates"></a>  Major updates </span></h2>
<!--Future editors should add their signatures beneath yours!-->
-- <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a> - 24 Jan 2008<br />    
-- <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a> - 04 Feb 2008 - completed documentation<br />    </div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Accounting<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GratiaReleaseV0dot32</span> <br />    
Topic revision: r16 - 06 Feb 2008 - 17:31:02 - <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />