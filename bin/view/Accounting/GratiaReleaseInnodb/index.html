<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GratiaReleaseInnodb &lt; Accounting &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Accounting/GratiaReleaseInnodb?_T=16 Feb 2017" type="application/x-wiki" title="edit GratiaReleaseInnodb" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Accounting/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Accounting/GratiaReleaseInnodb"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TABLEPLUGIN_table2--><style type="text/css" media="all">
.twikiTable#table2 th {background-color:#99CCCC;}
.twikiTable#table2 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table2 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table2 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table2 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table2 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--TABLEPLUGIN_table3--><style type="text/css" media="all">
.twikiTable#table3 th {background-color:#99CCCC;}
.twikiTable#table3 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table3 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table3 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table3 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table3 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--EDITTABLEPLUGIN--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/EditTablePlugin/edittable.css");
</style>

<!--TABLEPLUGIN_table5--><style type="text/css" media="all">
.twikiTable#table5 th {background-color:#99CCCC;}
.twikiTable#table5 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table5 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table5 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table5 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table5 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--TABLEPLUGIN_table1--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
.twikiTable#table1 th {background-color:#99CCCC;}
.twikiTable#table1 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table1 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table1 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<!--TABLEPLUGIN_table4--><style type="text/css" media="all">
.twikiTable#table4 th {background-color:#99CCCC;}
.twikiTable#table4 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table4 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table4 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table4 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table4 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style></head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <!--
These are general in nature and should be changed in the this template if the location changes: <ul>
<li> Set CURRENT_TOMCAT = <code><b>gratia09</b></code>
</li> <li> Set CURRENT_MYSQL = <strong><em>gratia06</em></strong>
</li> <li> Set NEW_TOMCAT = <code><b>gratia07</b></code>
</li> <li> Set NEW_MYSQL = <em>_ gratia07_</em>
</li> <li> Set TOMCAT_ALIAS = <code><b>gratia.opensciencegrid.org</b></code>
</li> <li> Set MYSQL_ALIAS = <code><b>gratia-db01.fnal.gov</b></code>
</li> <li> Set RELEASE_TAR_REPOSITORY = /afs/fnal.gov/files/expwww/gratia/html/Files
</li></ul> 
<p />
These are specific to a release and require changing: <ul>
<li> Set RELEASE_DATE = 2/14/2008 - 3/10/2008
</li> <li> Set CURRENT_RELEASE = v0.32.1
</li> <li> Set RELEASE_TAG = REMOVE
</li> <li> Set NEXT_DEVEL_VERSION = REMOVE
</li> <li> Set BUILD_DIRECTORY = REMOVE
</li> <li> Set INNODB = InnoDB
</li></ul> 
<p /> <ul>
<li> Set EDITTHISTEXT = <div class="twikiSmall"><a href="GratiaReleaseInnodb">edit this section</a></div>
</li></ul> 
-->
<p />
<p />
<h1><a name="Gratia_Release_v0_32_1_InnoDB_2"></a>  Gratia Release v0.32.1 InnoDB (2/14/2008 - 3/10/2008 - 4/2/2008)<br /> </h1>
<p />
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Overview"> Overview</a>
</li> <li> <a href="?cover=print#Anticipated_downtime"> Anticipated downtime</a>
</li> <li> <a href="?cover=print#Collectors_and_Databases_Affecte"> Collectors and Databases Affected</a>
</li> <li> <a href="?cover=print#Conversion_and_implementation"> Conversion and implementation</a>
</li> <li> <a href="?cover=print#Gratia_Innodb_Upgrade_Procedure"> Gratia Innodb Upgrade Procedure</a> <ul>
<li> <a href="?cover=print#Overview_AN1"> Overview</a>
</li> <li> <a href="?cover=print#Setup_the_temporary_gratiax23_to"> Setup the temporary <b>gratiax23</b> tomcat and <b>gratia07</b> database</a>
</li> <li> <a href="?cover=print#Bring_the_gratia07_into_sync_wit"> Bring the <b>gratia07</b> into sync with the <b>gratia06</b></a>
</li> <li> <a href="?cover=print#Switch_the_gratia09_tomcat_to_us"> Switch the <b>gratia09</b> tomcat to use the <b>gratia07</b> database</a>
</li> <li> <a href="?cover=print#Effect_the_conversion_using_grat"> Effect the conversion using <b>gratiax23</b> tomcat and <b>gratia06</b> database</a>
</li> <li> <a href="?cover=print#Bring_the_gratia06_into_sync_wit"> Bring the <b>gratia06</b> into sync with the <b>gratia07</b></a>
</li> <li> <a href="?cover=print#Switch_gratia09_tomcat_back_to_t"> Switch <b>gratia09</b> tomcat back to the <b>gratia06</b> database</a>
</li></ul> 
</li> <li> <a href="?cover=print#Post_mortem"> Post-mortem</a>
</li></ul> 
</div>
<p />
<p />
<h1><a name="Overview"></a> Overview </h1>
This release (v0.32.1) is a technical  release to convert the MySql database tables from MyISAM to InnoDB.  
<p />
There are no software updates included.
<p />
All databases will be converted to use the InnoDB engine with the <strong>exception</strong> of the following which require software updates that will be available in v0.34: <ul>
<li> gratia_psacct
</li> <li> gratia_osg_daily
</li></ul> 
<p />
The <em>gratia_qcd</em> was converted to InnoDB on 2/14/2008.
<p />
<p />
<!--   -------------------------------------------- -->
<h1><a name="Anticipated_downtime"></a> Anticipated downtime </h1>
These conversions will take place over a 2 week period.  The <em>gratia_qcd</em> database was already converted on 2/14/2008.  Unfortunately, no data was collected at that time to judge anticipated down time.  It is expected that down time for Gratia services will be minimal.
<p />
The changes affecting downtime for this release are: <ol>
<li> Length of time to make a backup of the database to the backup area using <code>mysqlhotcopy</code>
</li> <li> Installation and validation on the 6 Gratia schemas
</li></ol> 
<p />
<p />
<!--   -------------------------------------------- -->
<h1><a name="Collectors_and_Databases_Affecte"></a> Collectors and Databases Affected </h1>
The following Gratia collectors and databases have been converted to InnoDB:
<p />
<a name="edittable1"></a>
<div class="editTable">
<form name="edittable1" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseInnodb#edittable1" method="post">
<input type="hidden" name="ettablenr" value="1" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Date converted</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=2;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">MySql port</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=3;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector URL</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=4;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector host</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=5;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (bytes)</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol6"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=6;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (rows)</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol7 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=7;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Convertion Time</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_qcd </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 2/14/2008 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> gratia-fermi.fnal.gov:8883 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4"> gratia08.fnal.gov: </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5"> 3.5 Gb </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol6"> 971,574 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol7 twikiLastCol"> n/a </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 3/3/2008 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> gratia-fermi.fnal.gov:8881 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol4"> gratia08.fnal.gov: </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5"> 44 Mb </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol6"> 19,976 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol7 twikiLastCol"> 12s </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_integration </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 3/3/2008 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> gratia.opensciencegrid.org:8885 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4"> gratia09.fnal.gov </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5"> 4.5 Gb </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol6"> 1,237,028 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol7 twikiLastCol"> 16 minutes </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> fermi_osg </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> 3/3/2008 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLast"> gratia-fermi.fnal.gov:8880 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol4 twikiLast"> gratia08.fnal.gov: </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5 twikiLast"> 12 Gb </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol6 twikiLast"> 5,906,303 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol7 twikiLastCol twikiLast"> 42 minutes </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="5" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<p />
The following Gratia collectors and databases will be converted with this release:
<p />
<a name="edittable2"></a>
<div class="editTable">
<form name="edittable2" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseInnodb#edittable2" method="post">
<input type="hidden" name="ettablenr" value="2" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=0;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=1;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">MySql port</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=2;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector URL</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=3;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector host</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=4;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (bytes)</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=5;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (rows)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia.opensciencegrid.org:8881 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> gratia09.fnal.gov </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 12 Gb </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 6,985,631 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> gratia.opensciencegrid.org:8880 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLast"> gratia09.fnal.gov </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4 twikiLast"> 53 Gb </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5 twikiLastCol twikiLast"> 51,322,746 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="3" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<p />
<br />    
The following Gratia collectors and databases will <strong><em>NOT</em></strong>  be converted with this release.  These repositories require v0.34 and will be converted at that time.  <br />    
<p />
<p />
<a name="edittable3"></a>
<div class="editTable">
<form name="edittable3" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseInnodb#edittable3" method="post">
<input type="hidden" name="ettablenr" value="3" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table3" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=0;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=1;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">MySql port</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=2;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector URL</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=3;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector host</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=4;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (bytes)</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=5;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (rows)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_psacct </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia08.fnal.gov:8882 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> gratia08.fnal.gov: </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 9.3 Gb </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 5,694,312 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia_osg_daily </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> gratia.opensciencegrid.org:8884 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLast"> gratia09.fnal.gov </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4 twikiLast"> 85 Mb </td>
			<td bgcolor="#FFFFFF" align="center" valign="top" class="twikiTableCol5 twikiLastCol twikiLast"> 80,178 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="3" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
On the MySql server node ( <strong><em>gratia06</em></strong> ):
<p />
Take a back up the database instances (this will include all schema) using part of the <em>msqlhotcopy_cron</em> script from the command line as <em>root</em> user.
<br />    Backup will only being done to  <em>/backup/mysqldb</em> on <strong><em>gratia06</em></strong> in order to reduce the downtime. <ul>
<li> PSWD=xxxx (root passwd)
</li> <li> mysqlhotcopy -p $PSWD --addtodest fermi_itb /backup/mysqldb       
</li> <li> mysqlhotcopy -p $PSWD --addtodest gratia_osg_daily /backup/mysqldb    
</li> <li> mysqlhotcopy -p $PSWD --addtodest gratia_qcd /backup/mysqldb     
</li> <li> mysqlhotcopy -p $PSWD --addtodest gratia_osg_integration /backup/mysqldb  
</li> <li> mysqlhotcopy -p $PSWD --addtodest fermi_osg /backup/mysqldb   
</li> <li> mysqlhotcopy -p $PSWD --addtodest gratia_psacct /backup/mysqldb   
</li> <li> mysqlhotcopy -p $PSWD --addtodest gratia_itb /backup/mysqldb   
</li> <li> mysqlhotcopy -p $PSWD --addtodest gratia /backup/mysqldb    
</li></ul> 
<p />
<p />
Backup times:
<p />
<a name="edittable4"></a>
<div class="editTable">
<form name="edittable4" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseInnodb#edittable4" method="post">
<input type="hidden" name="ettablenr" value="4" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table4" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=0;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=1;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Duration - Last Release <br />    mysqlhotcopy</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=2;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Actual Time <br />     Mar 4 2008 </font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=3;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Backup <br />    Size</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=4;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Compressed <br />    Size</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=5;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Type</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 1 sec </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol2"> 00:00:11 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 44.03 MB </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 1.65 MB </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5 twikiLastCol"> mysqldump </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_daily </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 1 secs </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol2"> 00:00:11 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> 84.57 MB </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 11.77 MB </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol5 twikiLastCol"> mysqlhotcopy </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_qcd </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 80 secs </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol2"> 00:07:26 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 2.63 GB </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 174.42 MB </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5 twikiLastCol"> mysqldump </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_integration </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 134 secs </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol2"> 00:14:16 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> 4.53 GB </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 239.92 MB </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol5 twikiLastCol"> mysqldump </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_osg </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 302 secs </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol2"> 00:32:47 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 11.46 GB </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 639.66 MB </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5 twikiLastCol"> mysqldump </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_psacct </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 269 secs </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol2"> 00:24:06 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> 9.31 GB </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 1.18 GB </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol5 twikiLastCol"> mysqlhotcopy </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 338 secs (6+ min) </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol2"> 00:31:22 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 12.01 GB </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 1.43 GB </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5 twikiLastCol"> mysqlhotcopy </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> 2358 secs (39+ min) </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> &nbsp; </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLast"> &nbsp; </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol4 twikiLast"> &nbsp; </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol5 twikiLastCol twikiLast"> &nbsp; </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="9" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<p />
<p />
     </li>
</ol>
<p />
<p />
<!-- ----------------- UPGRADE AND IMPLEMENTATION ------------- -->
<h1><a name="Conversion_and_implementation"></a> Conversion and implementation </h1>
We will perform these upgrades based on the size of the individual database schema, in ascending order.
<p />
<p />
<a name="edittable5"></a>
<div class="editTable">
<form name="edittable5" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseInnodb#edittable5" method="post">
<input type="hidden" name="ettablenr" value="5" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table5" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=0;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=1;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Host</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=2;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">TOMCAT_LOCATION</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=3;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">tomcat service</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=4;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Start</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseInnodb?cover=print;sortcol=5;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Ended</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> gratia08 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> /data/tomcat-fermi_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> tomcat-fermi_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4"> &nbsp; </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 20328 ms </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_integration </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> gratia09 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> /data/tomcat-osg_integration </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3"> tomcat-osg_integration </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol4"> &nbsp; </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 992939 ms </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_osg </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> gratia08 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> /data/tomcat-fermi_osg </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> tomcat-fermi_osg </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4"> &nbsp; </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 2572958 ms </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> gratia09 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> /data/tomcat-itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3"> tomcat-itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol4"> &nbsp; </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol5 twikiLastCol"> &nbsp; </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLast"> gratia09 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLast"> /data/tomcat-gratia </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3 twikiLast"> tomcat-gratia </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4 twikiLast"> &nbsp; </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5 twikiLastCol twikiLast"> &nbsp; </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="6" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<p />
<hr width=95% />
<p />
For the <em>gratia_itb</em> and <em>gratia</em> database conversions, a little different approach will be taken.  The <em>gratia_itb</em> will be a practice of the conversion steps necessary for the <em>gratia</em> instance.  The conversion time for the <em>gratia</em> database conversion is unknown and is not expected to scale linearly based on the others instances.  
<p />
<!-- <ul>
<li> Set EDITTHISTEXT = <div class="twikiSmall"><a href="GratiaReleaseInnodb">edit this section</a></div>
</li></ul> 
<p /> <ul>
<li> Set PROD_VER      = <b>v0.32</b>
</li></ul> 
<p /> <ul>
<li> Set PROD_NODE    = <b>gratia09</b>
</li> <li> Set PROD_DB       = <b>gratia06</b>
</li> <li> Set PROD_TC       = <b><b>gratia09</b>:/data/tomcat-itb</b>
</li></ul> 
<p /> <ul>
<li> Set TEMP_NODE    = <b>gratiax23</b>
</li> <li> Set TEMP_DB       = <b>gratia07</b>
</li> <li> Set TEMP_TC       = <b><b>gratiax23</b>:VDT_LOCATION/tomcat/v55</b>
</li> <li> Set TEMP_URL      = <a href="http://gratiax23.fnal.gov:8880/gratia-administration" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration</a>
</li></ul> 
<p /> <ul>
<li> Set DB_NAME       = <b>gratia_itb</b>
</li></ul> 
<p /> <ul>
<li> Set JUR               = JobUsageRecord
</li> <li> Set CONFIG          = <b>./gratia/service-configuration.properties</b>
</li></ul> 
-->
<p />
<p />
<!-- <ul>
<li> Set EDITTHISTEXT = <div class="twikiSmall"><a href="GratiaInnodbUpgrade">edit this section</a></div>
</li></ul> 
<p /> <ul>
<li> Set PROD_VER      = <b>v0.32.1b</b>
</li></ul> 
<p /> <ul>
<li> Set PROD_NODE    = <b>gratia09</b>
</li> <li> Set PROD_DB       = <b>gratia06</b>
</li> <li> Set PROD_TC       = <b><b>gratia09</b>:/data/tomcat-gratia</b>
</li> <li> Set PROD_TC_SERVICE = tomcat-gratia
</li> <li> Set PROD_URL      = <a href="http://gratia09.fnal.gov:8880" target="_top">http://gratia09.fnal.gov:8880</a>
</li></ul> 
<p /> <ul>
<li> Set TEMP_NODE    = <b>gratiax23</b>
</li> <li> Set TEMP_DB       = <b>gratia07</b>
</li> <li> Set TEMP_TC       = <b><b>gratiax23</b>:VDT_LOCATION/tomcat/v55</b>
</li> <li> Set TEMP_TC_SERVICE = tomcat-55
</li> <li> Set TEMP_URL      = <a href="http://gratiax23.fnal.gov:8880" target="_top">http://gratiax23.fnal.gov:8880</a>
</li></ul> 
<p /> <ul>
<li> Set DB_NAME       = <b>gratia</b>
</li></ul> 
<p /> <ul>
<li> Set JUR               = JobUsageRecord
</li> <li> Set CONFIG          = <b>./gratia/service-configuration.properties</b>
</li></ul> 
-->
<p />
Database privileges: <ul>
<li> ./post-install.sh summary-view <ul>
<li> forces the update of the VIEWS.  There is a DEFINER= parameter in the VOProbeSummay view which contains the original database/collector used.  This can be reset by re-loading the views.
</li></ul> 
</li></ul> 
<p />
<p />
<p />
<h1><a name="Gratia_Innodb_Upgrade_Procedure"></a> Gratia Innodb Upgrade Procedure </h1>
<div class="twikiSmall"><a href="GratiaInnodbUpgrade">edit this section</a></div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Overview_AN1"></a> Overview </span></h2>
<p />
The intent is to minimize downtime (availability) of Gratia services.  This is a general outline and the details for each step will be addressed in a subsequent section.  This will also serve as a trial/template for future conversions where DB changes may require long conversion times. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Setup_the_temporary_gratiax23_to"></a> Setup the temporary <b>gratiax23</b> tomcat and <b>gratia07</b> database </span></h2>
<ol>
  <li> Install the current production version (<b>v0.32</b>) of Gratia on a test machine (<b>gratiax23</b>)
     <ol type="a">
      <li> To avoid complications and additional work, it is best if this is an instance that has <strong>no</strong> probes reporting to it.
      <li> Turn off the MySql instance to reduce resource consumption
<pre>
service mysql5 stop
</pre>
      <li> We are only using the tomcat web services and will be pointing it to the <b>gratia06</b> to effect the conversion.
      <li> To be safe, turn off the update services: on the gratia-administration screen, 
         <ul>
           <li> go to System--&gt;Administration, 
           <li> scroll down and click on the <em>Stop Update Services</em> link,
           <li> the <em>Current Status</em> should show <em>Stopped</em> 
          </ul>
       <li> <strong>Remember</strong> that every time you restart the <em>tomcat</em> service, the Gratia collector comes up in <em>Update</em> mode which <strong>will</strong> cause problems since we are converting the <strong>real</strong> database.  This is why using an instance that is assured of having no probes reporting to it is very important. 
      </ol>
<p />
   <li> We are going to be switching the <b><b>gratia09</b>:/data/tomcat-itb</b> collector/reporter to use the <b>gratia07</b> database while the conversion takes place on <b>gratia06</b>.  So, to effect this, we need to do the following:
      <ol type="a">
      <li> Rather than take the <b>gratia06</b> database off-line to do a backup to <b>gratia07</b>, we will use the nightly backup (currently a <em>mysqlhotcopy</em>).
      <li> On <b>gratia07</b>:
         <ul>
         <li> The night before, remove all files under the <b>/data/mysqldb/<b>gratia_itb</b></b> directory and set the ownership on the directory to <strong>gratia.mysql</strong>.
         <li> Also the night before, verify/set the users and privileges so the <b>gratiax23</b> has permissions to update the stored procedures:
<pre>
GRANT ALL ON *.* TO 'root'@'&lt;your collector ip address&gt;  identified by 'root password';
GRANT GRANT OPTION ON *.* TO 'root'@'&lt;your collector ip address&gt; 
<b>...note you can find the IP address by executing...
   host <b>gratiax23</b>.fnal.gov</b>
</pre>
            Also verify that the <b>gratia06</b> has the same root permissions for it's specific IP address.  If it doesn't, set them as above.
<p />
         <li> On the day of cutover, verify the ownership on the <b>/data/mysqldb/<b>gratia_itb</b></b> directory and the ownership on the table files are <strong>gratia.mysql</strong>.  They will likely have been reset from the nightly backup.
<p />
         <li> If replication is in use, we need to turn it off temporarily and also be in a position to turn it back on once we have converted to using the <b>gratia07</b> database:
<pre>
<b>... this creates a file to be used when turning Replication back on .... </b>
select "update Replication set running=1 where replicationid=",replicationid,";" 
from Replication where running=1 into outfile '/tmp/jgw.sql';
<b>... be sure that the <i>outfile</i> does not already exist or it will fail</b>

<b>... then turn replication off for those ids</b>
update Replication set running=0 where running=1;
</pre>
<font color="#008000">DONE: 3/27/08 10:23 No Replication "running" on gratia database</font>
<p />
         <li> Update the <strong>SystemProplist</strong> table for the attributes below so the stored procedures, triggers and table statistics get updated correctly.
            <pre>
update SystemProplist set cdr=0 where car='gratia.database.storedProcedureVersion';
update SystemProplist set cdr=0 where car='gratia.database.summaryTriggerVersion';
update SystemProplist set cdr=0 where car='gratia.database.TableStatisticsVersion';

select * from SystemProplist;  

+--------+----------------------------------------+------+
| propid | car                                    | cdr  |
+--------+----------------------------------------+------+
|    211 | use.report.authentication              | true | 
|    212 | gratia.database.version                | 28   | 
|    214 | gratia.database.summaryTableVersion    | 26   | 
|    <b>215 | gratia.database.summaryTriggerVersion  |  0   | </b>
|    <b>216 | gratia.database.storedProcedureVersion |  0   | </b>
|    217 | gratia.database.wantSummaryTable       | 1    | 
|    218 | gratia.database.wantSummaryTrigger     | 1    | 
|    219 | gratia.database.wantStoredProcedures   | 1    | 
|    <b>220 | gratia.database.TableStatisticsVersion |  0   | </b>
+--------+----------------------------------------+------+
</pre>
<p />
<font color="#008000">DONE: 3/27/08 10:30 </font>
         </ul>
<p />
      <li> On <b><b>gratiax23</b>:VDT_LOCATION/tomcat/v55</b>:
         <ul>
         <li> change the <b>./gratia/service-configuration.properties</b> file entries to use the <b>gratia07</b> database
         <pre>
service.mysql.url=jdbc:mysql://<b>gratia07</b>.fnal.gov:<b>3320</b>/<b>gratia_itb</b>
<b>... use the values from the <b><b>gratia09</b>:/data/tomcat-itb</b> instance....</b>
service.mysql.user=<b>xxxxx</b>
service.mysql.password=<b>xxxxx</b>
service.reporting.user=<b>xxxxx</b>
service.reporting.password=<b>xxxxx</b>
</pre>
         <li> Restart the tomcat service.  It's also not a bad idea to remove the log files so it is easier to spot any problems.
<pre>
service %TEMP_TC_SERVICE% stop
rm -f VDT_LOCATION/tomcat/v55/logs/*
service %TEMP_TC_SERVICE% start

<b>... since there should be no updates occurring, nor any replication 
         you should see only this line in the <i>catalina.out</i> file and
         no other activity</b>
INFO: Server startup in 14307 ms
</pre>
         <li>A couple of things to look for in the logs (other than obvious stacktrace errors) is any failures in updating the triggers, procedures, summary tables, or summary views:
<pre>
 grep -i fail ./logs/*  

grep "Summary trigger updated successfully" *
grep "Stored procedures updated successfully" *
grep "Summary tables updated successfully" *
grep "Summary view updated successfully" *
grep "Table statistics updated successfully" *
</pre>
           Another item to look for to verify you have connected to the right database would be to re-query the <em>SystemProplist</em> table on <b>gratia07</b>, checking
that the <em>cdr</em> value changed on those set to 0.
<pre>select * from SystemProplist;</pre>
<font color="#008000">DONE: 3/27/08 10:39 </font>
         </ul>
<p />
      <li> Verify you are connected correctly by bringing up the administration (<a href="http://gratiax23.fnal.gov:8880/gratia-administration/gratia-administration" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration/gratia-administration</a>) page in your browser.  The counts shown and those on the %PROD_URL%/gratia-administration page should be reasonably close with the only difference being the data collected since the <em>mysqlhotcopy</em> was performed.<br />    
<font color="#008000">DONE: 3/27/08 10:40 </font>
<p />
      <li>We need to create the static report files
         <ul>
         <li>Execute the following (as root):
<pre>
/usr/local/osg-collector/tomcat/v55/gratia/staticReports.py   /usr/local/osg-collector/tomcat/v55   http://gratiax23.fnal.gov:8880/gratia-reporting
</pre>
          <li>Bring up the gratia reporting<br />     - <a href="http://gratiax23.fnal.gov:8880/gratia-administration/gratia-reporting" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration/gratia-reporting</a>
<p />
          <li>Click on the <em>Static Reports</em> menu item and then verify each report comes up.
          </ul>
<font color="#ff0000">Don't think this makes any sense... re-evaluate</font>
      </ol>
</ol>
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Bring_the_gratia07_into_sync_wit"></a> Bring the <b>gratia07</b> into sync with the <b>gratia06</b> </span></h2>
We now have to "catch up" the <b>gratia07</b> database before switching the <b>gratia09</b> collector  to use it. 
<ol>
    <li> On <b>gratia07</b>, find the last <em>dbid</em>  for the JobUsageRecord table.
<!-- <ul>
<li> Set MAXDBID = 57907506
</li></ul> 
-->
<pre>
select max(dbid) from JobUsageRecord;
+-----------+
| max(dbid) |
+-----------+
|   %MAXDBID% | 
+-----------+
</pre>
<p />
    <li> On %PROD_URL%/gratia-administration, add a replication entry pointing to <a href="http://gratiax23.fnal.gov:8880/gratia-administration" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration</a> and starting with the <em>dbid</em> from the previous step <em>+1</em>.  Be sure to test it..*Do not activate it yet.*
<p />
    <li>In the <b>gratia06</b> <b>gratia_itb</b> database, set the <em>dbid</em> in the <em>Replication</em> table to the %MAXDBID%.
<pre>
select * from Replication where openconnection like '%<b>gratiax23</b>%';
update Replication set dbid=%MAXDBID%  where openconnection like '%<b>gratiax23</b>%';
</pre>
<p />
<font color="#ff0000">Replication will not render.  Doing this in mysql client.
<pre>
 insert into Replication VALUES(NULL,0,0,0,"http://gratiax23.fnal.gov:8880",NULL,1,57907506,0,"All",NULL);

replcationid=50

update Replication set running=1 where replicationid=50;
</pre>
DONE: 3/27/08 11:03
</font>
<p />
    <li> Now back on the %PROD_URL%/gratia-administration replication screen, refresh the screen and verify the <em>dbid</em> value.
<p />
    <li> If all is well, click the <em>Start</em> button.  Then watch for a while in the <b><b>gratiax23</b>:VDT_LOCATION/tomcat/v55</b> logs files for any errors.  You can also watch on the <a href="http://gratiax23.fnal.gov:8880/gratia-administration/gratia-administration" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration/gratia-administration</a> <em>Status</em> screen.
<p />
    <li> On %PROD_URL%/gratia-administration, go to the <em>System --&gt; Administration</em> page and then to <em>Starting/Stopping Database Update Services</em>  section and select the <em>Stop Update Services</em> link.    This will queue any updates and allow the two instances to sink without losing any data.
<p />
    <li> <strong>WAIT UNTIL</strong> the <em>All Time Total</em> numbers are equal for both %PROD_URL% and <a href="http://gratiax23.fnal.gov:8880/gratia-administration" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration</a>. Then we are caught up and can proceed.<br />    
<font color="#008000">Started - 11:07  Ended -    </font>
<p />
    <li> On the %PROD_URL%/gratia-administration replication screen, <strong>Stop</strong> the replication for <a href="http://gratiax23.fnal.gov:8880/gratia-administration" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration</a>.  
<p />
    <li> On the %PROD_URL%/gratia-administration replication screen, <strong>Delete</strong> the replication for <a href="http://gratiax23.fnal.gov:8880/gratia-administration" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration</a>.
<p />
   <li>On <b>gratiax23</b>, stop the tomcat service.  This positions us to switch the <b><b>gratia09</b>:/data/tomcat-itb</b> tomcat service to using the <b>gratia07</b> database.
        <pre>service %TEMP_TC_SERVICE% stop</pre>
</ol>
<p />
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Switch_the_gratia09_tomcat_to_us"></a> Switch the <b>gratia09</b> tomcat to use the <b>gratia07</b> database </span></h2>
On <b>gratia09</b>, switch the  tomcat instance using the <b>gratia06</b> database to the backup on <b>gratia07</b>. The <b>gratia07</b> database will be used for for production until the conversion is complete on <b>gratia06</b>.
<p />
This will be the first <em>downtime</em> period for the <b>gratia_itb</b> Gratia service.
<p />
<ol><li>Stop the %PROD_TC_SERVICE%
           <pre>service %PROD_TC_SERVICE% stop</pre>
<p />
      <li>Edit the <em><b><b>gratia09</b>:/data/tomcat-itb</b>/gratia/service-configuration.properties</em> file changing the <em>service.mysql.url</em> attribute to reference the <em><b>gratia07</b></em> database.
            <pre>service.mysql.url=jdbc:mysql://<b>gratia07</b>.fnal.gov:3320/<b>gratia_itb</b> </pre>
<p />
   <li>Start the %PROD_TC_SERVICE%
           <pre>service %PROD_TC_SERVICE% service</pre>
        It would probably be a good idea to <em>tail</em> the log files for a period to verify all is well.
<p />
</ol>
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Effect_the_conversion_using_grat"></a> Effect the conversion using <b>gratiax23</b> tomcat and <b>gratia06</b> database </span></h2>
<p />
<ol>
   <li> On <b>gratiax23</b>, the tomcat instance should have already been stopped.  If not, do it <strong>quickly</strong>.
<pre>
service %TEMP_TC_SERVICE% stop
</pre>
<p />
  <li> On <b>gratiax23</b>, edit the <em><b><b>gratiax23</b>:VDT_LOCATION/tomcat/v55</b>/gratia/service-configuration.properties</em> file changing the <em>service.mysql.url</em> attribute to reference the <em><b>gratia06</b></em> database.
            <pre>service.mysql.url=jdbc:mysql://<b>gratia06</b>.fnal.gov:3320/<b>gratia_itb</b> </pre>
       <strong>It is very important that this step be performed or the result will most likely be a mess.</strong>
<p />
  <li> On <b>gratiax23</b>, edit the <b><b>gratiax23</b>:VDT_LOCATION/tomcat/v55</b>/gratia/hibernate.cfg.xml file changing:
<pre>
         &lt;!-- SQL dialect --&gt;
<b>from.</b> &lt;property name="dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;
<b>to..</b> &lt;property name="dialect"&gt;org.hibernate.dialect.MySQLInnoDBDialect&lt;/property&gt;
</pre>
<p />
     <li> On <b>gratia06</b>, verify/set the users and privileges so the <b>gratiax23</b> has permissions to update the stored procedures:
<pre>
GRANT ALL ON *.* TO 'root'@'&lt;your collector ip address&gt;  identified by 'root password';
GRANT GRANT OPTION ON *.* TO 'root'@'&lt;your collector ip address&gt; 
<b>...note you can find the IP address by executing...
   host <b>gratiax23</b>.fnal.gov</b>
</pre>
<p />
  <li> On <b>gratiax23</b>, start the gratia tomcat services:
<pre>
service %TEMP_TC_SERVICE% start
</pre>
<p />
  <li> On <b>gratiax23</b>, when the tomcat service initializes, it will detect any schema changes have been effected and a conversion process will begin. 
     <ol type="a">
        <li> <em>tail</em> the  <em>catalina.out</em> log  
        <li>When the conversion process completes the log will show the following message:
<pre>INFO: Server startup in _xxx_ms</pre>
      </ol>
<p />
   <li> <strong>Wait until the previous step completes before proceeding.</strong>
<p />
</ol>
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Bring_the_gratia06_into_sync_wit"></a> Bring the <b>gratia06</b> into sync with the <b>gratia07</b> </span></h2>
Before we switch the <b>gratia09</b> tomcat service back to using the <b>gratia06</b>, we have to do a "catch up" on the data the <b>gratia07</b> has been collecting while the conversion was being performed.
<p />
<ol>
         <li> On <b>gratia06</b>, find the last <em>dbid</em>  for the JobUsageRecord table.
<!-- <ul>
<li> Set NEW_MAXDBID = 8054381
</li></ul> 
-->
<pre>
select max(dbid) from JobUsageRecord;
+-----------+
| max(dbid) |
+-----------+
|   %NEW_MAXDBID% | 
+-----------+
</pre>
<p />
    <li> On %PROD_URL%/gratia-administration, add a replication entry pointing to <a href="http://gratiax23.fnal.gov:8880/gratia-administration" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration</a> and starting with the <em>dbid</em> from the previous step <em>+1</em>.  Be sure to test it..*Do not activate it yet.*
<p />
    <li>On <b>gratia07</b> in the <b>gratia_itb</b> database, set the <em>dbid</em> in the <em>Replication</em> table to the %NEW_MAXDBID%.
<pre>
select * from Replication where openconnection = 'http://gratiax23.fnal.gov:8880/gratia-administration';
update Replication set dbid=%NEW_MAXDBID%  where openconnection = 'http://gratiax23.fnal.gov:8880/gratia-administration';
</pre>
<p />
    <li> Now back on the %PROD_URL%/gratia-administration replication screen, refresh the screen and verify the <em>dbid</em> value.
<p />
    <li> If all is well, click the <em>Start</em> button.  Then watch for a while in the <b><b>gratiax23</b>:VDT_LOCATION/tomcat/v55</b> logs files for any errors.  You can also watch on the <a href="http://gratiax23.fnal.gov:8880/gratia-administration/gratia-administration" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration/gratia-administration</a> <em>Status</em> screen.
<p />
    <li> On %PROD_URL%/gratia-administration, go to the <em>System --&gt; Administration</em> page and then to <em>Starting/Stopping Database Update Services</em>  section and select the <em>Stop Update Services</em> link.    This will queue any updates and allow the two instances to sink without losing any data.
<p />
    <li> <strong>WAIT UNTIL</strong> the <em>All Time Total</em> numbers are equal for both %PROD_URL% and <a href="http://gratiax23.fnal.gov:8880/gratia-administration" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration</a>. Then we are caught up and can proceed.
<p />
     <li> On the %PROD_URL%/gratia-administration replication screen, <strong>Stop</strong> the replication for <a href="http://gratiax23.fnal.gov:8880/gratia-administration" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration</a>.  
<p />
    <li> On the %PROD_URL%/gratia-administration replication screen, <strong>Delete</strong> the replication for <a href="http://gratiax23.fnal.gov:8880/gratia-administration" target="_top">http://gratiax23.fnal.gov:8880/gratia-administration</a>.
<p />
    <li>On <b>gratiax23</b>, stop the tomcat service.  This positions us to switch the <b><b>gratia09</b>:/data/tomcat-itb</b> tomcat service to using the <b>gratia06</b> database.
        <pre>service %TEMP_TC_SERVICE% stop</pre>
</ol>
<p />
<p />
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Switch_gratia09_tomcat_back_to_t"></a> Switch <b>gratia09</b> tomcat back to the <b>gratia06</b> database </span></h2>
<ol>
   <li> On <b>gratia09</b>, stop the tomcat service for <b>gratia_itb</b>.
<pre>
service %PROD_TC_SERVICE% stop
</pre>
<p />
  <li> On <b>gratia09</b>, edit the <em><b><b>gratia09</b>:/data/tomcat-itb</b>/gratia/service-configuration.properties</em> file changing the <em>service.mysql.url</em> attribute to reference the <em><b>gratia06</b></em> database.
            <pre>service.mysql.url=jdbc:mysql://<b>gratia06</b>.fnal.gov:3320/<b>gratia_itb</b> </pre>
       <strong>It is very important that this step be performed or the result will most likely be a mess.</strong>
<p />
  <li> On <b>gratia09</b>, edit the <b><b>gratia09</b>:/data/tomcat-itb</b>/gratia/hibernate.cfg.xml file changing:
<pre>
         &lt;!-- SQL dialect --&gt;
<b>from.</b> &lt;property name="dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;
<b>to..</b> &lt;property name="dialect"&gt;org.hibernate.dialect.MySQLInnoDBDialect&lt;/property&gt;
</pre>
<p />
<p />
  <li> On <b>gratia09</b>, start the gratia tomcat services:
<pre>
service %PROD_TC_SERVICE% start
</pre>
<p />
  <li> On <b>gratia09</b>, when the tomcat service initializes, it will detect any schema changes have been effected and a conversion process will begin. 
     <ol type="a">
        <li> <em>tail</em> the  <em>catalina.out</em> log  
        <li>When the conversion process completes the log will show the following message:
<pre>INFO: Server startup in _xxx_ms</pre>
      </ol>
<p />
   <li> <strong>WE ARE DONE  AND CAN BREATH AGAIN!!!!</strong>
<p />
</ol>
<p />
<p />
<p />
<hr width=95% />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<!-- ----------------- POST MORTEM  ------------- -->
<h1><a name="Post_mortem"></a> Post-mortem </h1>
At this time, this will appear to be random notes.  After the conversion, they may be organized.
<p />
<p />
<p />
<p />
<p />
<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Major_updates"></a>  Major updates </span></h2>
<!--Future editors should add their signatures beneath yours!-->
-- <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a> - 29 Feb 2008</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Accounting<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GratiaReleaseInnodb</span> <br />    
Topic revision: r15 - 02 Apr 2008 - 15:46:48 - <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />