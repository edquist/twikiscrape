<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GratiaReleaseV0dot36 &lt; Accounting &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Accounting/GratiaReleaseV0dot36?_T=16 Feb 2017" type="application/x-wiki" title="edit GratiaReleaseV0dot36" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Accounting/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Accounting/GratiaReleaseV0dot36"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TABLEPLUGIN_table2--><style type="text/css" media="all">
.twikiTable#table2 th {background-color:#99CCCC;}
.twikiTable#table2 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table2 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table2 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table2 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table2 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--EDITTABLEPLUGIN--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/EditTablePlugin/edittable.css");
</style>

<!--TABLEPLUGIN_table1--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
.twikiTable#table1 th {background-color:#99CCCC;}
.twikiTable#table1 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table1 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table1 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <!--
These are general in nature and should be changed in the this template if the location changes: <ul>
<li> Set CURRENT_TOMCAT = <code><b>gratia09</b></code>
</li> <li> Set CURRENT_MYSQL = <strong><em>gratia06</em></strong>
</li> <li> Set NEW_TOMCAT = <code><b>gratia07</b></code>
</li> <li> Set NEW_MYSQL = <em>_ gratia07_</em>
</li> <li> Set TOMCAT_ALIAS = <code><b>gratia.opensciencegrid.org</b></code>
</li> <li> Set MYSQL_ALIAS = <code><b>gratia-db01.fnal.gov</b></code>
</li> <li> Set RELEASE_TAR_REPOSITORY = /afs/fnal.gov/files/expwww/gratia/html/Files
</li></ul> 
<p />
These are specific to a release and require changing: <ul>
<li> Set RELEASE_DATE = 2008/07/15
</li> <li> Set CURRENT_RELEASE = v0.36
</li> <li> Set RELEASE_TAG = v0-36
</li> <li> Set NEXT_DEVEL_VERSION = v0.37
</li> <li> Set BUILD_DIRECTORY = /home/weigand/cdcvs/gratia-v0.36
</li></ul> 
<p />
<p />
<p />
-->
<h1><a name="Gratia_Release_v0_36_2008_07_15"></a>  Gratia Release v0.36 (2008/07/15)<br /> </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Overview"> Overview</a> <ul>
<li> <a href="?cover=print#Main_New_Features"> Main New Features:</a>
</li> <li> <a href="?cover=print#Reporter_Improvements"> Reporter Improvements</a>
</li> <li> <a href="?cover=print#Collector_Improvements"> Collector Improvements</a>
</li> <li> <a href="?cover=print#Additional_Features"> Additional Features:</a>
</li></ul> 
</li> <li> <a href="?cover=print#Anticipated_downtime"> Anticipated downtime</a>
</li> <li> <a href="?cover=print#Collectors_and_Databases_Affecte"> Collectors and Databases Affected</a>
</li> <li> <a href="?cover=print#Build_the_v0_36_for_distribution"> Build the v0.36 for distribution</a>
</li> <li> <a href="?cover=print#Database_backups_and_cron_init_d"> Database backups and cron/init.d services</a> <ul>
<li> <a href="?cover=print#On_the_tomcat_collector_nodes_gr"> On the tomcat/collector nodes (gratia08/gratia09)</a>
</li> <li> <a href="?cover=print#On_the_MySql_server_node_gratia0"> On the MySql server node ( gratia06 )</a>
</li></ul> 
</li> <li> <a href="?cover=print#Upgrade_and_implementation"> Upgrade and implementation</a> <ul>
<li> <a href="?cover=print#On_the_tomcat_collector_nodes"> On the tomcat/collector nodes</a>
</li></ul> 
</li> <li> <a href="?cover=print#Post_mortem"> Post-mortem</a>
</li></ul> 
</div>
<p />
<p />
<h1><a name="Overview"></a> Overview </h1>
 The main purpose of this release (v0.36) is first release to be fully operable by FermiGrid.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Main_New_Features"></a> Main New Features: </span></h2> <ul>
<li> All components (including daily reports) properly packaged. 
</li> <li> Documentation cleanup. 
</li> <li> Fully ready for wide distribution of collectors. 
</li> <li> Contains database size controls. 
</li> <li> Administration of Collector requires VO-authentication. 
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Reporter_Improvements"></a> Reporter Improvements </span></h2> <ul>
<li> Some speed improvements to OSG Daily reports 
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Collector_Improvements"></a> Collector Improvements </span></h2> <ul>
<li> Ensure backing up of the history directories 
</li> <li> Safe mode start and GUI-control-ability of replication, servlet and DB update processing threads. 
</li> <li> Automatic clean up of RawXML, trace and Duplicate tables. 
</li> <li> More efficient resolution of duplicate records. 
</li> <li> Enable cleanup of old records  <ul>
<li> After a customizable length of time (usually 3 months), job level records will deleted from the database 
</li> <li> Incoming job level records that pertain to date older than the specify dateline will be rejected. 
</li></ul> 
</li> <li> Update installation script to install for running as non-root. 
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Additional_Features"></a> Additional Features: </span></h2>
<p />
<!--   -------------------------------------------- -->
<h1><a name="Anticipated_downtime"></a> Anticipated downtime </h1>
 It is expected that this release will require the Gratia services and reporting to be unavailable beginning at:  <ul>
<li> Start: 2008/07/15 hh:mm CST 
</li> <li> Available: 2008/07/15 hh:mm CST 
</li></ul> 
<p />
The changes affecting downtime for this release are: <ol>
<li> Installation and validation on the 10 Gratia schemas 
</li></ol> 
<p />
<!--   -------------------------------------------- -->
<h1><a name="Collectors_and_Databases_Affecte"></a> Collectors and Databases Affected </h1>
<p />
The following Gratia collectors and databases will be converted with this release: 
 
<p />
<a name="edittable1"></a>
<div class="editTable">
<form name="edittable1" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV0dot36#edittable1" method="post">
<input type="hidden" name="ettablenr" value="1" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot36?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot36?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">MySql port</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot36?cover=print;sortcol=2;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector URL</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot36?cover=print;sortcol=3;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector host</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia-fermi.fnal.gov:8881 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3 twikiLastCol"> gratia08.fnal.gov </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_osg </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> gratia-fermi.fnal.gov:8880 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLastCol"> gratia08.fnal.gov </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia.opensciencegrid.org:8880 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3 twikiLastCol"> gratia09.fnal.gov </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> gratia.opensciencegrid.org:8881 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLastCol"> gratia09.fnal.gov </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_integration </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia.opensciencegrid.org:8885 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3 twikiLastCol"> gratia09.fnal.gov </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_qcd </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> gratia-fermi.fnal.gov:8883 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLastCol"> gratia08.fnal.gov </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_psacct </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia08.fnal.gov:8882 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3 twikiLastCol"> gratia08.fnal.gov </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia_osg_daily </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> gratia.opensciencegrid.org:8884 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLastCol twikiLast"> gratia09.fnal.gov </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="9" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<br />     The following Gratia collectors and databases will <strong><em>NOT</em></strong> be converted with this release. These repositories contained specialized reports that have not as yet been upgraded to the new Birt V2.2 software. <strong><em>However</em></strong>, they will be taken out-of-service while the other databases are being updated.<br />    
<p />
 
<p />
<a name="edittable2"></a>
<div class="editTable">
<form name="edittable2" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV0dot36#edittable2" method="post">
<input type="hidden" name="ettablenr" value="2" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot36?cover=print;sortcol=0;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1 twikiLast"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot36?cover=print;sortcol=1;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">MySql port</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2 twikiLast"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot36?cover=print;sortcol=2;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector URL</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3 twikiLastCol twikiLast"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot36?cover=print;sortcol=3;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector host</font></a> </th>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="1" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<!-- BUILD DISTRIBUTION -------------------- -->
<h1><a name="Build_the_v0_36_for_distribution"></a> Build the v0.36 for distribution </h1> <ol>
<li> Make sure your build area contains all <em>committed</em> changes.  <ul>
<li> cvs update 
</li></ul> 
</li> <li> In <em>gratia/build-scripts/Makefile</em> , change the <em>version_default</em> to:  <ul>
<li> version_default = v0.37 
</li> <li> commit the change 
</li></ul> 
</li> <li> Tag the release (for all committed changes):  <ul>
<li> cvs rtag -R v0-36 gratia 
</li></ul> 
</li> <li> <em>Into a <strong>new</strong> area</em>, export the tagged release:  <ul>
<li> cvs export -d gratia-v0.36 -r v0-36 gratia 
</li></ul> 
</li> <li> Build it for the release (this insures that tar files are produced for VDT):  <ul>
<li> cd gratia-v0.36/build-scripts 
</li> <li> source setup-jdk15.sh 
</li> <li> make release 
</li></ul> 
</li> <li> Copy the built tar files to the release area:  <ul>
<li> scp ../target/*_v0.36.tar flxi07.fnal.gov:/afs/fnal.gov/files/expwww/gratia/html/Files/ 
</li></ul> 
</li> <li> Update the version number on the <a href="/bin/view/Accounting/InstallationGuideVDT" class="twikiLink">services release TWiki page</a>:  <ul>
<li> Edit and update the TWiki variable <em>ReleaseVersion</em>. You willl likely have to use the 'raw edit' mode to change the variable indicating the version number. 
</li></ul> 
</li></ol> 
<p />
<!-- ----------------- DATABASE BACKUP ------------- -->
<h1><a name="Database_backups_and_cron_init_d"></a> Database backups and cron/init.d services </h1>
 The upgrade should not being until all database backups have been completed.
<p />
If it is expected that the upgrade will take a long time, then <ol>
<li> on the tomcat/collector nodes (gratia08/gratia09)  <ul>
<li> the static report crons should be commented 
</li> <li> disable the <em>init.d</em> services 
</li></ul> 
</li> <li> on the database node (gratia06)  <ul>
<li> the backup crons should be commented out. 
</li> <li> daily reports cron should be commented out 
</li> <li> the Gratia-APEL interface crons should be commented out 
</li></ul> 
</li></ol> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_tomcat_collector_nodes_gr"></a> On the tomcat/collector nodes (gratia08/gratia09) </span></h2> <ol>
<li> <strong><em>comment</em></strong> out the <strong><em>root</em></strong> user cron entry for the static reports. Example:  <pre>42 0 * * * '/data/tomcat-fermi_itb/gratia/staticReports.py' '/data/tomcat-fermi_itb' 'http://gratia-fermi.fnal.gov:8881/gratia-reporting/'  </pre> 
</li> <li> Disable <em>init.d</em> services as <strong><em>root</em></strong> user:  <ul>
<li> chkconfig tomcat-[GRATIA_INSTANCE] off 
</li></ul> 
</li></ol> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_MySql_server_node_gratia0"></a> On the MySql server node ( <strong><em>gratia06</em></strong> ) </span></h2> <ol>
<li> <strong><em>comment</em></strong> out the cron entries for: <p> <strong><em>gratia</em></strong> user cron jobs. </p> <pre>0 0 1-15 * * dir=/home/gratia/interfaces/apel-lcg; cd $dir; ./lcg.sh --config=lcg.conf --date=previous --update  30 01 * * * dir=/home/gratia/interfaces/apel-lcg; cd $dir; ./lcg.sh --config=lcg.conf --date=current --update  </pre> 
</li> <li> <strong><em>root</em></strong> user cron entry.  <pre>43 2 * * * WILL SUPPLY NAME TUESDAY  </pre>
</li></ol> 
<p />
<!-- ----------------- UPGRADE AND IMPLEMENTATION ------------- -->
<h1><a name="Upgrade_and_implementation"></a> Upgrade and implementation </h1>
 The <strong><em>upgrades should be single-threaded</em></strong> , that is, performed for each database schema one at a time.
<p />
We will perform these upgrades based on the size of the individual database schema, in ascending order.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_tomcat_collector_nodes"></a> On the tomcat/collector nodes </span></h2>
 To install the new software on a Gratia tomcat instance, run the following script:  <ul>
<li> /home/weigand/cdcvs/gratia-upgrade.sh 
</li></ul> 
<p />
This script will perform the following: <ul>
<li> Shuts down the tomcat instance 
</li> <li> runs the update-gratia-local script to update the sofware 
</li> <li> backs up the tomcat/gratia logs and places in the /data directory as tarballs 
</li> <li> deletes all logs from the /data/tomcat-[GRATIA_INSTANCE]/logs directory so you have a fresh view when the re-start the service 
</li> <li> optionally allows you to start the Gratia/tomcat instance. 
</li></ul> 
<p />
When you have restarted the service, go to the /data/tomcat-[GRATIA_INSTANCE]/logs directory and tail the logs looking for any bizarre errors. Definition of bizarre will be supplied later.
<p />
Run the static reports cron as <em>root</em> and verify these reports are generated. At the end of the gratia-update.sh execution, the root cron for the static reports for that instance will be displayed. Run them as root. Then in the UI, view the reports to verify they look correct.
<p />
<!-- ----------------- POST MORTEM  ------------- -->
<h1><a name="Post_mortem"></a> Post-mortem </h1>
 At this time, this will appear to be random notes. After the conversion, they may be organized.
<p /> <dl>
<dt> 2008/07/15 </dt><dd> upgrades performed on all collectors except production gratia and tomcat-conversion with &lt;5min per collector downtime (except ps-accounting, at 15min). The production gratia collector shall be upgraded after the upgrade from 0.34 is complete, possibly by early next week. A downtime will be announced to GOC 24h before the upgrade shall proceed. 
</dd></dl> 
<p />
<p />
<p />
<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Major_updates"></a>  Major updates </span></h2>
 <!--Future editors should add their signatures beneath yours!--></div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Accounting<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GratiaReleaseV0dot36</span> <br />    
Topic revision: r15 - 11 Dec 2008 - 18:51:44 - <a href="/bin/view/Main/KyleGross" class="twikiLink">KyleGross</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />