<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GratiaVdtInstallingServices &lt; Accounting &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Accounting/GratiaVdtInstallingServices?_T=16 Feb 2017" type="application/x-wiki" title="edit GratiaVdtInstallingServices" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Accounting/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Accounting/GratiaVdtInstallingServices"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <!-- <ul>
<li> Set VIEWTHISTOPIC = <div class="twikiSmall"><a href="GratiaVdtInstallingServices">View this section</a></div>
</li></ul> 
-->
<p />
<p />
<h1><a name="Gratia_Vdt_Installing_Services"></a>  <strong>Gratia Vdt Installing Services</strong> </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Installing_Gratia_services_from"> Installing Gratia services from VDT</a> <ul>
<li> <a href="?cover=print#Installation_user"> Installation user</a>
</li> <li> <a href="?cover=print#Installation_package"> Installation package</a>
</li> <li> <a href="?cover=print#Installing_CA_certificates_for_a"> Installing CA certificates for administrative login</a> <ul>
<li> <a href="?cover=print#Host_http_Certificates"> Host/http Certificates</a>
</li> <li> <a href="?cover=print#VDT_CA_Certificates_package"> VDT CA Certificates package</a>
</li></ul> 
</li> <li> <a href="?cover=print#Installation_location"> Installation location</a>
</li> <li> <a href="?cover=print#Reusing_Configuration_Informatio"> Reusing Configuration Information</a>
</li> <li> <a href="?cover=print#Installation_Cache"> Installation Cache</a>
</li> <li> <a href="?cover=print#Installation_output_questions"> Installation output/questions</a>
</li> <li> <a href="?cover=print#Verify_the_installation_complete"> Verify the  installation completed successfully</a>
</li> <li> <a href="?cover=print#Starting_Gratia"> Starting Gratia</a>
</li> <li> <a href="?cover=print#Verifying_your_Gratia_reporting"> Verifying your Gratia reporting and administration web services</a>
</li> <li> <a href="?cover=print#Shutting_down_Gratia"> Shutting down Gratia</a>
</li></ul> 
</li> <li> <a href="?cover=print#Gratia_Configuration_Guide"> Gratia Configuration Guide</a> <ul>
<li> <a href="?cover=print#Connections"> Connections</a>
</li> <li> <a href="?cover=print#Monitoring"> Monitoring</a>
</li> <li> <a href="?cover=print#Changing_your_Gratia_probes"> Changing your Gratia probes</a>
</li> <li> <a href="?cover=print#Setting_up_Gratia_replication"> Setting up Gratia replication</a>
</li></ul> 
</li></ul> 
</div>
<p />
<p />
<!--  <ul>
<li> Set OSG_DOC_REFERENCES = Integration/ITB090
</li> <li> Set GRATIA_CACHE  = <a href="http://vdt.cs.wisc.edu/vdt_1101_cache" target="_top">http://vdt.cs.wisc.edu/vdt_1101_cache</a>
</li> <li> Set GRATIA_PACKAGE = Gratia-Reporting
</li></ul> 
<p /> <ul>
<li> Set EDITTHISTEXT = <div class="twikiSmall"><a href="GratiaVdtInstallingServices">edit this section</a></div>
</li></ul> 
-->
<br />    
<h1><a name="Installing_Gratia_services_from"></a> Installing Gratia services from VDT </h1>
<p />
<br />    
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Installation_user"></a> Installation user </span></h2>
Must be done as root.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Installation_package"></a> Installation package </span></h2>
Pacman is the tool used for the installation.  If you are not familiar with it please refer to the <span class="twikiNewLink">OSG Pacman Install Guide<a href="/bin/edit/Integration/ITB090/PacmanInstall?topicparent=Accounting.GratiaVdtInstallingServices" rel="nofollow" title="OSG Pacman Install Guide (this topic does not yet exist; you can create it)">?</a></span>
<p />
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Installing_CA_certificates_for_a"></a> Installing CA certificates for administrative login </span></h2>
<div class="twikiSmall"><a href="GratiaCertificates">View this section</a></div>
<p />
If the host you are installing your collector on does <strong>not</strong> have a host/http certificate and the VDT CA Certificates package installed, you will have do so before you proceed.
<p />
<h3><a name="Host_http_Certificates"></a> Host/http Certificates </h3>
To obtain a host/http certificate, contact your UNIX administrator.
<p />
The host certificates should be installed in <strong>/etc/grid-security</strong> as:
<pre>
-rw-r--r-- 1 root root 1477 May 19 10:08 hostcert.pem
-rw------- 1 root root 1675 May 19 10:09 hostkey.pem
</pre>
<p />
The http certificate should be installed in <strong>/etc/grid-security</strong> as:
<pre>
drwxr-xr-x 2 root root 4096 May 19 09:34 http
--rw-r--r-- 1 root root 1485 May 19 09:34 httpcert.pem
--rw------- 1 root root 1675 May 19 09:34 httpkey.pem
</pre>
<p />
<p />
If you are running the collector as a <em>non-root</em> user like <em>daemon</em> , the ownership of the <em>http</em> directory and <em>.pem</em> files should be that user (e.g. <em>daemon</em> ).
<p />
<h3><a name="VDT_CA_Certificates_package"></a> VDT CA Certificates package </h3>
For additional information on the OSG CA certificates process, refer to the OSG Certificate Authority Distribution documentation found here: <ul>
<li> <a href="https://twiki.grid.iu.edu/bin/view/Documentation/CaDistribution" target="_top">https://twiki.grid.iu.edu/bin/view/Documentation/CaDistribution</a>
</li></ul> 
If you do not have <strong>pacman</strong> installed, you can install it in <strong>/usr/local</strong>: <ul>
<li> cd /usr/local
</li> <li> mkdir pacman
</li> <li> cd pacman 
</li> <li> wget <a href="http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-latest.tar.gz" target="_top">http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-latest.tar.gz</a>
</li> <li> tar zxf pacman-latest.tar.gz
</li></ul> 
<p />
To install the VDT CA Certificates package, you will need to go to the VDT site. <ul>
<li> For information on how VDT installations work with pacman, refer to <a href="http://vdt.cs.wisc.edu/download.html" target="_top">http://vdt.cs.wisc.edu/download.html</a>
</li> <li> The latest VDT packages can be found here: <a href="http://vdt.cs.wisc.edu/documentation.html" target="_top">http://vdt.cs.wisc.edu/documentation.html</a>
</li> <li> The CA Certificates package for the 1.10.1 release is: <a href="http://vdt.cs.wisc.edu/vdt_1101_cache/CA-Certificates.pacman" target="_top">http://vdt.cs.wisc.edu/vdt_1101_cache/CA-Certificates.pacman</a>
</li></ul> 
<p />
To install the CA-Certificates package: <ul>
<li> cd /usr/local/pacman/pacman-[VERSION}
</li> <li> source setup.sh
</li> <li> cd /usr/local
</li> <li> mkdir vdt-certificates-{VERSION]
</li> <li> cd vdt-certificates-{VERSION]
</li> <li> pacman -get <a href="http://vdt.cs.wisc.edu/vdt_1101_cache:CA-Certificates" target="_top">http://vdt.cs.wisc.edu/vdt_1101_cache:CA-Certificates</a>
</li></ul> 
<p />
Answer "y" to all the questions.
<p />
When asked where to install the certificates, it is your choice. Most common place is /etc/grid-security. If you choose another location, you will need to update the specified locations of the host and HTTP certificates and keys; and of the CA certificates and CRLs in the collector configuration (.dat) file.
<p />
In order obtain the OSG maintained list of CA's, you will have to edit the following configuration file: <ul>
<li> $VDT_LOCATION/vdt/etc/vdt-update-certs.conf
</li></ul> 
<p />
adding the following line to the file: <ul>
<li> cacerts_url = <a href="http://software.grid.iu.edu/pacman/cadist/ca-certs-version" target="_top">http://software.grid.iu.edu/pacman/cadist/ca-certs-version</a>
</li></ul> 
<p />
Then, install the certificates: <ul>
<li> cd /usr/local/vdt-certificates-{VERSION]
</li> <li> source setup.sh 
</li> <li> ./vdt/sbin/vdt-setup-ca-certificates --root (or --local depending on how you answered the question on the initial installation.
</li></ul> 
<p />
After all of the above has been done, you will need to turn on the VDT installed services (crons) necessary to maintain the certificates. <ul>
<li> cd /usr/local/vdt-certificates-{VERSION]
</li> <li> source setup.sh
</li> <li> vdt-control --on
</li></ul> 
<p />
<strong>Note:</strong> If you are upgrading your certificates, you should then re-cycle the collectors so they re-read the certificates. You may run into some problems if you don't.
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Installation_location"></a> Installation location </span></h2>
Wherever you like.  Shown below as  directory <code>/usr/local/gratia</code>.  Then set the VDT_LOCATION variable to that directory. <ul>
<li> cd /usr/local
</li> <li> mkdir gratia
</li> <li> export VDT_LOCATION=/usr/local/gratia
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Reusing_Configuration_Informatio"></a> Reusing Configuration Information </span></h2>
If you are doing a major update (from one VDT version to another, but not a minor update, such as VDT 1.10.1a to VDT 1.10.1b), you can automatically reuse some of the configuration information from the old version in your new installation.  Instructions for this can be found in the <span class="twikiNewLink">OSG documentation topic on Reusing Configuration Information<a href="/bin/edit/Integration/ITB090/ReusingConfigurationInformation?topicparent=Accounting.GratiaVdtInstallingServices" rel="nofollow" title="OSG documentation topic on Reusing Configuration Information (this topic does not yet exist; you can create it)">?</a></span>
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Installation_Cache"></a> Installation Cache </span></h2>
To install Gratia: <ul>
<li> cd $VDT_LOCATION
</li> <li> pacman -get  <a href="http://vdt.cs.wisc.edu/vdt_1101_cache:Gratia-Reporting" target="_top">http://vdt.cs.wisc.edu/vdt_1101_cache:Gratia-Reporting</a>
</li></ul> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Installation_output_questions"></a> Installation output/questions </span></h2>
Some of the questions related to 'trusted caches' and 'unrecognized platforms' may not appear depending on your host and any <code>pacman</code> variables already set in your environment.
<p />
<pre class="screen">
Do you want to add [http://software.grid.iu.edu/pacman/] to [trusted.caches]? (y or n): <b> y </b>

Do you want to add [http://vdt.cs.wisc.edu/vdt_1101_cache] to [trusted.caches]? (y or n): <b>y</b>

...


VDT 1.10.1 installs a variety of software, each with its own license.
In order to continue, you must agree to the licenses.
You can view the licenses online at:

     http://vdt.cs.wisc.edu/licenses/1.10.1

After the installation has completed, you will also be able to
view the licenses in the "licenses" directory.

Do you agree to the licenses? [y/n]  <b>y</b>
---------------------

...
Downloading [Gratia-Services-1.10.0.tar.gz] from [http://vdt.cs.wisc.edu/software/questions/1.10.0]...
Downloading [configure_gratia-1-295.tar.gz] from [http://vdt.cs.wisc.edu/software//configure_gratia/1]...
Downloading [gratia-services-0.32.1.tar.gz] from [http://vdt.cs.wisc.edu/software//gratia/gratia-services/0.32.1]...
Downloading [gratia-reporting-0.32.1.tar.gz] from [http://vdt.cs.wisc.edu/software//gratia/gratia-reporting/0.32.1]...
</pre>
<p />
The above line should be the last line of output you see.  
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Verify_the_installation_complete"></a> Verify the  installation completed successfully </span></h2>
To verify  the VOMS installation was successful, there should be a setup.(c)sh in the VDT_LOCATION.  Source it. <ul>
<li> cd $VDT_LOCATION
</li> <li> source setup.sh
</li></ul> 
<p />
This does not necessarily indicate that everything was installed and configured successfully.  It just verifies that the <code>pacman</code> installation of Gratia completed successfully.  There is a lot of other "magic" that occurs during the process that should be validated. We'll take you through that process.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Starting_Gratia"></a> Starting Gratia </span></h2>
To start up Gratia services and reporting:
<pre class="screen">
# cd $VDT_LOCATION
# source setup.sh
# vdt-control --on
enabling cron service fetch-crl... ok
enabling cron service vdt-rotate-logs... ok
enabling cron service vdt-update-certs... ok
enabling init service mysql5... ok
skipping init service 'mysql' -- marked as disabled
enabling init service apache... ok
enabling init service tomcat-55... ok
enabling cron service gratia-reports... ok
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Verifying_your_Gratia_reporting"></a> Verifying your Gratia reporting and administration web services </span></h2>
To verify your installation of the Gratia web services was good, you can access the following urls and see if they render.  Remember that, at this time, you will have no accounting data to view so keep you expectations low.  You just want to verify the installation.  Start up the Gratia services as described in the <code>Starting Gratia</code> section above.
<p />
For open access: <ul>
<li> <a href="http://&lt;YOUR_HOST&gt;:8880/gratia-administration" target="_top">http://&lt;YOUR_HOST&gt;:8880/gratia-administration</a>
</li> <li> <a href="http://&lt;YOUR_HOST&gt;:8880/gratia-reporting" target="_top">http://&lt;YOUR_HOST&gt;:8880/gratia-reporting</a>
</li></ul> 
<p />
For secure (ssl) access: <ul>
<li> <a href="https://&lt;YOUR_HOST&gt;:8443/gratia-administration" target="_top">https://&lt;YOUR_HOST&gt;:8443/gratia-administration</a>
</li> <li> <a href="https://&lt;YOUR_HOST&gt;:8443/gratia-reporting" target="_top">https://&lt;YOUR_HOST&gt;:8443/gratia-reporting</a>
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Shutting_down_Gratia"></a> Shutting down Gratia </span></h2>
To shut down Gratia services and reporting:
<pre class="screen">
# cd $VDT_LOCATION
# source setup.sh
# vdt-control --off
disabling cron service gratia-reports... ok
disabling init service tomcat-55... ok
disabling init service apache... ok
disabling init service mysql... ok
disabling init service mysql5... ok
disabling cron service vdt-update-certs... ok
disabling cron service vdt-rotate-logs... ok
disabling cron service fetch-crl... ok
</pre>
<p />
<p />
<p />
<br />    
<h1><a name="Gratia_Configuration_Guide"></a> <em>Gratia Configuration Guide</em> </h1>
<div class="twikiSmall"><a href="GratiaConfigurationGuide">edit this section</a></div>
<br />    
There are several attributes you may wish to configure before accepting accounting data from the Gratia probes.  This are in the
The <code>$VDT_LOCATION/tomcat/v55/gratia/service-configuration.properties</code> file.  This topic will not cover all of them as the file contains a reasonable explanation of each attribute.  It will just cover a couple you may want to look at initially. <ul>
<li> Connections
</li> <li> Monitoring
</li></ul> 
<p />
Additionally, if you are installing remote installation for the purpose of capturing your local accounting data and then forwarding selected accounting data to the OSG or ITB instances of Gratia, you will be need to do 2 additional steps: <ul>
<li> Change your Gratia probes to report to your instance of a remote/local  Gratia collector
</li> <li> Set up Gratia replication to forward selective probes to the OSG or ITB Gratia collectors.
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Connections"></a> Connections </span></h2>
You have two ports by which you can access the Gratia reporting and administration services that are     defined by these attributes in the file: <ul>
<li> service.open.connection (defaults to 8880);
</li> <li> service.secure.connection (defaults to 8443).
</li></ul> 
<p />
These are pre-set during installation by the <code>$VDT_location/vdt/setup/configure_gratia</code> script.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Monitoring"></a> Monitoring </span></h2>
The attributes control whether or not to have Gratia post an email if it hasn't received
a job usage record from a probe within a specified amount of time.
<p />
These attributes are not set in the <code>configure_gratia</code> script and should be changed.  They are: <ul>
<li> monitor.smtp.server=YOUR-SMTP-SERVER
</li> <li> monitor.smtp.authentication.required=false
</li> <li> monitor.smtp.user=EMAIL-USER-NAME
</li> <li> monitor.smtp.password=EMAIL-PASSWORD
</li> <li> monitor.from.address=FROM-EMAIL-ADDRESS
</li> <li> monitor.to.address.0=TO-EMAIL-ADDRESS
</li> <li> monitor.subject=EMAIL-SUBJECT
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Changing_your_Gratia_probes"></a> Changing your Gratia probes </span></h2>
To start reporting the accounting data to your local/remote Gratia collector, you will need to change the configuration file for your Gratia probes.  All references to VDT_LOCATION in this section of the document refer to the installation on your CE node or worker node if you have glexec probes configured.
<p />
<strong>VERY VERY IMPORTANT: Before you do this, you need to insure that all accounting data for each probe as been reported to the current collector.</strong>  
<p />
On each host that you will be changing to report to your local Gratia collector, you will do the following to insure that all data has been transferred:
<p />
1. Verify that there are no probe records in the gratia queue (this would only occur if the current collector has been unavailable).
       There should be no files in <code>$VDT_LOCATION/gratia/var/tmp/gratiafiles</code> . If there are files here, you will want to wait until these have been process by your Gratia probe cron service entry.  When there are no files in the queue, you can proceed.
<p />
2. Comment or remove the Gratia probe cron process for your scheduler, named gratia-&lt;scheduler&gt;.<br />    
       For example, the command to disable a condor probe is <code>vdt-control --off gratia-condor</code>
<p />
3. You can now make the changes to <code>ProbeConfig</code> file necessary to report to your local/remote collector.
The configuration file for the various probes are shown here:
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <font color="#0000ff"><b>Probe</b></font> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <font color="#0000ff"><b>$VDT_LOCATION/gratia/probe</b></font> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Condor </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> ./condor/ProbeConfig </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> PBS </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> ./pbs/ProbeConfig </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> LSF </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> ./lsf/ProbeConfig </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> SGE </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> ./sge/ProbeConfig </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> gLexec </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> ./glexec/ProbeConfig </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> metric </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> ./metric/ProbeConfig </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<font color="#ff0000"><strong>Note</strong></font> that the metric probe reports to the official OSG RSV collector at GOC, Indiana. It's highly unlikely that you would want to collect this information locally since there are no graphical reports for this data type.
<p />
There are 3 attributes that need to be changed to report to your local/remote collector based on the attributes specified in the <code>service-configuration.properties</code> file:
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <font color="#0000ff"><b>ProbeConfig<br />     attribute</b></font> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <font color="#0000ff"><b>service-configuration.properties<br />     attribute</b></font> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> SSLHost </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> service.secure.connection </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> SSLRegistrationHost </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> service.open.connection </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> CollectorHost </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> service.open.connection </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
4. Uncomment your Gratia probe cron service or run vdt-control --on for the relevant probe.
<p />
You will now be reporting to your local collector for each of these hosts. You can verify this by going the Gratia administration web service for the collector.  You may have to wait for the cron job, which runs every ten minutes.
<p />
If you will be forwarding this accounting data to the OSG or ITB Fermilab Gratia Collectors, you will need to set up replication as described in the next section.
<p />
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Setting_up_Gratia_replication"></a> Setting up Gratia replication </span></h2>
Gratia has the ability to replicate its database contents (actually, the JobUsageRecords) to another instance of Gratia running &#8220;out there somewhere&#8221;. This replication service can be found on the gratia-administration web service menu. 
<p />
Assuming your database is the source, and the OSG/ITB Gratia collectors at Fermilab are the target(s):
<p />
1. Under the <code>Replication</code> menu, select <code>Job Usage Replication</code> or <code>Metric Replication</code> depending on the accounting data you wish to forward.
<p />
2. On the <code>Replication</code> screen, under <code>Remote Host</code>, you will add an entry and then click on the <code>Update</code> button.
<p />
If you are forwarding to the central Gratia OSG services, these are the URLs for the respective collectors:
on    
<p />
You can select specific probes below to ensure that information is forwarded to the right place.
<p />
3.Then, for your entry, select <code>Test</code> under the <code>Options</code> column on the far right.
<p />
Your server will send a dummy transaction to the remote host and let you know whether or not the connection was made.
<p />
It should indicate either success or failure.  A failure means either your entry was incorrect or the <code>Remote Host</code> is not available (an error message including the number "503" indicates the latter and is fine: try again later). If a non-transient problem is indicated and you are sure the URL is correct., try to access the remote via your web browser and contact the Gratia administrator of the remote host if you are unable to resolve the problem locally.
<p />
4. Now you will select the probes that you want to forward. 
<p />
Under the <code>Probe Name</code> column, you can specify selective probes, probes for specific VOs or All.  Press the <code>Update</code> button to add the entry to the database.
<p />
<b>NOTE:</b> If do not specify <code>All</code>, you will need to create a replication entry for each probe or VO you desire to forward.  This means repeating steps 2 through 5.
<p />
5. Finally, start the replication process by using the <code>Start</code> button under the <code>Options</code> column. Replication should start within a minute or so. You can stop the process with the <code>Stop</code> link (which will also take a minute or so).
<p />
Please also consider replicating ProbeDetails records (same procedure as above but select the ProbeDetails replication page): this enables the OSG collectors to receive probe version information and also to distinguish between a probe that is not reporting and a probe that merely has nothing to report.
<p />
From our testing gratia can replicate roughly 2000 records per minute.
<p />
You can view the status of your Replication entries by viewing: <ul>
<li> <code>Running</code> column which indicates naturally if it is running or not
</li> <li> <code>DBID</code> column indicating the last <code>dbid</code> (key of the JobUsageRecord table) sent
</li> <li> <code>Row Count</code> column indicating the number of replication entries sent
</li></ul> 
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<p />
-- <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a> - 24 Apr 2008</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Accounting<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GratiaVdtInstallingServices</span> <br />    
Topic revision: r7 - 11 Dec 2008 - 18:51:44 - <a href="/bin/view/Main/KyleGross" class="twikiLink">KyleGross</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />