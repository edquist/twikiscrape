<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> InstallationGuideFNAL &lt; Accounting &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Accounting/InstallationGuideFNAL?_T=16 Feb 2017" type="application/x-wiki" title="edit InstallationGuideFNAL" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Accounting/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Accounting/InstallationGuideFNAL"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <!-- <ul>
<li> Set VIEWTHISTOPIC = <div class="twikiSmall"><a href="InstallationGuideFNAL">View this section</a></div>
</li></ul> 
--> 
<p />
<h1><a name="FNAL_specific_Gratia_collector_i"></a> FNAL-specific Gratia collector installation guide. </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#FNAL_specific_Gratia_collector_i"> FNAL-specific Gratia collector installation guide.</a> <ul>
<li> <a href="?cover=print#Install_and_configure_a_standard"> Install and configure a standard VDT CA certificates installation.</a>
</li> <li> <a href="?cover=print#Obtain_and_install_the_Java_Runt"> Obtain and install the Java Runtime.</a>
</li> <li> <a href="?cover=print#Obtain_and_install_the_MySql_cli"> Obtain and install the MySql client.</a>
</li> <li> <a href="?cover=print#Ensure_the_existence_of_a_suitab"> Ensure the existence of a suitable DB schema.</a>
</li> <li> <a href="?cover=print#Create_or_adjust_configuration_d"> Create or adjust configuration data file.</a>
</li> <li> <a href="?cover=print#Perform_the_install_upgrade"> Perform the install / upgrade.</a>
</li> <li> <a href="?cover=print#Set_up_backups_and_other_mainten"> Set up backups and other maintenance tasks</a>
</li> <li> <a href="?cover=print#Set_up_production_reporting"> Set up production reporting.</a>
</li></ul> 
</li></ul> 
</div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Install_and_configure_a_standard"></a> Install and configure a standard VDT CA certificates installation. </span></h2>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Obtain_and_install_the_Java_Runt"></a> Obtain and install the Java Runtime. </span></h2>
<p />
Install the appropriate <code>java-sun-compat</code> from the FSL distribution's yum repository.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Obtain_and_install_the_MySql_cli"></a> Obtain and install the MySql client. </span></h2>
<p />
If not already available on the node, install the MySql client from the FSL distribution's yum repository.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Ensure_the_existence_of_a_suitab"></a> Ensure the existence of a suitable DB schema. </span></h2>
<p />
Create a new empty DB if necessary with appropriate access permissions for gratia (all) and reader (SELECT and EXECUTE).
<p />
These are the MySql commands (as MySql root user) using <em>gratia_mydb</em> with tomcat on <em>gratia-vm02.fnal.gov</em> as the example:
<pre>
CREATE DATABASE &#91;MY&#95;DATABASE]; 
GRANT ALL PRIVILEGES ON &#91;MY&#95;DATABASE].&#42; TO &#39;gratia&#39;&#64;&#39;&#37;.fnal.gov&#39; IDENTIFIED BY &#39;update&#95;password&#39;; 
GRANT SELECT,EXECUTE ON &#91;MY&#95;DATABASE].&#42; TO &#39;reader&#39;&#64;&#39;&#37;&#39; IDENTIFIED BY &#39;reader&#95;password&#39;; 
</pre>
<p />
Additionally. you may need to add this entry is it does not exist in the <em>mysql.db</em> database:
<pre>
GRANT SELECT ON information&#95;schema.&#42; TO &#39;gratia&#39;&#64;&#39;&#37;.fnal.gov&#39; IDENTIFIED BY &#39;update&#95;password&#39;; 
</pre>
<p />
You will also need to allow root access from the collector node (this is for the post-install.sh script executed by the collector):
<pre>
GRANT ALL PRIVILEGES ON &#42;&#60;nop&#62;&#42;&#42;.&#42; TO &#39;root&#39;&#64;&#39;&#91;COLLECTOR&#95;NODE]&#39; IDENTIFIED BY &#39;root&#95;password&#39;;
GRANT GRANT OPTION ON &#42;&#60;nop&#62;&#42;&#42;.&#42; TO &#39;root&#39;&#64;&#39;&#91;COLLECTOR&#95;NODE]&#39; IDENTIFIED BY &#39;root&#95;password&#39;;
FLUSH PRIVILEGES;
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Create_or_adjust_configuration_d"></a> Create or adjust configuration data file. </span></h2>
 The <tt>[PATH-TO-GRATIA-RELEASE]/common/configuration/configure-collector</tt> script configures necessary software and configuration files for the Gratia collectors at FNAL based on a data file. The current production data files are to be found in the CD CVS repository: <code>:ext:cvsuser@cdcvs.fnal.gov:/cvs/cd/fermigrid/gratia-ops/collector-config/</code>. Current contents (2010/08/02) are:
<p /> <ul>
<li> <code>collector-fermi-gratia10.dat</code>
</li> <li> <code>collector-fermi-gratia11.dat</code>
</li> <li> <code>collector-integration-gratia05.dat</code>
</li> <li> <code>collector-osg-gratia12.dat</code>
</li> <li> <code>collector-osg-gratia13.dat</code>
</li></ul> 
<p />
Edit the appropriate data file if it does not already contain the correct information for the collector you wish to install. Refer to <code>%default_attributes</code> and existing or commented attributes in <tt>[PATH-TO-GRATIA-RELEASE]/common/configuration/service-configuration.properties</tt> for possible attributes. Be especially careful not to use ports already in use.
<p />
The <code>.dat</code> file is 'eval'ed by perl and should constitute a properly constructed perl associative array ('hash'). 
<p />
Example configuration:
<pre>  
 &#34;fermi-osg&#34; &#61;&#62;
 {
  access&#95;log &#61;&#62; 1,
  collector&#95;host &#61;&#62; &#34;gratia-fermi-osg.fnal.gov&#34;,
  db&#95;host &#61;&#62; &#34;gr-fnal-mysql-collector.fnal.gov&#34;,
  db&#95;port &#61;&#62; 3306,
  db&#95;schema &#61;&#62; &#34;fermi&#95;osg&#34;,
  http&#95;port &#61;&#62; 80,
  install&#95;prefix &#61;&#62; &#34;/data&#34;,
  instance&#95;name &#61;&#62; &#34;gratia&#34;,
  jsvc &#61;&#62; &#34;/data/jsvc/bin/jsvc&#34;,
  max&#95;heap&#95;size &#61;&#62; &#34;1536m&#34;,
  max&#95;perm&#95;size &#61;&#62; &#34;256m&#34;,
  remote&#95;host &#61;&#62; &#34;gr10x0.fnal.gov&#34;,
  rmi&#95;port &#61;&#62; 17000,
  server&#95;port &#61;&#62; 8104,
  ssl&#95;port &#61;&#62; 443,
  tomcat&#95;group &#61;&#62; &#34;daemon&#34;,
  tomcat&#95;user &#61;&#62; &#34;daemon&#34;,
  want&#95;reporting &#61;&#62; &#34;redirect&#34;,
  &#34;properties.attributes&#34; &#61;&#62;
  {
   &#34;maintain.history.log&#34; &#61;&#62; 75,
   &#34;monitor.from.address&#34; &#61;&#62; &#39;gratia-operation&#64;opensciencegrid.org&#39;,
   &#34;monitor.recordProcessor.wait&#34; &#61;&#62; 60,
   &#34;monitor.to.address.0&#34; &#61;&#62; &#39;gratia-root&#64;fnal.gov&#39;,
   &#34;service.admin.DN.0&#34; &#61;&#62; &#39;/DC&#61;org/DC&#61;doegrids/OU&#61;Services/CN&#61;gr10x5.fnal.gov&#39;,
   &#34;service.admin.DN.1&#34; &#61;&#62; &#39;/DC&#61;org/DC&#61;doegrids/OU&#61;Services/CN&#61;gr11x5.fnal.gov&#39;,
   &#34;service.admin.DN.2&#34; &#61;&#62; &#39;/DC&#61;org/DC&#61;doegrids/OU&#61;Services/CN&#61;gr10x0.fnal.gov&#39;,
   &#34;service.admin.FQAN.0&#34; &#61;&#62; &#34;/fermilab/Role&#61;GratiaAdmin&#34;,
   &#34;service.lifetime.JobUsageRecord&#34; &#61;&#62; &#34;3 months&#34;,
   &#34;service.lifetime.MetricRecord&#34; &#61;&#62; &#34;1 month&#34;,
   &#34;service.lifetime.ComputeElement&#34; &#61;&#62; &#34;3 months&#34;,
   &#34;service.lifetime.StorageElement&#34; &#61;&#62; &#34;3 months&#34;,
   &#34;service.lifetime.ComputeElementRecord&#34; &#61;&#62; &#34;3 months&#34;,
   &#34;service.lifetime.StorageElementRecord&#34; &#61;&#62; &#34;3 months&#34;,
   &#34;service.lifetime.Subcluster&#34; &#61;&#62; &#34;3 months&#34;,
   &#34;service.lifetimeManagement.checkInterval&#34; &#61;&#62; &#34;24 hours&#34;,
   &#34;service.security.level&#34; &#61;&#62; 3,
  }
 },
</pre>
<p />
Once the above steps have been carried out, the rest of the procedure is identical to upgrading an already-installed collector.
<p />
Note that any attribute to be found by name in <code>service-configuration.properties</code> should be in the <tt>"properties.attributes"</tt> section of the configuration file.
<p />
Also note: this will alter the configuration for <strong>future</strong> installs (provided the area <code>~gratia/gratia-ops</code> is updated). For current installs it is easier by far to edit <code>/data/tomcat-gratia/gratia/service-configuration.properties</code> manually and restart the service.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Perform_the_install_upgrade"></a> Perform the install / upgrade. </span></h2>
<p />
There are several short-cut scripts in <code>:ext:cvsuser@cdcvs.fnal.gov:/cvs/cd/fermigrid/gratia-ops/</code>:
<p /> <ul>
<li> <code>upgrade-fermi-collectors</code>
</li> <li> <code>upgrade-fermi-reporting</code>
</li> <li> <code>upgrade-osg-collectors</code>
</li> <li> <code>upgrade-osg-reporting</code>
</li></ul> 
<p />
They all make use of the <tt>install-group</tt> (<code>https://gratia.svn.sourceforge.net/svnroot/gratia/trunk/build-scripts/install-group</code>) script infrastructure for installing multiple similar releases in the same operation, which in turn uses <a href="/bin/view/Accounting/GratiaInstallReleaseScript" class="twikiLink"><tt>install-release</tt></a> (<code>https://gratia.svn.sourceforge.net/svnroot/gratia/trunk/build-scripts/install-release</code>).
<p />
For an in-depth example of all the steps required to perform a production upgrade, including taking account of such things as heartbeat and minimizing service downtime, see the <a href="/bin/view/Accounting/GratiaReleaseV1dot06" class="twikiLink">release 1.06 notes</a>.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Set_up_backups_and_other_mainten"></a> Set up backups and other maintenance tasks </span></h2>
<p /> <ul>
<li> See the <a href="/bin/view/Accounting/GratiaServiceOperationGuide#Information_on_backups" class="twikiAnchorLink">backups</a> section of the <a href="/bin/view/Accounting/GratiaServiceOperationGuide" class="twikiLink">service operation guide</a> for details on backups of various types. Note DB schema backups should generally only be done on the reporting DB.
</li> <li> On each DB VM, set up <a href="/bin/view/Accounting/GratiaServiceOperationGuide#Schema_optimization" class="twikiAnchorLink">schema optimization</a> in root's crontab (collector and reporting DB).
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Set_up_production_reporting"></a> Set up production reporting. </span></h2>
<p /> <ul>
<li> As the Gratia user on the reporting DB, install the reporting <code>crontab</code>, currently saved as <code>~gratia/cron.gr13x5</code>:<pre>crontab ~gratia/cron.gr13x5</pre>
</li></ul> 
<p />
-- <a href="/bin/view/Main/ChrisGreen" class="twikiLink">ChrisGreen</a> - 02 Aug 2010</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Accounting<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>InstallationGuideFNAL</span> <br />    
Topic revision: r31 - 16 Aug 2010 - 19:12:15 - <a href="/bin/view/Main/ChrisGreen" class="twikiLink">ChrisGreen</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />