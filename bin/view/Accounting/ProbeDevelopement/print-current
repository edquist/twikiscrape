<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> ProbeDevelopement &lt; Accounting &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Accounting/ProbeDevelopement?_T=16 Feb 2017" type="application/x-wiki" title="edit ProbeDevelopement" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Accounting/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Accounting/ProbeDevelopement"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TWISTYPLUGIN_TWISTY--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.css");
</style>
<script type='text/javascript' src='https://twiki.opensciencegrid.org/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js'></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiPref.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.compressed.js"></script>
<script type="text/javascript">
// <![CDATA[
var styleText = '<style type="text/css" media="all">.twikiMakeVisible{display:inline;}.twikiMakeVisibleInline{display:inline;}.twikiMakeVisibleBlock{display:block;}.twikiMakeHidden{display:none;}</style>';
document.write(styleText);
// ]]>
</script>

<!--TABLEPLUGIN_table1--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
.twikiTable td {padding:1px;}
.twikiTable th {padding:1px;}
.twikiTable#table1 {border-width:0px;}
.twikiTable#table1 th {background-color:#F3EDE7;}
.twikiTable#table1 th.twikiSortedCol {background-color:#F3EDE7;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td {background-color:#F3EDE7;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#F3EDE7;}
.twikiTable#table1 td {text-align:left;}
.twikiTable#table1 td {padding:1px;}
.twikiTable#table1 th {padding:1px;}
</style>
<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<!--TABLEPLUGIN_twikiAttachmentsTable--><style type="text/css" media="all">
.twikiTable#twikiAttachmentsTable td {border-style:solid none;}
.twikiTable#twikiAttachmentsTable th {border-style:solid none;}
.twikiTable#twikiAttachmentsTable td {vertical-align:middle;}
.twikiTable#twikiAttachmentsTable th {vertical-align:middle;}
.twikiTable#twikiAttachmentsTable td {vertical-align:top;}
.twikiTable#twikiAttachmentsTable th {background-color:#eceef2;}
.twikiTable#twikiAttachmentsTable th.twikiSortedCol {background-color:#e0e3e9;}
.twikiTable#twikiAttachmentsTable tr.twikiTableRowdataBg0 td {background-color:#ffffff;}
.twikiTable#twikiAttachmentsTable tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#f2f3f6;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol0 {text-align:center;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol1 {text-align:left;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol2 {text-align:left;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol3 {text-align:right;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol4 {text-align:left;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol5 {text-align:left;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol6 {text-align:left;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol7 {text-align:center;}
</style></head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <table width="100%">
<tr><td valign="top">
</td>
<td valign="top">
<h1><a name="Probe_Developement_Guide"></a> Probe Developement Guide </h1>
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Minimal_example"> Minimal example</a>
</li> <li> <a href="?cover=print#Gratia_Send"> Gratia.Send</a>
</li> <li> <a href="?cover=print#Gratia_Handshake"> Gratia.Handshake</a>
</li> <li> <a href="?cover=print#Data_type"> Data type </a>
</li> <li> <a href="?cover=print#Public_Interface"> Public Interface:</a> <ul>
<li> <a href="?cover=print#StartTime_self_value_description"> StartTime(self, value, description = "")</a>
</li> <li> <a href="?cover=print#EndTime_self_value_description"> EndTime(self, value, description = "")</a>
</li> <li> <a href="?cover=print#WallDuration_self_value_descript"> WallDuration(self, value, description = "")</a>
</li> <li> <a href="?cover=print#CpuDuration_self_value_cputype_d"> CpuDuration(self, value, cputype, description = ""):</a>
</li> <li> <a href="?cover=print#UserKeyInfo_self_value"> UserKeyInfo(self,value)</a>
</li> <li> <a href="?cover=print#Status_self_value_description"> Status(self,value, description = "")</a>
</li> <li> <a href="?cover=print#LocalUserId_self_value"> LocalUserId(self,value)</a>
</li> <li> <a href="?cover=print#LocalJobId_self_value"> LocalJobId (self,value)</a>
</li> <li> <a href="?cover=print#GlobalJobId_self_value"> GlobalJobId(self,value)</a>
</li> <li> <a href="?cover=print#ProcessId_self_value"> ProcessId(self,value)</a>
</li> <li> <a href="?cover=print#GlobalUsername_self_value"> GlobalUsername(self,value)</a>
</li> <li> <a href="?cover=print#JobName_self_value_description"> JobName(self, value, description = "")</a>
</li> <li> <a href="?cover=print#Charge_self_value_unit_formula_d"> Charge(self,value, unit = "", formula = "", description = "")</a>
</li> <li> <a href="?cover=print#TimeDuration_self_value_timetype"> TimeDuration(self, value, timetype, description = ""):</a>
</li> <li> <a href="?cover=print#TimeInstant_self_value_timetype"> TimeInstant(self, value, timetype, description = ""):</a>
</li> <li> <a href="?cover=print#MachineName_self_value_descripti"> MachineName(self, value, description = "") </a>
</li> <li> <a href="?cover=print#Host_self_value_primary_False_de"> Host(self, value, primary = False, description = "") </a>
</li> <li> <a href="?cover=print#SubmitHost_self_value_descriptio"> SubmitHost(self, value, description = "") </a>
</li> <li> <a href="?cover=print#Queue_self_value_description"> Queue(self, value, description = "") </a>
</li> <li> <a href="?cover=print#ProjectName_self_value_descripti"> ProjectName(self, value, description = "") </a>
</li> <li> <a href="?cover=print#Network_self_value_storageUnit_p"> Network(self, value, storageUnit = "", phaseUnit = "", metric = "total", description = "") :</a>
</li> <li> <a href="?cover=print#Disk_self_value_storageUnit_phas"> Disk(self, value, storageUnit = "", phaseUnit = "", type = "", metric = "total", description = "") :</a>
</li> <li> <a href="?cover=print#Memory_self_value_storageUnit_ph"> Memory(self, value, storageUnit = "", phaseUnit = "", type = "", metric = "total", description = "") :</a>
</li> <li> <a href="?cover=print#Swap_self_value_storageUnit_phas"> Swap(self, value, storageUnit = "", phaseUnit = "", type = "", metric = "total", description = "") :</a>
</li> <li> <a href="?cover=print#NodeCount_self_value_metric_tota"> NodeCount(self, value, metric = "total", description = "") :</a>
</li> <li> <a href="?cover=print#Processors_self_value_consumptio"> Processors(self, value, consumptionRate = 0, metric = "total", description = "") :</a>
</li> <li> <a href="?cover=print#ServiceLevel_self_value_type_des"> ServiceLevel(self, value, type, description = "")</a>
</li> <li> <a href="?cover=print#Resource_self_description_value"> Resource(self,description,value):</a>
</li> <li> <a href="?cover=print#AdditionalInfo_self_description"> AdditionalInfo(self,description,value) :</a>
</li></ul> 
</li> <li> <a href="?cover=print#Gratia_Specific_interface">Gratia Specific interface</a> <ul>
<li> <a href="?cover=print#ResourceType_self_value"> ResourceType(self,value)</a>
</li> <li> <a href="?cover=print#VOName_self_value"> VOName(self,value)</a>
</li> <li> <a href="?cover=print#ReportableVOName_self_value"> ReportableVOName(self,value)</a>
</li> <li> <a href="?cover=print#Njobs_self_value_description"> Njobs(self, value, description = "") </a>
</li> <li> <a href="?cover=print#ProbeName_self_value_description"> ProbeName(self, value, description = "") :</a>
</li> <li> <a href="?cover=print#SiteName_self_value_description"> SiteName(self, value, description = "") :</a>
</li></ul> 
</li> <li> <a href="?cover=print#Gratia_Meta_Data_interface">Gratia Meta Data interface</a> <ul>
<li> <a href="?cover=print#AddTransientInputFile_self_filen"> AddTransientInputFile(self, filename)</a>
</li></ul> 
</li></ul> 
</div>
</td>
<td valign="top" align="right" width="25%">
</td></tr></table>
<p />
<p />
<p />
We current provide a simple python library (Gratia.py) for the implementation of the Gratia Probe.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Minimal_example"></a> Minimal example </span></h2>
<p />
The following script is a minimal example, showing the steps need to upload a record:
<p />
<pre>#Load the library
import Gratia.py
# Initialize the Gratia library (read the Probe configuration file)
Gratia.Initialize()
# Create the record
# The parameter indicates the Resource Type (&#34;Batch&#34;, &#34;RawCPU&#34;, &#34;Storage&#34;,etc)
# See also the function ResourceType
r &#61; Gratia.UsageRecord(&#34;Batch&#34;)
r.LocalUserId(&#34;cmsuser000&#34;)
# Send it
r.Send()</pre>
<p />
See <a href="https://twiki.opensciencegrid.org/twiki/pub/Accounting/ProbeDevelopement/samplemeter.py.txt" target="_top">samplemeter.py.txt</a> for a complete example.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Gratia_Send"></a> Gratia.Send </span></h2>
<p />
Generate the XML file corresponding to the usage record and upload it to the server.
The return value is an empty string in case of success.  In case of failure, the error
message is returned.  Usually the error are non fatal in the sense that the xml file
will be cached and re-send the next time the probe is ran.
<p />
In the rare case where Gratia is <strong>both</strong> unable to store the file locally and unable to upload it to the
server the message will start with <code>Fatal Error:</code>, for example:
<p />
<code>Fatal Error: Record not send and not cached.&nbsp; Record will be lost.</code>
<p />
<code>Fatal Error: too many pending files</code>
<p />
is issued and the record will need to be recreated by the probe once either the
write error or the communication error has been resolved (see log file for
details on the error).    For example:<pre>        # Send to gratia, and see what it says.
        response &#61; Gratia.Send(usageRecord)
        baseMsg &#61; &#34;Record: &#37;s, &#37;s, njobs &#37;i&#34; &#37; (str(row&#91;&#39;datestamp&#39;]),
            row&#91;&#39;transaction&#39;], row&#91;&#39;njobs&#39;])
        if response &#61;&#61; &#34;Fatal Error: too many pending files&#34;:
            # The server is currently not accepting record and
            # Gratia.py was not able to store the record, we will
            # need to resend it.
            # For now take a long nap and then by &#39;break&#39; we
            # force a retry for this record.
            self.&#95;log.error(&#34;Error sending : too many pending files&#34;)
            longsleep &#61; 15&#42;60
            self.&#95;log.warn(&#34;sleeping for &#61; &#37;i seconds.&#34; &#37; longsleep)
            sleep&#95;check(longsleep, self.&#95;stopFileName)
        elif response.startswith(&#39;Fatal Error&#39;) or \
            response.startswith(&#39;Internal Error&#39;):
            self.&#95;log.critical(&#39;error sending &#39; + baseMsg + \
                &#39;\ngot response &#39; + response)
            sys.exit(2)
            self.&#95;log.debug(&#39;sent &#39; + baseMsg)
        # If we got a non-fatal error, slow down since the server
        # might be overloaded.
        if response&#91;:2] !&#61; &#39;OK&#39;:
            self.&#95;log.error(&#39;error sending &#39; + baseMsg + \
                            &#39;\ngot response &#39; + response)</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Gratia_Handshake"></a> Gratia.Handshake </span></h2>
<p />
The Probe and Collector exchange a handshake message when Gratia.Initialize is called.   
This allows to differentiate between a Probe with no data to report and a probe with a 
broken configuration. 
<p />
The Handshake can also be called explicitly:
<p />
   <span class="twikiNewLink">GratiaCore<a href="/bin/edit/Accounting/GratiaCore?topicparent=Accounting.ProbeDevelopement" rel="nofollow" title="GratiaCore (this topic does not yet exist; you can create it)">?</a></span>.Handshake() 
<p />
This is in particular recommended for Probe that are implemented as a daemon.
Those probes should call Gratia.Handshake() regularly (especially if there is no real data to upload).  The call to Handshake will also re-establish the connection
if it was previously broken or it has timed-out.  If 'True' is passed as a parameter ( Gratia.Handshake(True) ), the number of connection retries will be reset
(effectively forcing a connection attempt even if many previous attempt failed)
<p />
Probe should call: 
<pre>  GratiaCore.RegisterReporterLibrary(name,version)</pre>
to register the libraries the Probe itself is using.
<pre>  GratiaCore.RegisterReporter(name,version)</pre>
to register the version of the Probe itself
<pre>  GratiaCore.RegisterService(name,version)</pre>
to register the version of the service (Condor,
PBS,LSF,DCache,SunGrid Engine, etc.) being 'probed'
<p />
<pre>  GratiaCore.RegisterEstimatedServiceBacklog(number&#95;service&#95;records&#95;not&#95;yet&#95;sent)</pre>
to register an estimation of the amount of records the probe will have to go through and send to the Collector.
<p />
Those function must be called before the call to Gratia.Initialize.
<p />
<a name="DataType"></a>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Data_type"></a> Data type </span></h2>
<p />
When expecting a time instant (i.e. a date and time), the Gratia interface expects either a number of second since epoch or
a string formated using the format <a href="http://www.w3.org/TR/xmlschema-2/#dateTime" target="_top">xsd:dateTime</a>.
<p />
The function <span class="twikiNewLink">TimeToString<a href="/bin/edit/Gratia/TimeToString?topicparent=Accounting.ProbeDevelopement" rel="nofollow" title="TimeToString (this topic does not yet exist; you can create it)">?</a></span> takes a python struct_time object and convert it
to a string following the format <a href="http://www.w3.org/TR/xmlschema-2/#dateTime" target="_top">xsd:dateTime</a>.
<p />
When expecting a time duration, the Gratia interface expects a number in second and fraction of second or 
a string formated using the format <a href="http://www.w3.org/TR/xmlschema-2/#duration" target="_top">xsd:duration</a>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Public_Interface"></a> Public Interface: </span></h2>
In general the function correspond to the equivalent XML tag described in the <a href="http://www.psc.edu/~lfm/PSC/Grid/UR-WG/UR-Spec-gfd.58-ggf18.pdf" target="_top">OGF Usage Record XML Schema</a>.  Only 2 of <span class="twikiNewLink">StartTime<a href="/bin/edit/Accounting/StartTime?topicparent=Accounting.ProbeDevelopement" rel="nofollow" title="StartTime (this topic does not yet exist; you can create it)">?</a></span>, <span class="twikiNewLink">EndTime<a href="/bin/edit/Accounting/EndTime?topicparent=Accounting.ProbeDevelopement" rel="nofollow" title="EndTime (this topic does not yet exist; you can create it)">?</a></span> and <span class="twikiNewLink">WallDuration<a href="/bin/edit/Accounting/WallDuration?topicparent=Accounting.ProbeDevelopement" rel="nofollow" title="WallDuration (this topic does not yet exist; you can create it)">?</a></span> are required.
<h3><a name="StartTime_self_value_description"></a> StartTime(self, value, description = "") </h3>
Time instant at which the 'usage' started.  See <a href="/bin/view/Accounting/ProbeDevelopement#DataType" class="twikiCurrentTopicLink twikiAnchorLink">Data Type</a> for details on the syntax for 'value'.
The argument can be either a string (with the correct formating) or a struct_time python object
<h3><a name="EndTime_self_value_description"></a> EndTime(self, value, description = "") </h3>
Time instant at which the 'usage' ended.  See <a href="/bin/view/Accounting/ProbeDevelopement#DataType" class="twikiCurrentTopicLink twikiAnchorLink">Data Type</a> for details on the syntax for 'value'
The argument can be either a string (with the correct formating) or a struct_time python object
<h3><a name="WallDuration_self_value_descript"></a> WallDuration(self, value, description = "") </h3>
Wall clock time that elapsed while the job was running. 
<pre>r.WallDuration(3600&#42;25+63&#42;60+21.2)</pre>
See <a href="/bin/view/Accounting/ProbeDevelopement#DataType" class="twikiCurrentTopicLink twikiAnchorLink">Data Type</a> for details on the syntax for 'value'
<h3><a name="CpuDuration_self_value_cputype_d"></a> CpuDuration(self, value, cputype, description = ""): </h3>
Total amount of cpu time used by the job.   Cputype must be specified and be one of either 'user' or 'system'
<pre>        r.CpuDuration(&#34;PT23H12M1.75S&#34;,&#34;user&#34;)
        r.CpuDuration(&#34;PT12M1.75S&#34;,&#34;sys&#34;)</pre>
See <a href="/bin/view/Accounting/ProbeDevelopement#DataType" class="twikiCurrentTopicLink twikiAnchorLink">Data Type</a> for details on the syntax for 'value'
<h3><a name="UserKeyInfo_self_value"></a> UserKeyInfo(self,value) </h3>
Expect the complete DN.  The currently supported format look like:
<p />
<code>/DC=gov/DC=fnal/O=Fermilab/OU=Robots/CN=cdf/CN=Elliot D. Lipeles/USERID=lipeles</code>
<p />
<code>CN=john ainsworth, L=MC, OU=Manchester, O=eScience, C=UK</code>
<p />
<h3><a name="Status_self_value_description"></a> Status(self,value, description = "") </h3>
The value is represented as a string
<p />
This property will represent the completion status of the job. For example, this may
represent the exit status of an interactive running process or the exit status from the batch
queuing system&#8217;s accounting record. The semantic meaning of status is site dependent.
<p />
Numerical value are supported as well as the following 'words'
 * aborted &#8211; A policy or human intervention caused the job to cease execution.
 * completed &#8211; The execution completed.
 * failed &#8211; Execution halted without external intervention.
 * held &#8211; Execution is held at the time this usage record was generated.
 * queued &#8211; Execution was queued at the time this usage record was generated.
 * started &#8211; Execution started at the time this usage record was generated.
 * suspended &#8211; Execution was suspended at the time this usage record was generated.
<h3><a name="LocalUserId_self_value"></a> LocalUserId(self,value) </h3>
The local identity of the user associated with the resource consumption reported in this
Usage Record. This user is often referred to as the requesting user. For example, the
value may be the user&#8217;s login name corresponding to the user&#8217;s uid in the /etc/passwd file
on Unix systems.
<h3><a name="LocalJobId_self_value"></a> LocalJobId (self,value) </h3>
The local job identifier as assigned by the batch queue expressed as a string.
<h3><a name="GlobalJobId_self_value"></a> GlobalJobId(self,value) </h3>
The global job identifier as assigned by a metascheduler or federation scheduler.
<h3><a name="ProcessId_self_value"></a> ProcessId(self,value) </h3>
The (OS level) process id of the jobs (PID).
<h3><a name="GlobalUsername_self_value"></a> GlobalUsername(self,value) </h3>
The global identity of the user associated with the resource consumption reported in this
Usage Record.  For example, the value may be the distinguished name from the user&#8217;s
certificate.
<h3><a name="JobName_self_value_description"></a> JobName(self, value, description = "") </h3>
The job or application name. For example, this could be the name of the executable that
ran, or the name of the batch queuing system&#8217;s name for the job.
<h3><a name="Charge_self_value_unit_formula_d"></a> Charge(self,value, unit = "", formula = "", description = "") </h3>
This property represents the total charge of the job in the system&#8217;s allocation unit. For
example 100, 200, or 3000. The meaning of this charge will be site dependent. The value
for this property MAY include premiums or discounts assessed on the actual usage
represented within this record. Therefore, the reported charge might not be directly
reconstructable from the specific usage reported.
<p />
Note that &#8220;Charge&#8221; does not necessarily refer to a currency-based unit unless that is what
members of the grid virtual organization agree to as the definition. If charge denotes a
value in currency, standard currency codes should be used to indicate the currency unit
being reported.
<h3><a name="TimeDuration_self_value_timetype"></a> TimeDuration(self, value, timetype, description = ""): </h3>
Additional measure of time duration that is relevant to the reported usage.  timetype can be one of 'submit','connect','dedicated' (or other).
<p />
See <a href="/bin/view/Accounting/ProbeDevelopement#DataType" class="twikiCurrentTopicLink twikiAnchorLink">Data Type</a> for details on the syntax for 'value'
<h3><a name="TimeInstant_self_value_timetype"></a> TimeInstant(self, value, timetype, description = ""): </h3>
Additional identified discrete time that is relevant to the reported usage.
timetype can be one of 'submit','connect' (or other)
<p />
See <a href="/bin/view/Accounting/ProbeDevelopement#DataType" class="twikiCurrentTopicLink twikiAnchorLink">Data Type</a> for details on the syntax for 'value'
<h3><a name="MachineName_self_value_descripti"></a> MachineName(self, value, description = "") </h3>
Should be the fully qualified name of the CE/SE.
<h3><a name="Host_self_value_primary_False_de"></a> Host(self, value, primary = False, description = "") </h3>
Hostname where the job was actually run.
In the description you can/should add a description of the node itself.  For example:
<p />
    si2k=7363.23 'model='Intel(R) Xeon(TM) CPU 2.40GHz' ncpu=4
<p />
where si2k is optional and would contain the result of running the Spec Int 2000 test
on that node.
<p />
<h3><a name="SubmitHost_self_value_descriptio"></a> SubmitHost(self, value, description = "") </h3>
The system hostname from which the job was submitted.
<h3><a name="Queue_self_value_description"></a> Queue(self, value, description = "") </h3>
The name of the queue from which the job was executed or submitted.
<h3><a name="ProjectName_self_value_descripti"></a> ProjectName(self, value, description = "") </h3>
The project associated with the resource usage reported with this record. Some
accounting systems define this is the ACID. On some systems, the project is identified
with the effective GID under which the job consumed resources.
[This is currently stored but not used by Gratia.
<h3><a name="Network_self_value_storageUnit_p"></a> Network(self, value, storageUnit = "", phaseUnit = "", metric = "total", description = "") : </h3>
The amount of network resource used by the job.
<p />
Metric should be one of 'total','average','max','min'
value should be an integer. 
<span class="twikiNewLink">PhaseUnit<a href="/bin/edit/Accounting/PhaseUnit?topicparent=Accounting.ProbeDevelopement" rel="nofollow" title="PhaseUnit (this topic does not yet exist; you can create it)">?</a></span> should expressed as a duration; see <a href="/bin/view/Accounting/ProbeDevelopement#DataType" class="twikiCurrentTopicLink twikiAnchorLink">Data Type</a> for details on the syntax.
<h3><a name="Disk_self_value_storageUnit_phas"></a> Disk(self, value, storageUnit = "", phaseUnit = "", type = "", metric = "total", description = "") : </h3>
Disk storage used.
<p />
Metric should be one of 'total','average','max','min'.  Type can be one of scratch or temp.
<p />
phaseUnit should expressed as a duration; see <a href="/bin/view/Accounting/ProbeDevelopement#DataType" class="twikiCurrentTopicLink twikiAnchorLink">Data Type</a> for details on the syntax.
<h3><a name="Memory_self_value_storageUnit_ph"></a> Memory(self, value, storageUnit = "", phaseUnit = "", type = "", metric = "total", description = "") : </h3>
The amount of memory used by all concurrent processes in the job.
<p />
Metric should be one of 'total','average','max','min'.   Type can be one of shared, physical, dedicated.
<p />
phaseUnit should expressed as a duration; see <a href="/bin/view/Accounting/ProbeDevelopement#DataType" class="twikiCurrentTopicLink twikiAnchorLink">Data Type</a> for details on the syntax.
<h3><a name="Swap_self_value_storageUnit_phas"></a> Swap(self, value, storageUnit = "", phaseUnit = "", type = "", metric = "total", description = "") : </h3>
This property specifies the swap usage
<p />
Metric should be one of 'total','average','max','min'.  Type can be one of shared, physical, dedicated.
<p />
phaseUnit should expressed as a duration; see <a href="/bin/view/Accounting/ProbeDevelopement#DataType" class="twikiCurrentTopicLink twikiAnchorLink">Data Type</a> for details on the syntax.
<h3><a name="NodeCount_self_value_metric_tota"></a> NodeCount(self, value, metric = "total", description = "") : </h3>
Number of nodes used. A node definition may be dependent on the architecture, but
typically a node is a physical machine. For example a cluster of 16 physical machines
with each machine having one processor each is a 16 &#8220;node&#8221; machine, each with one
&#8220;processor&#8221;. A 16 processor SMP machine however, is 1 physical node (machine) with
16 processors.
<p />
Metric should be one of 'total','average','max','min' 
<h3><a name="Processors_self_value_consumptio"></a> Processors(self, value, consumptionRate = 0, metric = "total", description = "") : </h3>
The number of processors used or requested. A processor definition may be dependent on
the machine architecture. Typically processor is equivalent to the number of physical
CPUs used. For example, if a job uses two cluster &#8220;nodes&#8221;, each node having 16 CPUs
each, the total number of processors would be 32.
<p />
Metric should be one of 'total','average','max','min'
consumptionRate specifies te consumption rate for the report processor usage.  The cinsumption rate is a sclaing factor that indicates the average percentage of utilization. 
<h3><a name="ServiceLevel_self_value_type_des"></a> ServiceLevel(self, value, type, description = "") </h3>
This property identifies the quality of service associated with the resource consumption.
For example, service level may represent a priority associated with the usage.
<p />
<h3><a name="Resource_self_description_value"></a> Resource(self,description,value): </h3>
Send arbitrary information along for the job usage record.
"description" should uniquely identify the semantic.
<h3><a name="AdditionalInfo_self_description"></a> AdditionalInfo(self,description,value) : </h3>
Send arbitrary information along for the job usage record.
"description" should uniquely identify the semantic.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Gratia_Specific_interface"></a> Gratia Specific interface </span></h2>
The following are not officially part of the Usage Record format
<h3><a name="ResourceType_self_value"></a> ResourceType(self,value) </h3>
Indicate the type of resource this record has been generated on.
The supported values are: <ul>
<li> Batch (aka Condor, pbs, lsf, glexec)
</li> <li> Storage (aka Dcache)
</li> <li> RawCPU (aka process level sacct)
</li></ul> 
<p />
<h3><a name="VOName_self_value"></a> VOName(self,value) </h3>
<p />
<h3><a name="ReportableVOName_self_value"></a> ReportableVOName(self,value) </h3>
'Reportable VO NAme (as defined by VOMS).
<p />
<h3><a name="Njobs_self_value_description"></a> Njobs(self, value, description = "") </h3>
Number of jobs convered by this usage record.
<p />
<p />
<h3><a name="ProbeName_self_value_description"></a> ProbeName(self, value, description = "") : </h3>
Unique name of the Probe (usually entered via the <a href="/bin/view/Accounting/ProbeConfig" class="twikiLink">ProbeConfig</a> file).
<h3><a name="SiteName_self_value_description"></a> SiteName(self, value, description = "") : </h3>
Indicates which site the service accounted for belong to (usually entered via the <a href="/bin/view/Accounting/ProbeConfig" class="twikiLink">ProbeConfig</a> file).
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Gratia_Meta_Data_interface"></a> Gratia Meta Data interface </span></h2>
The following are additional information about the probe or related work delegated to the probe.
<h3><a name="AddTransientInputFile_self_filen"></a> AddTransientInputFile(self, filename) </h3>
The given file will be deleted as soon as (but only if) a proper XML record is either send to the Collector or safety stored in the 'xml-file-to-be-sent' directory.  
If the record is suppressed (because it is missing a DN or because the probe is configured to reject local jobs), the input file will be copied in a quarantine
folder under the <span class="twikiNewLink">DataFolder<a href="/bin/edit/Accounting/DataFolder?topicparent=Accounting.ProbeDevelopement" rel="nofollow" title="DataFolder (this topic does not yet exist; you can create it)">?</a></span>.   This will be cleanup after a configurable amount time (default 31 days) and can be recovered until then if the Probe was
inadvertently configured to reject local jobs.
<p />
<p />
<p />
<p />
-- <a href="/bin/view/Main/PhilippeCanal" class="twikiLink">PhilippeCanal</a> - 14 Dec 2006</div><!-- /patternTopic-->
<p />
<p />
<div class="twikinetRounded twikinetRoundedAttachments"><div class="rCRounded"><div class="rCTR"><div class="rCTL"></div><!--/rCTL--><div class="twikiAttachments">
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="topicattachmentslistshow" class="twistyRememberSetting twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Attachments</span></a> </span> <span id="topicattachmentslisthide" class="twistyRememberSetting twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Attachments</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="topicattachmentslisttoggle" class="twistyRememberSetting twistyContent twikiMakeHidden twistyInited">
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table summary="Topic attachments" cellspacing="3" id="twikiAttachmentsTable" cellpadding="1" class="twikiTable" rules="rows" border="1"><caption>Topic attachments</caption>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol0 twikiFirstCol"> <font color="#252b37">I</font> </th>
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol1"> <font color="#252b37">Attachment</font> </th>
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol2"> <font color="#252b37">Action</font> </th>
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol3"> <font color="#252b37">Size</font> </th>
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol4"> <font color="#252b37">Date</font> </th>
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol5"> <font color="#252b37">Who</font> </th>
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol6 twikiLastCol"> <font color="#252b37">Comment</font> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <img width="16" alt="txt" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/txt.gif" height="16" border="0" /><span class="twikiHidden">txt</span> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol1 twikiLast"> <a href="/twiki/pub/Accounting/ProbeDevelopement/samplemeter.py.txt">samplemeter.py.txt</a> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol2 twikiLast"> <a href="/bin/attach/Accounting/ProbeDevelopement?filename=samplemeter.py.txt;revInfo=1" title="change, update, previous revisions, move, delete..." rel="nofollow">manage</a> </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol3 twikiLast"> 1.7&nbsp;K </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol4 twikiLast"> <span class="twikiNoBreak">15 Dec 2006 - 14:29</span> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol5 twikiLast"> <a href="/bin/view/Main/UnknownUser" class="twikiLink">UnknownUser</a> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol6 twikiLastCol twikiLast"> Example of Gratia Probe (python script) </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
</div></div> <!--/twistyPlugin--></div><!--//twikiAttachments--></div><!--/rCTR--><div class="rCBR"><div class="rCBL"></div><!--/rCBL--></div><!--/rCBR--></div><!--/rCRounded--></div><!--/twikinetRounded--></div><!-- /patternContent-->
<hr />
This topic: Accounting<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>ProbeDevelopement</span> <br />    
Topic revision: r12 - 13 Jul 2011 - 21:56:58 - <a href="/bin/view/Main/PhilippeCanal" class="twikiLink">PhilippeCanal</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />