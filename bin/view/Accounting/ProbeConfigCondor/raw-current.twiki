---+OSG Gratia probe configuration: Condor
&lt;ol&gt;
&lt;li&gt;[[ProbeInstallation][Install]] the software using pacman or RPM.

&lt;ul&gt;&lt;li&gt;%RED%NOTE%ENDCOLOR% Because of the complicated nature of the interaction between the jobmanagers and probe, the assumption is made that Gratia is installed directly into =$VDT_LOCATION=. If this is not the case, then you should link the gratia directory into =$VDT_LOCATION=: it is assumed by the jobmanager that interim Gratia data files it produces go in to =$VDT_LOCATION/gratia/var/data=, and the entry for =DataFolder= in the Gratia =ProbeConfig= file should reflect that fact.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;

#ProbeConfig&lt;li&gt;Customize the Gratia =ProbeConfig= file. The following variables (at least)
should have appropriate values (See [[ProbeConfig]] for more details):

| *Gratia Configuration Variable=&amp;quot;Default&amp;quot;* | *Set value information* |
| !MeterName = &amp;quot;generic&amp;quot; | This value will be entered in the database to indicate where the record came from.&lt;br /&gt;We recommend a =batchsystem:FQDN= such as &quot;condor:fermigrid1.fnal.gov&quot;. |
| !SiteName = &amp;quot;Generic Site&amp;quot; | This value is used in the report to refer to the site/farm/cluster to which the head node gives access. |
| !VDTSetupFile = &amp;quot;&lt;tt&gt;MAGIC_VDT_LOCATION&lt;/vdt&gt;/setup.sh&amp;quot; |Path to the VDT =setup.sh= file. Please expand =MAGIC_VDT_LOCATION=. |
| !UserVOMapFile = &amp;quot;&lt;tt&gt;MAGIC_VDT_LOCATION&lt;tt&gt;/osg/etc/osg-user-vo-map.txt&amp;quot; |Path to the VDT =osg-user-vo-map.txt= (or =grid3-user-vo-map.txt=) file. Please expand =MAGIC_VDT_LOCATION=. |
| !EnableProbe = &amp;quot;1&amp;quot; | If present, this attribute must be set to one to enable probe reporting. |
&lt;/li&gt;

&lt;li&gt;The RPM install procedure makes appropriate entries in =/etc/cron.d=
for uploading accounting information to gratia at the appropriate
time; this time is randomized.&lt;/li&gt;

#GratiaCondorGramPatch&lt;li&gt;Under the directory =gratia/condor-probes/gram_mods= there are two
files that contain some required changes to the GRAM jobmanager scripts. These patches change =$VDT_LOCATION/globus/lib/perl/Globus/GRAM/JobManager/condor.pm= and =$VDT_LOCATION/globus/lib/perl/Globus/GRAM/JobManager/managedfork.pm=

The RPM installation will attempt to check for these patches if installed under =$VDT_LOCATION=: if they are not found you will be warned.

&lt;ol&gt;
#GratiaCondorGramPatchPacman&lt;li&gt;VDT-1.3.10 (part of OSG 0.4.1) has a pacman patch Gratia-Patch(install with pacman -get Gratia-Patch); OR: &lt;/li&gt;

#GratiaCondorGramPatchManual&lt;li&gt;You may apply the patches yourself:

&lt;verbatim&gt;
cd $VDT_LOCATION/globus/lib/perl/Globus/GRAM/JobManager
patch --verbose -p0 &lt; &lt;gratia-dir&gt;/probe/condor/gram_mods/condor.pm.diff
patch --verbose -p0 &lt; &lt;gratia-dir&gt;/probe/condor/gram_mods/managedfork.pm.diff
&lt;/verbatim&gt;

If these commands fail it is likely to be because either the version of VDT you have or a previous RPM install has already applied the patches.
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;

&lt;li&gt;The !CollectorHost has been pre-configured to use the official OSG Gratia
collector (or the official ITB Gratia if you installed the ITB RPMs); please verify this configuration before enabling the probe.&lt;/li&gt;

&lt;/ol&gt;

-- Main.ChrisGreen - 08 Jun 2007
