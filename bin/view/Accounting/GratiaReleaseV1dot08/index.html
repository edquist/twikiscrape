<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GratiaReleaseV1dot08 &lt; Accounting &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Accounting/GratiaReleaseV1dot08?_T=16 Feb 2017" type="application/x-wiki" title="edit GratiaReleaseV1dot08" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Accounting/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Accounting/GratiaReleaseV1dot08"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TABLEPLUGIN_table2--><style type="text/css" media="all">
.twikiTable#table2 th {background-color:#99CCCC;}
.twikiTable#table2 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table2 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table2 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table2 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table2 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--TABLEPLUGIN_table3--><style type="text/css" media="all">
.twikiTable#table3 th {background-color:#99CCCC;}
.twikiTable#table3 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table3 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table3 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table3 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table3 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--EDITTABLEPLUGIN--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/EditTablePlugin/edittable.css");
</style>

<!--TABLEPLUGIN_table1--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
.twikiTable#table1 th {background-color:#99CCCC;}
.twikiTable#table1 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table1 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table1 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <!--
These are general in nature and should be changed in the this template if the location changes: <ul>
<li> Set CURRENT_TOMCAT = <code><b>gratia09</b></code>
</li> <li> Set CURRENT_MYSQL = <strong><em>gratia06</em></strong>
</li> <li> Set NEW_TOMCAT = <code><b>gratia07</b></code>
</li> <li> Set NEW_MYSQL = <em>_ gratia07_</em>
</li> <li> Set TOMCAT_ALIAS = <code><b>gratia.opensciencegrid.org</b></code>
</li> <li> Set MYSQL_ALIAS = <code><b>gratia-db01.fnal.gov</b></code>
</li> <li> Set RELEASE_TAR_REPOSITORY = /afs/fnal.gov/files/expwww/gratia/html/Files
</li></ul> 
<p />
These are specific to a release and require changing: <ul>
<li> Set RELEASE_DATE = July 15, 2011
</li> <li> Set CURRENT_RELEASE = v1.08.0
</li> <li> Set RELEASE_TAG = v1-08-0
</li> <li> Set NEXT_DEVEL_VERSION = v1.09
</li></ul> 
<p /> <ul>
<li> Set BUILD_DIRECTORY = /home/weigand/cdcvs/gratia-v1.08.0
</li></ul> 
<p />
-->
<h1><a name="Gratia_Release_v1_08_0_July_15_2"></a>  Gratia Release v1.08.0 (July 15, 2011)<br /> </h1>
<p />
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Overview"> Overview</a> <ul>
<li> <a href="?cover=print#Main_Features">Main Features:</a>
</li> <li> <a href="?cover=print#Notices"> Notices</a>
</li> <li> <a href="?cover=print#Report_Improvements"> Report Improvements</a>
</li> <li> <a href="?cover=print#Probe_Improvements"> Probe Improvements</a>
</li> <li> <a href="?cover=print#Collector_Improvements"> Collector Improvements</a> <ul>
<li> <a href="?cover=print#Technical_information"> Technical information</a>
</li></ul> 
</li></ul> 
</li> <li> <a href="?cover=print#Anticipated_downtime"> Anticipated downtime</a>
</li> <li> <a href="?cover=print#Collectors_and_Databases_Affecte"> Collectors and Databases Affected</a>
</li> <li> <a href="?cover=print#Build_the_v1_08_0_for_distributi"> Build the v1.08.0 for distribution</a>
</li> <li> <a href="?cover=print#Shutdown_and_database_backup"> Shutdown and database backup.</a> <ul>
<li> <a href="?cover=print#On_the_tomcat_collector_nodes"> On the tomcat/collector nodes</a>
</li> <li> <a href="?cover=print#On_the_MySql_server_node_gratia0"> On the MySql server node (  gratia06 )</a>
</li></ul> 
</li> <li> <a href="?cover=print#Upgrade_and_implementation"> Upgrade and implementation</a> <ul>
<li> <a href="?cover=print#On_the_tomcat_collector_node_AN1"> On the tomcat/collector nodes</a>
</li></ul> 
</li> <li> <a href="?cover=print#Activating_the_new_release"> Activating the new release</a> <ul>
<li> <a href="?cover=print#On_the_tomcat_collector_node_AN2"> On the tomcat/collector nodes</a>
</li> <li> <a href="?cover=print#On_the_MySql_server_node_gra_AN1"> On the MySql server node ( gratia06 )</a>
</li></ul> 
</li> <li> <a href="?cover=print#Post_mortem"> Post-mortem</a>
</li></ul> 
</div>
<p />
<p />
<h1><a name="Overview"></a> Overview </h1>
<p />
The main purpose of this release (v1.08.0) is to enhance the database schema and to add a record of the whole Gratia ecosystem's health.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Main_Features"></a> Main Features: </span></h2>
<p /> <ul>
<li> Introduced support for monitoring and display any potential backlog of any of the Gratia components (See <a href="/bin/view/Accounting/GratiaReleaseV1dot08#Probe_Improvements" class="twikiCurrentTopicLink twikiAnchorLink">probe details</a> and  <a href="/bin/view/Accounting/GratiaReleaseV1dot08#Collector_Improvements" class="twikiCurrentTopicLink twikiAnchorLink">collector details</a>)
</li> <li> Increased the range of the dbid for the raw data (from 32 bits to 64 bits integer), virtually removing any size limitation (beside the limitation of the database engine or hardware).
</li> <li> Completed revamping of the gathering of information about the status and performance of the Collector (see <a href="/bin/view/Accounting/GratiaReleaseV1dot08#Collector_Improvements" class="twikiCurrentTopicLink twikiAnchorLink">details</a> below)
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Notices"></a> Notices </span></h2>
<p /> <ul>
<li> First restart will be slow due to the significant database schema upgrade required.
</li> <li> The duplicate detection on SE, CE, and Subcluster was replaced at the request of HCC and OSG (due to the fact we really don't want duplicate detection here but "transition detection").
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Report_Improvements"></a> Report Improvements </span></h2>
<p /> <ul>
<li> Static reports upgrade to no longer produce non-truncated PDF.
</li> <li> Daily pre-generated reports are now PDF files.
</li> <li> Upgraded to BIRT 2.6.1
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Probe_Improvements"></a> Probe Improvements </span></h2>
<p /> <ul>
<li> Add new functionality to allow delegation of the lifetime of transient input files to Gratia so that there are deleted only in case the record is properly saved and backed-up.   This feature is now used in the Condor probe.
</li> <li> Add upload of information about the amount of data still needing to be processed or uploaded by a Probe to the Collector.
</li> <li> Add interface (<span class="twikiNewLink">GratiaCore<a href="/bin/edit/Accounting/GratiaCore?topicparent=Accounting.GratiaReleaseV1dot08" rel="nofollow" title="GratiaCore (this topic does not yet exist; you can create it)">?</a></span>::RegisterEstimatedServiceBacklog) to to let the probe tell the system how much work is left to do (Individual probes still need to be updated to take advantage of this feature).
</li> <li> Update <span class="twikiNewLink">GratiaCore<a href="/bin/edit/Accounting/GratiaCore?topicparent=Accounting.GratiaReleaseV1dot08" rel="nofollow" title="GratiaCore (this topic does not yet exist; you can create it)">?</a></span> to upload both the amount 
</li> <li> Allow delegation of lifetime of input file to the Gratia Core library for easier deletion only in case of full success ; this fixes a problem with file accumulation with the condor probe.
</li> <li> Checking on number of inodes and disk space used by the urCollector par of the PBS/LSF Probe (to prevent overflow)
</li> <li> Extra status reporting
</li> <li> Support for HTPC jobs
</li> <li> Support for CREAM (by supporting blahp.log to provide certificate information).
</li> <li> Repaired SGE probe.
</li> <li> Merged the <span class="twikiNewLink">GlideInWMS<a href="/bin/edit/Accounting/GlideInWMS?topicparent=Accounting.GratiaReleaseV1dot08" rel="nofollow" title="GlideInWMS (this topic does not yet exist; you can create it)">?</a></span> probe into the Condor probe.
</li> <li> Added support in the PBS probe for ‘array jobs’.
</li> <li> Added support for Torque stores old accounting logs in .gz files. 
</li> <li> Removed dependency on SQLAlchemy and setup tools.
</li> <li> Add support for ancient python version (2.3.4)
</li> <li> Several fixed for dcache probe.
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Collector_Improvements"></a> Collector Improvements </span></h2>
<p /> <ul>
<li> General improvement in the response time both of the administration page and of the enabling/disabling of the Collector features.
</li> <li> Housekeeping is now automatically paused if the number of record in one of the queue reach the value of 'max.housekeeping.nrecords' in the configuration file.  The housekeeping service is restarted if the number of record in each queues goes back under 'min.housekeeping.nrecords'.
</li> <li> Increased the range of the dbid for the raw data (from 32 bits to 64 bits integer) <ul>
<li> The collector schema will be automatically updated the first time the collector is restarted, this will involve (essentially) a complete rewrite of all the data table and thus can be quire time consuming.
</li></ul> 
</li> <li> Improved XML error handling when parsing the incoming data (i.e. eliminate potential data loss in case of non standard record being uploaded)
</li> <li> New administration page listing the performance of Collector and containing:  <ul>
<li> current uploading rate
</li> <li> current incoming rate
</li> <li> recovery estimate
</li> <li> recovery estimate including estimated backlog on the service side
</li> <li> housekeeping status and recovery rate
</li></ul> 
</li> <li> New administration pages detailing the current backlog content: <ul>
<li> Backlog of any probe or collector sending information to the local Collector.
</li> <li> Historical information on those backlog
</li> <li> Details on which probes still has data files in the local queue
</li></ul> 
</li> <li> Improve information available in Status page, add collector-status.html page to get the state of the sub-system.  See <a href="https://twiki.grid.iu.edu/bin/view/Accounting/Monitoring" target="_top">documentation page</a> for details. 
</li> <li> Greatly improved response time and stability of the Status page.
</li></ul> 
<p />
<h3><a name="Technical_information"></a> Technical information </h3>
<p /> <ul>
<li> The file name used to stage the incoming data in the Collector's thread directory now encodes the name of the origin and the number of records (i.e. job#randomnumber#.#origin#.#numberOfRecords#.xml where  the origin is the sender collector or probe with all : and / replaced with underscores.)
</li> <li> The way the Collector gathers and displays the statistics and performance information has been completely revamped. <ul>
<li> The Status and MonitorStatus administration pages have been updated to take advantage of the new tables and are now fast even under heavy load.
</li> <li> 4 tables now participates: TableStatistics, TableStatisticsSnapshots, TableStatisticsHourly, TableStatisticsDaily <ul>
<li> TableStatistics contains for each record type (<span class="twikiNewLink">JobUsage<a href="/bin/edit/Accounting/JobUsage?topicparent=Accounting.GratiaReleaseV1dot08" rel="nofollow" title="JobUsage (this topic does not yet exist; you can create it)">?</a></span>, Metric, etc.) the number of records that are currently in the database and the number of records that have been processed (even if they have been deleted since).   For each, the table not only the number of good record but also the number of duplicates and the number of ‘errorneous’ records (‘Qualifier’). The main new feature in this table is the addition of the ‘lifetime’ number in addition to the current numbers.
</li> <li> TableStatisticsSnapshots contains a copy of the content of <span class="twikiNewLink">TableStatistics<a href="/bin/edit/Accounting/TableStatistics?topicparent=Accounting.GratiaReleaseV1dot08" rel="nofollow" title="TableStatistics (this topic does not yet exist; you can create it)">?</a></span> taken every five minutes (customizable) and kept for a day (default)
</li> <li> TableStatisticsHourly contains a summary of the snapshots taken during a given hour.   For each entry (current/lifetime,RecordType,Qualifier), the table records the exact start and end time it covers, the minimum, maximum and average number of records during the period.  The default is to keep those hourly summary for one year.
</li> <li> TableStatisticsDaily contains a summary of the snapshots taken during a given day.   For each entry (current/lifetime,RecordType,Qualifier), the table records the exact start and end time it covers, the minimum, maximum and average number of records during the period.  The default is to keep those daily summary indefinitely.     * A new class, TableStatisticsManager, is introduced to manage the lifetime of the rows in the new statistics tables and to do/schedule the copying and summarizing.  2 new MYSQLl functions are also introduced for this purpose: table_statictics_hourly_summary and table_statictics_daily_summary.
</li></ul> 
</li></ul> 
</li> <li> The Collector now and displays the current and historical information about its backlog and the backlog of its providers. <ul>
<li> The backlog details administration pages have been created to take advantage of the new tables
</li> <li> 4 tables now participates: BacklogStatistics, BacklogStatisticsSnapshots, BacklogStatisticsHourly, BacklogStatisticsDaily <ul>
<li> BacklogStatistics contains for each providers the number of records and xml files (and tar files) currently in their Gratia as well as an estimate of the amount of information about the service (for example number of batch jobs) the Probe still need to process.   In addition, the table records the bundle size used by the provider to upload its records and the maximum size allowed for its queue. 
</li> <li> BacklogStatisticsSnapshots contains a copy of the content of <span class="twikiNewLink">BacklogStatistics<a href="/bin/edit/Accounting/BacklogStatistics?topicparent=Accounting.GratiaReleaseV1dot08" rel="nofollow" title="BacklogStatistics (this topic does not yet exist; you can create it)">?</a></span> taken every fifteen minutes (customizable) and kept for a day (default).
</li> <li> BacklogStatisticsHourly contains a summary of the snapshots taken during a given hour.   For each entry (<span class="twikiNewLink">EntityType<a href="/bin/edit/Accounting/EntityType?topicparent=Accounting.GratiaReleaseV1dot08" rel="nofollow" title="EntityType (this topic does not yet exist; you can create it)">?</a></span>/Name), the table records the exact start and end time it covers, the minimum, maximum and average number of records during the period.  The default is to keep those hourly summary for one year.
</li> <li> BacklogStatisticsDaily contains a summary of the snapshots taken during a given day.   For each entry (<span class="twikiNewLink">EntityType<a href="/bin/edit/Accounting/EntityType?topicparent=Accounting.GratiaReleaseV1dot08" rel="nofollow" title="EntityType (this topic does not yet exist; you can create it)">?</a></span>/Name)), the table records the exact start and end time it covers, the minimum, maximum and average number of records during the period.  The default is to keep those daily summary indefinitely. 
</li></ul> 
</li></ul> 
</li> <li> A new class, BacklogtatisticsManager, is introduced to manage the lifetime of the rows in the new statistics tables and to do/schedule the copying and summarizing.  2 new MYSQLl functions are also introduced for this purpose: backlog_statictics_hourly_summary and backlog_statictics_daily_summary.
</li> <li> These 2 new set of features are customizable via the following configuration entry:
</li></ul> 
<pre class="screen">#
# Table Statistics history 
#
# frequency of the snapshots, 0 disable the history recording.
# In number of minutes between snapshots
#
tableStatistics.snapshots.wait = 5
#
# How long to keep the individual snap shots of the table statistics
#
service.lifetime.TableStatisticsSnapshots = 1 day
#
# How long to keep the hourly summary of the table statistics
#
service.lifetime.TableStatisticsHourly = 1 year
#
# How long to keep the daily summary of the table statistics
#
service.lifetime.TableStatisticsDaily = UNLIMITED
#
# input queue control - whether or not to monitor queue sizes.
#
#
# Backlog Statistics history 
#
# frequency of the snapshots, 0 disable the history recording.
# In number of minutes between snapshots
#
backlogStatistics.snapshots.wait = 15
#
# How long to keep the individual snap shots of the backlog statistics
#
service.lifetime.BacklogStatisticsSnapshots = 1 day
#
# How long to keep the hourly summary of the backlog statistics
#
service.lifetime.BacklogStatisticsHourly = 1 year
#
# How long to keep the daily summary of the backlog statistics
#
service.lifetime.BacklogStatisticsDaily = UNLIMITED
#
# input queue control - whether or not to monitor queue sizes.
#</pre>
<p />
<p />
<!--   -------------------------------------------- -->
<h1><a name="Anticipated_downtime"></a> Anticipated downtime </h1>
It is expected that this release will require the Gratia services and reporting to be unavailable beginning at: <ul>
<li> Start: July 15, 2011  hh:mm CST
</li> <li> Available: July 15, 2011 hh:mm CST
</li></ul> 
<p />
The changes affecting downtime  for this release are: <ol>
<li> Length of time to make a backup of the database to the backup area using <code>mysqlhotcopy</code>
</li> <li> Installation and validation on the 6 Gratia schemas
</li></ol> 
<p />
<p />
<p />
<p />
<!--   -------------------------------------------- -->
<h1><a name="Collectors_and_Databases_Affecte"></a> Collectors and Databases Affected </h1>
<p />
The following Gratia collectors and databases will be converted with this release:
<p />
<a name="edittable1"></a>
<div class="editTable">
<form name="edittable1" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV1dot08#edittable1" method="post">
<input type="hidden" name="ettablenr" value="1" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">MySql port</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=2;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector URL</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=3;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector host</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=4;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (bytes)</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=5;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (rows)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia-fermi.fnal.gov:8881 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> gratia08.fnal.gov: </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 868K </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 1 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_osg </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> gratia-fermi.fnal.gov:8880 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3"> gratia08.fnal.gov: </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 5.0G </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 2,554,484 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia.opensciencegrid.org:8880 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> gratia09.fnal.gov </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 60.0G </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 30,226,750 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> gratia.opensciencegrid.org:8881 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3"> gratia09.fnal.gov 3.5 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 9.2G </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 2,796,812 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_integration </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia.opensciencegrid.org:8885 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> gratia09.fnal.gov </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 3.5G </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 905,703 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia_qcd </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> gratia-fermi.fnal.gov:8883 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLast"> gratia08.fnal.gov: </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4 twikiLast"> 2.2G </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5 twikiLastCol twikiLast"> 817,080 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="7" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<br />    
The following Gratia collectors and databases will <strong><em>NOT</em></strong>  be converted with this release.  These repositories contained specialized reports that have not as yet been upgraded to the new Birt V2.2 software. <strong><em>However</em></strong>, they will be taken out-of-service while the other databases are being updated.<br />    
<p />
<p />
<a name="edittable2"></a>
<div class="editTable">
<form name="edittable2" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV1dot08#edittable2" method="post">
<input type="hidden" name="ettablenr" value="2" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=0;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=1;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">MySql port</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=2;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector URL</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=3;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector host</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=4;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (bytes)</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=5;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (rows)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_psacct </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia08.fnal.gov:8882 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> gratia08.fnal.gov: </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 6.6G </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5 twikiLastCol"> 4,144,690 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia_osg_daily </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> <strong><em>gratia06</em></strong>.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> gratia.opensciencegrid.org:8884 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLast"> gratia09.fnal.gov </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4 twikiLast"> 65.0M </td>
			<td bgcolor="#FFFFFF" align="center" valign="top" class="twikiTableCol5 twikiLastCol twikiLast"> 56,300 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="3" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<p />
<p />
<!-- BUILD DISTRIBUTION -------------------- -->
<h1><a name="Build_the_v1_08_0_for_distributi"></a> Build the v1.08.0 for distribution </h1>
<ol>
<li>Make sure your build area contains all <em>committed</em> changes.
<ul><li>svn status</li></ul>
</li>
<p />
<li>In <em>gratia/build-scripts/Makefile</em> , change the <em>version_default</em> to:
<ul><li>version_default = v1.09</li>
       <li>commit the change</li>
</ul>
</li>
<p />
<li>Tag the release (for all committed changes):
<ul><li>svn cp <a href="https://gratia.svn.sourceforge.net/svnroot/gratia/trunk" target="_top">https://gratia.svn.sourceforge.net/svnroot/gratia/trunk</a> <a href="https://gratia.svn.sourceforge.net/svnroot/gratia/tags/v1-08-0" target="_top">https://gratia.svn.sourceforge.net/svnroot/gratia/tags/v1-08-0</a></li></ul>
</li>
<p />
<li> <em>Into a <strong>new</strong> area</em>, export the tagged release:
<ul><li>svn export <a href="https://gratia.svn.sourceforge.net/svnroot/gratia/tags/v1-08-0" target="_top">https://gratia.svn.sourceforge.net/svnroot/gratia/tags/v1-08-0</a> gratia-v1.08.0</li></ul>
</li>
<p />
<li>Build it for the release (this insures that tar files are produced for VDT):
<ul><li>cd gratia-v1.08.0/build-scripts</li>
<li>source setup-jdk15.sh</li>
<li>make release</li></ul>
</li>
<p />
<li>Copy the built tar files to the release area:
<ul><li>scp ../target/*_v1.08.0.tar   flxi07.fnal.gov:/afs/fnal.gov/files/expwww/gratia/html/Files/</li></ul> </li>
<p />
<li>Update the version number on the <a href="/bin/view/Accounting/InstallationGuideVDT" class="twikiLink">services release TWiki page</a>:</li>
<ul><li>Edit and update the TWiki variable <em>ReleaseVersion</em>.</li></ul>
</ol>
<p />
<p />
<!-- ----------------- SHUTDOWN AND DATABASE BACKUP ------------- -->
<h1><a name="Shutdown_and_database_backup"></a> Shutdown and database backup. </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_tomcat_collector_nodes"></a> On the tomcat/collector nodes </span></h2>
<ol>
<li> <strong><em>comment</em></strong> out the <strong><em>root</em></strong> user cron entry for the static reports:
<p />
On <strong><em>gratia08</em></strong> :
<pre class="screen">
42 0 * * * '/data/tomcat-fermi_itb/gratia/staticReports.py' '/data/tomcat-fermi_itb' 'http://gratia-fermi.fnal.gov:8881/gratia-reporting/' 
42 0 * * * '/data/tomcat-qcd/gratia/staticReports.py' '/data/tomcat-qcd' 'http://gratia-fermi.fnal.gov:8883/gratia-reporting/' >/dev/null 
42 0 * * * '/data/tomcat-fermi_osg/gratia/staticReports.py' '/data/tomcat-fermi_osg' 'http://gratia-fermi.fnal.gov:8880/gratia-reporting/' 
</pre>
<p />
On <strong><em>gratia09</em></strong> :
<pre class="screen">
42 0 * * * '/data/tomcat-osg_integration/gratia/staticReports.py' '/data/tomcat-osg_integration' 'http://gratia.opensciencegrid.org:8885/gratia-reporting/' 
42 0 * * * '/data/tomcat-itb/gratia/staticReports.py' '/data/tomcat-itb' 'http://gratia.opensciencegrid.org:8881/gratia-reporting/' 
42 0 * * * '/data/tomcat-gratia/gratia/staticReports.py' '/data/tomcat-gratia' 'http://gratia.opensciencegrid.org:8880/gratia-reporting/' 
</pre>
</li>
<p />
    <li> Disable <em>init.d</em> services  as <strong><em>root</em></strong> user:
<p />
On <strong><em>gratia08</em></strong>: <ul>
<li> chkconfig tomcat-ps off
</li> <li> chkconfig tomcat-qcd   off
</li> <li> chkconfig tomcat-fermi_osg off
</li> <li> chkconfig tomcat-fermi_itb  off
</li></ul> 
<p />
On <strong><em>gratia09</em></strong> : <ul>
<li> chkconfig tomcat-gratia  off
</li> <li> chkconfig tomcat-osg_daily   off
</li> <li> chkconfig tomcat-osg_integration off
</li> <li> chkconfig tomcat-itb    off
</li></ul> 
<p />
</li>
<p />
<p />
     <li> For <strong><em>ALL</em></strong> of the Gratia collectors (  <strong><em>including those <u>not</u> being upgraded</em></strong>  ) ,  <strong><em>stop</em></strong> the Gratia update services: <ul>
<li> In your browser,  connect to the Gratia administrative services url for each of the databases.
</li> <li> Select the <em>System / Administration</em> menu option in the left menu
</li> <li> Then scroll down to the <em>Starting/Stopping Database Update Services</em> section and select the <em>Stop Update Services</em> link.
</li></ul> 
<p />
<strong><em>Note:</em></strong> Effective with Gratia v0.31, this step is not necessary.  For any pre-v0.31 installation, this step is still necessary.
<p />
      </li>
<p />
     <li> <strong><em>Stop</em></strong> the tomcat init.d service for__ALL__ Gratia collectors.
<p />
On <strong><em>gratia08</em></strong>: <ul>
<li> service tomcat-fermi_itb  stop
</li> <li> service tomcat-fermi_osg stop
</li> <li> service tomcat-ps  stop
</li> <li> service tomcat-qcd stop
</li></ul> 
<p />
On <strong><em>gratia09</em></strong> : <ul>
<li> service tomcat-gratia  stop
</li> <li> service tomcat-itb  stop
</li> <li> service tomcat-osg_daily  stop
</li> <li> service tomcat-osg_integration stop
</li></ul> 
<p />
</li>
<p />
<li>This is optional, but probably a good idea to save off the logs under each tomcat instance and empty the <em>log</em> directory.  It will facilitate catching any errors that may occur (of course there won't be any, but a good idea anyway).
<b>This can be performed while the database backups are being performed.</b>
<p />
On <strong><em>gratia09</em></strong> : <ul>
<li> date=`date '+%Y%m%d'`
</li> <li> cd /data/tomcat-osg_integration/logs
</li> <li> tar zcf  /data/gratia_tomcat_logs_backups/tomcat-osg_integration.$date.tgz     * 
</li> <li> rm -f *
</li> <li> 
</li> <li> cd     /data/tomcat-itb/logs/
</li> <li> tar zcf /data/gratia_tomcat_logs_backups/tomcat-itb.$date.tgz   *
</li> <li> rm -f *
</li> <li> 
</li> <li> cd  /data/tomcat-gratia/logs/
</li> <li> tar zcf /data/gratia_tomcat_logs_backups/tomcat-gratia.$date.tgz  *
</li> <li> rm -f *
</li></ul> 
<p />
On <strong><em>gratia08</em></strong> : <ul>
<li> date=`date '+%Y%m%d'`
</li> <li> cd        /data/tomcat-fermi_itb/logs/
</li> <li> tar zcf /data/gratia_tomcat_logs_backups/tomcat-fermi_itb.$date.tgz   *
</li> <li> rm -f *
</li> <li> 
</li> <li> cd  /data/tomcat-qcd/logs/
</li> <li> tar zcf /data/gratia_tomcat_logs_backups/tomcat-qcd.$date.tgz     *
</li> <li> rm -f *
</li> <li> 
</li> <li> cd     /data/tomcat-fermi_osg/logs/
</li> <li> tar zcf /data/gratia_tomcat_logs_backups/tomcat-fermi_osg.$date.tgz  *
</li> <li> rm -f *
</li></ul> 
<p />
</li>
<p />
</ol>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_MySql_server_node_gratia0"></a> On the MySql server node (  <strong><em>gratia06</em></strong> ) </span></h2>
  <ol type="1">
    <li> <strong><em>comment</em></strong> out the cron entries for:
<p />
<strong><em>gratia</em></strong> user cron jobs.
<pre class="screen">
0 0 1-15 * *   dir=/home/gratia/interfaces/apel-lcg; cd $dir; ./lcg.sh --config=lcg.conf --date=previous --update
30 01 * * *   dir=/home/gratia/interfaces/apel-lcg; cd $dir; ./lcg.sh --config=lcg.conf --date=current --update
</pre>
<p />
<strong><em>root</em></strong> user cron entry.
<pre class="screen">
43 2 * * * /usr/local/bin/mysqlhotcopy_cron.sh &gt; /var/log/mysqlhotcopy.out 2&gt; &1
</pre>
</li>
<p />
<p />
<li>On the MySql server node ( <strong><em>gratia06</em></strong> ):
<p />
Take a back up the database instances (this will include all schema) using part of the <em>msqlhotcopy_cron</em> script from the command line as <em>root</em> user.
<br />    Backup will only being done to  <em>/backup/mysqldb</em> on <strong><em>gratia06</em></strong> in order to reduce the downtime. <ul>
<li> mysqlhotcopy -p lisp01 --addtodest fermi_itb /backup/mysqldb       
</li> <li> mysqlhotcopy -p lisp01 --addtodest gratia_osg_daily /backup/mysqldb    
</li> <li> mysqlhotcopy -p lisp01 --addtodest gratia_qcd /backup/mysqldb     
</li> <li> mysqlhotcopy -p lisp01 --addtodest gratia_osg_integration /backup/mysqldb  
</li> <li> mysqlhotcopy -p lisp01 --addtodest fermi_osg /backup/mysqldb   
</li> <li> mysqlhotcopy -p lisp01 --addtodest gratia_psacct /backup/mysqldb   
</li> <li> mysqlhotcopy -p lisp01 --addtodest gratia_itb /backup/mysqldb   
</li> <li> mysqlhotcopy -p lisp01 --addtodest gratia /backup/mysqldb      
</li></ul> 
<p />
<p />
Backup times:
<p />
<a name="edittable3"></a>
<div class="editTable">
<form name="edittable3" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV1dot08#edittable3" method="post">
<input type="hidden" name="ettablenr" value="3" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table3" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=0;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=1;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Expected Duration</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV1dot08?cover=print;sortcol=2;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Actual Duration</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 1 sec </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> &nbsp; </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_daily </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 6 secs </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol"> &nbsp; </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_qcd </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 64 secs </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> &nbsp; </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_integration </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 99 secs </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol"> &nbsp; </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_osg </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 132 secs </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> &nbsp; </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_psacct </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 179 secs </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol"> &nbsp; </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_itb </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 461 secs (8 min) </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> &nbsp; </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> 2900 secs (48+ min) </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> &nbsp; </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="9" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
     </li>
<p />
<p />
<p />
</ol>
<p />
<p />
<!-- ----------------- UPGRADE AND IMPLEMENTATION ------------- -->
<h1><a name="Upgrade_and_implementation"></a> Upgrade and implementation </h1>
The <strong><em>upgrades should be single-threaded</em></strong> , that is, performed for each database schema one at a time.  
<p />
We will perform these upgrades based on the size of the individual database schema, in ascending order.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_tomcat_collector_node_AN1"></a> On the tomcat/collector nodes </span></h2>
<ol>
  <li>Install the new software on a Gratia tomcat instance:
<br />     pswd=xxx
<br />     source=/home/weigand/cdcvs/gratia-v1.08.0
<br />     pgm=/home/weigand/cdcvs/gratia-v1.08.0/common/configuration/update-gratia-local 
<br />     On <strong><em>gratia09:</em></strong> <ul>
<li> $pgm  -d $pswd -S $source  osg_integration
</li> <li> $pgm  -d $pswd -S $source  itb
</li> <li> $pgm  -d $pswd -S $source   gratia
</li></ul> 
<br />     On <strong><em>gratia08:</em></strong> <ul>
<li> $pgm  -d $pswd -S $source  fermi_itb
</li> <li> $pgm  -d $pswd -S $source qcd
</li> <li> $pgm  -d $pswd -S $source   fermi_osg
</li></ul> 
<p />
</li>
<p />
<p />
<li>Start the gratia tomcat services: <ul>
<li> service &lt;tomcat service&gt; start
</li> <li> When the tomcat service initializes, it will detect any schema changes have been effected and a conversion process will begin. 
</li> <li> <em>tail</em> the  <em>catalina.out</em> log. When the conversion process completes the log will show the following message:<br />           "INFO: Server startup in _xxx_ms"
</li></ul> 
<p />
<li>Then, <em>start</em> the Gratia <em>update</em> services for the database schema just upgraded.<br />     <ul>
<li> In your browser, connect to the Gratia administrative services url for each of the databases.<br />    
</li> <li> Select the <em>System / Administration</em> menu option in the left menu<br />    
</li> <li> Then scroll down to the <em>Starting/Stopping Database Update Services</em> section and select the <em>Start Update Services</em> link.
</li> <li> As <strong><em>each</em></strong> collector/tomcat host update service is started, monitor the tomcat logs files for any errors.
</li> <li> Bring up the gratia <em>administration</em> web interface and verify that the collectors are processing the data.
</li> <li> Bring up the gratia <em>reporting</em> web interface and verify that the reports look reasonable while still <em>tail'ing</em> the log files.
</li></ul> 
<p />
<li>If all looks good, <em>stop</em> the Gratia <em>update</em> services for the database schema just upgraded.
<p />
<p />
<li> Run the static reports cron as <em>root</em> and verify these reports are generated: <ul>
<li> ./gratia-reports/reports-static/UsageByVOByDate-ranked.pdf
</li> <li> ./gratia-reports/reports-static/UsageBySiteByDate-ranked.pdf
</li> <li> ./gratia-reports/reports-static/WeeklyUsageByVO-ranked.pdf
</li></ul> 
<p />
On <strong><em>gratia08</em></strong> :
<pre class="screen">
42 0 * * * '/data/tomcat-fermi_itb/gratia/staticReports.py' '/data/tomcat-fermi_itb' 'http://gratia-fermi.fnal.gov:8881/gratia-reporting/' 
42 0 * * * '/data/tomcat-qcd/gratia/staticReports.py' '/data/tomcat-qcd' 'http://gratia-fermi.fnal.gov:8883/gratia-reporting/' 
42 0 * * * '/data/tomcat-fermi_osg/gratia/staticReports.py' '/data/tomcat-fermi_osg' 'http://gratia-fermi.fnal.gov:8880/gratia-reporting/' 
</pre>
<p />
On <strong><em>gratia09</em></strong> :
<pre class="screen">
42 0 * * * '/data/tomcat-osg_integration/gratia/staticReports.py' '/data/tomcat-osg_integration' 'http://gratia.opensciencegrid.org:8885/gratia-reporting/' 
42 0 * * * '/data/tomcat-itb/gratia/staticReports.py' '/data/tomcat-itb' 'http://gratia.opensciencegrid.org:8881/gratia-reporting/' 
42 0 * * * '/data/tomcat-gratia/gratia/staticReports.py' '/data/tomcat-gratia' 'http://gratia.opensciencegrid.org:8880/gratia-reporting/' 
</pre>
</li>
<p />
<li>If satisifed, <strong><em>stop</em></strong> the tomcat service for that tomcat database schema so you can proceed to the next one. <ul>
<li> service &lt;tomcat service&gt; stop
</li></ul> 
</li>
</ol>
<p />
<p />
<!-- ----------------- ACTIVATING THE NEW RELEASE ------------- -->
<h1><a name="Activating_the_new_release"></a> Activating the new release </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_tomcat_collector_node_AN2"></a> On the tomcat/collector nodes </span></h2>
  <ol>
        <li> <strong><em>start</em></strong> the tomcat service for the Gratia collectors.<br />    
<p />
On <strong><em>gratia08:</em></strong> <ul>
<li> service tomcat-fermi_itb  start
</li> <li> service tomcat-fermi_osg start
</li> <li> service tomcat-ps start
</li> <li> service tomcat-qcd start
</li></ul> 
<p />
On <strong><em>gratia09:</em></strong> <ul>
<li> service tomcat-gratia start  
</li> <li> service tomcat-itb start
</li> <li> service tomcat-osg_daily start
</li> <li> service tomcat-osg_integration start
</li></ul> 
</li>
<p />
   <li> As <strong><em>each</em></strong> collector/tomcat host service is started, monitor the tomcat logs files for any errors.
<p />
</li>
<p />
   <li> Bring up the gratia administrative web interface and verify that the collectors are processing the data.<br />    
     If they are not processing any data,  <strong><em>verify</em></strong> the Gratia update services are active.
<ul><li>In your browser,  connect to the Gratia administrative services url for each of the databases.</li>
       <li>Select the <em>System / Administration</em> menu option in the left menu</li>
       <li>Then scroll down to the <em>Starting/Stopping Database Update Services</em> section and and view the status.</li>
</ul>
      </li>
<p />
    <li> Enable <em>init.d</em> services for all tomcats as <strong><em>root</em></strong> user:
<p />
On <strong><em>gratia08:</em></strong> <ul>
<li> chkconfig tomcat-ps on
</li> <li> chkconfig tomcat-qcd   on
</li> <li> chkconfig tomcat-fermi_osg on
</li> <li> chkconfig tomcat-fermi_itb  on
</li></ul> 
<p />
On <strong><em>gratia09:</em></strong> <ul>
<li> chkconfig tomcat-gratia  on
</li> <li> chkconfig tomcat-osg_daily   on
</li> <li> chkconfig tomcat-osg_integration on
</li> <li> chkconfig tomcat-itb    on
</li></ul> 
</li>
<p />
   <li> <strong><em>Uncomment/verify</em></strong>   the <strong><em>root</em></strong> user cron entry for the static reports:
<p />
On <strong><em>gratia08</em></strong> :
<pre class="screen">
42 0 * * * '/data/tomcat-fermi_itb/gratia/staticReports.py' '/data/tomcat-fermi_itb' 'http://gratia-fermi.fnal.gov:8881/gratia-reporting/' 
42 0 * * * '/data/tomcat-qcd/gratia/staticReports.py' '/data/tomcat-qcd' 'http://gratia-fermi.fnal.gov:8883/gratia-reporting/' 
42 0 * * * '/data/tomcat-fermi_osg/gratia/staticReports.py' '/data/tomcat-fermi_osg' 'http://gratia-fermi.fnal.gov:8880/gratia-reporting/' 
</pre>
<p />
On <strong><em>gratia09</em></strong> :
<pre class="screen">
42 0 * * * '/data/tomcat-osg_integration/gratia/staticReports.py' '/data/tomcat-osg_integration' 'http://gratia.opensciencegrid.org:8885/gratia-reporting/' 
42 0 * * * '/data/tomcat-itb/gratia/staticReports.py' '/data/tomcat-itb' 'http://gratia.opensciencegrid.org:8881/gratia-reporting/' 
42 0 * * * '/data/tomcat-gratia/gratia/staticReports.py' '/data/tomcat-gratia' 'http://gratia.opensciencegrid.org:8880/gratia-reporting/' 
</pre>
</li>
</ol>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="On_the_MySql_server_node_gra_AN1"></a> On the MySql server node ( <strong><em>gratia06</em></strong> ) </span></h2>
<ol>
<li> <strong><em>Uncomment</em></strong>   the <strong><em>root</em></strong> user cron job(s) for gratia backups
<pre class="screen">
43 2 * * * /usr/local/bin/mysqlhotcopy_cron.sh > /var/log/mysqlhotcopy.out 2>&1
</pre>
</li>
<li> <strong><em>Uncomment</em></strong>  the <strong><em>gratia</em></strong> user cron job(s).
<pre class="screen">
0 0 1-15 * *   dir=/home/gratia/interfaces/apel-lcg; cd $dir; ./lcg.sh --config=lcg.conf --date=previous --update
30 01 * * *   dir=/home/gratia/interfaces/apel-lcg; cd $dir; ./lcg.sh --config=lcg.conf --date=current --update
</pre>
</li>
</ol>
<p />
<p />
<p />
<!-- ----------------- POST MORTEM  ------------- -->
<h1><a name="Post_mortem"></a> Post-mortem </h1>
At this time, this will appear to be random notes.  After the conversion, they may be organized.
<p />
<ol>
<p />
</ol>
<p />
<p />
<p />
<p />
<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Major_updates"></a>  Major updates </span></h2>
<!--Future editors should add their signatures beneath yours!--></div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Accounting<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GratiaReleaseV1dot08</span> <br />    
Topic revision: r13 - 13 Jul 2011 - 21:24:09 - <a href="/bin/view/Main/PhilippeCanal" class="twikiLink">PhilippeCanal</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />