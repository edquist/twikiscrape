<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> Monitoring &lt; Accounting &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Accounting/Monitoring?_T=16 Feb 2017" type="application/x-wiki" title="edit Monitoring" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Accounting/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Accounting/Monitoring"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> 
<p />
<h1><a name="Monitoring_tools"></a> Monitoring tools </h1>
<p />
<form name="VIEWTHIS" action="Monitoring" method="get"><input type="submit" value="View section" alt="View this section" title="Click to view this section" class="twikiButton" style="font-size:.5em;"><input type="hidden" value="1487267889" name="t"></form>
<p />
To monitor the health of a collector you have the following options:
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Probes_to_Collector_connection"></a> Probes to Collector connection </span></h2>
<p />
To test the probe to collector connection, execute the script <em>GratiaPing.py</em>
<p />
This script will return the exit code 0 in case of successful connection to the server.
<p />
This script can be found in the probe/common directory.  You will need to execute it in a directory with a <a href="/bin/view/Accounting/ProbeConfig" class="twikiLink">ProbeConfig</a> pointing to your collector.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Collector_record_processing"></a> Collector record processing. </span></h2>
<p />
The collector can be setup to send mail if no record has been processed in a given time period.   To setup up this emails and its frequency, you need to edit the monitor/monitoring section in the Gratia service-configuration.properties (located in $tomcat_topdir/gratia )
<p />
<pre>
gratia-fermi.fnal.gov:8884 tomcat-conversion Potential listener problem

The MonitorListenerThread has detected a possible problem. There have been
no input records processed in the past 60 minutes. Please check the service.
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Collector_Metrics"></a> Collector Metrics </span></h2>
<p />
System status information can be found in the administration page <a href="http://yourhost:youport/gratia-administration" target="_top">http://yourhost:youport/gratia-administration</a>.
<p />
The <em>normal</em> status page shows the number of messages in the queue.  This messages have been received by the collector but not yet processed.  Those messages includes both the regular job level record, as well as handshake records and (possibly) duplication messages.  Each duplication message may contain more than one job level records.
<p />
It also shows the number of individual records and of duplicates records processed in each of the last 6 hours, the last day, the last week and forever.
<p />
The detailed page also include the number of error seen during the record processing (each error represent one record that was not processed).
<p />
The page 'rates' under 'System Performance' shows the following information: <ul>
<li> Performance <ul>
<li> Current record processing speed.
</li> <li> Number of records actually processed in the last hour.
</li> <li> Variation in queue size in the last hour (differential between number of incoming records and number of record processed)
</li> <li> Number of incoming records in the last hours
</li></ul> 
</li> <li> Catchup based on queue size  <ul>
<li> Estimate of the amount of time needed to reduce the queue size to zero or an estimate of the number of record accumulating in the queue.
</li></ul> 
</li> <li> Catchup based on full service backlog <ul>
<li> Total estimated number of records still be uploaded by the providers
</li> <li> Variation in this total number in the last hour
</li> <li> Variation in this total number + the queue size (i.e. differential between the number of records created by the services and the number of record processed by the collector).
</li> <li> Estimate of the amount of time needed to catch up or an estimate of the number of record accumulating in the backlog
</li></ul> 
</li> <li> Housekeeping (details) <ul>
<li> Status of the housekeeping
</li> <li> Number of record purged in the last day
</li> <li> Addition details (extra click needed, slow to be shown) for each table (plus the xml table for <span class="twikiNewLink">JobUsage<a href="/bin/edit/Accounting/JobUsage?topicparent=Accounting.Monitoring" rel="nofollow" title="JobUsage (this topic does not yet exist; you can create it)">?</a></span> and Metric records): <ul>
<li> Oldest date requested to be kept
</li> <li> Oldest record actually still in the database
</li> <li> Time difference between the 2
</li> <li> Number of records still to be deleted
</li> <li> Estimate of the amount of time needed to delete them.
</li></ul> 
</li></ul> 
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Collector_Backlog"></a> Collector Backlog </span></h2>
<p />
The backlog details pages given access for each data providers (Probes, remote Collectors) to: <ul>
<li> Records to be uploaded
</li> <li> Estimated service backlog
</li> <li> bundle size
</li> <li> Current status (up to date, losing ground, catching up)
</li> <li> Estimate of the amount of time needed to catch up or an estimate of the number of record accumulating in the backlog
</li> <li> Link to the historical data for all these values
</li></ul> 
<p />
A link to the breakdown by probe and collectors of the current queue content.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Automated_Status_Monitoring"></a> Automated Status Monitoring </span></h2>
<p />
<h3><a name="General_Health"></a> General Health </h3>
Automated Status Monitoring can be done via the page:
<p />
<a href="http://gratiacollector:port/gratia-administration/monitor-status.html" target="_top">http://gratiacollector:port/gratia-administration/monitor-status.html</a> 
<p />
which issues things like:<pre>record-count-hour&#61;15413&#124;record-count-24hour&#61;357661&#124;queuesize0&#61;40&#124;record-queue0&#61;800&#124;</pre>
<p />
As of release v1.02/02, a xml version is also available:
<p />
<a href="http://gratiacollector:port/gratia-administration/monitor-status.html?xml=yes" target="_top">http://gratiacollector:port/gratia-administration/monitor-status.html?xml=yes</a>
<p />
<pre>&#60;record-count-hour&#62;0&#60;/record-count-hour&#62;&#60;record-count-24hour&#62;0&#60;/record-count-24hour&#62;
&#60;queuesize thread&#61;0&#62;0&#60;/queuesize&#62;&#60;record-queue thread&#61;0&#62;0&#60;/record-queue&#62;</pre>
<p />
<p />
<h3><a name="Site_Specific"></a> Site Specific </h3>
<p />
To get reporting information about all currently reporting sites, use <a href="http://gratiacollector:port/gratia-administration/monitor-status.html?allsites" target="_top">http://gratiacollector:port/gratia-administration/monitor-status.html?allsites</a> which gives Site Name, Probe Name, Last  Reporting Time:
<pre>
site&#61;FNAL&#95;CDFOSG&#95;4&#124;probename&#61;condor:fcdfosg4.fnal.gov&#124;last-contact&#61;2009-02-10 19:07:20&#124;
site&#61;FNAL&#95;DZEROOSG&#95;1&#124;probename&#61;pbs:d0cabosg1.fnal.gov&#124;last-contact&#61;2009-02-10 19:07:18&#124;
</pre>
<p />
To get the xml version use: <a href="http://gratiacollector:port/gratia-administration/monitor-status.html?allsites&amp;xml=yes" target="_top">http://gratiacollector:port/gratia-administration/monitor-status.html?allsites&amp;xml=yes</a>
<p />
<pre>
&#60;site&#62;FNAL&#95;CDFOSG&#95;4&#60;/site&#62;&#60;probename&#62;condor:fcdfosg4.fnal.gov&#60;/probename&#62;&#60;last-contact&#62;2009-02-10 19:07:20&#60;/last-contact&#62;
&#60;site&#62;FNAL&#95;DZEROOSG&#95;1&#60;/site&#62;&#60;probename&#62;pbs:d0cabosg1.fnal.gov&#60;/probename&#62;&#60;last-contact&#62;2009-02-10 19:07:18&#60;/last-contact&#62;
</pre>
<p />
Version prior to v1.02/02 issues text in the following format:<pre>AGLT2&#124;condor:gate02.grid.umich.edu&#124;2009-02-13 16:44:28
BNL&#95;ATLAS&#95;1&#124;condor:gridgk01.racf.bnl.gov&#124;2009-02-13 16:43:28
</pre>
<p />
In order to verify that your site is now reporting correctly, please wait until the relevant probe is no longer running (some probes may churn through a large local backlog before uploading records) before visiting the status page for your site: <a href="http://gratiacollector:port/gratia-administration/monitor-status.html?sitename=mySiteName" target="_top">http://gratiacollector:port/gratia-administration/monitor-status.html?sitename=mySiteName</a>. which gives <span class="twikiNewLink">ProbeName<a href="/bin/edit/Accounting/ProbeName?topicparent=Accounting.Monitoring" rel="nofollow" title="ProbeName (this topic does not yet exist; you can create it)">?</a></span> and Last reporting time
<pre>probename&#61;glexec:fcdfosg3.fnal.gov&#124;last-contact&#61;2009-02-10 19:07:21&#124;
probename&#61;condor:fcdfosg3.fnal.gov&#124;last-contact&#61;2009-02-10 19:07:19&#124;
</pre>or in xml <a href="http://gratiacollector:port/gratia-administration/monitor-status.html?sitename=mySiteName&amp;xml=yes" target="_top">http://gratiacollector:port/gratia-administration/monitor-status.html?sitename=mySiteName&amp;xml=yes</a>
<pre>&#60;probename&#62;glexec:fcdfosg3.fnal.gov&#60;/probename&#62;&#60;last-contact&#62;2009-02-10 19:07:21&#60;/last-contact&#62;
&#60;probename&#62;condor:fcdfosg3.fnal.gov&#60;/probename&#62;&#60;last-contact&#62;2009-02-10 19:07:19&#60;/last-contact&#62;
</pre>
<p />
Prior to version v1.02/02 the output looked like:
<p />
<pre>condor:gate02.grid.umich.edu: last-contact&#61;2009-02-13 16:44:28
condor:gate01.aglt2.org: last-contact&#61;2009-02-13 16:44:27</pre>
<p />
<h3><a name="Probe_Specific"></a> Probe Specific. </h3>
<p />
To see information about a single probe use <a href="http://gratiacollector:port/gratia-administration/monitor-status.html?probename=MyProbeName" target="_top">http://gratiacollector:port/gratia-administration/monitor-status.html?probename=MyProbeName</a> which gives: <pre>last-contact&#61;2009-02-13 16:44:28&#124;</pre>or in xml
ttp://gratiacollector:port/gratia-administration/monitor-status.html?probename=MyProbeName&amp;xml=yes<pre>&#60;last-contact&#62;2009-02-10 19:07:21&#60;/last-contact&#62;</pre>
<p />
<h3><a name="Host_specifc_information"></a> Host specifc information </h3>
<p />
To see information about a single host use <a href="http://gratiacollector:port/gratia-administration/monitor-status.html?host=MyHostName" target="_top">http://gratiacollector:port/gratia-administration/monitor-status.html?host=MyHostName</a>: <pre>last-contact&#61;2009-02-13 16:44:28&#124;</pre>
or in xml
ttp://gratiacollector:port/gratia-administration/monitor-status.html?host=MyHostName&amp;xml=yes<pre>&#60;last-contact&#62;2009-02-10 19:07:21&#60;/last-contact&#62;</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Collector_Sub_System_Status"></a> Collector Sub-System Status </span></h2>
<p />
You can check the current state of the collector sub-system via the page <a href="http://gratiacollector:port/gratia-administration/collector-status.html" target="_top">http://gratiacollector:port/gratia-administration/collector-status.html</a>
See <a href="http://gratiacollector:port/gratia-administration/collector-tatus.html?out=html" target="_top">http://gratiacollector:port/gratia-administration/collector-tatus.html?out=html</a> for a complete html version of the status similar to the system administration page.
<h3><a name="Output"></a> Output </h3>
<h4><a name="Text"></a> Text </h4>
The text output can be obtained with the option <code>collector-tatus.html?out=text</code>
<p />
<pre>operations&#61;active&#124;collector&#61;active&#124;databaseupdate&#61;active&#124;replication&#61;active&#124;datahousekeeping&#61;sleeping&#124;history&#61;sleeping&#124;</pre>
<h4><a name="Xml"></a> Xml </h4>
The xml output can be obtained with the option: <code>collector-tatus.html?out=xml</code>
<p />
<pre>&#60;operations&#62;active&#60;/operations&#62;
&#60;collector&#62;active&#60;/collector&#62;
&#60;databaseupdate&#62;active&#60;/databaseupdate&#62;
&#60;replication&#62;active&#60;/replication&#62;
&#60;datahousekeeping&#62;sleeping&#60;/datahousekeeping&#62;
&#60;history&#62;sleeping&#60;/history&#62;
</pre>
<p />
<h3><a name="Single_sub_system"></a> Single sub system </h3>
<p />
To get the information about a specific sub-system, use the option: <code>collector-tatus.html?out=text&amp;subsystem=operations</code>
<p />
<h4><a name="List_of_valid_sub_system"></a> List of valid sub system </h4>
<p /> <ul>
<li> operations : Global Operational Status
</li> <li> Collector : status of the servlet (i.e. whether the collector accepts incoming records)
</li> <li> databaseupdate : whether the incoming record are processed or just staged.
</li> <li> replication : Whether the replication mechanism is turned on
</li> <li> datahousekeeping : status of the sub-system in charge of deletin old records
</li> <li> history : status of the sub-system in charge of compressing and deleting old historical incoming data file.
</li></ul> 
<p />
<h4><a name="List_of_valid_status"></a> List of valid status </h4>
<p />
This is the full list of possible status.
<p /> <ul>
<li> disabled
</li> <li> enabled
</li> <li> safe
</li> <li> running
</li> <li> sleeping
</li> <li> paused
</li> <li> stopped
</li> <li> unknown
</li></ul> 
<p />
<p />
-- <a href="/bin/view/Main/PhilippeCanal" class="twikiLink">PhilippeCanal</a> - 02 Jul 2008</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Accounting<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>Monitoring</span> <br />    
Topic revision: r11 - 13 Jul 2011 - 21:52:18 - <a href="/bin/view/Main/PhilippeCanal" class="twikiLink">PhilippeCanal</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />