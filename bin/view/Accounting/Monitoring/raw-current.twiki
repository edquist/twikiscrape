%STARTINCLUDE%

---+Monitoring tools

%VIEWTHIS%

To monitor the health of a collector you have the following options:

---++Probes to Collector connection

To test the probe to collector connection, execute the script _GratiaPing.py_

This script will return the exit code 0 in case of successful connection to the server.

This script can be found in the probe/common directory.  You will need to execute it in a directory with a ProbeConfig pointing to your collector.

---++Collector record processing.

The collector can be setup to send mail if no record has been processed in a given time period.   To setup up this emails and its frequency, you need to edit the monitor/monitoring section in the Gratia service-configuration.properties (located in $tomcat_topdir/gratia )

&lt;verbatim&gt;
gratia-fermi.fnal.gov:8884 tomcat-conversion Potential listener problem

The MonitorListenerThread has detected a possible problem. There have been
no input records processed in the past 60 minutes. Please check the service.
&lt;/verbatim&gt;

---++Collector Metrics

System status information can be found in the administration page http://yourhost:youport/gratia-administration.

The _normal_ status page shows the number of messages in the queue.  This messages have been received by the collector but not yet processed.  Those messages includes both the regular job level record, as well as handshake records and (possibly) duplication messages.  Each duplication message may contain more than one job level records.

It also shows the number of individual records and of duplicates records processed in each of the last 6 hours, the last day, the last week and forever.

The detailed page also include the number of error seen during the record processing (each error represent one record that was not processed).

The page &#39;rates&#39; under &#39;System Performance&#39; shows the following information:
   * Performance
      * Current record processing speed.
      * Number of records actually processed in the last hour.
      * Variation in queue size in the last hour (differential between number of incoming records and number of record processed)
      * Number of incoming records in the last hours
   * Catchup based on queue size 
      * Estimate of the amount of time needed to reduce the queue size to zero or an estimate of the number of record accumulating in the queue.
   * Catchup based on full service backlog
      * Total estimated number of records still be uploaded by the providers
      * Variation in this total number in the last hour
      * Variation in this total number + the queue size (i.e. differential between the number of records created by the services and the number of record processed by the collector).
      * Estimate of the amount of time needed to catch up or an estimate of the number of record accumulating in the backlog
   * Housekeeping (details)
      * Status of the housekeeping
      * Number of record purged in the last day
      * Addition details (extra click needed, slow to be shown) for each table (plus the xml table for JobUsage and Metric records):
         * Oldest date requested to be kept
         * Oldest record actually still in the database
         * Time difference between the 2
         * Number of records still to be deleted
         * Estimate of the amount of time needed to delete them.

---++Collector Backlog

The backlog details pages given access for each data providers (Probes, remote Collectors) to:
   * Records to be uploaded
   * Estimated service backlog
   * bundle size
   * Current status (up to date, losing ground, catching up)
   * Estimate of the amount of time needed to catch up or an estimate of the number of record accumulating in the backlog
   * Link to the historical data for all these values

A link to the breakdown by probe and collectors of the current queue content.

---++Automated Status Monitoring

---+++General Health
Automated Status Monitoring can be done via the page:

http://gratiacollector:port/gratia-administration/monitor-status.html 

which issues things like:&lt;verbatim&gt;record-count-hour=15413|record-count-24hour=357661|queuesize0=40|record-queue0=800|&lt;/verbatim&gt;

As of release v1.02/02, a xml version is also available:

http://gratiacollector:port/gratia-administration/monitor-status.html?xml=yes

&lt;verbatim&gt;&lt;record-count-hour&gt;0&lt;/record-count-hour&gt;&lt;record-count-24hour&gt;0&lt;/record-count-24hour&gt;
&lt;queuesize thread=0&gt;0&lt;/queuesize&gt;&lt;record-queue thread=0&gt;0&lt;/record-queue&gt;&lt;/verbatim&gt;


---+++Site Specific

To get reporting information about all currently reporting sites, use http://gratiacollector:port/gratia-administration/monitor-status.html?allsites which gives Site Name, Probe Name, Last  Reporting Time:
&lt;verbatim&gt;
site=FNAL_CDFOSG_4|probename=condor:fcdfosg4.fnal.gov|last-contact=2009-02-10 19:07:20|
site=FNAL_DZEROOSG_1|probename=pbs:d0cabosg1.fnal.gov|last-contact=2009-02-10 19:07:18|
&lt;/verbatim&gt;

To get the xml version use: http://gratiacollector:port/gratia-administration/monitor-status.html?allsites&amp;xml=yes

&lt;verbatim&gt;
&lt;site&gt;FNAL_CDFOSG_4&lt;/site&gt;&lt;probename&gt;condor:fcdfosg4.fnal.gov&lt;/probename&gt;&lt;last-contact&gt;2009-02-10 19:07:20&lt;/last-contact&gt;
&lt;site&gt;FNAL_DZEROOSG_1&lt;/site&gt;&lt;probename&gt;pbs:d0cabosg1.fnal.gov&lt;/probename&gt;&lt;last-contact&gt;2009-02-10 19:07:18&lt;/last-contact&gt;
&lt;/verbatim&gt;

Version prior to v1.02/02 issues text in the following format:&lt;verbatim&gt;AGLT2|condor:gate02.grid.umich.edu|2009-02-13 16:44:28
BNL_ATLAS_1|condor:gridgk01.racf.bnl.gov|2009-02-13 16:43:28
&lt;/verbatim&gt;

In order to verify that your site is now reporting correctly, please wait until the relevant probe is no longer running (some probes may churn through a large local backlog before uploading records) before visiting the status page for your site: http://gratiacollector:port/gratia-administration/monitor-status.html?sitename=mySiteName. which gives ProbeName and Last reporting time
&lt;verbatim&gt;probename=glexec:fcdfosg3.fnal.gov|last-contact=2009-02-10 19:07:21|
probename=condor:fcdfosg3.fnal.gov|last-contact=2009-02-10 19:07:19|
&lt;/verbatim&gt;or in xml http://gratiacollector:port/gratia-administration/monitor-status.html?sitename=mySiteName&amp;xml=yes
&lt;verbatim&gt;&lt;probename&gt;glexec:fcdfosg3.fnal.gov&lt;/probename&gt;&lt;last-contact&gt;2009-02-10 19:07:21&lt;/last-contact&gt;
&lt;probename&gt;condor:fcdfosg3.fnal.gov&lt;/probename&gt;&lt;last-contact&gt;2009-02-10 19:07:19&lt;/last-contact&gt;
&lt;/verbatim&gt;

Prior to version v1.02/02 the output looked like:

&lt;verbatim&gt;condor:gate02.grid.umich.edu: last-contact=2009-02-13 16:44:28
condor:gate01.aglt2.org: last-contact=2009-02-13 16:44:27&lt;/verbatim&gt;

---+++Probe Specific.

To see information about a single probe use http://gratiacollector:port/gratia-administration/monitor-status.html?probename=MyProbeName which gives: &lt;verbatim&gt;last-contact=2009-02-13 16:44:28|&lt;/verbatim&gt;or in xml
ttp://gratiacollector:port/gratia-administration/monitor-status.html?probename=MyProbeName&amp;xml=yes&lt;verbatim&gt;&lt;last-contact&gt;2009-02-10 19:07:21&lt;/last-contact&gt;&lt;/verbatim&gt;

---+++Host specifc information

To see information about a single host use http://gratiacollector:port/gratia-administration/monitor-status.html?host=MyHostName: &lt;verbatim&gt;last-contact=2009-02-13 16:44:28|&lt;/verbatim&gt;
or in xml
ttp://gratiacollector:port/gratia-administration/monitor-status.html?host=MyHostName&amp;xml=yes&lt;verbatim&gt;&lt;last-contact&gt;2009-02-10 19:07:21&lt;/last-contact&gt;&lt;/verbatim&gt;

---++Collector Sub-System Status

You can check the current state of the collector sub-system via the page http://gratiacollector:port/gratia-administration/collector-status.html
See http://gratiacollector:port/gratia-administration/collector-tatus.html?out=html for a complete html version of the status similar to the system administration page.
---+++Output
---++++Text
The text output can be obtained with the option =collector-tatus.html?out=text=

&lt;verbatim&gt;operations=active|collector=active|databaseupdate=active|replication=active|datahousekeeping=sleeping|history=sleeping|&lt;/verbatim&gt;
---++++Xml
The xml output can be obtained with the option: =collector-tatus.html?out=xml=

&lt;verbatim&gt;&lt;operations&gt;active&lt;/operations&gt;
&lt;collector&gt;active&lt;/collector&gt;
&lt;databaseupdate&gt;active&lt;/databaseupdate&gt;
&lt;replication&gt;active&lt;/replication&gt;
&lt;datahousekeeping&gt;sleeping&lt;/datahousekeeping&gt;
&lt;history&gt;sleeping&lt;/history&gt;
&lt;/verbatim&gt;

---+++Single sub system

To get the information about a specific sub-system, use the option: =collector-tatus.html?out=text&amp;subsystem=operations=

---++++List of valid sub system

   * operations : Global Operational Status
   * Collector : status of the servlet (i.e. whether the collector accepts incoming records)
   * databaseupdate : whether the incoming record are processed or just staged.
   * replication : Whether the replication mechanism is turned on
   * datahousekeeping : status of the sub-system in charge of deletin old records
   * history : status of the sub-system in charge of compressing and deleting old historical incoming data file.

---++++List of valid status

This is the full list of possible status.

   * disabled
   * enabled
   * safe
   * running
   * sleeping
   * paused
   * stopped
   * unknown

%STOPINCLUDE%
-- Main.PhilippeCanal - 02 Jul 2008
