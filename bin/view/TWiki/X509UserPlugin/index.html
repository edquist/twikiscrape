<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> X509UserPlugin &lt; TWiki &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/TWiki/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/TWiki/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/TWiki/X509UserPlugin?_T=16 Feb 2017" type="application/x-wiki" title="edit X509UserPlugin" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/TWiki/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/TWiki/X509UserPlugin"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFD8AA ;
	}
	.patternBookView {
		border-color:#FFD8AA ;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="X509UserPlugin"></a> X509UserPlugin </h1>
<p />
X509 Authentication support
<p />
This plugin supports the authentication of users using X.509 certificates.
<p />
<br /><div class="twikiToc"> <ul>
<li> <a href="?cover=print#X509UserPlugin"> X509UserPlugin</a> <ul>
<li> <a href="?cover=print#Overview"> Overview</a>
</li> <li> <a href="?cover=print#Syntax_Rules"> Syntax Rules</a> <ul>
<li> <a href="?cover=print#Common_parameters"> Common parameters</a> <ul>
<li> <a href="?cover=print#remove_regexp"> remove="regexp"</a>
</li> <li> <a href="?cover=print#replace_string"> replace="string"</a>
</li> <li> <a href="?cover=print#from_issuer"> from="issuer"</a>
</li> <li> <a href="?cover=print#login_DN"> login="DN"</a>
</li></ul> 
</li> <li> <a href="?cover=print#X509_element_ele_remove_regexp_r"> %X509{element="ele" remove="regexp" replace="string" login="DN" from="issuer"}%</a>
</li> <li> <a href="?cover=print#X509_getloginname_1_remove_regex"> %X509{getloginname="1" remove="regexp" replace="string" login="DN" from="issuer"}%</a>
</li> <li> <a href="?cover=print#X509_getcert_component_remove_re"> %X509{getcert="component" remove="regexp" replace="string" from="issuer"}%</a>
</li> <li> <a href="?cover=print#X509_getwikiname_1_remove_regexp"> %X509{getwikiname="1" remove="regexp" replace="string" login="DN" from="issuer"}%</a>
</li></ul> 
</li> <li> <a href="?cover=print#Examples"> Examples</a>
</li> <li> <a href="?cover=print#Plugin_Settings"> Plugin Settings</a>
</li> <li> <a href="?cover=print#Plugin_Installation_Instructions"> Plugin Installation Instructions</a> <ul>
<li> <a href="?cover=print#Configure_settings"> Configure settings</a> <ul>
<li> <a href="?cover=print#Plugins_X509UserPlugin_Debug"> {Plugins}{X509UserPlugin}{Debug}</a>
</li> <li> <a href="?cover=print#Plugins_X509UserPlugin_ForceAuth"> {Plugins}{X509UserPlugin}{ForceAuthentication}</a>
</li> <li> <a href="?cover=print#Plugins_X509UserPlugin_Registrat"> {Plugins}{X509UserPlugin}{RegistrationTopic}</a>
</li> <li> <a href="?cover=print#Plugins_X509UserPlugin_RequireWi"> {Plugins}{X509UserPlugin}{RequireWikinameFromCertificate}</a>
</li> <li> <a href="?cover=print#Plugins_X509UserPlugin_RegisterI"> {Plugins}{X509UserPlugin}{RegisterInUsersTopic}</a>
</li> <li> <a href="?cover=print#Plugins_X509UserPlugin_RegisterU"> {Plugins}{X509UserPlugin}{RegisterUsersWithLoginName}</a>
</li> <li> <a href="?cover=print#Plugins_X509UserPlugin_Cert2Wiki"> {Plugins}{X509UserPlugin}{Cert2Wiki}</a>
</li></ul> 
</li> <li> <a href="?cover=print#Update_your_Registration_topic"> Update your Registration topic</a>
</li> <li> <a href="?cover=print#Update_your_ResetPassword_Change"> Update your ResetPassword, ChangePassword, and ChangeEmail Topics</a>
</li> <li> <a href="?cover=print#Webserver_configuration"> Webserver configuration</a>
</li></ul> 
</li> <li> <a href="?cover=print#Plugin_Info"> Plugin Info</a>
</li></ul> 
</li></ul> 
</div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Overview"></a> Overview </span></h2>
This plugin relies on the X509UserMapping, X509Login and X509PasswdUser modules, which are included in the kit.
<p />
As a whole, this allows TWiki contributors to be automagically identified by X.509 certificate (long a wish listed in, for example: <a href="http://twiki.org/cgi-bin/view/TWiki/TWikiUserAuthentication" target="_top">The TWiki User Authentication topic</a>.
<p />
This plugin is used in the administration of a TWiki, and is not particularly useful for other contributors.
<p />
There are a number of configurable policy options, discussed below. However, I'm sure I didn't anticipate everyone's requrements - I stopped a while after I met mine.
<p />
The plugin proper allows you access to fields in the user certificate. This is used on the <a href="/bin/view/TWiki/TWikiRegistration" class="twikiLink">TWikiRegistration</a> topic (Yours should, of course be in <span class="twikiNewLink">TWikiRegistration<a href="/bin/edit/Main/TWikiRegistration?topicparent=TWiki.X509UserPlugin" rel="nofollow" title="TWikiRegistration (this topic does not yet exist; you can create it)">?</a></span>), where it allows you to specify most of the form fields from the certificate.
<p />
The %X509 variable can not be used on other pages unless you have CHANGE access to the Registration topic because a malicious user could mis-use it to expose arbitrary TWiki server state.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Syntax_Rules"></a> Syntax Rules </span></h2>
<p />
There are several syntaxes for the %X509% variable. First, the syntax of an X.509 Distinguished Name (DN):
<p />
An X.509 certificate's distingushed name looks like:
<pre>/C&#61;US/ST&#61;NewYork/L&#61;Albany/O&#61;Megalith Corporation/OU&#61;Executives/OU&#61;Wayward/CN&#61;Myway, Lost II/emailAddress&#61;rich&#64;megalith.example.com</pre>
<p />
A typical X.509 certificate has 2 Distinguished Names: that of the certificate's <em>issuer</em> and that of the <em>subject</em>. The issuer is the authority that asserts that the certificate content is valid. The subject is the person (or in some cases, thing) that is being identified. As used here, the subject is the TWiki user. Thus, the subject's DN is of primary interest for authentication.
<p />
The subject's DN is placed in the <code>SSL_CLIENT_S_DN</code> environment variable by the webserver. It's also placed in the <code>REMOTE_USER</code> variable under <code>FakeBasicAuth</code>, which is the environment expected by this plugin.
<p />
Each /XX= is called an <em>element.</em> An element can occur multiple times; in the example, <strong>Executives</strong> and <strong>Wayard</strong> are both occurances of the <strong>OU</strong> element. TWiki's X509 subsystem names the first occurance <strong>OU</strong> and the second <strong>OU.2</strong>. The next would be <strong>OU.3</strong> and so on.
<p />
With OpenSSL, you can extract the DN from a certificate in PEM format using :
<p />
<code>openssl x509 -noout -subject -inform pem <font color="#000000">(or </font>der<font color="#000000">)</font> -in <font color="#000000">filename</font></code>
<p />
The %X509 variable returns certificate-related information, primarily from the client certificate.
<p />
<h3><a name="Common_parameters"></a> Common parameters </h3>
The following optional parameters are used by more than one form of the %X509% variable.
<p />
<h4><a name="remove_regexp"></a> remove="regexp" </h4>
The value returned by the %X509% variable is modified by applying <font color="#800000">regexp</font> as the left side of a <font color="#800000"> <strong>s///</strong> </font>operator. This usually specifies what string is to be removed from the value, although the full power of <font color="#800000"> <strong>s///</strong> </font>is available.
<p />
<h4><a name="replace_string"></a> replace="string" </h4>
When the <font color="#800000">remove</font> parameter is specified, <font color="#800000">replace</font> specifies the replacement string. You can specify backreferences to make the substitution as powerful as you like.
<p />
<h4><a name="from_issuer"></a> from="issuer" </h4>
To extract data from the Issuer fields of a certificate, specify <font color="#800000">from=issuer</font>. The default is <font color="#800000">from="user'</font>.
<p />
<h4><a name="login_DN"></a> login="DN" </h4>
The %X509% variable normally obtains its data from the <code>SSL_CLIENT_S_DN</code> environment variable. To use another DN, specify <font color="#800000">login="DN"</font> (in the /xx=... format). Note that this overrides <font color="#800000">from="issuer"</font> if both are specified.
<p />
<h3><a name="X509_element_ele_remove_regexp_r"></a> %X509{element="ele" remove="regexp" replace="string" login="DN" from="issuer"}% </h3>
Extracts <font color="#800000">element</font> from the certificate. Typical elements are <strong>CN</strong>, <strong>O</strong>, <strong>OU</strong>.
<p />
<h3><a name="X509_getloginname_1_remove_regex"></a> %X509{getloginname="1" remove="regexp" replace="string" login="DN" from="issuer"}% </h3>
Returns the login name (the full DN).
<p />
<h3><a name="X509_getcert_component_remove_re"></a> %X509{getcert="component" remove="regexp" replace="string" from="issuer"}% </h3>
Extracts <font color="#800000">component</font> from the certificate, contained in the <strong>SSL_CLIENT_S_<font color="#800000">component</font></strong> environment variable. This provides access to country codes (C &rArr; /C=), Localities (L &rArr; /L=), etc.
<p />
<h3><a name="X509_getwikiname_1_remove_regexp"></a> %X509{getwikiname="1" remove="regexp" replace="string" login="DN" from="issuer"}% </h3>
Computes the (probable) wikiname that would be assigned to the specified certificate at registration.
<p />
A different wikiname may be assigned - in particular, the one offered could be claimed by somone else who registers between the expansion of this variable and the registration agent's action.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Examples"></a> Examples </span></h2>
<p /> <ul>
<li> <code>%X509{getcert="Email"}%</code> &rArr; rich@megalith.example.com
</li> <li> <code>%X509{"CN"}%</code> &rArr; Myway, Lost II
</li> <li> <code>%X509{"CN" remove="^.*, "}%</code> &rArr; Myway
</li> <li> <code>%X509{"CN" remove="^(.*), (.*$)" replace="$2$1"}%</code> &rArr; LostIIMyway
</li> <li> <code>%X509{"emailAddress" from="issuer" remove="(?:\@(.*))$" replace=" at $1.NOSPAM" }%</code> &rArr; certificates at security.megalith.example.com.NOSPAM
</li> <li> <code>%X509{"CN" from="issuer"}%</code> &rArr; Megalith Certificate Authority
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Plugin_Settings"></a> Plugin Settings </span></h2>
<p />
All settings for this plugin are stored in the configure database, and are managed by the system administrator. They are described below.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Plugin_Installation_Instructions"></a> Plugin Installation Instructions </span></h2>
<p />
<strong><em>Note:</em></strong> You do not need to install anything on the browser to use this plugin. The following instructions are for the administrator who installs the plugin on the TWiki server.
<p /> <ul>
<li> Download the ZIP file from the Plugin Home (see below)
</li> <li> Unzip <strong>X509UserPlugin.zip</strong> in your twiki installation directory. Content:
</li></ul> 
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/TWiki/X509UserPlugin?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">File:</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1 twikiLastCol"> <a rel="nofollow" href="/bin/view/TWiki/X509UserPlugin?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Description:</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <code><b>data/TWiki/X509UserPlugin.txt</b></code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> Plugin topic </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> <code><b>data/Trash/SandboxTWikiRegistration.txt</b></code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> Sample registration topic </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <code><b>lib/TWiki/Plugins/X509UserPlugin.pm</b></code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> Perl module </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> <code><b>lib/TWiki/Plugins/X509UserPlugin/Config.spec</b></code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> Configure specification </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <code><b>lib/TWiki/Configure/Checkers/Plugins/X509UserPlugin/System.pm</b></code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> Configuration checker </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> <code><b>lib/Twiki/LoginManager/X509Login.pm</b></code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> Perl module </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <code><b>lib/TWiki/Users/X509PasswdUser.pm</b></code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> Perl module </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> <code><b>lib/TWiki/Users/X509UserMapping.pm</b></code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> Perl module </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <code><b>lib/TWiki/Users/X509UserMapping/Cert.pm</b></code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> Perl module </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p /> <ul>
<li> Prepare your environment  <ul>
<li> If you have previously been using Apache login, edit your .htpasswd file to include <a href="/bin/view/TWiki/WikiName" class="twikiLink">WikiName</a> before the email field.
</li> <li> Modify your webserver's configuration to support SSL and FakeBasicAuth - see below for an example.
</li></ul> 
</li> <li> Configure the Plugin:  <ul>
<li> TWiki 4.0 and up: Run the <a href="https://twiki.opensciencegrid.org/bin/configure" target="_top">configure</a> script to enable the Plugin
</li> <li> Change the Plugin settings as needed
</li> <li> Update your Registration topic
</li></ul> 
</li> <li> Test if the installation was successful:  <ul>
<li> Register and login
</li></ul> 
</li></ul> 
<p />
<h3><a name="Configure_settings"></a> Configure settings </h3>
Here are the configure settings for this facility.
<p />
<h4><a name="Plugins_X509UserPlugin_Debug"></a> {Plugins}{X509UserPlugin}{Debug} </h4>
Enables debugging - currently mostly log messages from the plugin. May be useful to determine why things aren't working as you expect.
<p />
<h4><a name="Plugins_X509UserPlugin_ForceAuth"></a> {Plugins}{X509UserPlugin}{ForceAuthentication} </h4>
Because X.509 Certificates are automatically presented by the browser (assuming your webserver is properly setup), it is convenient to automagically login every user. Enable this option to cause authentication requests for all views except your registration page.
<p />
To force authentication for other scripts, add them to the {AuthScripts} configuration variable
<p />
<h4><a name="Plugins_X509UserPlugin_Registrat"></a> {Plugins}{X509UserPlugin}{RegistrationTopic} </h4>
The topic name (Don't include the webname, which is either the main or the twiki web) of the user registration topic - normally <span class="twikiNewLink">SandboxTWikiRegistration<a href="/bin/edit/Trash/SandboxTWikiRegistration?topicparent=TWiki.X509UserPlugin" rel="nofollow" title="SandboxTWikiRegistration (this topic does not yet exist; you can create it)">?</a></span>. Only this topic (or users with CHANGE access to it) can use the X509 variable. Only this topic will bypass {ForceAuthentication}. Changing and renaming this topic should be restricted to the <span class="twikiNewLink">TwikiAdminGroup<a href="/bin/edit/TWiki/TwikiAdminGroup?topicparent=TWiki.X509UserPlugin" rel="nofollow" title="TwikiAdminGroup (this topic does not yet exist; you can create it)">?</a></span>.
<p />
<h4><a name="Plugins_X509UserPlugin_RequireWi"></a> {Plugins}{X509UserPlugin}{RequireWikinameFromCertificate} </h4>
Select this option to force a user's <a href="/bin/view/TWiki/WikiName" class="twikiLink">WikiName</a> to be derived from his/her X.509 distingushed name. When not selected, the user's <a href="/bin/view/TWiki/WikiName" class="twikiLink">WikiName</a> is suggested from the certificate name, but can be overridded by the registration form.
<p />
<h4><a name="Plugins_X509UserPlugin_RegisterI"></a> {Plugins}{X509UserPlugin}{RegisterInUsersTopic} </h4>
Select this option if you want users registerd in the %UsersWeb.%UsersTopicName%. This is handy, but not required.
<p />
<h4><a name="Plugins_X509UserPlugin_RegisterU"></a> {Plugins}{X509UserPlugin}{RegisterUsersWithLoginName} </h4>
<p />
X.509 certificate names not only look like line noise, they often contain characters that will confuse TWiki if they are placed on the Users Topic. By default, they are omitted. If you really want to deal with the problems, set this option.
<p />
<h4><a name="Plugins_X509UserPlugin_Cert2Wiki"></a> {Plugins}{X509UserPlugin}{Cert2Wiki} </h4>
<p />
Certificate authorities vary greatly in how they format a DN.
<p />
While the X509UserMapping code isn't infinitely flexible, it does allow the TWiki administrator to specify how to derive a wikiname from their certificates' DNs.
<p />
{X509UserPlugin}{Cert2Wiki} specifies the algorithm as a mapping string.
<p />
The mapping string is parsed into commands to fetch and format elements of the DN. The string is applied to the DN iteratively.
<p />
Each pass applies all the commands specified for that pass. If the resultingWikiname is unique, it stops. If not, it tries again, adding the commands for the next pass.
<p />
If the name still isn't unique after all commands have been tried, a sequence number is added to the result of the last pass.
<p />
Commands in the mapping string are separated by spaces.
<p />
Each command consists of optional flags, an element name, and an optional formatter.
<p />
The flags are: <ul>
<li> <strong>^</strong> will ucfirst each word in an element of the DN
</li> <li> <strong>n?</strong> - will add this element in the nth pass only if the generated name is ambiguous at the start of the pass.
</li></ul> 
<p />
The <strong>element name</strong> is as found in the DN. If a name (such as OU) occurs more than once, the second occurance will be name.2; the third name.3 and so on.
<p />
The formatter is applied to the element as an s/// command. The formatter must contain its delimiters, and any flags. You can use this to extract or re-order subfields of an element, or pretty much anything else that's necessary.
<p />
After the formatter runs, any remaining spaces are removed (they're not valid in a wikiname).
<p />
A given element can be used as many or as few times as required. If an element isn't present in a particular certificate, its formatter will not be applied.
<p />
If the formatter is sufficiently ugly, you may need to quote the whole command.
<p />
Some examples:
<p />
The default of <code>^CN</code> will give <code>/CN=John a McSmith</code> the <a href="/bin/view/TWiki/WikiName" class="twikiLink">WikiName</a> <font color="#0000ff">JohnAMcSmith</font>.
<p />
<code>"^CN/(\w+), <strong>(.</strong>)/$2$1/" ^OU.2</code> would give <code>/OU=megalith/OU=widget sales/CN=smith, jan</code> the <a href="/bin/view/TWiki/WikiName" class="twikiLink">WikiName</a> <font color="#0000ff">JanSmithWidgetSales</font>.
<p />
If you want the first <code>smith, jan</code> to be <font color="#0000ff">JanSmith</font>, but subsequent to be <font color="#0000ff">JanSmithWidgetSales</font>, you might use <code>"CN{^(\w+),\s*(.*)$}($2$1)" ^1?OU.2/^([\w\s-]*?)(Department|Dept|Group|Team).*$/$1/</code>
<p />
There's quite a bit of room for creativity to mapthe often stilted formats used by the Certificate Authorities into friendly <a href="/bin/view/TWiki/WikiName" class="twikiLink">WikiNames</a>. Or not - whatever meets your needs.
<p />
Quotes are necessary only if you embed spaces in your regexp. You can \-quote your quote - but any other \ is sent as-is to the s-command.
<p />
<h3><a name="Update_your_Registration_topic"></a> Update your Registration topic </h3>
A sample is provided in the sandbox. You'll want to update it with your rules for filling out the fields from your certificates. The sample may work for you if your CN fields are Firstname {middle names, intitials...} Last name.
<p />
<h3><a name="Update_your_ResetPassword_Change"></a> Update your ResetPassword, ChangePassword, and ChangeEmail Topics </h3>
These don't apply to X.509 authentication - or when they do, they're some site-specific means of communicating with some other server. How to do that is beyond the scope of this document.
<p />
If you have a simple environment, you can simply make these topic say "No" (politely, of course.)
<p />
<h3><a name="Webserver_configuration"></a> Webserver configuration </h3>
Your webserver needs to be configured for SSL. Here is an extract of mine - an apache server. The key is how the <code>bin</code> directory is setup. You also need to setup the webserver's certificates - that's well documented elsewhere. <pre>
    DocumentRoot &#34;/var/www/twiki/webroot&#34;
    SSLOptions +FakeBasicAuth +StrictRequire +OptRenegotiate
    SSLVerifyClient require
    SSLVerifyDepth  10

    ScriptAlias /twiki/bin &#34;/var/www/twiki/bin&#34;
    Alias /twiki &#34;/var/www/twiki&#34;

    #Default / to /bin/view (which gets the main page)
    RedirectMatch ^/$ https://wiki.example.com/twiki/bin/view

&#60;Directory &#34;/var/www/twiki/bin&#34;&#62;
    SSLOptions +StdEnvVars

    AllowOverride None
    Order Allow,Deny
    Allow from all
    Deny from env&#61;blockAccess
    Satisfy all

    Options ExecCGI FollowSymLinks
    SetHandler cgi-script

    AuthUserFile /var/www/twiki/data/.htpasswd
    AuthName &#39;Select your personal identity certificate for wiki access, or click &#34;cancel&#34; to register.&#39;
    AuthType Basic

    # File to return on access control error (e.g. no certificate)
   ErrorDocument 401 /twiki/bin/view/Main/TWikiRegistration

    &#60;FilesMatch &#34;(passwd).&#42;&#34;&#62;
   Order Deny,Allow
   Deny from all
   # The images are inserted to ensure that the error page is above the
   # microsoft threshhold (512 bytes) for &#34;friendly error messages&#34;.
   ErrorDocument 403 &#34;&#60;img src&#61;\&#34;/Images/topleftimage.gif\&#34;&#62; \
&#60;B&#62;This site is protected by X.509 certificates. Password resets are neither useful or permitted. &#60;/B&#62;\
&#60;img src&#61;\&#34;/Images/toprightimage.gif\&#34;&#62;&#34;
    &#60;/FilesMatch&#62;

    &#60;FilesMatch &#34;^(configure)$&#34;&#62;
   SetHandler cgi-script
   Order Deny,Allow
   Deny from all
   Allow from SpecificWorkstations.example.com

   AuthName &#39;example.com personal identity certificate must be authorized for wiki administrtion&#39;
   Require user   &#34;/C&#61;...&#34;

   ErrorDocument 401 default
   Satisfy all
    &#60;/FilesMatch&#62;

    # When using Apache type login the following defines the TWiki scripts
    # that makes Apache ask the browser to authenticate. It is correct that
    # the view script is not authenticated, as it&#39;s used for registration.

    &#60;FilesMatch &#34;(attach&#124;edit&#124;manage&#124;rename&#124;save&#124;upload&#124;mail&#124;logon&#124;rest&#124;.&#42;auth).&#42;&#34;&#62;
   require valid-user
    &#60;/FilesMatch&#62;
&#60;/Directory&#62;
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Plugin_Info"></a> Plugin Info </span></h2>
<p /> <ul>
<li> Set SHORTDESCRIPTION = Authenticate &amp; identify users using X.509 certificates
</li></ul> 
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Plugin Author: </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <a href="http://twiki.org/cgi-bin/view/Main.TimotheLitt" title="'Main.TimotheLitt' on TWiki.org">TWiki:Main.TimotheLitt</a> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Copyright: </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> © 2007, 2008, <a href="http://twiki.org/cgi-bin/view/Main.TimotheLitt" title="'Main.TimotheLitt' on TWiki.org">TWiki:Main.TimotheLitt</a> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> License: </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> GPL (<a href="http://www.gnu.org/copyleft/gpl.html" target="_top">GNU General Public License</a>) </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Plugin Version: </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> 20 Oct 2008 (V1.0-1) </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Change History: </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <!-- versions below in reverse order --> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 26 Oct 2008: </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> V1.0-3 Correct documentation of configuration parameters </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 24 Oct 2008: </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> V1.0-2 Return better status from <span class="twikiNewLink">X509UserMapping<a href="/bin/edit/TWiki/X509UserMapping?topicparent=TWiki.X509UserPlugin" rel="nofollow" title="X509UserMapping (this topic does not yet exist; you can create it)">?</a></span>:removeUser </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 20 Oct 2008: </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> Initial version </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> TWiki Dependency: </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> $TWiki::Plugins::VERSION 1.2, TWiki 4.2.3 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> CPAN Dependencies: </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> none </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Other Dependencies: </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> none </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Perl Version: </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> 5.8.8 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <a href="http://twiki.org/cgi-bin/view/Plugins/Benchmark" title="'Plugins/Benchmark' on TWiki.org">Benchmarks</a>: </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <a href="/bin/view/TWiki/GoodStyle" class="twikiLink">GoodStyle</a> nn%, <a href="/bin/view/TWiki/FormattedSearch" class="twikiLink">FormattedSearch</a> nn%, <a href="/bin/view/TWiki/X509UserPlugin" class="twikiCurrentTopicLink twikiLink">X509UserPlugin</a> nn% </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Plugin Home: </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> <a href="http://TWiki.org/cgi-bin/view/Plugins/X509UserPlugin" target="_top">http://TWiki.org/cgi-bin/view/Plugins/X509UserPlugin</a> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Feedback: </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <a href="http://TWiki.org/cgi-bin/view/Plugins/X509UserPluginDev" target="_top">http://TWiki.org/cgi-bin/view/Plugins/X509UserPluginDev</a> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Appraisal: </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> <a href="http://TWiki.org/cgi-bin/view/Plugins/X509UserPluginAppraisal" target="_top">http://TWiki.org/cgi-bin/view/Plugins/X509UserPluginAppraisal</a> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<strong><em>Related Topics:</em></strong> <a href="/bin/view/TWiki/TWikiPlugins" class="twikiLink">TWikiPlugins</a>, <a href="/bin/view/TWiki/DeveloperDocumentationCategory" class="twikiLink">DeveloperDocumentationCategory</a>, <a href="/bin/view/TWiki/AdminDocumentationCategory" class="twikiLink">AdminDocumentationCategory</a>, <a href="/bin/view/TWiki/TWikiPreferences" class="twikiLink">TWikiPreferences</a>
<p />
<br />%TOPICCREATE{ template="Plugins.PluginDevTemplate" topic="X509UserPluginDev" disable="NewPluginTemplate" parameters="pluginName=X509UserPlugin&amp;RelatedTopics=X509UserPlugin, <span class="twikiNewLink">X509UserPluginAppraisal<a href="/bin/edit/TWiki/X509UserPluginAppraisal?topicparent=TWiki.X509UserPlugin" rel="nofollow" title="X509UserPluginAppraisal (this topic does not yet exist; you can create it)">?</a></span>" }% %TOPICCREATE{ template="Plugins.PluginAppraisalTemplate" topic="X509UserPluginAppraisal" disable="NewPluginTemplate" parameters="RelatedTopics=X509UserPlugin, <span class="twikiNewLink">X509UserPluginDev<a href="/bin/edit/TWiki/X509UserPluginDev?topicparent=TWiki.X509UserPlugin" rel="nofollow" title="X509UserPluginDev (this topic does not yet exist; you can create it)">?</a></span>" }%
<p />
-- <a href="http://twiki.org/cgi-bin/view/Main.TimotheLitt" title="'Main.TimotheLitt' on TWiki.org">TWiki:Main.TimotheLitt</a> - 20 Oct 2008</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: TWiki<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/TWiki/TWikiPlugins" class="twikiLink">TWikiPlugins</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>X509UserPlugin</span> <br />    
Topic revision: r2 - 16 Aug 2011 - 13:29:10 - <a href="/bin/view/Main/KyleGross" class="twikiLink">KyleGross</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />