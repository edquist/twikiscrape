<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> JohnWeigandGratiaConfigureOsgChanges &lt; Main &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Main/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Main/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Main/JohnWeigandGratiaConfigureOsgChanges?_T=16 Feb 2017" type="application/x-wiki" title="edit JohnWeigandGratiaConfigureOsgChanges" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Main/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Main/JohnWeigandGratiaConfigureOsgChanges"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFEFA6;
	}
	.patternBookView {
		border-color:#FFEFA6;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Proposed_Change_to_configure_osg"></a> Proposed Change to configure-osg.py for Gratia </h1>
<p />
<!--
<p /> <ul>
<li> Set VIEWTHISTOPIC = <div class="twikiSmall"><a href="JohnWeigandGratiaConfigureOsgChanges">View this section</a></div>  -->
</li></ul> 
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Proposed_Change_to_configure_osg"> Proposed Change to configure-osg.py for Gratia</a> <ul>
<li> <a href="?cover=print#Description"> Description</a>
</li> <li> <a href="?cover=print#History_of_configure_osg_py_sh"> History of configure-osg.py/sh</a>
</li> <li> <a href="?cover=print#Current_Problems"> Current Problems</a>
</li> <li> <a href="?cover=print#Proposed_Change"> Proposed Change</a>
</li></ul> 
</li></ul> 
</div>
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Description"></a> Description </span></h2>
<div class="twikiSmall"><a href="JohnWeigandGratiaConfigureOsgChanges">View this section</a></div> 
<p />
The configuration of the ProbeConfig file is performed by the VDT <em>configure_gratia</em> script with is run each time the <em>configure-osg.py/sh</em> script is run.  Recent changes have been made to the <em>configure_gratia</em> script to avoid the overwriting (as in changing various attributes) that may have been manually changed.
<p />
These modifications were required because the <em>configure-osg.py</em> .ini file does not contain these attributes.  So when <em>configure-osg.py</em> is executed for other changes, it spawns <em>configure_gratia</em> with default values thus overwriting manual changes. 
<p />
The "--force-probe-config" option that was added to the <em>configure_gratia</em> is really a band-aid solution.  The critical gratia attributes should be added to the <em>configure-osg.py</em> .ini files for a more effective long-term solution.
<p />
Currently, the only attribute the OSG <em>full-config.ini</em> file has for Gratia is: <ul>
<li> enable_gratia = %(disable)s
</li></ul> 
<p />
If Gratia is enabled, the configure-osg.py script will execute <em>configure_gratia</em> twice, once for the batch queue manager probe and once for the rsv metric probe:
<pre>
Configuring Gratia now.
Configuring Gratia to report to ITB server
Executing configure&#95;gratia as:
/usr/local/osg-ce/vdt/setup/configure&#95;gratia
--probe-cron
--site-name ITB&#95;INSTALL&#95;TEST&#95;2
--report-to gratia.opensciencegrid.org:8881
--probe condor

Configuring Gratia to report to ITB server
Executing configure&#95;gratia as:
/usr/local/osg-ce/vdt/setup/configure&#95;gratia
--probe-cron
--site-name ITB&#95;INSTALL&#95;TEST&#95;2
--report-to gratia.opensciencegrid.org:8881
--report-to rsv-itb.grid.iu.edu:8880
--probe metric
</pre>
<p />
<em>Note:</em> In the above execution of the rsv metric probe, there appears to be a bug as <em>configure_gratia</em> is executed with 2 '--report-to' arguments.  It does not affect the results since the rsv 'report-to' is last.
<p />
<p />
The current attributes of the various gratia configuration file that are affected by <em>configure_gratia</em> are: <ol>
<li> job manager probes (condor, lsf, sge, pbs)      <pre>
    SSLHost&#61;&#34;gratia.opensciencegrid.org:8881&#34;
    SSLRegistrationHost&#61;&#34;gratia.opensciencegrid.org:8881&#34;
    SOAPHost&#61;&#34;gratia.opensciencegrid.org:8881&#34;
    SiteName&#61;&#34;ITB&#95;INSTALL&#95;TEST&#95;2&#34;
    MeterName&#61;&#34;condor:cms-xen1.fnal.gov&#34;
      </pre> <ul>
<li> SSLHost / SSLRegistrationHost / SOAPHost -   set by the '--report-to' argument and based on whether the Site Information section / group attribute of the .ini file is OSG or OSG-ITB
</li> <li> SiteName - set based based on the Site Information section / site_name attribute of the .ini file
</li> <li> MeterName - set based on the 'enabled' attribute of the batch queue manager section of the .ini file.
</li></ul> 
</li></ol> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="History_of_configure_osg_py_sh"></a> History of configure-osg.py/sh </span></h2>
The various services (e.g., Gratia, <a href="/bin/view/Trash/ReleaseDocumentationMonALISA" class="twikiLink">ReleaseDocumentationMonALISA</a>, GIP, RSV, gridftp, etc)  that run on a given node, in many cases, share some common information.  Each has its own configuration file(s).  Insuring consistency of the common data across these various services was a serious problem.
<p />
The <em>configure-osg.py/sh</em> scripts were created to provide a single point of configuration data for a node and handled the consistency issue. The <em>configure-osg.sh</em> script is being deprecated in favor of <em>configure-osg.py</em> which uses an editable configuration file in place of a question/answer  method.   So these changes are directed at the <em>configure-osg.py</em> script and configuration files.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Current_Problems"></a> Current Problems </span></h2>
As the Gratia probes evolved and multiplied, data needed in its configuration files were addressed solely in the VDT <em>configure_gratia</em> script.  Since the <em>configure-osg-py</em> is run any time a change is made to configuration data, changes to gratia confguration data was affected.  This was fine unless an administrator made manual changes to one of the configuration files.  It would then get over-written by the default values in <em>configure-osg.py</em> .
<p />
While the '--force-probe-config' option allows you to make changes to the ProbeConfig file independent of the <em>configure-osg.py</em> <em>full-config.ini</em> file, it defeats the original intent  of that file and process.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Proposed_Change"></a> Proposed Change </span></h2>
I am proposing that the following attributes be added to the OSG's <em>full-config.ini</em> file for Gratia: <ul>
<li> enable_gratia = %(disable)s
</li> <li> gratia_report_to_host = %(default)s<br />          . defaults:<br />              Site Information section / group attribute = OSG, then gratia.opensciencegrid.org:8880<br />              Site Information section / group attribute = OSG-ITB, then gratia.opensciencegrid.org:8881<br />              If 'default not specified, use the value.<br />             This change is especially critical if Gratia gets deployed at site(s) for collection of local accounting data.
</li></ul> 
<p />
<p />
<p />
<p />
<p />
<p />
<p />
-- <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a> - 18 Nov 2008</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Main<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Main/TWikiUsers" class="twikiLink">TWikiUsers</a> &gt; <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>JohnWeigandGratiaConfigureOsgChanges</span> <br />    
Topic revision: r2 - 07 Feb 2017 - 19:16:29 - <a href="/bin/view/Main/BrianBockelman" class="twikiLink">BrianBockelman</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />