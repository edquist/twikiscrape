<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> LBStashCache &lt; Main &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Main/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Main/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Main/LBStashCache?_T=16 Feb 2017" type="application/x-wiki" title="edit LBStashCache" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Main/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Main/LBStashCache"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFEFA6;
	}
	.patternBookView {
		border-color:#FFEFA6;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TABLEPLUGIN_table1--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
</style>
<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <style type="text/css">
code em, pre em { color: red; font-weight: normal; font-style: normal; }
</style>
<p />
<h1><a name="Installing_and_Using_StashCache"></a> Installing and Using StashCache </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Installing_and_Using_StashCache"> Installing and Using StashCache</a> <ul>
<li> <a href="?cover=print#About_This_Guide"> About This Guide</a>
</li> <li> <a href="?cover=print#Before_Starting"> Before Starting</a>
</li> <li> <a href="?cover=print#Installing_the_StashCache_daemon"> Installing the StashCache daemon</a>
</li> <li> <a href="?cover=print#Configuring_StashCache"> Configuring StashCache</a> <ul>
<li> <a href="?cover=print#Modifying_the_XRootD_configurati"> Modifying the XRootD configuration</a>
</li> <li> <a href="?cover=print#Optional_configuration"> Optional configuration</a>
</li></ul> 
</li> <li> <a href="?cover=print#Using_StashCache"> Using StashCache</a> <ul>
<li> <a href="?cover=print#Managing_StashCache_and_associat"> Managing StashCache and associated services</a>
</li> <li> <a href="?cover=print#Validating_StashCache"> Validating StashCache</a>
</li></ul> 
</li> <li> <a href="?cover=print#Getting_Help"> Getting Help</a>
</li></ul> 
</li></ul> 
</div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="About_This_Guide"></a> About This Guide </span></h2>
<p />
This document describes how to install a StashCache cache, a server that caches files locally rather than serving files to the StashCache federation. The installation utilizes XRootD and HTCondor for file storage and monitoring, respectively.
<p />
%NOTE% Currently, StashCache is only supported on EL6 hosts.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Before_Starting"></a> Before Starting </span></h2>
<p />
Before starting the installation process, consider the following points:
<p /> <ul>
<li> <strong>User IDs:</strong> If they do not exist already, the installation will create the Linux user IDs <code>condor</code> and <code>xrootd</code>
</li> <li> <strong>Service certificate:</strong> The StashCache service uses a host certificate at <code>/etc/grid-security/host*.pem</code>
</li> <li> <strong>Network ports:</strong> The StashCache service must talk to the central collector on port 9619 (TCP) and XRootD services on port 1094 (TCP)
</li> <li> <strong>Hardware requirements:</strong> We recommend that a StashCache server has at least 10Gbps connectivity, 1TB of disk space, and 8GB of RAM.
</li></ul> 
<p />
As with all OSG software installations, there are some one-time steps to prepare in advance:
<p /> <ul>
<li> Ensure the host has <span class="twikiNewLink">a supported operating system<a href="/bin/edit/Main/SupportedOperatingSystems?topicparent=Main.LBStashCache" rel="nofollow" title="a supported operating system (this topic does not yet exist; you can create it)">?</a></span>
</li> <li> Obtain root access to the host
</li> <li> Prepare <span class="twikiNewLink">the required Yum repositories<a href="/bin/edit/Main/YumRepositories?topicparent=Main.LBStashCache" rel="nofollow" title="the required Yum repositories (this topic does not yet exist; you can create it)">?</a></span>
</li> <li> Install <span class="twikiNewLink">CA certificates<a href="/bin/edit/Main/InstallCertAuth?topicparent=Main.LBStashCache" rel="nofollow" title="CA certificates (this topic does not yet exist; you can create it)">?</a></span>
</li></ul> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Installing_the_StashCache_daemon"></a> Installing the StashCache daemon </span></h2>
<p />
The StashCache daemon consists of an XRootD server and an HTCondor-based service for collecting and reporting statistics about the cache. To simplify installation, OSG provides convenience RPMs that install all required software with a single command:
<p />
<ol>
<p />
    <li>
      <p>Clean yum cache:</p>
      <pre class="rootscreen">[root@client ~]$ yum clean all --enablerepo=*</pre>
    </li>
    <li>
      <p>Update software:</p>
      <pre class="rootscreen">[root@client ~]$ yum update</pre>
      <p>This command will update <strong>all</strong> packages on your system.</p>
    </li>
<p />
  <li>
    <p>Install the StashCache metapackage from OSG's upcoming repository:</p>
    <pre class="rootscreen">[root@client ~]$ yum install stashcache-daemon fetch-crl stashcache-cache-server --enablerepo=osg-upcoming</pre>
  </li>
  <li>
    <p>Mount the disk that will be used for the cache to <code>/stash</code>.
  </li>
</ol>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Configuring_StashCache"></a> Configuring StashCache </span></h2>
<p />
The following section describes required configuration to have a functional StashCache cache. 
<p />
<h3><a name="Modifying_the_XRootD_configurati"></a> Modifying the XRootD configuration </h3>
<p />
Modify <code>XROOTD_DEFAUL_OPTIONS</code> in the XRootD system configuration, <code>/etc/sysconfig/xrootd</code>, so that it uses the configuration file provided by the <code>stashcache-cache-server</code> package: 
<p />
<pre class="file">
XROOTD_DEFAULT_OPTIONS="-l /var/log/xrootd/xrootd.log -c <span style="background-color: #FFCCFF;">/etc/xrootd/xrootd-stashcache-cache-server.cfg</span> -k fifo"
</pre>
<p />
<a name="OptionalConfiguration"></a>
<h3><a name="Optional_configuration"></a> Optional configuration </h3>
<p />
The following configuration is not required to have a functional StashCache cache. The default configuration should be sufficient so you should make changes to the configuration only if you have specific reasons to do so.
<p />
<h4><a name="Adjust_disk_utilization"></a> Adjust disk utilization </h4>
To adjust the disk utilization of your StashCache cache, modify the values of <code>pfc.diskusage</code> in <code>/etc/xrootd/xrootd-stashcache-cache-server.cfg</code>:
<pre class="file">
pfc.diskusage <span style="background-color: #FFCCFF;">0.98 .99</span>
</pre>
<p />
The first value and second values correspond to the low and high usage watermarks, respectively, in percentages. When the high watermark is reached, the XRootD service will automatically purge cache objects down to the low watermark. 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Using_StashCache"></a> Using StashCache </span></h2>
<p />
<h3><a name="Managing_StashCache_and_associat"></a> Managing StashCache and associated services </h3>
Ensure that your <code>/stash</code> disk is mounted, and then start the <code>fetch-crl</code> and <code>condor</code> service:
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <font color="#252b37">Software</font> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1"> <font color="#252b37">Service name</font> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <font color="#252b37">Notes</font> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Fetch CRL </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> On EL 6: <code>fetch-crl-boot</code> and <code>fetch-crl-cron</code> <br />     On EL 5: <code>fetch-crl3-boot</code> and <code>fetch-crl3-cron</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> See <span class="twikiNewLink">CA documentation<a href="/bin/edit/Main/InstallCertAuth?topicparent=Main.LBStashCache" rel="nofollow" title="CA documentation (this topic does not yet exist; you can create it)">?</a></span> for more info </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> HTCondor </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLast"> <code>condor</code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> &nbsp; </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
Start the services in the order listed and stop them in reverse order. As a reminder, here are common service commands (all run as <code>root</code>):
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <font color="#252b37">To &hellip;</font> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1 twikiLastCol"> <font color="#252b37">Run the command &hellip;</font> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Start a service </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <code>service <em>SERVICE-NAME</em> start</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Stop a service </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> <code>service <em>SERVICE-NAME</em> stop</code> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Enable a service to start during boot </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <code>chkconfig <em>SERVICE-NAME</em> on</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Disable a service from starting during boot </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> <code>chkconfig <em>SERVICE-NAME</em> off</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<h3><a name="Validating_StashCache"></a> Validating StashCache </h3>
<p />
To verify that your cache is being monitored properly, run the following command:
<p />
<pre class="screen">
[user@client ~]$ condor_status -any -l -const "Name==\"xrootd@`hostname`\""
</pre>
<p />
Where <span style="background-color: #D1CAF2;">hostname</span> is the string returned by the <code>hostname</code> command. The output of the above command should provide an HTCondor ClassAd that details the status of your cache.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Getting_Help"></a> Getting Help </span></h2>
<p />
To get assistance, please use the <a href="/bin/view/Documentation/HelpProcedure" class="twikiLink">this page</a>.</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Main<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>LBStashCache</span> <br />    
Topic revision: r4 - 02 Sep 2015 - 19:07:17 - <a href="/bin/view/Main/BrianLin" class="twikiLink">BrianLin</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />