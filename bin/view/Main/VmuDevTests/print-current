<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> VmuDevTests &lt; Main &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Main/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Main/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Main/VmuDevTests?_T=16 Feb 2017" type="application/x-wiki" title="edit VmuDevTests" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Main/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Main/VmuDevTests"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFEFA6;
	}
	.patternBookView {
		border-color:#FFEFA6;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Supporting_Developer_Tests_in_VM"></a> Supporting Developer Tests in VMU </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="About_This_Document"></a> About This Document </span></h2>
<p />
This is the design document for supporting the OSG <a href="/bin/view/SoftwareTeam/SoftwareDevelopmentProcess#TestingProcedures" class="twikiAnchorLink">developer tests</a> in our <a href="/bin/view/SoftwareTeam/TestRunsAsVMs" class="twikiLink">VM universe test suite</a> as outlined in ticket <a href="https://jira.opensciencegrid.org/browse/SOFTWARE-1733?filter=12359" target="_top">SOFTWARE-1733</a>. The requirements are as follows:
<p /> <ul>
<li> Add the ability to specify a package or list of packages and the repositories that they should come from for installation and upgrade tests.
</li> <li> <strong>ONLY</strong> install the specified packages out of the corresponding repositories. All other packages that need to be installed and/or upgraded will be pulled from the repositories that are enabled by default: osg-release, EPEL and the OS.
</li> <li> Add ability to specify a source RPM for which all of its binary RPMs will be installed and/or upgraded
</li></ul> 
<p />
The proposed solution is to allow the user to specify hashes of repositories and their corresponding packages in the <code>packages</code> lists of <code>test-parameters,yaml</code>. Additionally, they will be allowed to prefix package names with an <code>@</code> to mark them as source RPMs. This solution will only mean changes to the VMU test infrastructure in <code>vmu-reporter</code> to handle the new <code>test-parameters.yaml</code> formatting and <code>generate.dag</code> to create the osg-test configuration and new yum repo files .
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="User_Interface"></a> User Interface </span></h2>
<p />
Currently, the user can specify repositories and packages in the following way:
<p />
<pre class="file">
sources:
  - 3.1; osg			# Perform installation with osg-release enabled
  - 3.1; osg-testing            # Perform installation with osg-testing enabled in addition to osg-release
  - 3.1; osg > osg-testing	# Perform installation with osg-release enabled then upgrade with osg-testing and osg-release enabled

packages:
  - [osg-tested-internal]
  - [condor.x86_64, osg-ce-condor, rsv]
</pre>
<p />
The VMU infrastructure then runs osg-test against all the different combinations of sources, packages and platforms (not shown here). So for the HTCondor upgrade case, <code>osg-test</code> will perform the following yum commands to prepare the tests:
<p />
<pre class="rootscreen">
[root@client ~]$ yum install -y condor.x86_64
[root@client ~]$ yum install -y osg-ce-condor
[root@client ~]$ yum install -y rsv
[root@client ~]$ yum update -y --enablerepo=osg-testing
</pre>
<p />
<h3><a name="Limiting_repos_to_specific_packa"></a> Limiting repos to specific packages </h3>
<p />
To allow the user to specify pacakges to be installed out of specific repositories, we propose a new syntax in the <code>packages</code> section of the parameters file that would look like <code>{&lt;repository&gt;: &lt;list of packages&gt;}</code>. To run clean install and upgrade tests against a newly built htcondor-ce package out of development while grabbing the other packages out of release, users would write something like:
<p />
<pre class="file">
sources:
  - 3.2; osg-development
  - 3.2; osg > osg-development

packages:
  - [osg-tested-internal, {osg-development: htcondor-ce}]
</pre>
<p />
This would create a new repo file (henceforth referred to as <code>osg-development-abridged</code>) that has the same contents as <code>osg-development</code> except with <code>includepkgs=htcondor-ce</code>. The clean install tests would then perform the following yum commands:
<p />
<pre class="rootscreen">
[root@client ~]$ yum install -y osg-tested-internal --enablerepo=osg-development-abridged
[root@client ~]$ yum install -y htcondor-ce --enablerepo=osg-development-abridged
</pre>
<p />
The second yum command actually won't do anything since <code>osg-tested-internal</code> contains htcondor-ce already. And the upgrade tests would perform these yum commands:
<p />
<pre class="rootscreen">
[root@client ~]$ yum install -y osg-tested-internal
[root@client ~]$ yum update -y --enablerepo=osg-development-abridged
</pre>
<p />
<h3><a name="Installing_source_RPM_s"></a> Installing source RPM's </h3>
<p />
Another interesting feature to add would be a special syntax that would tell the VMU tests that the specified package is a source RPM, whose list of binary RPM's can be found using koji with the following shell:
<p />
<pre class="rootscreen">
[root@client ~]$ pkgs=$(koji -c /etc/osg-koji.cfg list-tagged --rpms --latest osg-3.2-el6-development vo-client \
| grep -v '\.src$' | perl -lpe 's/(-[^-]+){2}$//' | sort -u | xargs | tr ' ' , )
</pre>
<p />
This would require installing the koji client on <code>osghost.chtc.wisc.edu</code> as well as including a koji configuration to point towards OSG's koji server. A proposed syntax to designate source RPMs is to prepend the package name with an <code>@</code>. 
<p />
<pre class="file">
sources:
  - 3.2; osg-development

packages:
  - [@gums, {osg-development: @vo-client}]
</pre>
<p />
Would result in the following yum commands:
<p />
<pre class="rootscreen">
[root@client ~]$ yum install -y gums --enablerepo=osg-development-abridged
[root@client ~]$ yum install -y gums-client --enablerepo=osg-development-abridged
[root@client ~]$ yum install -y gums-service --enablerepo=osg-development-abridged
[root@client ~]$ yum install -y osg-gums-config --enablerepo=osg-development-abridged
[root@client ~]$ yum install -y vo-client --enablerepo=osg-development-abridged
[root@client ~]$ yum install -y vo-client-edgmkgridmap --enablerepo=osg-development-abridged
</pre>
<p />
If a SRPM generates binary RPMs that conflict with each other, one of the yum commands will fail. Since we don't currently prevent users from trying to install conflicting packages, we shouldn't need to add precautions for conflicting packages coming from an SRPM.
<p />
-- <a href="/bin/view/Main/BrianLin" class="twikiLink">BrianLin</a> - 23 Jan 2015</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Main<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Main/BrianLin" class="twikiLink">BrianLin</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>VmuDevTests</span> <br />    
Topic revision: r5 - 27 Jan 2015 - 17:10:14 - <a href="/bin/view/Main/BrianLin" class="twikiLink">BrianLin</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />