<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> NightlyTests &lt; SoftwareTeam &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/SoftwareTeam/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/SoftwareTeam/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/SoftwareTeam/NightlyTests?_T=16 Feb 2017" type="application/x-wiki" title="edit NightlyTests" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/SoftwareTeam/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/SoftwareTeam/NightlyTests"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#DDDDDD;
	}
	.patternBookView {
		border-color:#DDDDDD;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="OSG_Nightly_Test_Infrastructure"></a> OSG Nightly Test Infrastructure </h1>
<p />
<strong>NOTE</strong> This test infrastructure has been decomissioned as of 01/21/2014.
It has been replaced by automated tests based on HTCondor's VM universe.
This page is for archival only.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Machine_setup"></a> Machine setup </span></h2>
<p />
The test machines are VMs, hosted by the Build and Test Lab at UW-Madision.
Currently, host-2.batlab.org is the host.
They are reimaged before each test with the following distributions:
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/SoftwareTeam/NightlyTests?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Host</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1 twikiLastCol"> <a rel="nofollow" href="/bin/view/SoftwareTeam/NightlyTests?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Distribution</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> vdt-test-1.batlab.org </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> Scientific Linux 6 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> vdt-test-2.batlab.org </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> RHEL 6 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> vdt-test-3.batlab.org </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> CentOS 6 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> vdt-test-4.batlab.org </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> Scientific Linux 5 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> vdt-test-5.batlab.org </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> RHEL 5 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> vdt-test-6.batlab.org </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> CentOS 5 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Test_Sets"></a> Test Sets </span></h2>
<p />
We test installs from the osg-testing and osg-release repositories against either the latest released version of osg-test or the version in svn trunk.
Here is when the each set of tests is run.
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/SoftwareTeam/NightlyTests?cover=print;sortcol=0;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Time</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/SoftwareTeam/NightlyTests?cover=print;sortcol=1;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">OSG Repository</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/SoftwareTeam/NightlyTests?cover=print;sortcol=2;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">OSG-Test Version</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol0 twikiFirstCol"> 10 pm </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> osg-testing </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> latest in osg-testing </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" align="right" valign="top" class="twikiTableCol0 twikiFirstCol"> 12 am </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1"> osg-release </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol"> latest in osg-testing </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol0 twikiFirstCol"> 2 am </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> osg-testing </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> SVN trunk </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" align="right" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> 4 am </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLast"> osg-release </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> SVN trunk </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Scripts"></a> Scripts </span></h2>
<p />
Helper scripts run to set up the VM to run the tests, execute the tests, and collect and report the results.
The scripts are found in SVN, in <code>new-test/trunk</code>.
<p />
<h3><a name="pretest_script"></a> pretest-script </h3>
<p />
When each VM is reimaged, <code>pretest-script</code> runs first.
<code>pretest-script</code> is actually part of the VM image that gets installed onto the machine, not downloaded separately.
In case changes are made to <code>pretest-script</code>, the Batlab infrastructure people have to be notified so that they can update the VM images.
Because of this, <code>pretest-script</code> does little more than fetch <code>osg-test-wrapper</code> from SVN.
The UW-Madison members of the software team are notified if the script fails.
<p />
<h3><a name="osg_test_wrapper"></a> osg-test-wrapper </h3>
<code>osg-test-wrapper</code> does most of the work in setting up the machine and launching tests.
The script sets the test parameters (e.g. the version of <code>osg-test</code> to use) based on time of day.
This is a hack, but it works for now and is not very complicated to set up.
Afterward, <code>osg-test-wrapper</code> fetches and runs <code>bootstrap-osg-test</code> from SVN, and runs it to install the EPEL and OSG repositories, and <code>osg-test</code> itself.
If we're using <code>osg-test</code> from SVN, <code>osg-test-wrapper</code> fetches it and installs it.
<code>osg-test-wrapper</code> then runs <code>osg-test</code>, does some parsing of the results, adds a summary to the test log, and sends the result back to a UW-Madison Comp Sci machine via SCP (or via email to the osg-software mailing list email if the SCP fails).
<p />
<h3><a name="aggregator"></a> aggregator </h3>
<p />
The <code>aggregator/</code> directory contains multiple scripts that perform various operations on the test results that <code>osg-test-wrapper</code> creates.
The directory contains two library files, <code>parser.py</code> (used for parsing the test results) and <code>taglib.py</code> (helpers for generating html).
It also contains 4 scripts, all run from cron:
<p /> <ul>
<li> <code>archiver.py</code> moves fresh test results to an archive directory in AFS and deletes test results that are too old (currently defined as "older than 28 days").
</li> <li> <code>reporter.py</code> creates the html summaries at <a href="http://vdt.cs.wisc.edu/software_testing/results/index.html" target="_top">http://vdt.cs.wisc.edu/software_testing/results/index.html</a>
</li> <li> <code>emailer.py</code> creates the daily summary email and sends it out.
</li> <li> <code>dashboard.py</code> creates the OSG dashboard page at <a href="http://vdt.cs.wisc.edu/osg_dashboard.html" target="_top">http://vdt.cs.wisc.edu/osg_dashboard.html</a>
</li></ul> 
<p />
The scripts are run between 6 am and 7 am using cron as the <code>cndrutil</code> user on <code>ingwe.cs.wisc.edu</code>, from an SVN checkout of <code>new-test/trunk</code> located at <code>/p/condor/workspaces/vdt/new-test</code>. The checkout is updated before the scripts are run.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="osg_tested_internal"></a> osg-tested-internal </span></h2>
<p />
<code>osg-tested-internal</code> is a metapackage that depends on all the software that we test.
That is the package that gets installed during the nightlies.
Declaring the packages to test in a metapackage has the advantage of being simple; no code needs to be added to any of the test scripts.
It is also easy to use for when people want to duplicate the nightly tests on another machine, for example.
When we do a release, <code>osg-tested-internal</code> gets released along with everything else; this means that we won't have problems caused by forgetting to update which packages we test after a release.
The major downside to this method is that if any of the dependencies of the metapackage fail to install, then none of the dependencies will be installed and therefore no packages will be tested.
This will need to be addressed.
<p />
<!-- vim:ft=twiki
--></div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: SoftwareTeam<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/SoftwareTeam/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a> &gt; <a href="/bin/view/SoftwareTeam/InternalDocs" class="twikiLink">InternalDocs</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>NightlyTests</span> <br />    
Topic revision: r5 - 21 Jan 2014 - 20:24:13 - <a href="/bin/view/Main/MatyasSelmeci" class="twikiLink">MatyasSelmeci</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />