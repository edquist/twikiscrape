<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> TestingXrootdPlugins &lt; SoftwareTeam &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/SoftwareTeam/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/SoftwareTeam/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/SoftwareTeam/TestingXrootdPlugins?_T=16 Feb 2017" type="application/x-wiki" title="edit TestingXrootdPlugins" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/SoftwareTeam/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/SoftwareTeam/TestingXrootdPlugins"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#DDDDDD;
	}
	.patternBookView {
		border-color:#DDDDDD;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="XrootD_plug_ins_testing"></a>  <span class="twikiNewLink">XrootD<a href="/bin/edit/SoftwareTeam/XrootD?topicparent=SoftwareTeam.TestingXrootdPlugins" rel="nofollow" title="XrootD (this topic does not yet exist; you can create it)">?</a></span> plug-ins testing </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#1_About_This_Document">1  About This Document</a>
</li> <li> <a href="?cover=print#2_About_XrootD">2  About XrootD</a>
</li> <li> <a href="?cover=print#3_Requirements">3  Requirements</a>
</li> <li> <a href="?cover=print#4_Hadoop_name_node_installation">4  Hadoop name node installation:</a>
</li> <li> <a href="?cover=print#5_Hadoop_data_node_installation">5  Hadoop data node installation</a>
</li> <li> <a href="?cover=print#6_Gridftp_installation">6  Gridftp installation</a>
</li> <li> <a href="?cover=print#7_Testing_instructions">7  Testing instructions</a>
</li> <li> <a href="?cover=print#8_On_the_name_node">8  On the name node:</a>
</li></ul> 
</div>
<p />
<h1><a name="1_About_This_Document"></a> 1  About This Document </h1>
<p />
<img width="16" alt="hand" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/hand.gif" height="16" border="0" /> This document is intended for OSG Software/Release teams to gather information on testing <span class="twikiNewLink">XrootD<a href="/bin/edit/SoftwareTeam/XrootD?topicparent=SoftwareTeam.TestingXrootdPlugins" rel="nofollow" title="XrootD (this topic does not yet exist; you can create it)">?</a></span> plug-ins
<p />
<h1><a name="2_About_XrootD"></a> 2  About <span class="twikiNewLink">XrootD<a href="/bin/edit/SoftwareTeam/XrootD?topicparent=SoftwareTeam.TestingXrootdPlugins" rel="nofollow" title="XrootD (this topic does not yet exist; you can create it)">?</a></span> </h1>
<p />
<h1><a name="3_Requirements"></a> 3  Requirements </h1>
<p /> <ul>
<li> There nodes with  root access
</li></ul> 
<p />
<h1><a name="4_Hadoop_name_node_installation"></a> 4  Hadoop name node installation: </h1>
<p />
Use the following script with option 1:
<p />
<pre class="file">
#!/bin/bash
set -e

select NODETYPE in namenode datanode gridftp; do
  [[ $NODETYPE ]] && break
done
case $NODETYPE in
  namenode ) NAMENODE=$HOSTNAME ;;
         * ) read -p 'hostname for NAMENODE? ' NAMENODE ;;
esac
echo NODETYPE=$NODETYPE
echo NAMENODE=$NAMENODE
read -p 'ok? [y/N] ' ok
case $ok in
  y*|Y*) ;;  # ok
      *) exit ;;
esac
#yum install --enablerepo=osg-minefield osg-se-hadoop-$NODETYPE
yum install osg-se-hadoop-$NODETYPE
case $NODETYPE in
  namenode|datanode )
    mkdir -p /data/{hadoop,scratch,checkpoint}
    chown -R hdfs:hdfs /data
    sed -i s/NAMENODE/$NAMENODE/ /etc/hadoop/conf.osg/{core,hdfs}-site.xml
    cp /etc/hadoop/conf.osg/{core,hdfs}-site.xml /etc/hadoop/conf/
    touch /etc/hosts_exclude
    ;;
  gridftp )
    ln -snf conf.osg /etc/hadoop/conf
    sed -i s/NAMENODE/$NAMENODE/ /etc/hadoop/conf.osg/{core,hdfs}-site.xml
    echo "hadoop-fuse-dfs# /mnt/hadoop fuse server=$NAMENODE,port=9000,rdbuffer=131072,allow_other 0 0" >> /etc/fstab
    mkdir /mnt/hadoop
    mount /mnt/hadoop
    cp -v /etc/redhat-release /mnt/hadoop/test-file
    sed -i '/globus_mapping/s/^# *//' /etc/grid-security/gsi-authz.conf
    sed -i s/yourgums.yourdomain/gums.fnal.gov/ /etc/lcmaps.db
    mkdir /mnt/hadoop/fnalgrid
    useradd fnalgrid -g fnalgrid
    chown fnalgrid:fnalgrid /mnt/hadoop/fnalgrid
    service globus-gridftp-server start
    if type -t globus-url-copy >/dev/null; then
      globus-url-copy file:////bin/bash  gsiftp://$HOSTNAME/mnt/hadoop/fnalgrid/first_test
    else
      echo globus-url-copy not installed
    fi
    ;;
esac
case $NODETYPE in
  namenode ) su - hdfs -c "hadoop namenode -format" ;;
esac
service hadoop-hdfs-$NODETYPE start

</pre>
<p />
<h1><a name="5_Hadoop_data_node_installation"></a> 5  Hadoop data node installation </h1>
<p /> <ul>
<li> Run same script as before but with option number 2.
</li> <li> Install xrootd-server: <pre class="rootscreen"> yum install xrootd-server </pre>
</li> <li> Install xrootd-plugins <pre class="rootscreen"> yum install xrootd-cmstfc xrootd-hdfs</pre>
</li></ul> 
<p />
<h1><a name="6_Gridftp_installation"></a> 6  Gridftp installation </h1>
<p />
Run same as script but with option number.
<p />
<h1><a name="7_Testing_instructions"></a> 7  Testing instructions </h1>
<p />
<h1><a name="8_On_the_name_node"></a> 8  On the name node: </h1>
<p />
<pre class="rootscreen">
[root@fermicloud092 ~]# hdfs dfs -ls /test-file
Found 1 items
-rw-r--r--   2 root root          0 2014-07-21 15:57 /test-file
</pre>
<p />
This means your hadoop is working.
<p />
Modify the file <code>/etc/xrootd/xrootd-clustered.cfg</code>
to look like this:
<pre class="file">
xrd.port 1094

# The roles this server will play.                                                                                            
all.role server
all.role manager if xrootd.unl.edu
# The known managers                                                                                                          
all.manager srm.unl.edu:1213
#all.manager xrootd.ultralight.org:1213                                                                                       

# Allow any path to be exported; this is further refined in the authfile.                                                     
all.export / nostage

# Hosts allowed to use this xrootd cluster                                                                                    
cms.allow host *

### Standard directives                                                                                                       
# Simple sites probably don't need to touch these.                                                                            
# Logging verbosity                                                                                                           
xrootd.trace all -debug
ofs.trace all -debug
xrd.trace all -debug
cms.trace all -debug

# Integrate with CMS TFC, placed in /etc/storage.xml                                                                          
oss.namelib /usr/lib64/libXrdCmsTfc.so file:/etc/xrootd/storage.xml?protocol=hadoop

xrootd.seclib /usr/lib64/libXrdSec.so
xrootd.fslib /usr/lib64/libXrdOfs.so
ofs.osslib /usr/lib64/libXrdHdfs.so
all.adminpath /var/run/xrootd
all.pidpath /var/run/xrootd

cms.delay startup 10
cms.fxhold 60s
cms.perf int 30s pgm /usr/bin/XrdOlbMonPerf 30

oss.space default_stage /opt/xrootd_cache
</pre>
<p />
Create file <code>/etc/xrootd/storage.xml</code> and place this:
<p />
<pre>
&#60;storage-mapping&#62;
&#60;lfn-to-pfn protocol&#61;&#34;hadoop&#34; destination-match&#61;&#34;.&#42;&#34; path-match&#61;&#34;.&#42;/+tmp2/test-file&#34; result&#61;&#34;/test-file&#34;/&#62;
&#60;/storage-mapping&#62;
</pre>
<p />
For el7 the instrucctions are a little bit different. See:
<p />
<a href="https://jira.opensciencegrid.org/browse/SOFTWARE-2198?focusedCommentId=334667&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-334667" target="_top">https://jira.opensciencegrid.org/browse/SOFTWARE-2198?focusedCommentId=334667&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-334667</a>
<p />
Now from a node do:
<p />
<pre class ="rootscreen">
xrdcp --debug 3 root://yourdatanode.yourdomain:1094//tmp2/test-file .
</pre>
<p />
<p />
<p />
If it is sucessful it would have tested both cmstfc and hdfs plugins
-- <a href="/bin/view/Main/EdgarFajardo" class="twikiLink">EdgarFajardo</a> - 25 Jul 2014</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: SoftwareTeam<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>TestingXrootdPlugins</span> <br />    
Topic revision: r2 - 01 Mar 2016 - 19:04:32 - <a href="/bin/view/Main/EdgarMauricioFajardoHernandez" class="twikiLink">EdgarMauricioFajardoHernandez</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />