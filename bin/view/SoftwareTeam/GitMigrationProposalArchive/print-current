<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GitMigrationProposalArchive &lt; SoftwareTeam &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/SoftwareTeam/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/SoftwareTeam/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/SoftwareTeam/GitMigrationProposalArchive?_T=16 Feb 2017" type="application/x-wiki" title="edit GitMigrationProposalArchive" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/SoftwareTeam/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/SoftwareTeam/GitMigrationProposalArchive"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#DDDDDD;
	}
	.patternBookView {
		border-color:#DDDDDD;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Switching_RPM_area_native_redhat"></a> Switching RPM area (/native/redhat) to Git (on hold) </h1>
Note: This proposal is on hold. See <a href="/bin/view/SoftwareTeam/GitMigrationProposal" class="twikiLink">GitMigrationProposal</a> for the proposal that's live.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Additional_Objectives"></a> Additional Objectives </span></h2>
In addition to objectives listed in the software area migration topic,
these are also necessary:
<p /> <ul>
<li> Trusted contributors (people with Koji accounts) should be able to make scratch builds from non-authoritative repos
</li> <li> Only team members should be able to make non-scratch builds
</li> <li> Non-scratch builds should only be made from authoritative repos
</li> <li> Existing repo branch / tag safeguards (e.g. builds from <code>hcc</code> repo only accepted into the <code>hcc*</code> tags) must continue to function
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Architecture"></a> Architecture </span></h2>
Same architecture as the software area.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Usage"></a> Usage </span></h2>
<p />
<h3><a name="Contributions"></a> Contributions </h3>
Same method as the software area.
<p />
<h3><a name="Scratch_Builds_by_Anyone_From_An"></a> Scratch Builds by Anyone From Anywhere </h3>
<p />
<strong>TODO</strong> Need to research how this is possible. We may not be able to enforce this
at the Koji level, but might have to do it in osg-build.
<p />
<h3><a name="Non_Scratch_Builds_by_Team_Membe"></a> Non-Scratch Builds by Team Members Only From Authoritative Repos </h3>
<p />
This is how things currently are. We would need to make no changes other than
changing the repo URLs in the Koji configs. <strong>TODO</strong> Research if it is possible
to keep this restriction while still removing the scratch build restriction.
<p />
<h3><a name="Repo_Tag_Safeguards"></a> Repo / Tag Safeguards </h3>
<p />
Requires changes to osg-build. We can't completely lock things down, as all
osg-build safeguards can be bypassed by using Koji commands directly.
<p />
<h3><a name="Documentation"></a> Documentation </h3>
<p />
We will need separate documentation for team members (read: people who
can merge pull requests), and for other contributors. We should have
information about branch layout, best practices, common workflows, etc.
Docs on how to submit builds might need to be updated.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Migration"></a> Migration </span></h2>
<p />
<h3><a name="Difficulties"></a> Difficulties </h3>
<p />
Our SVN repo contains many different projects, and generally each one has its
own set of <code>trunk/</code>, <code>branches/</code>, <code>tags/</code> directories. We can do this in SVN
because a branch or a tag is just another directory, and merges can happen
between any two directories.
<p />
In Git, such a structure is impossible. Branches and tags are global to the
entire repository and merges happen between branches, not between directories.
Therefore, the only way to migrate our SVN repo is to split it up into multiple
repos, one per project.
<p />
We should to create an <code>authors</code> file that maps the authors of SVN commits to
real names and email addresses.
<p />
We will need to rewrite any hooks that we have (such as the post-commit email).
<p />
We need to evaluate how well the conversion tools keep track of renames,
especially when an entire project gets renamed.
<p />
We will <strong>not</strong> remove the old SVN repo after conversion, but keep them for
historical reasons. We may disable commits to it, though. This also allows us
to skip migrating subtrees which are no longer in use.
<p />
<h3><a name="Directories_to_Migrate"></a> Directories to Migrate </h3>
<p />
<h4><a name="Software_Area_software"></a> Software Area (/software/*) </h4>
<p />
The majority of projects here already have the standard SVN layout. Those that
don't have a single directory that corresponds to trunk. Git easily handles
either case.
<p />
<h4><a name="access_pacman_rsv_donotuse_osg_e"></a> /access, /pacman, /rsv.donotuse, /osg-edu, /sandbox, /utils </h4>
<p />
<p />
These will not be migrated. /access and /utils are empty. /pacman and
/rsv.donotuse may have historical value, but will not get new updates. /sandbox
is unnecessary: people have their own repos they can play around with.
<p />
<h4><a name="certs_ligo_nees_ft_teragrid_test"></a> /certs, /ligo, /nees-ft, /teragrid, /tests, /vdt </h4>
<p />
These are old projects and have not been committed to in years. We will evaluate
whether to migrate, not migrate, or defer migration to a later date.
<p />
<h4><a name="new_test"></a> /new-test </h4>
<p />
Has a standard SVN layout and will be its own repo.
<p />
<h4><a name="native"></a> /native </h4>
<p />
This directory has its own set of challenges. See "Migrating the Native Area"
below.
<p />
<h3><a name="Available_Software_for_Migration"></a> Available Software for Migration </h3>
<p />
<h4><a name="git_svn"></a> git-svn </h4>
<p />
Part of the git suite. git-svn allows bidirectional communication between Git
and SVN, i.e. you can use git-svn to create a git repo from a subtree of an SVN
repo, make your changes in the git repo, and then push the changes back to SVN.
Some developers (Matyas Selmeci, Brian Lin) already do this.
<p />
The method, if we were to use this, would be to use git-svn to make Git repos
for each SVN subtree we want to convert, clone and commit to those repos and
<em>not</em> push the commits back to SVN.
<p />
<strong>Advantages:</strong> <ul>
<li> Package available in RHEL repositories, and also available in the CSL
</li> <li> Bidirectional support allows people to try it out before switching over
</li> <li> Lots of instructions on-line
</li> <li> This is more or less the way everyone does it
</li></ul> 
<p />
<strong>Disadvantages:</strong> <ul>
<li> Apparently does not keep merge history
</li> <li> May be slow
</li></ul> 
<p />
<h4><a name="SubGit"></a> SubGit </h4>
<p />
A commercial software product specifically written to solve the limitations of
git-svn. Also bidirectional, but can do one-time imports as well. Free to
evaluate, has special licensing for Open Source projects. Matyas has used it
(albeit to do the reverse, convert from Git to SVN), and considers it very easy
to use.
<p />
The method, if we were to use this, would be to use their <code>subgit import</code>
command once per subtree. (This is their one-way conversion command).
<p />
<strong>Advantages:</strong> <ul>
<li> Does everything git-svn does, but better
</li></ul> 
<p />
<strong>Disadvantages:</strong> <ul>
<li> Not available everywhere -- Java app (though Matyas has been able to install it onto his CSL desktop)
</li> <li> Proprietary — may cost money and/or require proof of open-sourceness; however, there is an evaluation (nagware) version available, and if all we're doing is a one-time conversion, we could just install it, run it once, then uninstall it
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Migrating_the_Native_Area"></a> Migrating the Native Area </span></h2>
<p />
<h3><a name="Background"></a> Background </h3>
<p />
The /native/redhat subtree of SVN is where we keep all of our packages and is
currently the most active subtree. Getting the migration and the layout of this
area right is therefore extremely important.
<p />
<h3><a name="Problems"></a> Problems </h3>
<p />
While on the surface, this subtree appears to have the standard SVN layout
(trunk, branches, tags), several of the "branches" here are used very
differently than in normal software projects.
<p />
In a normal software project, the contents of two branches are very similar --
they usually have the same set of files, plus or minus a few. This is true for
/native/redhat/trunk and /native/redhat/branches/osg-3.1, but <strong>not</strong> true for any
of our other branches.
<p />
For example, the upcoming branch contains only a handful of packages, each
package either specifically created in the upcoming directory, or copied over
from trunk. We completely empty the upcoming branch whenever we release a new
major version (after merging the changes into trunk).
<p />
The osg-internal branch contains a few packages that are used only for building,
and will <strong>never</strong> be merged into trunk. This is not at all how a branch in a
normal software project is used.
<p />
The advantage we have here is a mostly consistent mapping of packages in SVN and
packages in Koji tags.
<p />
Another advantage we get with SVN is the ability to do partial merges -- that
is, merge only a single directory. Git cannot merge between directories, only
between branches. While we encourage developers to make one commit per
directory, if case they do not, then it will take effort to split up their
commits.
<p />
<h3><a name="Possible_Layouts"></a> Possible Layouts </h3>
<p />
<h4><a name="1_Normal_project"></a> 1. Normal project </h4>
<p />
In this layout, we treat the entire /native/redhat area as a normal
software project.  osg-3.1 will be a branch, as will upcoming. This is a
simple, obvious conversion to do. The problem will come with the
mostly-empty repos like upcoming. You won't be able to get an easy
overview of what is and what isn't in upcoming by doing an ls. At best
you can get a look at what has changed by doing 'git diff master'. We
lose the 1-1 correspondence.
<p />
<h4><a name="2_Separate_repos_for_separate_ta"></a> 2. Separate repos for separate tags </h4>
<p />
In this layout, we put /native/redhat/trunk and /native/redhat/branches/osg-3.1
in one repo, and we make separate repos for upcoming, osg-internal, and the
other.
<p />
We mostly keep the 1-1 mapping. The tricky bit is merging from upcoming to main.
We could either use git format-patch/git am, or just copy files. Either way,
merging is going to be a pain and history won't be as complete. <strong>TODO</strong>
elaborate on this
<p />
<h4><a name="3_One_repo_per_package"></a> 3. One repo per package </h4>
<p />
This may sound excessive, but it is the approach that Fedora takes. Each
package lives in its own repo that has its own set of branches that we
must keep synchronized. We would have to build a lot of tooling around
this to keep the branches consistent (make sure that the repo for each
package that's supposed to be in upcoming has an upcoming branch, for
example). This lets us make individual checkouts of packages. It also
makes merges from upcoming to trunk, etc., easy because that is the way
Git is designed to work.
<p />
The downside is that it's more to maintain, and it's hard at a glance to
do things across all packages in a tag (for example, touch everything in
upcoming).
<p />
<strong>TODO</strong> would we have to make one GitHub repo per package? Is that
allowed? Can we automate it? I notice that Fedora doesn't have a GitHub
mirror, maybe that's why...
<p />
<h4><a name="4_Keep_native_redhat_as_an_SVN_r"></a> 4. Keep native/redhat as an SVN repo, make a GitHub mirror of that </h4>
<p />
<strong>TODO</strong> Derek Weitzel (I think) already set something like that up at one
point. See if it's still up, and how he synchronizes it.
<p />
<h4><a name="5_Keep_most_of_native_redhat_as"></a> 5. Keep most of native/redhat as an SVN repo, but turn the contrib branch into its own Git repo </h4>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Case_Studies"></a> Case Studies </span></h2>
<p />
<h3><a name="Fedora_EPEL"></a> Fedora / EPEL </h3>
<a href="http://pkgs.fedoraproject.org/cgit/" target="_top">http://pkgs.fedoraproject.org/cgit/</a> and <a href="https://fedoraproject.org/wiki/Using_Fedora_GIT" target="_top">https://fedoraproject.org/wiki/Using_Fedora_GIT</a>
<strong>TODO</strong> brief description
<p />
<p />
<p />
<p />
-- <a href="/bin/view/Main/MatyasSelmeci" class="twikiLink">MatyasSelmeci</a> - 12 Jun 2014</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: SoftwareTeam<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GitMigrationProposalArchive</span> <br />    
Topic revision: r1 - 12 Jun 2014 - 19:54:10 - <a href="/bin/view/Main/MatyasSelmeci" class="twikiLink">MatyasSelmeci</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />