<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> CaCertsAutoUpdaterDesignDocument &lt; SoftwareTeam &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/SoftwareTeam/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/SoftwareTeam/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/SoftwareTeam/CaCertsAutoUpdaterDesignDocument?_T=16 Feb 2017" type="application/x-wiki" title="edit CaCertsAutoUpdaterDesignDocument" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/SoftwareTeam/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/SoftwareTeam/CaCertsAutoUpdaterDesignDocument"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#DDDDDD;
	}
	.patternBookView {
		border-color:#DDDDDD;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Proposed_Design_for_CA_Certs_Aut"></a> Proposed Design for CA-Certs Auto-Updater package </h1>
<p />
In OSG 3.x, the most natural way to manage CA certificates is via the yum command-line tool, which can both install and update packages. However, unlike other mechanisms for installing and updating CA certificates, there is currently no tool for updating the CA certificates (and only the CA certificates) automatically and periodically. This page describes a new, simple tool that site administrators can use to perform auto-updates of just the CA certificates.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Overview"></a> Overview </span></h2>
<p />
Essentially, the tool consists of a simple script that runs a “yum update” command on just the CA certificate packages. Nearly all of the remaining details are about controlling the execution of that script.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Description"></a> Description </span></h2>
<p />
A Python script running from cron is suitable enough for this. Condor-Cron was considered, but it was decided that Condor-cron is not appealing to some site administrators, and that we can and will work around cron’s deficiencies within the script itself.
<p />
The script will update CA certificate packages by running “yum update” on all of the individual <code>*-ca-certs</code> package names (e.g., <code>osg-ca-certs</code>, <code>igtf-ca-certs</code>). Any given machine will have only one of the (currently) four mutually exclusive CA certificate packages installed; for the three not-installed packages, the yum command will issue a warning. Because of this, we are safe from a potential error caused by the software trying to install one ca-certs package on top of a different ca-certs package.
<p />
We maintain the ca-certs packages, so we have full control over the dependencies they bring in. Because of this, we insure that no other parts of the user’s system are touched by updating the ca-certs packages.
<p />
In order to reduce load on the repositories caused by multiple sites' systems all trying to update at the same time, the script will have a “random delay” option.
If this option is set, the script will wait for a random amount of time before trying to update.
<code>fetch-crl</code> also does this.
<p />
<code>yum</code> comes with locking built-in; if an existing yum process is running, a new yum process will wait until the previous one is finished before starting.
Because of this, we are not susceptible to problems caused by multiple copies of the script running simultaneously.
<p />
The updater script will write the time of the last successful update into a file.
Upon running, the script will compare the current time with the time of the last successful update.
The script will have a "minimum age" option to have a minimum elapsed time before attempting to update.
This allows us to avoid problems caused by (a) the system/crond being down when the update is scheduled, or (b) transient errors when the update is scheduled.
We can also have the script raise an error if an update was unsuccessful and the last successful update was too far in the past (as determined by a "maximum age" option).
<code>fetch-crl</code> also does the latter.
<p />
The RPM will install the cron job into <code>/etc/cron.d</code>.
There will be an init script in <code>/etc/rc.d/init.d</code> which, if started, creates a lock file under <code>/var/lock/subsys</code>; and if stopped, will remove the lock file.
The cron job will check for the existence of the lock file and it will not start the script if the lock file is missing.
This will make the updater look to the user as if it is a service, i.e. they start it via <code>service osg-ca-certs-updater start</code>, or enable it on boot with <code>chkconfig osg-ca-certs-updater on</code>.
<code>fetch-crl</code> also does this.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Details"></a> Details </span></h2>
<p />
<h3><a name="Package_Filesystem_Layout"></a> Package Filesystem Layout </h3>
<p /> <dl>
<dt> <code>/usr/sbin/osg-ca-certs-updater</code> </dt><dd> Main script
</dd> <dt> <code>/etc/cron.d/osg-ca-certs-updater</code> </dt><dd> Crontab entry for the script
</dd> <dt> <code>/etc/rc.d/init.d/osg-ca-certs-updater-cron</code> </dt><dd> Init script to enable/disable running the service from cron
</dd> <dt> <code>/var/lock/subsys/osg-ca-certs-updater-cron</code> </dt><dd> File which, if present, enables running the service from cron
</dd> <dt> <code>/var/lib/osg-ca-certs-updater-lastrun</code> </dt><dd> File which contains the time of the last successful run of <code>osg-ca-certs-updater</code>
</dd> <dt> <code>/usr/share/man/man8/osg-ca-certs-updater.8.gz</code> </dt><dd> Unix manual page
</dd> <dt> <code>/usr/share/doc/osg-ca-certs-updater-VERSION/README</code> </dt><dd> Brief description and notes
</dd></dl> 
<p />
<h3><a name="Command_Line_Arguments"></a> Command-Line Arguments </h3>
<p />
<pre>
   osg-ca-certs-updater &#91;options]

Options:
  -h, --help            show this help message and exit
  -a HOURS, --minimum-age&#61;HOURS
                        The time which must have elapsed since the last
                        successful run before attempting an update. If not
                        supplied or 0, always update.
  -x HOURS, --maximum-age&#61;HOURS
                        The time after the last successful run after which an
                        unsuccessful run is considered an error. If not
                        supplied or 0, all unsuccessful runs are considered
                        errors.
  -r MINUTES, --random-wait&#61;MINUTES
                        Delay for at most this many minutes before running an
                        update, to reduce load spikes on update servers. If
                        not supplied or 0, update immediately.
  -v, --verbose         Display more information.
  -q, --quiet           Only display errors.
  -l PATH, --logfile&#61;PATH
                        Write messages to this file instead of console.
  -s, --log-to-syslog   Write messages to syslog instead of console.
  --syslog-address&#61;SYSLOG&#95;ADDRESS
                        Address to use for syslog. Can be a file (e.g.
                        /dev/log) or an address:port combination. Default is
                        /dev/log.
  --syslog-facility&#61;SYSLOG&#95;FACILITY
                        The syslog facility to log to. Default is user.
</pre>
<p />
<h3><a name="Cron_Entry"></a> Cron Entry </h3>
<p />
Below is the proposed, <strong>default</strong> crontab entry to ship with the package. A site administrator can change this entry.
<p />
<pre>
# The test is reversed so the expression has an exit status of 0 if the lockfile does not exist.
0 &#42;/6 &#42; &#42; &#42; root &#91; ! -f /var/lock/subsys/osg-ca-certs-updater-cron ] &#124;&#124; osg-ca-certs-updater -a 23 -x 72 -r 30 -q
</pre>
<p />
<!-- vim:ft=twiki
--></div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: SoftwareTeam<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/SoftwareTeam/CaCertsAutoUpdate" class="twikiLink">CaCertsAutoUpdate</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>CaCertsAutoUpdaterDesignDocument</span> <br />    
Topic revision: r8 - 17 Oct 2012 - 21:05:39 - <a href="/bin/view/Main/MatyasSelmeci" class="twikiLink">MatyasSelmeci</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />