<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> MatyasSelmeciJava8UpdateInvestigation &lt; Sandbox &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Sandbox/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Sandbox/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Sandbox/MatyasSelmeciJava8UpdateInvestigation?_T=16 Feb 2017" type="application/x-wiki" title="edit MatyasSelmeciJava8UpdateInvestigation" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><meta name="robots" content="noindex,nofollow"> 
<base href="https://twiki.opensciencegrid.org/bin/view/Sandbox/MatyasSelmeciJava8UpdateInvestigation"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#DDDDDD;
	}
	.patternBookView {
		border-color:#DDDDDD;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> Java 8 Update Investigation
<p />
<p />
<h1><a name="Summary"></a> Summary </h1>
We are considering switching our software to Java 8, since Java 8 contains improvements over Java 7, and is still in active development. Our switch to Java 7 was hurried and painful, and we should investigate how to make the process easier this time.
<p />
There is no urgent need to switch as quickly as we did the last time. While Oracle has end-of-lifed Java 7, we are now using OpenJDK, obtained from the OS, and it's reasonable to expect Red Hat to support it for a long time. OpenJDK 7 is still the environment that any EL 5/6/7 machine will prefer, if multiple environments are installed.
<p />
Furthermore, we must distinguish between switching the runtime environment (JRE) only, or also switching the development environment (JDK) for our package builds. At the moment, we can only partially switch the JDK, because:
<p /> <ul>
<li> EL 5 does not have and will never have Java 8.
</li> <li> HDFS is known not to build with JDK 8.
</li></ul> 
<p />
Fortunately, the improvements we care about -- better security settings -- are in the runtime.
<p />
The drawbacks to only switching the JRE:
<p /> <ul>
<li> We would have to test software on both JRE 7 and JRE 8 because we cannot force admins to pick one over the other.
</li> <li> We may eventually be forced to switch, if our upstreams start using features only in Java 8.
</li></ul> 
<p />
<p />
Testing the JRE switch should be fairly simple and does not require rebuilding the packages, because multiple JRE versions can live side-by-side and we can configure our software to use a particular JRE.
<p />
<p />
We can switch which JDK to build with on a per-package basis. However, the JRE switch <em>must</em> be tested before we switch JDKs for any package.
<p />
We have two hacks for Java: missing-java-1.7.0-dirs, and osg-java7-compat. The former was for EL 5 only, so we do not have to create a Java 8 analogue. The latter can go away if and only if we change our policy to say that we will only support OpenJDK, and not the Oracle JDK.
<p />
<p />
<h1><a name="Details"></a> Details </h1>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="What_is_the_status_of_Java_7"></a> What is the status of Java 7? </span></h2>
End of lifed by Oracle in spring 2015; OpenJDK development hasn't stopped, however, and I expect Red Hat to keep patching big security issues at least until RHEL 6 is end of lifed as well.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="What_are_the_benefits_of_switchi"></a> What are the benefits of switching? </span></h2>
Primarily, better security algorithms and TLS settings. These are benefits of switching runtime environment, not compilation environment. In fact, BB recommends running with Java 8, but building with Java 7, or at least telling javac to produce Java 7-compatible bytecode. That will be especially useful for our more difficult builds, like HDFS.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="How_hard_is_switching"></a> How hard is switching? </span></h2>
<h3><a name="Switching_JREs"></a> Switching JREs </h3> <ul>
<li> Our RPMs explicitly require JRE 7; we will have to change this dependency to either JRE 8, or JRE &gt;= 7, or 7 &lt;= JRE &lt;= 8.
</li> <li> JRE 7 is still the 'preferred' version in RHEL-based distributions; we would have to provide instructions for admins to force use of JRE 8.
</li></ul> 
<p />
<p />
<h3><a name="Switching_JDKs"></a> Switching JDKs </h3> <ul>
<li> <a href="http://www.oracle.com/technetwork/java/javase/8-compatibility-guide-2156366.html" target="_top">Oracle's incompatibilities guide for Java 7 to 8</a> will let us verify by looking at the source code whether <em>our</em> software is directly affected. However, we will not be able to do that for the many dependencies brought in by our software.
</li> <li> HDFS does not build with JDK 8. This is a known issue upstream; we'd have to wait for them.
</li> <li> EL 5 does not have Java 8.
</li></ul> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="When_will_our_packages_bring_in"></a> When will our packages bring in and use Java 8 by default? </span></h2>
Bring in: never. Our packages will continue to bring in Java 7 because they explicitly require it (via the dependencies 'java7' and 'java7-devel').
<p />
Use: unknown. For some of our packages, we can explicitly specify the runtime; others will use the system runtime, which is determined by the 'alternatives' system. In that case, the admin can choose which of the installed JREs to use, or can go with the default. The current default is Java 7, but Red Hat can change the default at any time -- which will affect upgrades as well as fresh installations.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="What_hacks_can_we_drop"></a> What hacks can we drop? </span></h2> <ul>
<li> missing-java-1.7.0-dirs (EL 5 only) -- we do not need an equivalent for Java 8, since the dirs are already provided by the OS packages
</li> <li> NOT osg-java7-compat: <ul>
<li> we will continue to need this as long as: <ol>
<li> we support Oracle JDK as an alternative to OpenJDK
</li> <li> we have packages that require a full JDK instead of just a JRE            Here's what java-1.8.0-openjdk-devel provides on SLF 6 (queried with `repoquery --plugins --provides java-1.8.0-openjdk-devel`:            <br />                <pre>
            java-1.8.0-openjdk-devel &#61; 1:1.8.0.51-0.b16.el6&#95;6
            java-1.8.0-openjdk-devel(x86-64) &#61; 1:1.8.0.51-0.b16.el6&#95;6
            lib.so()(64bit)
            lib.so(SUNWprivate&#95;1.1)(64bit)
            libjawt.so()(64bit)
            libjawt.so(SUNWprivate&#95;1.1)(64bit)
            libjli.so()(64bit)
            libjli.so(SUNWprivate&#95;1.1)(64bit)
            libunpack.so()(64bit)
            libunpack.so(SUNWprivate&#95;1.1)(64bit)
            </pre>            There does not seem to be anything <em>generic</em> that we can use as bringing in <em>any</em> JDK 8. (I checked the file list -- nothing there either). This is why we need the osg-java7-compat hack.            <br />                Current packages that require java7-devel at runtime: <ul>
<li> hadoop
</li> <li> voms-admin-server
</li> <li> bestman2
</li> <li> osg-wn-client
</li> <li> emi-trustmanager-tomcat
</li></ul> 
</li></ol> 
</li></ul> 
</li></ul> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Open_questions"></a> Open questions </span></h2> <ul>
<li> What are the effects of using Oracle for the JRE but OpenJDK for the JDK?
</li> <li> What do the packages that require java7-devel at runtime need it for? How would they be affected if they had separate JRE vs JDK versions? <ul>
<li> For the second question, from BB: "from the traffic I've seen on the HDFS list, it should be fine.  It's just building on Java 8 that's busted right now."
</li></ul> 
</li></ul> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Other_notes"></a> Other notes </span></h2>
<h3><a name="How_to_determine_the_JRE_version"></a> How to determine the JRE version you need for a class </h3>
<a href="https://stackoverflow.com/a/1096159" target="_top">As described in an answer from stackoverflow</a>, run:
<p />
<p />
<pre>
javap -verbose ClassName &#124; grep major
</pre>
<p />
'major' is 52 for Java 8 and 51 for Java 7. (It's just the ASCII code of the version number).
<p />
(or you can look at byte 8 of the .class file, like: `od -j7 -N1 -c OIDTokenizer.class | awk '{print $2}'`)
<p />
<p />
<h3><a name="If_both_Java_7_and_Java_8_instal"></a> If both Java 7 and Java 8 installed, alternatives will pick Java 7 </h3>
I ran `alternatives --display java` and `alternatives --display javac` and found the following:
<p />
On SLF 6, Java 1.7.0.85 has priority 170085 in the alternatives system (see what they did there?), and Java 1.8.0.51 has priority 41 (no, I don't know where that one came from).
<p />
On CentOS 7, Java 1.7.0.91 has priority 170091 and Java 1.8.0.65 has priority 53.
<p />
So for now, Java 7 always gets picked over Java 8.
<p />
By default, alternatives are on 'auto', meaning that if a new package is installed with a higher priority than what is currently installed, then the system will switch to using the new package. The admin can override that explicitly.
<p />
<p />
<h3><a name="Some_installs_on_EL_7_already_br"></a> Some installs on EL 7 already bring in Java 8 </h3>
Most OSG packages bring in Java 7 via the 'java7' dependency. emi-trustmanager brings in Java 8 instead. Right now, I'm considering that a bug, and made <a href="https://jira.opensciencegrid.org/browse/SOFTWARE-2095" target="_top">SOFTWARE-2095</a> to take care of it. However, recommended practice is to require 'java &gt;= 1:1.7.0' or similar, instead of a specific JRE. (See the <a href="https://fedoraproject.org/wiki/Packaging:Java" target="_top">Fedora Java packaging guidelines</a>)</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Sandbox<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Main/TWikiGroups" class="twikiLink">TWikiGroups</a> &gt; <a href="/bin/view/Main/GridGroup" class="twikiLink">GridGroup</a> &gt; <a href="/bin/view/Main/MatyasSelmeci" class="twikiLink">MatyasSelmeci</a> &gt; <a href="/bin/view/Sandbox/MatyasSelmeciSandbox" class="twikiLink">MatyasSelmeciSandbox</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>MatyasSelmeciJava8UpdateInvestigation</span> <br />    
Topic revision: r2 - 06 Nov 2015 - 23:10:58 - <a href="/bin/view/Main/MatyasSelmeci" class="twikiLink">MatyasSelmeci</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />