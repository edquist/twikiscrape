<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> InstallGlideinWMSFactory &lt; Documentation/Release3 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Documentation/Release3/InstallGlideinWMSFactory?_T=16 Feb 2017" type="application/x-wiki" title="edit InstallGlideinWMSFactory" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Documentation/Release3/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/InstallGlideinWMSFactory"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFFFFF;
	}
	.patternBookView {
		border-color:#FFFFFF;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TWISTYPLUGIN_TWISTY--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.css");
</style>
<script type='text/javascript' src='https://twiki.opensciencegrid.org/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js'></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiPref.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.compressed.js"></script>
<script type="text/javascript">
// <![CDATA[
var styleText = '<style type="text/css" media="all">.twikiMakeVisible{display:inline;}.twikiMakeVisibleInline{display:inline;}.twikiMakeVisibleBlock{display:block;}.twikiMakeHidden{display:none;}</style>';
document.write(styleText);
// ]]>
</script>

<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<!--TABLEPLUGIN_table4--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
</style></head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> 
<p />
<!-- Local variables <ul>
<li> Set CONDORREL = 8.4.11
</li> <li> Set AS_OF_DATE = Feb 1, 2017
</li></ul> 
-->
<p />
<h1><a name="GlideinWMS_Factory_Installation"></a> GlideinWMS Factory Installation </h1>
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#About_This_Document"> About This Document</a>
</li> <li> <a href="?cover=print#Requirements"> Requirements</a> <ul>
<li> <a href="?cover=print#Host_and_OS"> Host and OS</a>
</li> <li> <a href="?cover=print#Users"> Users</a>
</li> <li> <a href="?cover=print#Certificates"> Certificates </a>
</li> <li> <a href="?cover=print#Networking"> Networking</a>
</li></ul> 
</li> <li> <a href="?cover=print#Installation_Procedure"> Installation Procedure</a> <ul>
<li> <a href="?cover=print#Install_the_Yum_Repositories_req"> Install the Yum Repositories required by OSG</a> <ul>
<li> <a href="?cover=print#Install_EPEL"> Install EPEL</a>
</li> <li> <a href="?cover=print#Install_the_Yum_priorities_packa"> Install the Yum priorities package</a>
</li> <li> <a href="?cover=print#Install_OSG_Repositories"> Install OSG Repositories</a>
</li></ul> 
</li> <li> <a href="?cover=print#Install_the_CA_Certificates_A_qu"> Install the CA Certificates: A quick guide</a>
</li> <li> <a href="?cover=print#Install_HTCondor"> Install HTCondor</a> <ul>
<li> <a href="?cover=print#Install_HTCondor_BOSCO"> Install HTCondor-BOSCO</a>
</li></ul> 
</li> <li> <a href="?cover=print#Download_and_install_the_Factory"> Download and install the Factory RPM</a>
</li></ul> 
</li> <li> <a href="?cover=print#Configuration_Procedure"> Configuration Procedure </a> <ul>
<li> <a href="?cover=print#Download_condor_tarballs"> Download condor tarballs</a>
</li> <li> <a href="?cover=print#Configuring_the_Factory"> Configuring the Factory</a> <ul>
<li> <a href="?cover=print#Frontend_security_configuration"> Frontend security configuration</a>
</li> <li> <a href="?cover=print#Web_server_configuration"> Web server configuration</a>
</li> <li> <a href="?cover=print#Entry_configuration"> Entry configuration</a>
</li></ul> 
</li> <li> <a href="?cover=print#Configuring_Tarballs"> Configuring Tarballs</a>
</li> <li> <a href="?cover=print#Configuring_Condor"> Configuring Condor</a> <ul>
<li> <a href="?cover=print#Configuring_Condor_Privilege_Sep"> Configuring Condor Privilege Separation</a>
</li> <li> <a href="?cover=print#Using_UW_Madison_Condor_RPM"> Using UW Madison Condor RPM</a>
</li></ul> 
</li> <li> <a href="?cover=print#Create_a_Condor_grid_mapfile"> Create a Condor grid mapfile.</a>
</li> <li> <a href="?cover=print#Reconfigure_and_verify_installat"> Reconfigure and verify installation</a>
</li></ul> 
</li> <li> <a href="?cover=print#Service_Activation_and_Deactivat"> Service Activation and Deactivation</a>
</li> <li> <a href="?cover=print#Validation_of_Service_Operation"> Validation of Service Operation</a>
</li> <li> <a href="?cover=print#Troubleshooting"> Troubleshooting</a> <ul>
<li> <a href="?cover=print#File_Locations"> File Locations</a>
</li> <li> <a href="?cover=print#Increase_the_log_level_and_chang"> Increase the log level and change rotation policy</a>
</li> <li> <a href="?cover=print#Failed_authentication_errors"> Failed authentication errors</a>
</li> <li> <a href="?cover=print#Glideins_start_but_do_not_connec"> Glideins start but do not connect to User pool / VO Frontend</a>
</li> <li> <a href="?cover=print#Glideins_start_but_fail_before_r"> Glideins start but fail before running job with error "Proxy not long lived enough"</a>
</li> <li> <a href="?cover=print#Condor_root_switchboard_errors"> Condor_root_switchboard errors</a>
</li></ul> 
</li> <li> <a href="?cover=print#References"> References</a>
</li> <li> <a href="?cover=print#Comments"> Comments</a>
</li></ul> 
</div>
<p />
<h1><a name="About_This_Document"></a> About This Document </h1>
<p />
This document describes how to install the Glidein Workflow Managment System (GlideinWMS) Factory instance.
<p />
This document assumes expertise with Condor and familiarity with the glideinWMS software.  It <strong>does not</strong> cover anything but the simplest possible install.   Please consult the <a href="http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/doc.prd/install.html" target="_top">Glidein WMS reference documentation</a> for advanced topics, including non-root, non-RPM-based installation.
<p />
This document covers three primary components of the Glidein WMS system: <ul>
<li> <strong>WMS Collector / Schedd</strong>: A set of <code>condor_collector</code> and <code>condor_schedd</code> processes that allow the submission of pilots to Grid entries.  
</li> <li> <strong>Glidein Factory</strong>: The process submitting the pilots when needed
</li></ul> 
<p />
This document follows the general OSG documentation conventions: <div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdDocumentation/Release3InstallGlideinWMSFactory1show" class="twistyRememberSetting twistyStartHide twistyTrigger twikiUnvisited twistyInited0"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Click to expand document conventions...</span></a> </span> <span id="twistyIdDocumentation/Release3InstallGlideinWMSFactory1hide" class="twistyRememberSetting twistyStartHide twistyTrigger twikiUnvisited twistyHidden twistyInited0"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide Full Output</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdDocumentation/Release3InstallGlideinWMSFactory1toggle" class="twistyRememberSetting twistyStartHide twistyContent twikiMakeHidden twistyInited0">
on    
on    
</div></div> <!--/twistyPlugin-->
<p />
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" />     <strong><font color="#ff0000"> WARNING! </font></strong> </dt><dd>  We really recommend you to use the OSG provided Factory and not to install your own. A <a href="/bin/view/Documentation/Release3/InstallGlideinWMSFrontend" class="twikiLink">VO Frontend</a> is sufficient to submit your jobs and to decide scheduling policies. And this will avoid for you the complexity to avoid directly with grid sites. If you really need you own factory be aware that it is a complex component and may require a non trivial maintenance effort.
</dd></dl> 
<p />
<p />
<h1><a name="Requirements"></a> Requirements </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Host_and_OS"></a> Host and OS </span></h2> <ol>
<li> A host to install the GlideinWMS Factory (pristine node). 
</li> <li> OS is Red Hat Enterprise Linux 5, 6, 7, and variants (see <a href="/bin/view/Documentation/Release3/SupportedOperatingSystems" class="twikiLink">details...</a>).  Currently most of our testing has been done on Scientific Linux 6.
</li> <li> Root access
</li></ol> 
<p />
The Glidein WMS VO Factory has the following requirements: <ul>
<li> <strong>CPU</strong>: 4-8 for a large installation (1 should suffice on a small install)
</li> <li> <strong>RAM</strong>: 4-8GB on a large installation (1GB should suffice for small installs)
</li> <li> <strong>Disk</strong>:  10GB will be plenty sufficient for all the binaries, config and log files related to glideinWMS.  If you are a large site with need to keep significant history and logs, you may want to allocate 100GB+ to store long histories.
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Users"></a> Users </span></h2>
The Glidein WMS Factory installation will create the following users unless they are already created.
<p />
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">User</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Default uid</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=2;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Comment</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> <code>condor</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> none </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> Condor user (installed via dependencies). </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <code>gfactory</code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLast"> none </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> This user runs the Glidein VO factory. </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
Note that, if you use a different user (or <code>gfactory</code> has a different group than <code>gfactory</code>),
then you will have to modify <code>/etc/condor/privsep_config</code> to allow condor to use the
condor root switchboard. 
To verify that the user <code>gfactory</code> has <code>gfactory</code> as primary group check the output of 
<code><b>getent passwd gfactory | cut -d: -f4 | xargs getent group</b></code>.
It should be the <code>gfactory</code> group. 
<p />
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Certificates"></a> Certificates </span></h2>
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=0;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Certificate</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=1;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">User that owns certificate</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=2;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Path to certificate</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Host certificate </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLast"> <code>root</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <code>/etc/grid-security/hostcert.pem</code> <br> <code>/etc/grid-security/hostkey.pem</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<a href="/bin/view/Trash/ReleaseDocumentationGetHostServiceCertificates" class="twikiLink">Here</a> are instructions to request a host certificate.
<p />
The host certificate/key is used for authorization,  however, 
authorization between the factory and the wms collector is done by file system authentication.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Networking"></a> Networking </span></h2>
<p />
<p />
<!-- No variables can be defined because will not be visible in the including document
Need this because double quotes used in Y in TWikiPreferences or ICON cause problems (replaced with single ones) <ul>
<li> Set ALTy = <img src='/twiki/pub/TWiki/TWikiDocGraphics/choice-yes.gif' alt='Y' title='Y' width='16' height='16' border='0' />    
</li></ul> 
ALTy replacend inline whenever the icon is needed.
-->
For more details on overall Firewall configuration, please see our <a href="/bin/view/Documentation/Release3/FirewallInformation" class="twikiLink">Firewall documentation</a>.
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
                <table cellspacing="0" id="table3" cellpadding="0" class="twikiTable" rules="cols" border="1">               
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=0;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Service Name</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=1;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Protocol</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=2;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Port Number</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=3;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Inbound</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=4;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Outbound</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol5 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=5;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Comment</font></a> </th>
		</tr>               
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <a href="/bin/view/Documentation/GlossaryH#DefsHTCondor" class="twikiAnchorLink">HTCondor</a> collector </td>
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol1 twikiLast"> tcp </td>
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol2 twikiLast"> 9618 </td>
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol3 twikiLast"> <img src='/twiki/pub/TWiki/TWikiDocGraphics/choice-yes.gif' alt='Y' title='Y' width='16' height='16' border='0' /> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol4 twikiLast"> &nbsp; </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol5 twikiLastCol twikiLast"> HTCondor Collector (received ClassAds from resources and jobs) </td>
		</tr>               </table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<p />
It must be on the public internet, with at least one port open to the world; all worker nodes will load data from this node trough HTTP. Note that worker nodes will also need outbound access in order to access this HTTP port. 
<p />
<p />
<p />
<p />
<p />
<h1><a name="Installation_Procedure"></a> Installation Procedure </h1>
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Install_the_Yum_Repositories_req"></a> Install the Yum Repositories required by OSG </span></h2>
<p />
The OSG RPMs currently support Red Hat Enterprise Linux 5, 6, 7, and variants (see <a href="/bin/view/Documentation/Release3/SupportedOperatingSystems" class="twikiLink">details...</a>).
<p />
OSG RPMs are distributed via the OSG yum repositories. Some packages depend on packages distributed via the <a href="http://fedoraproject.org/wiki/EPEL" target="_top">EPEL</a> repositories. So both repositories must be enabled.
<p />
<h3><a name="Install_EPEL"></a> Install EPEL </h3>
<p /> <ul>
<li> Install the EPEL repository, if not already present. <strong>Note:</strong> This enables EPEL by default. Choose the right version to match your OS version. <pre class="rootscreen">
<font color="#ff0000"># EPEL 5 (For RHEL 5, CentOS 5, and SL 5) </font>
[root@client ~]$ curl -O https://dl.fedoraproject.org/pub/epel/epel-release-latest-5.noarch.rpm
[root@client ~]$ rpm -Uvh epel-release-latest-5.noarch.rpm
<font color="#ff0000"># EPEL 6 (For RHEL 6, CentOS 6, and SL 6) </font>
[root@client ~]$ rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm
<font color="#ff0000"># EPEL 7 (For RHEL 7, CentOS 7, and SL 7) </font>
[root@client ~]$ rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</pre>       <strong>WARNING</strong>: if you have your own mirror or configuration of the EPEL repository, you <strong>MUST</strong> verify that the OSG repository has a better yum priority than EPEL (<a href="/bin/view/Documentation/Release3/InstallBestPractices#YumPriorities" class="twikiAnchorLink">details</a>). Otherwise, you will have strange dependency resolution (<em>depsolving</em>) issues.
</li></ul> 
<p />
<h3><a name="Install_the_Yum_priorities_packa"></a> Install the Yum priorities package </h3>
<p />
For packages that exist in both OSG and EPEL repositories, it is important to prefer the OSG ones or else OSG software installs may fail. Installing the Yum priorities package enables the repository priority system to work.
<p /> <ol>
<li> <p>Choose the correct package name based on your operating system’s major version:</p> <ul>
<li> For EL&nbsp;5 systems, use <code>yum-priorities</code>
</li> <li> For EL&nbsp;6 and EL&nbsp;7 systems, use <code>yum-plugin-priorities</code>
</li></ul> 
</li> <li> <p>Install the Yum priorities package:</p>       <pre class="rootscreen">[root@client ~]$ yum install <em>PACKAGE</em></pre>       <p>Replace <em><code>PACKAGE</code></em> with the package name from the previous step.</p>
</li> <li> <p>Ensure that <code>/etc/yum.conf</code> has the following line in the <code>[main]</code> section (particularly when using ROCKS), thereby enabling Yum plugins, including the priorities one:</p>       <pre class="file">plugins=1</pre>       <strong>NOTE</strong>: If you do not have a required key you can force the installation using <code>--nogpgcheck</code>; e.g., <code>yum install --nogpgcheck yum-priorities</code>.
</li></ol> 
<p />
<h3><a name="Install_OSG_Repositories"></a> Install OSG Repositories </h3>
<p />
<!--   1. <p>First, determine which OSG series you will be installing; 3.1 or 3.2.  The OSG 3.1 and 3.2 series are each well tested and contain the entire OSG software stack.  The 3.1 series continues to support all packages that have been released throughout its lifetime, while the 3.2 series contains newer versions of software (including HTCondor, Hadoop, glideinWMS) and removes support for obsolete packages (including CEMonitor).  Initially, most packages are identical between 3.1 and 3.2, but we expect the new series to diverge over time. <br/><br/>Note that some packages (eg, Hadoop) do not inter-operate between 3.1 and 3.2, and therefore require all nodes to use the same series.</p> -->
<p />
<ol>
   <li>
      <p>If you are upgrading from OSG 3.1 (or 3.2) to OSG 3.2 (or 3.3), remove the old OSG repository definition files and clean the Yum cache:</p>         <pre class="rootscreen">[root@client ~]$ yum clean all
[root@client ~]$ rpm -e osg-release</pre>       <p>This step ensures that local changes to <code>*.repo</code> files will not block the installation of the new OSG repositories. After this step, <code>*.repo</code> files that have been changed will exist in <code>/etc/yum.repos.d/</code> with the <code>*.rpmsave</code> extension. After installing the new OSG repositories (the next step) you may want to apply any changes made in the <code>*.rpmsave</code> files to the new <code>*.repo</code> files.</p>
   </li>
   <li>
      <p>Install the OSG repositories using one of the following methods depending on your EL version:</p>      <ol>
         <li>
            <p>For EL versions greater than EL5, install the files directly from <code>repo.grid.iu.edu</code>:</p>            <pre class="rootscreen">[root@client ~]$ rpm -Uvh <font color="#ff0000">URL</font></pre>            <p>Where <code><font color="#ff0000">URL</font></code> is one of the following:</p> <table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table4" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=0;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Series</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=1;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">EL6 URL (for RHEL 6, CentOS 6, or SL 6)</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=2;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">EL7 URL (for RHEL 7, CentOS 7, or SL 7)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <font color="#252b37">OSG 3.2</font> </th>
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol1"> <code>https://repo.grid.iu.edu/osg/3.2/osg-3.2-el6-release-latest.rpm</code> </td>
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol2 twikiLastCol"> N/A </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <font color="#252b37">OSG 3.3</font> </th>
			<td bgcolor="#f2f3f6" align="center" valign="top" class="twikiTableCol1 twikiLast"> <code>https://repo.grid.iu.edu/osg/3.3/osg-3.3-el6-release-latest.rpm</code> </td>
			<td bgcolor="#f2f3f6" align="center" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <code>https://repo.grid.iu.edu/osg/3.3/osg-3.3-el7-release-latest.rpm</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
         </li>
         <li>
            <p>For EL5, download the repo file and install it using the following:</p>
            <pre class="rootscreen">[root@client ~]$ curl -O https://repo.grid.iu.edu/osg/3.2/osg-3.2-el5-release-latest.rpm
[root@client ~]$ rpm -Uvh osg-3.2-el5-release-latest.rpm</pre>
         </li>
      </ol>
   </li>
</ol>
<p />
For more details, please see our <a href="/bin/view/Documentation/Release3/YumRepositories" class="twikiLink">yum repository documentation</a>.
<p />
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Install_the_CA_Certificates_A_qu"></a> Install the CA Certificates: A quick guide </span></h2>
<p />
You must perform one of the following <code>yum</code> commands below to select this host's CA certificates.
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table5" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=0;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Set of CAs</font></a> </th>
			<th bgcolor="#d8dde4" align="right" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=1;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">CA certs name</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=2;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37"> Installation command (as root)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> OSG </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> osg-ca-certs </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> <code>yum install osg-ca-certs</code> <font color="#ff0000"><b>Recommended</b></font> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> IGTF </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1"> igtf-ca-certs </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol"> <code>yum install igtf-ca-certs</code> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> None* </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> empty-ca-certs </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> <code>yum install empty-ca-certs --enablerepo=osg-empty</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Any** </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLast"> Any </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <code>yum install osg-ca-scripts</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
* The <code>empty-ca-certs</code> RPM indicates you will be manually installing the CA certificates on the node. <br/>
** The <code>osg-ca-scripts</code> RPM provides a cron script that automatically downloads CA updates, and requires further configuration. <br/>
<p />
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  If you use options 1 or 2, then you will need to run "yum update" in order to get the latest version of CAs when they are released. With option 4 a cron service is provided which will always download the updated CA package for you.
</dd></dl> 
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  If you use services like Apache's httpd you must restart them after each update of the CA certificates, otherwise they will continue to use the old version of the CA certificates.
</dd></dl> 
For more details and options, please see our <a href="/bin/view/Documentation/Release3/InstallCertAuth" class="twikiLink">CA certificates documentation</a>. 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Install_HTCondor"></a> Install HTCondor </span></h2>
Most required software is installed from the Factory RPM installation. HTCondor is the only exception since there are <a href="/bin/view/Documentation/Release3/CondorInformation" class="twikiLink">many different ways to install it</a>, using the RPM system or not. 
You need to have HTCondor installed before installing the Glidein WMS Factory. If yum cannot find a HTCondor RPM, it will install the dummy <code>empty-condor</code> RPM, assuming that you installed HTCondor using a tarball distribution.
<p />
If you don't have HTCondor already installed, you can install the HTCondor RPM in the OSG repository:
<pre class="rootscreen">[root@client ~]$ yum install condor.x86_64
# If you have a 32 bit host use instead:
[root@client ~]$ yum install condor.i386</pre>
<p />
See <a href="/bin/view/Documentation/Release3/CondorInformation" class="twikiLink">this HTCondor document</a> for more information on the different options.
<p />
<h3><a name="Install_HTCondor_BOSCO"></a> Install HTCondor-BOSCO </h3>
If you plan to send jobs using <a href="http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/doc.prd/recipes/batch.html" target="_top">direct batch submission</a> (aka BOSCO), then you need also the <code>condor-bosco</code> package. You'll have to install the package and remove one of its file (<code>/etc/condor/config.d/60-campus_factory.config</code>) because it interferes with the factory configuration.
<pre class="rootscreen">[root@client ~]$ yum install condor-bosco
[root@client ~]$ rm /etc/condor/config.d/60-campus_factory.config
[root@client ~]$ touch /etc/condor/config.d/60-campus_factory.config</pre>
<p />
There is an <span class="twikiNewLink">Advanced configuration section<a href="/bin/edit/Trash/Trash/CampusGrids/BoscoInstall?topicparent=Documentation/Release3.InstallGlideinWMSFactory" rel="nofollow" title="Advanced configuration section (this topic does not yet exist; you can create it)">?</a></span> in the BOSCO documentation that can be useful to know, specially how to deal with <span class="twikiNewLink">multi homed BOSCO resources<a href="/bin/edit/Trash/Trash/CampusGrids/BoscoInstall?topicparent=Documentation/Release3.InstallGlideinWMSFactory" rel="nofollow" title="multi homed BOSCO resources (this topic does not yet exist; you can create it)">?</a></span>
and the <span class="twikiNewLink">specification of custom submit properties<a href="/bin/edit/Trash/Trash/CampusGrids/BoscoInstall?topicparent=Documentation/Release3.InstallGlideinWMSFactory" rel="nofollow" title="specification of custom submit properties (this topic does not yet exist; you can create it)">?</a></span>.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Download_and_install_the_Factory"></a> Download and install the Factory RPM </span></h2>
<p />
The RPM is available in the OSG repository:
<p />
Install the RPM and dependencies (be prepared for a lot of dependencies).
<p />
   <pre class="rootscreen">[root@client ~]$ yum install glideinwms-factory</pre>
<p />
This will install the current production release verified and tested by OSG with default condor configuration.
This command will install the glideinwms factory, condor, the OSG client, and all the required dependencies.
If you wish to install a different version of GlideinWMS, add the "--enablerepo" argument to the command as follows:
<p /> <ul>
<li> <code>yum install --enablerepo=osg-testing glideinwms-factory</code>: The most recent production release, still in testing phase.  This will usually match the current tarball version on the GlideinWMS home page.  (The osg-release production version may lag behind the tarball release by a few weeks as it is verified and packaged by OSG).  Note that this will also take the osg-testing versions of all dependencies as well.
</li> <li> <code>yum install --enablerepo=osg-contrib glideinwms-factory</code>:  The most recent development series release, ie version 3 release.  This has newer features such as cloud submission support, but is less tested.
</li></ul> 
<p />
<p />
<p />
<p />
<p />
<h1><a name="Configuration_Procedure"></a> Configuration Procedure </h1>
<p />
After installing the RPM you need to configure the components of the Glidein WMS Factory: <ol>
<li> Edit Factory configuration options
</li> <li> Edit Condor configuration options
</li> <li> Create a Condor grid map file
</li> <li> Reconfigure and Start factory
</li></ol> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Download_condor_tarballs"></a> Download condor tarballs </span></h2>
<p />
You will need to download Condor tarballs for each architecture that you want to deploy pilots on.
At this point, glideinWMS factory does not support pulling condor binaries from your system area.
Suggested is that you put these binaries in <code>/var/lib/gwms-factory/condor</code> but any <code>gfactory</code> accessible location should suffice.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Configuring_the_Factory"></a> Configuring the Factory </span></h2>
<p />
The configuration file is <code>/etc/gwms-factory/glideinWMS.xml</code>.  The next steps will describe each line that you will need to edit for most cases, but you may want to 
review the whole file to be sure that it is configured correctly.
<p />
<h3><a name="Frontend_security_configuration"></a> Frontend security configuration </h3>
<p />
In the security section, you will need to provide each frontend that is allowed to communicate with the factory:
   <pre class="file">
   &lt;security allow_proxy="frontend" key_length="2048" pub_key="RSA" reuse_oldkey_onstartup_gracetime="900"&gt;
      &lt;frontends&gt;
         &lt;frontend name="<font color="#ff6600">vofrontend_sec_name</font>" identity="<font color="#008000">vofrontend_service</font>@FACTORY_COLLECTOR_HOSTNAME"&gt;
            &lt;security_classes&gt;
               &lt;security_class name="<font color="#ff0000">frontend_sec_class</font>" username="frontend"/&gt;
            &lt;/security_classes&gt;
         &lt;/frontend&gt;
      &lt;/frontends&gt;
   &lt;/security&gt;
   </pre>
<p />
These attributes are very important to get exactly right or the frontend will not be trusted.  This should match one of the <em>factory</em> and <em>security</em> sections of the <a href="/bin/view/Documentation/Release3/InstallGlideinWMSFrontend#Configuring_the_Frontend" class="twikiAnchorLink">frontend configuration</a> in the following way:
<pre class="file"><font color="#ff0000">This is a snippet from the Frontend configuration (for reference), not the Factory that you are configuring now!</font>
&lt;factory query_expr='((stringListMember("<font color="#ff00ff">VO</font>", GLIDEIN_Supported_VOs)))'>
  ...
  &lt;collectors>
     &lt;collector DN="/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=FACTORY_COLLECTOR_HOSTNAME" 
          comment="Define factory collector globally for simplicity" factory_identity="gfactory@FACTORY_COLLECTOR_HOSTNAME" 
          my_identity="<font color="#008000">vofrontend_service</font>@FACTORY_COLLECTOR_HOSTNAME" 
          node="FACTORY_COLLECTOR_HOSTNAME"/>
     &lt;/collectors>
&lt;/factory>

   &lt; security classad_proxy="/tmp/vo_proxy" proxy_DN="<font color="#0000ff">/DC=org/DC=doegrids/OU=People/CN=Some Name 123456</font>" 
      proxy_selection_plugin="ProxyAll" security_name="<font color="#ff6600">vofrontend_sec_name</font>" sym_key="aes_256_cbc"&gt;
      &lt;proxies&gt;
         &lt;proxy absfname="/tmp/pilot_proxy" security_class="<font color="#ff0000">frontend_sec_class</font>"/&gt;
      &lt;/proxies&gt;
   &lt;/security &gt;
</pre>
Note that the identity of the frontend must match what <strong>condor</strong> authenticates the DN of the frontend to.  In <code>/etc/condor/certs/condor_mapfile</code>
(See next section for more details), there must be an entry:
<pre class="file">
GSI "<font color="#0000ff">^\/DC\=org\/DC\=doegrids\/OU\=People\/CN\=Some\ Name\ 834323</font>$" <font color="#008000">vofrontend_service</font>
</pre>
<p />
<p />
<h3><a name="Web_server_configuration"></a> Web server configuration </h3>
<p />
Verify web area:
   <pre class="file">
       &lt;stage base_dir="/var/lib/gwms-factory/web-area/stage" use_symlink="True" web_base_url="http://HOSTNAME:PORT/factory/stage"/&gt;
   </pre>
This will determine the location of your web server.  It is advisable (but not necessarily) to change the port here and in apache by modifying the "Listen" directive in <code>/etc/httpd/conf/httpd.conf</code>.  Note that web servers are an often attacked piece of infrastruture, so you may want to go through the Apache configuration in 
<code>/etc/httpd/conf/httpd.conf</code> and disable unneeded modules.
<p />
<h3><a name="Entry_configuration"></a> Entry configuration </h3>
<p />
Entries are grid endpoints (Compute Elements) that can accept job requests and run pilots (which will run user jobs).
Each needs to be configured to go to a specific gatekeeper.
<p />
An example test entry is provided in the configuration file.  At the very least, you will need to modify the entry line:
<pre class="file">
<font color="#ff0000"># These lines are form the configuration of v 3.x</font>
       &lt;entry name="<font color="#ff0000">ENTRY_NAME</font>" enabled="True" auth_method="grid_proxy" trust_domain="OSG" 
       gatekeeper="<font color="#ff0000">gatekeeper.domain.tld/jobmanager-type</font>" gridtype="gt2" rsl="(queue=default)(jobtype=single)"
       schedd_name="<font color="#ff0000">schedd_glideins2@FACTORY_HOSTNAME</font>" verbosity="std" work_dir="OSG">
<font color="#ff0000"># These lines are the same section form the configuration of v 2.x</font>
       &lt;entry name="<font color="#ff0000">ENTRY_NAME</font>" enabled="True" gatekeeper="<font color="#ff0000">gatekeeper.domain.tld/jobmanager-type</font>" 
       gridtype="gt2" rsl="(queue=default)(jobtype=single)" schedd_name="<font color="#ff0000">schedd_glideins2@FACTORY_HOSTNAME</font>" 
       verbosity="std" work_dir="OSG" &gt;
</pre>
You will need to modify the entry name and gatekeeper.  This will determine the gatekeeper that you access.  Specific gatekeepers often require specific "rsl" attributes that determine the job queue that you are in or other attributes.  Add them in the <em>rsl</em> attribute.  Also, be sure to distribute your entries across the various condor schedd work managers to balance load.  To see the available schedd use <code>condor_status -schedd -l | grep Name</code>.  Several schedd options are configured by default for you:  schedd_glideins2, schedd_glideins3, schedd_glideins4, schedd_glideins5, as well as the default schedd.  This can be modified in the condor configuration.  Add any specific options, such as limitations on jobs/pilots or glexec/voms requirements in the entry section below the above line.
<p />
If there is no match between auth_metod and trust_domain of the entry and the type and trust domain listed in one of the <a href="/bin/view/Documentation/Release3/InstallGlideinWMSFrontend#Configuring_the_Frontend" class="twikiAnchorLink">credentials of one of the frontends</a> using this factory, then no job can run on that entry.
<p />
The factory must advertise the correct Resource Name of each entry for accounting purposes. Then the factory must also advertise in the entry all the attributes that will allow to match the query expression used in the frontends connecting to this factory (e.g. <code><b>&lt;factory query_expr='((stringListMember("<font color="#ff00ff">VO</font>", GLIDEIN_Supported_VOs)))'&gt;</b></code> in the <a href="/bin/view/Documentation/Release3/InstallGlideinWMSFrontend#Configuring_the_Frontend" class="twikiAnchorLink">VO frontend configuration document</a>). Then you must advertise correctly if the site supports gLExec. If it does not set <code>GLEXEC_BIN</code> to <code>NONE</code>, if gLExec is installed via OSG set it to <code>OSG</code>, otherwise set it to the path of gLExec. 
For example this snippet advertises <code>GLIDEIN_Supported_VOs</code> attribute with the supported VO so that can be used with the query above in the VO frontend and says that the resource does not support gLExec:
<pre class="file">
       &lt;entry name="RESOURCE_NAME" ...
          &lt;config>
         ...
          &lt;attrs>
            ...
             &lt;attr name="GLIDEIN_Supported_VOs" const="True" glidein_publish="True" job_publish="True" 
             parameter="True" publish="True" type="string" value="<font color="#ff00ff">VO</font>"/>
             &lt;attr name="GLEXEC_BIN" const="True" glidein_publish="False" job_publish="False" parameter="True" 
             publish="True" type="string" value="<font color="#ff0000">NONE</font>"/>
             &lt;attr name="GLIDEIN_Resource_Name" const="True" glidein_publish="True" job_publish="True" 
             parameter="True" publish="True" type="string" value="<font color="#ff0000">SiteNameFromOIM</font>"/>
          &lt;/attrs>
</pre>
<p />
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  Specially if jobs are sent to OSG resources, it is very important to set the GLIDEIN_Resource_Name and to be consistent with the Resource Name reported in OIM because that name will be used for job accounting in Gratia. It should be the name of the Resource in OIM or the name of the Resource Group (specially if there are many gatekeepers submitting to the same cluster).
</dd></dl> 
<p />
More information on options can be found here:
<a href="http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/doc.prd/factory/configuration.html" target="_top">http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/doc.prd/factory/configuration.html</a>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Configuring_Tarballs"></a> Configuring Tarballs </span></h2>
<p />
Each pilot will download condor binaries from the staging area.  Often, multiple binaries are needed to support various architectures and platforms. 
Currently, you will need to provide at least one tarball for glideinWMS to use.  (Using the system binaries is currently not supported).
<p />
Download a condor tarball from: <a href="http://research.cs.wisc.edu/condor/downloads-v2/download.pl" target="_top">http://research.cs.wisc.edu/condor/downloads-v2/download.pl</a>.  Suggested is to put the binaries in <code>/var/lib/gwms-factory/condor</code>, but any factory-accessible location will do just fine.
<p />
Once you have downloaded the tarball, configure it in <code>/etc/gwms-factory/glideinWMS.xml</code> like in the following:
   <pre class="file">
     &lt; condor_tarball arch="default" base_dir="/var/lib/gwms-factory/condor/condor-7.6.6-x86_64_rhap_5-stripped" os="default" version="default"/&gt;
   </pre>
<p />
Remember also to modify the <code>condor_os</code> and <code>condor_arch</code> attributes in the entries (the configured Compute Elements) to pick the correct HTCondor binary.
[[http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/doc.prd/factory/configuration.html#tarballs][Here] are more details on using multiple condor binaries. Note that is sufficient to set the <code>base_dir</code>; the reconfigure command will prepare the tarball and add it to the XML config file.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Configuring_Condor"></a> Configuring Condor </span></h2>
<p />
The condor configuration for the frontend is placed in <code>/etc/condor/config.d</code>. <ul>
<li> 00_gwms_factory_general.config
</li> <li> 01_gwms_factory_collectors.config
</li> <li> 02_gwms_factory_schedds.config
</li> <li> 03_gwms_factory_local.config
</li></ul> 
<p />
Get rid of the pre-loaded condor default. 
<pre class="rootscreen">
  rm /etc/condor/config.d/00personal_condor.config
</pre>
<p />
For most installations, the items you need to modify are in <code>03_gwms_factory_local.config</code>.  The lines you will have to edit are:
<p /> <ol>
<li> Credentials of the machine.  You can either run using a proxy, or a service certificate.  It is recommended to use a host certificate and specify it's location in the 
</li></ol> 
variables <code>GSI_DAEMON_CERT</code> and <code>GSI_DAEMON_KEY</code>.  The host certificate should be owned by <code>root</code> and have the correct permissions, 600. <ol>
<li> Condor ids in the form UID.GID (both are integers)
</li> <li> Condor admin email it will email when services fail.   <pre class="file">
#-- Condor user: condor
CONDOR_IDS =
#--  Contact (via email) when problems occur
CONDOR_ADMIN =

############################
# GSI Security config
############################
#-- Grid Certificate directory
GSI_DAEMON_TRUSTED_CA_DIR= /etc/grid-security/certificates

#-- Credentials
GSI_DAEMON_CERT =  /etc/grid-security/hostcert.pem
GSI_DAEMON_KEY  =  /etc/grid-security/hostkey.pem

#-- Condor mapfile
CERTIFICATE_MAPFILE= /etc/condor/certs/condor_mapfile

###################################
# Whitelist of condor daemon DNs
###################################
#DAEMON_LIST = COLLECTOR, MASTER, NEGOTIATOR, SCHEDD, STARTD
</pre>
</li></ol> 
<p />
After configuring condor, be sure to restart condor:
<p />
<pre class="rootscreen">
service condor restart</pre>
<p />
<p />
<h3><a name="Configuring_Condor_Privilege_Sep"></a> Configuring Condor Privilege Separation </h3>
<p />
Lastly, verify the settings in <code>/etc/condor/privsep_config</code>.  By default,
the values in this file should not need to be modified.  However,
if your user/group differs from <code>gfactory</code> / <code>gfactory</code>, or if you are operating
a factory with multiple frontends, you will have to modify this file.
<p />
This file controls the condor root switchboard, which allows the factory
to change permissions of files, specifically the proxies and files
passed to it by the frontends.
<p />
<pre class="file">
valid-caller-uids = gfactory
valid-caller-gids = gfactory
valid-target-uids = fecmsucsd : fehcc : fecmscern
valid-target-gids = fecmsucsd : fehcc : fecmscern
valid-dirs = /var/lib/gwms-factory/client-proxies
valid-dirs = /var/lib/gwms-factory/client-logs
valid-dirs = /var/log/gwms-factory/client
valid-dirs = /var/lib/gwms-factory
valid-dirs = /var/log/gwms-factory
procd-executable = /usr/sbin/condor_procd
</pre>
<p />
Thus, the <code>valid-called-uids</code> and <code>valid-caller-gids</code> should match the user/group of your factory user.
The <code>valid-target-uids</code> and <code>valid-target-gids</code> should be a colon-separated list of all the frontend
users and groups.  This should match the security_classes section in <code>/etc/gwms-factory/glideinWMS.xml</code>.
<p />
<p />
<h3><a name="Using_UW_Madison_Condor_RPM"></a> Using UW Madison Condor RPM </h3>
<p />
The above procedure will work if you are using the OSG condor RPMS.
If you are using the UW Madison Condor RPMS, be aware of the following changes:
<p /> <ul>
<li> This Condor RPM uses a file <code>/etc/condor/condor_config.local</code> to add your local machine slot to the user pool.
</li> <li> If you want to disable this behavior (recommended), you should blank out that file or comment out the line in <code>/etc/condor/condor_config</code> for LOCAL_CONFIG_FILE.  (Make sure that LOCAL_CONFIG_DIR is set to <code>/etc/condor/config.d</code>)
</li> <li> Note that the variable LOCAL_DIR is set differently in UW Madison and OSG RPMs.  This should not cause any more problems in the glideinwms RPMs, but please take note if you use this variable in your job submissions or other customizations.
</li></ul> 
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Create_a_Condor_grid_mapfile"></a> Create a Condor grid mapfile. </span></h2>
<p />
The Condor grid mapfile (<code>/etc/condor/certs/condor_mapfile</code>) is used for authentication between the glidein running on a remote worker node, and the local collector.  Condor uses the mapfile to map certificates to pseudo-users on the local machine.  It is important that you map the DN's of each frontend you are talking to.
<p />
Below is an example mapfile, by default found in <code>/etc/condor/certs/condor_mapfile</code>:
   <pre class="file">
GSI "^\/DC\=org\/DC\=doegrids\/OU\=People\/CN\=Some\ Name\ 123456$" frontend
GSI (.*) anonymous
FS (.*) \1 </pre>
Each frontend needs a line that maps to the user specified in the identity argument in the frontend security section of the factory configuration.
<p />
After configuring the mapfile, be sure to restart condor:
<p />
<pre class="rootscreen">
service condor restart</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Reconfigure_and_verify_installat"></a> Reconfigure and verify installation </span></h2>
<p />
In order to use the factory, first you must reconfigure it.
Each time you change the configuration you must reconfigure it using the "upgrade" or "reconfigure" option in order to 
populate scripts and information correctly. 
<p />
<p />
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/warning.gif" alt="ALERT!" title="ALERT!" width="16" height="16" border="0" />     <strong><font color="#ff0000"> WARNING! </font></strong> </dt><dd>  Before you start the factory service first time, you should always use the "upgrade" option.  <pre class="rootscreen">
<font color="#ff0000"># For RHEL 6, CentOS 6, and SL6</font>
[root@client ~]$ service gwms-factory upgrade

<font color="#ff0000"># For RHEL 7, CentOS 7, and SL7</font>
[root@client ~]$ /usr/sbin/gwms-factory upgrade</pre>
</dd></dl> 
<p />
After reconfiguring, you can start the factory:
<pre class="rootscreen">
<font color="#ff0000"># For RHEL 6, CentOS 6, and SL6</font>
[root@client ~]$ service gwms-factory start 

<font color="#ff0000"># For RHEL 7, CentOS 7, and SL7</font>
[root@client ~]$ systemctl start gwms-factory</pre>
<p />
<p />
<h1><a name="Service_Activation_and_Deactivat"></a> Service Activation and Deactivation </h1>
<p />
To <strong>start the Factory</strong> you must start also HTCondor and the Web server beside the Factory itself: <ul>
<li> HTCondor <pre class="rootscreen">
<font color="#ff0000"># For RHEL 6, CentOS 6, and SL6</font>
[root@client ~]$ service condor start
[root@client ~]$ service httpd start
[root@client ~]$ service gwms-factory start 

<font color="#ff0000"># For RHEL 7, CentOS 7, and SL7</font>
[root@client ~]$ systemctl start condor
[root@client ~]$ systemctl start httpd
[root@client ~]$ systemctl start gwms-factory</pre>
</li></ul> 
<p />
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>   Anytime you change the <code>/etc/gwms-factory/glideinWMS.xml</code> file and/or some glidein script, you will need to reconfigure the factory with: <pre class="rootscreen">
<font color="#ff0000"># For RHEL 6, CentOS 6, and SL6</font>
[root@client ~]$ service gwms-factory reconfig
<font color="#ff0000"># And if you change also some code</font>
[root@client ~]$ service gwms-factory upgrade 

<font color="#ff0000"># For RHEL 7, CentOS 7, and SL7</font>
[root@client ~]$ systemctl reload gwms-factory
<font color="#ff0000"># And if you change also some code (note that on SL7 the factory must be stopped to upgrade)</font>
[root@client ~]$ /usr/sbin/gwms-factory upgrade
</pre>
</dd></dl> 
<p />
To enable the services so that they restart after a reboot:
<pre class="rootscreen">
<font color="#ff0000"># For RHEL 6, CentOS 6, and SL6</font>
[root@client ~]$ /sbin/chkconfig fetch-crl-cron on 
[root@client ~]$ /sbin/chkconfig fetch-crl-boot on 
[root@client ~]$ /sbin/chkconfig condor on 
[root@client ~]$ /sbin/chkconfig httpd on 
[root@client ~]$ /sbin/chkconfig gwms-factory on

<font color="#ff0000"># For RHEL 7, CentOS 7, and SL7</font>
[root@client ~]$ systemctl enable fetch-crl-cron 
[root@client ~]$ systemctl enable fetch-crl-boot
[root@client ~]$ systemctl enable condor 
[root@client ~]$ systemctl enable httpd 
[root@client ~]$ systemctl enable gwms-factory</pre>
<p />
<p />
<p />
<br/>
To <strong>stop the Factory</strong>:<pre class="rootscreen">
<font color="#ff0000"># For RHEL 6, CentOS 6, and SL6</font>
[root@client ~]$ service gwms-factory stop 

<font color="#ff0000"># For RHEL 7, CentOS 7, and SL7</font>
[root@client ~]$ systemctl stop gwms-factory</pre>
<p />
You can also stop these other services if you don't use them for other programs sunning on your host: <ul>
<li> E.g. stop HTCondor and httpd<pre class="rootscreen">
<font color="#ff0000"># For RHEL 6, CentOS 6, and SL6</font>
[root@client ~]$ service condor stop
[root@client ~]$ service httpd stop

<font color="#ff0000"># For RHEL 7, CentOS 7, and SL7</font>
[root@client ~]$ systemctl stop condor
[root@client ~]$ systemctl stop httpd</pre>
</li></ul> 
<p />
<p />
<h1><a name="Validation_of_Service_Operation"></a> Validation of Service Operation </h1>
<p />
The validation of the factroy is the submission of actual jobs.
<p />
You can also check that the services are up and running:
<pre class="screen">
[user@client ~]$ condor_status -any

MyType               TargetType           Name

glidefactoryclient         None                 12345_TEST_ENTRY@gfactory_instance@
glideclient          None                 12345_TEST_ENTRY@gfactory_instance@
glidefactory         None                 TEST_ENTRY@gfactory_instance@
glidefactoryglobal   None                 gfactory_instance@gfactory_ser
glideclientglobal    None                 gfactory_instance@gfactory_ser
Scheduler            None                 hostname.fnal.gov
DaemonMaster         None                 hostname.fnal.gov
Negotiator           None                 hostname.fnal.gov
Scheduler            None                 schedd_glideins2@hostname
Scheduler            None                 schedd_glideins3@hostname
Scheduler            None                 schedd_glideins4@hostname
Scheduler            None                 schedd_glideins5@hostname
Collector            None                 wmscollector_service@hostname
</pre>
<p />
You should have one "glidefactory" classad for each entry that you have enabled.
If you have already configured the frontends, 
you will also have one glidefactoryclient and one glideclient classad for each frontend / entry.
<p />
You can check also the monitoring Web page: <code><b>http://YOUR_HOST_FQDN/factory/monitor/</b></code>
<p />
You can also test the local submission of a job to a resource using the test script <code>local_start.sh</code> but you must first install <a href="/bin/view/Documentation/Release3/InstallOSGClient" class="twikiLink">OSG client</a> and generate a proxy. After that you can run the test (replace ENTRY_NAME with the name of one of the entries in <code>/etc/gwms-factory/glideinWMS.xml</code>):
<pre class=screen>[user@client ~]$ cd /var/lib/gwms-factory/work-dir; ./local_start.sh ENTRY_NAME fast -- GLIDEIN_Collector `hostname`
</pre>
<p />
<h1><a name="Troubleshooting"></a> Troubleshooting </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="File_Locations"></a> File Locations </span></h2>
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table6" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=0;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">File Description</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=1;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">File Location</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGlideinWMSFactory?cover=print;sortcol=2;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Comment</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Configuration file </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> /etc/gwms-factory/glideinWMS.xml </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> Main configuration file </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Logs </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1"> /var/log/gwms-factory/server/factory </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol"> Overall server logs </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol">  </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> /var/log/gwms-factory/server/entry_NAME </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> Specific entry logs (generally more useful) </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol">  </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1"> /var/log/gwms-factory/client </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol"> Glidein Pilot logs seperated by user and entry. </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Startup script </td>
			<td bgcolor="#ffffff" colspan="2" valign="top" class="twikiTableCol1"> /etc/init.d/gwms-factory </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Web Directory </td>
			<td bgcolor="#f2f3f6" colspan="2" valign="top" class="twikiTableCol1"> /var/lib/gwms-factory/web-area </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Web Base </td>
			<td bgcolor="#ffffff" colspan="2" valign="top" class="twikiTableCol1"> /var/lib/gwms-factory/web-base </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Working Directory </td>
			<td bgcolor="#f2f3f6" colspan="2" valign="top" class="twikiTableCol1 twikiLast"> /var/lib/gwms-factory/work-dir/ </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Increase_the_log_level_and_chang"></a> Increase the log level and change rotation policy </span></h2>
You can increase the log level of the frontend. To add a log file with all the log information add the following line with all the message types in the <code>process_log</code> section of <code>/etc/gwms-factory/glideinWMS.xml</code>:
<pre class="file">&lt;log_retention>
   &lt;process_logs>
       &lt;process_log extension="all" max_days="7.0" max_mbytes="100.0" min_days="3.0" msg_types="DEBUG,EXCEPTION,INFO,ERROR,ERR"/>
</pre>
You can also change the rotation policy and choose whether compress the rotated files, all in the same section of the config files: <ul>
<li> max_bytes is the max size of the log files
</li> <li> max_days it will be rotated.
</li> <li> compression specifies if rotated files are compressed
</li> <li> backup_count is the number of rotated log files kept 
</li></ul> 
Further details are in the <a href="http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/doc.prd/factory/configuration.html#process_logs" target="_top">reference documentation</a>.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Failed_authentication_errors"></a> Failed authentication errors </span></h2>
<p />
If you get messages such as these in the logs, the factory does not trust the frontend and will not submit glideins.
<p />
<pre class="screen">
WARNING: Client fermicloud128-fnal-gov_OSG_gWMSFrontend.main (secid: frontend_name) not in white list. Skipping request
</pre>
  * This error means that the frontend name in the security section of the factory does not match the security_name in the frontend.
<p />
<pre class="screen">
Client fermicloud128-fnal-gov_OSG_gWMSFrontend.main (secid: frontend_name) is not coming from a trusted source;
 AuthenticatedIdentity vofrontend_condor@fermicloud130.fnal.gov!=vofrontend_factory@fermicloud130.fnal.gov. 
Skipping for security reasons.
</pre>
  * This error means that the identity in the security section of the factory does not match what the <code>/etc/condor/certs/condor_mapfile</code> authenticates the frontend to in condor (AuthenticatedIdentity in the classad).
<p />
Make sure the attributes are correctly lined up as in the Frontend security configuration section above.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Glideins_start_but_do_not_connec"></a> Glideins start but do not connect to User pool / VO Frontend </span></h2>
<p />
Check the appropriate job err and out logs in <code>/var/log/gwms-factory/client</code> to see if any errors were reported.
Often, this will be a pilot unable to access a web server or with an invalid proxy.  Also, verify that the condor_mapfile is correct on the VO Frontend's user pool collector and configuration.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Glideins_start_but_fail_before_r"></a> Glideins start but fail before running job with error "Proxy not long lived enough" </span></h2>
If the glideins are running on a resource (entry) but the jobs are not running and the log files in <code>/var/log/gwms-factory/client/user_frontend/glidein_gfactory_instance/ENTRY_NAME</code>
report an error like "Proxy not long lived enough (86096 s left), shortened retire time ...", 
then probably the HTCondor RLM on the Compute Element is delegating the proxy and shortening its lifespan.
<p />
This can be fixed by setting <code><b>DELEGATE_JOB_GSI_CREDENTIALS = FALSE</b></code> as suggested in the <a href="/bin/view/Documentation/Release3/InstallComputeElement#5_1_If_you_are_using_Condor" class="twikiAnchorLink">CE install document</a>.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Condor_root_switchboard_errors"></a> Condor_root_switchboard errors </span></h2>
<p />
Make sure that you run <code>service gwms-factory upgrade</code> instead of the more light-weight <code>service gwms-factory reconfig</code>
to ensure that all scripts are created correctly. 
<p />
Next verify <code>/etc/condor/privsep_config</code> to make sure the users and groups are listed correctly.
<p />
Lastly, verify that permissions are correct.  The parent directory of all valid-dirs must be owned by root.
<p />
<h1><a name="References"></a> References </h1>
<p /> <ul>
<li> <a href="http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/doc.prd" target="_top">http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/doc.prd</a>
</li> <li> <a href="http://twiki.grid.iu.edu/bin/view/Documentation/Release/GlideinWMSVOFrontendInstall" target="_top">http://twiki.grid.iu.edu/bin/view/Documentation/Release/GlideinWMSVOFrontendInstall</a>
</li></ul> 
<p />
<p />
<h1><a name="Comments"></a> Comments </h1>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Documentation/Release3/InstallGlideinWMSFactory" enctype="multipart/form-data" name="tableappend0" id="tableappend0">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="0"  /></form>
<p />
<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 <code><b>===============</b></code>
<p />
 Thank you for claiming ownership for this document! Please fill in your <span class="twikiNewLink">FirstLast<a href="/bin/edit/Documentation/Release3/FirstLast?topicparent=Documentation/Release3.InstallGlideinWMSFactory" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> name here: <ul>
<li> Local OWNER = <span class="twikiNewLink">MarcoMambelli<a href="/bin/edit/Documentation/Release3/MarcoMambelli?topicparent=Documentation/Release3.InstallGlideinWMSFactory" rel="nofollow" title="MarcoMambelli (this topic does not yet exist; you can create it)">?</a></span>
</li></ul> 
<p />
 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (<span class="twikiNewLink">ComputeElement<a href="/bin/edit/Documentation/Release3/ComputeElement?topicparent=Documentation/Release3.InstallGlideinWMSFactory" rel="nofollow" title="ComputeElement (this topic does not yet exist; you can create it)">?</a></span>|General|Trash/Trash/Integration|Monitoring|Operations|Security|Storage|Trash/Tier3|User|VO) <ul>
<li> Local DOC_AREA       = General
</li></ul> 
<p />
 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (Developer|Documenter|Scientist|Student|SysAdmin|VOManager) <ul>
<li> Local DOC_ROLE       = <span class="twikiNewLink">SysAdmin<a href="/bin/edit/Documentation/Release3/SysAdmin?topicparent=Documentation/Release3.InstallGlideinWMSFactory" rel="nofollow" title="SysAdmin (this topic does not yet exist; you can create it)">?</a></span>
</li></ul> 
<p />
 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (<span class="twikiNewLink">HowTo<a href="/bin/edit/Documentation/Release3/HowTo?topicparent=Documentation/Release3.InstallGlideinWMSFactory" rel="nofollow" title="HowTo (this topic does not yet exist; you can create it)">?</a></span>|Installation|Knowledge|Navigation|Planning|Training|Troubleshooting) <ul>
<li> Local DOC_TYPE       = Installation  Please define if this document in general needs to be reviewed before release ( 1 | 0 )
</li> <li> Local INCLUDE_REVIEW = 1
</li></ul> 
<p />
 Please define if this document in general needs to be tested before release ( 1 | 0 ) <ul>
<li> Local INCLUDE_TEST   = 1
</li></ul> 
<p />
 change to 1 once the document is ready to be reviewed and back to 0 if that is not the case <ul>
<li> Local REVIEW_READY   = 1
</li></ul> 
<p />
 change to 1 once the document is ready to be tested and back to 0 if that is not the case <ul>
<li> Local TEST_READY     = 1
</li></ul> 
<p />
 change to 1 only if the document has passed the review and the test (if applicable) and is ready for release <ul>
<li> Local RELEASE_READY  = 0
</li></ul> 
<p />
<p />
 DEAR DOCUMENT REVIEWER
 <code><b>==================</b></code>
<p />
 Thank for reviewing this document! Please fill in your <span class="twikiNewLink">FirstLast<a href="/bin/edit/Documentation/Release3/FirstLast?topicparent=Documentation/Release3.InstallGlideinWMSFactory" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> name here: <ul>
<li> Local REVIEWER       = <span class="twikiNewLink">ParagMhashilkar<a href="/bin/edit/Documentation/Release3/ParagMhashilkar?topicparent=Documentation/Release3.InstallGlideinWMSFactory" rel="nofollow" title="ParagMhashilkar (this topic does not yet exist; you can create it)">?</a></span> Please define the review status for this document to be in progress ( 2 ), failed ( 0 ) or passed ( 1 )
</li> <li> Local REVIEW_PASSED  = 2
</li></ul> 
<p />
<p />
 DEAR DOCUMENT TESTER
 <code><b>================</b></code>
<p />
 Thank for testing this document! Please fill in your <span class="twikiNewLink">FirstLast<a href="/bin/edit/Documentation/Release3/FirstLast?topicparent=Documentation/Release3.InstallGlideinWMSFactory" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> name here: <ul>
<li> Local TESTER         = <span class="twikiNewLink">ParagMhashilkar<a href="/bin/edit/Documentation/Release3/ParagMhashilkar?topicparent=Documentation/Release3.InstallGlideinWMSFactory" rel="nofollow" title="ParagMhashilkar (this topic does not yet exist; you can create it)">?</a></span> Please define the test status for this document to be in progress ( 2 ), failed ( 0 ) or passed ( 1 )
</li> <li> Local TEST_PASSED    = 2
</li></ul> 
############################################################################################################
--></div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Documentation/Release3<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Documentation/Release3/NavTechGlideinWMS" class="twikiLink">NavTechGlideinWMS</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>InstallGlideinWMSFactory</span> <br />    
Topic revision: r49 - 07 Feb 2017 - 19:34:16 - <a href="/bin/view/Main/BrianBockelman" class="twikiLink">BrianBockelman</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />