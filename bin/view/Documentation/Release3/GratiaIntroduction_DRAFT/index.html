<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GratiaIntroduction_DRAFT &lt; Documentation/Release3 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Documentation/Release3/GratiaIntroduction_DRAFT?_T=16 Feb 2017" type="application/x-wiki" title="edit GratiaIntroduction_DRAFT" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Documentation/Release3/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/GratiaIntroduction_DRAFT"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFFFFF;
	}
	.patternBookView {
		border-color:#FFFFFF;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Introduction_to_Gratia_Accountin"></a> Introduction to Gratia Accounting </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Introduction_to_Gratia_Accountin"> Introduction to Gratia Accounting</a> <ul>
<li> <a href="?cover=print#About_this_Document"> About this Document</a>
</li> <li> <a href="?cover=print#What_is_Accounting"> What is Accounting?</a>
</li> <li> <a href="?cover=print#What_is_Gratia"> What is Gratia?</a> <ul>
<li> <a href="?cover=print#Gratia_probes"> Gratia probes</a>
</li> <li> <a href="?cover=print#Gratia_probe_lifecycle"> Gratia probe lifecycle </a>
</li></ul> 
</li> <li> <a href="?cover=print#Details"> Details</a>
</li></ul> 
</li></ul> 
</div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="About_this_Document"></a> About this Document </span></h2>
<p />
This document serves as an introduction to the Gratia accounting system: where the accounting takes place, where the accounting data is uploaded, and how the accounting data is displayed.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="What_is_Accounting"></a> What is Accounting? </span></h2>
<p />
In the OSG, job statistics and data transfers are recorded to determine computing and storage usage trends. The process by which this data is recorded and collected is called <em>accounting</em>.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="What_is_Gratia"></a> What is Gratia? </span></h2>
<p />
Gratia is used for accounting of jobs and data transfers in the OSG. Individual <code>Gratia probes</code> running on site resources (e.g. Compute Element, Storage Element, GlideinWMS Frontend, etc.) collect data in the form of accounting records. In turn, these records are sent to a <code>Gratia Collector</code> (by default, the central OSG Gratia Collector), which can be accessed to visualize the records by <code>Gratia Reporters</code>.
<p />
<img src="/twiki/pub/Documentation/Release3/GratiaIntroduction_DRAFT/gratia-basics.png" alt="gratia-basics.png" />    
<p />
These are the definitions of the major elements in the above figure.
<p /> <ul>
<li> <strong>Gratia probe:</strong> A piece of software that runs on a site's resource, generates accounting records, and uploads the accounting records to a <code>Gratia server</code>.
</li> <li> <strong>Gratia server:</strong> A host that receives Gratia accounting records from the <code>Gratia probes</code> and can display aggregate records via <code>Reporter</code> (see below)
</li> <li> <strong>Collector:</strong> A web service running on the <code>Gratia server</code> that collects data from one or more <code>Gratia probes</code>. Users do not directly interact with the <code>Collector</code>.
</li> <li> <strong>Reporter:</strong> A web service running on the <code>Gratia server</code> that can be accessed using web clients such as <a href="http://display.grid.iu.edu/" target="_top">OSG Display</a> or <a href="http://gratiaweb.grid.iu.edu/" target="_top">Gratia-Webtool</a> as well as regular e-mail reports (subscribe <a href="/bin/view/Accounting/ReportsDescription" class="twikiLink">here</a>).
</li></ul> 
<p />
<h3><a name="Gratia_probes"></a> Gratia probes </h3>
<p />
Currently, there are over a dozen probes that can report to a <code>Gratia collector</code> and can be divided into the following four categories.
<p /> <ul>
<li> <strong>Local Batch System probes:</strong> A probe specific to to the type of site's batch system is running at each grid site. It collects information about finished jobs. Condor, Torque (PBS), LSF, SGE and Slurm Batch Systems are supported. The probes are installed with installation of a Compute Element or GlideinWMS Frontend.
</li> <li> <strong>Transfer probes:</strong> A probe collects information about the file transfers from/to Storage installed at each grid site. GridFTP, dCache, xrootd, hadoop transfer probes are supported. A probe is installed with installation of a Storage Element.
</li> <li> <strong>Storage probes:</strong> A probe gathers information about physical and logical pools utilization of a Storage installed at each grid site.   dCache, xrootd, hadoop storage probe are supported. A probe is installed with installation of a Storage Element.
</li> <li> <strong>Worker Node probes:</strong> The probes that  may be installed on a worker node are ps-accounting probe and glexec probes. ps-accounting probe collects unix accounting information about finished processes ran by user. Glexec probe reports information about identity  of the user running jobs via glidein pilot. More information about glexec could be found <a href="/bin/view/Documentation/Release3/InstallGlexec" class="twikiLink">here</a>.
</li></ul> 
<p />
<h3><a name="Gratia_probe_lifecycle"></a> Gratia probe lifecycle </h3>
<p />
The following outlines how Gratia probes collect and upload accounting records to a Gratia collector:
<p /> <ol>
<li> The probe is invoked with the configuration located in <code>/etc/gratia/<font color="#ff0000">PROBE-NAME</font>/ProbeConfig</code>.
</li> <li> It collects the accounting information from the underlying system. For example, the Condor probe will read job history files from <code>PER_JOB_HISTORY_DIR</code> (default: <code>/var/lib/gratia/data</code>).
</li> <li> The collected data is transformed into Gratia records and the records are saved into <code>/var/lib/gratia/tmp/gratiafiles/</code>.
</li> <li> When there are a sufficient number of Gratia records, or when enough time has passed, Gratia uploads sets of records in batches to the Gratia server and removes records that have been successfully uploaded.
</li> <li> If there are failures in uploading the files to the Gratia server: <ol>
<li> Files are not removed from <code>gratiafiles</code> until they are successfully uploaded.
</li> <li> Errors are logged to log files in <code>/var/log/gratia</code>.
</li> <li> The uploads will be tried again later.
</li> <li> <font color="#ff0000"> TO DO: In some cases, failed transfers get moved somewhere else. No details, [todo] ask Brian</font>
</li></ol> 
</li></ol> 
<p />
<a name="ReferenceSection"></a>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Details"></a> Details </span></h2>
<p /> <ul>
<li> <a href="/bin/view/Documentation/Release3/InstallGratia_DRAFT" class="twikiLink">Installing and Maintaining Gratia Probes</a>
</li> <li> <a href="/bin/view/Documentation/Release3/TroubleshootingGratia_DRAFT" class="twikiLink">Troubleshooting Gratia Probes</a>
</li> <li> <a href="/bin/view/Documentation/Release3/GratiaReference_DRAFT" class="twikiLink">Gratia Probe Reference</a>
</li> <li> <a href="http://gratiaweb.opensciencegrid.org" target="_top">Gratia reports by OSG site or VO</a>
</li> <li> <a href="http://display.opensciencegrid.org" target="_top">Gratia aggregate reports</a>
</li></ul> </div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Documentation/Release3<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GratiaIntroduction_DRAFT</span> <br />    
Topic revision: r5 - 28 Nov 2016 - 22:45:28 - <a href="/bin/view/Main/BrianLin" class="twikiLink">BrianLin</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />