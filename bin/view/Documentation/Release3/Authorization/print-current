<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> Authorization &lt; Documentation/Release3 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Documentation/Release3/Authorization?_T=16 Feb 2017" type="application/x-wiki" title="edit Authorization" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Documentation/Release3/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/Authorization"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFFFFF;
	}
	.patternBookView {
		border-color:#FFFFFF;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Edg_Mkgridmap"></a> Edg-Mkgridmap </h1>
(This is obsolete. Please go <a href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/Edg-mkgridmap" target="_top">here</a> for latest information )
<p />
This document aims to describe in detail how you can authorize the users accessing the resources that you provide using <code>edg-mkgridmap</code> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Configuration"></a> Configuration </span></h2> <ul>
<li> First, you need to tell <code>edg-mkgridmap</code>, which Virtual Organizations (VOs) you wish to support.       For this, edit the <code>/etc/edg-mkgridmap.conf</code> such that all VOs that you wish to support are present and uncommented and all VOs that you do not wish to support are either commented or not present.
</li></ul> 
Example in which <code>cdf</code> VO is disabled and <code>fermilab</code> VO is enabled
<pre class="file">
[root@fermicloud046 ~]# cat /etc/edg-mkgridmap.conf 
#### GROUP: group URI [lcluser]
#
#-------------------
# USER-VO-MAP cdf CDF -- 1 -- Dennis Box (dbox@fnal.gov)     
#group vomss://voms.fnal.gov:8443/voms/cdf cdf
#group vomss://voms.cnaf.infn.it:8443/voms/cdf cdf
#-------------------
# USER-VO-MAP fermilab FERMILAB -- 2 -- Fermilab Service Desk (servicedesk@fnal.gov)  
group vomss://voms.fnal.gov:8443/voms/fermilab fermilab
[root@fermicloud046 ~]#
</pre>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Execution_Enabling"></a> Execution/Enabling </span></h2> <ul>
<li> Second, you need to configure <code><b>edg-mkgridmap</b></code> to run automatically via a cron job. To enable this, you need to run the following command.
</li></ul> 
<p />
     <pre class="rootscreen">
[root@fermicloud046 ~]# /sbin/service edg-mkgridmap start
Enabling periodic edg-mkgridmap:                           [  OK  ]
[root@fermicloud046 ~]#
     </pre>
     The entry in cron file (<code>/etc/cron.d/edg-mkgridmap-cron</code>) looks like
     <pre class="file">
     [root@fermicloud046 ~]# cat /etc/cron.d/edg-mkgridmap-cron 
# Cron job running by default every 6 hours.
# The lock file can be enabled or disabled via a
# service edg-mkgridmap start
# chkconfig edg-mkgridmap on

# Note the lock file not existing is success hence the the slightly odd logic
# below.
# run every 6 hours but sleep for random time every 5 hours

0 */6 * * * root perl -e 'sleep rand 18000'; [ ! -f /var/lock/subsys/edg-mkgridmap ] || /usr/sbin/edg-mkgridmap
[root@fermicloud046 ~]#
     </pre>
<strong>Note</strong>: As you can see above, that this cron will run every 6 hours. If you do not want to wait that long, you can execute the command <code>/usr/sbin/edg-mkgridmap</code> directly on command line
<p />
You can also chkconfig it on, so it automatically starts if the machine was rebooted
<pre class="rootscreen">
[root@fermicloud046 ~]# chkconfig edg-mkgridmap on
[root@fermicloud046 ~]# chkconfig --list edg-mkgridmap
edg-mkgridmap  	0:off	1:off	2:on	3:on	4:on	5:on	6:off
[root@fermicloud046 ~]# chkconfig edg-mkgridmap off
[root@fermicloud046 ~]# chkconfig --list edg-mkgridmap
edg-mkgridmap  	0:off	1:off	2:off	3:off	4:off	5:off	6:off
[root@fermicloud046 ~]#
</pre>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Disabling"></a> Disabling </span></h2>
     If, for some reason, you want to disable the automatic execution of <code>edg-mkgridmap</code>, run following command
     <pre class="rootscreen">
[root@fermicloud046 ~]# /sbin/service edg-mkgridmap stop
Disabling periodic edg-mkgridmap:                          [  OK  ]
[root@fermicloud046 ~]#
     </pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="When_edg_mkgridmap_runs_what_doe"></a> When <code>edg-mkgridmap</code> runs, what does it do? </span></h2>
    It reads the <code>/etc/edg-mkgridmap.conf</code> configuration file, and contacts VOMS server (for each VO that is uncommented ) to retrieve list of all users that belong to that VO.
    It then, reads <code>/etc/osg/local-user-vo-map</code> file to see if there are any local users that you may have defined on your site. If you have defined such local users, it will append them to the list of users that it already has. The resulting file <code>/var/lib/osg/user-vo-map</code> will contain the complete list. Each line in this file is a mapping between the user DN and the local user to which the user got mapped to.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Gridmap_file"></a> Gridmap file </span></h2>
<p />
<h3><a name="Configuring_Gridmap_Support"></a> Configuring Gridmap Support </h3>
<p />
By default, GridFTP uses a gridmap file, found in <code>/etc/grid-security/gridmap-file</code>.
This file is not generated by default.  There are two ways you can generate this file.
You can generate this file manually, by including DN/username combinations.  This is most useful for debugging.  Otherwise, you can use <code>edg-mkgridmap</code>, which will periodically contact a list of VOMS servers that you specify. It assembles a list of users from those servers and creates a grid-mapfile.  This grid-mapfile serves both as a list of authorized users and provides a mapping from user dns to local user ids.  edg-mkgridmap is already installed with 
<p />
In order to use edg-mkgridmap, review <code>/etc/edg-mkgridmap.conf</code> to make sure that it has all VOs that you are interested in and also to comment out any VOs that you do not wish to support. 
<pre class="rootscreen">
vi /etc/edg-mkgridmap.conf
</pre>
This utility <code>edg-mkgridmap</code> runs as a cronjob <code>/etc/cron.d/edg-mkgridmap-cron</code> (by default every 6 hours). You can also run <code>edg-mkgridmap</code> manually to see that it generates <code>/etc/grid-security/gridmap-file</code>.  
<pre class="rootscreen">
edg-mkgridmap
</pre>
Then, you can enable/start the service.
<pre class="rootscreen">
/sbin/service edg-mkgridmap start
/sbin/chkconfig edg-mkgridmap on
</pre>
<p />
Troubleshooting information on edg-mkgridmap can be found <a href="https://www.opensciencegrid.org/bin/view/ReleaseDocumentation/EdgMkgridmapTroubleshootingGuide" target="_top">here</a>
<p />
-- <a href="/bin/view/Main/NehaSharma" class="twikiLink">NehaSharma</a> - 13 Jun 2012</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Documentation/Release3<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Documentation/Release3/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>Authorization</span> <br />    
Topic revision: r3 - 10 Dec 2013 - 20:52:30 - <a href="/bin/view/Main/NehaSharma" class="twikiLink">NehaSharma</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />