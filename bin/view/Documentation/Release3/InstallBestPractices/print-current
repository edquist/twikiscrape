<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> InstallBestPractices &lt; Documentation/Release3 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Documentation/Release3/InstallBestPractices?_T=16 Feb 2017" type="application/x-wiki" title="edit InstallBestPractices" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Documentation/Release3/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/InstallBestPractices"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFFFFF;
	}
	.patternBookView {
		border-color:#FFFFFF;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Installation_Best_Practices"></a>  <strong>Installation Best Practices</strong> </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#About_This_Document"> About This Document</a>
</li> <li> <a href="?cover=print#Install_yum_priorities"> Install yum-priorities</a>
</li> <li> <a href="?cover=print#Automatic_Updates"> Automatic Updates</a>
</li> <li> <a href="?cover=print#Troubleshooting"> Troubleshooting</a>
</li> <li> <a href="?cover=print#Considerations_for_Large_Sites"> Considerations for Large Sites</a>
</li> <li> <a href="?cover=print#Repository_Mirrors"> Repository Mirrors</a>
</li> <li> <a href="?cover=print#CA_Certificate_Installation_Cons"> CA Certificate Installation Considerations</a>
</li> <li> <a href="?cover=print#Certificate_Revocation_List_CRL"> Certificate Revocation List (CRL) Installation/Update</a>
</li> <li> <a href="?cover=print#Removing_Large_numbers_of_RPMs"> Removing Large numbers of RPMs</a>
</li> <li> <a href="?cover=print#Comments"> Comments</a>
</li></ul> 
</div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="About_This_Document"></a> About This Document </span></h2>
This document covers best practices to be used in installing software packages or security certificates on large numbers of hosts.  It assumes you understand <a href="/bin/view/Documentation/Release3/YumRpmBasics" class="twikiLink">YUM/RPM Basics</a> and <a href="/bin/view/Documentation/Release3/YumRepositories" class="twikiLink">YUM Repositories</a>.
<p />
<a name="YumPriorities"></a>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Install_yum_priorities"></a> Install yum-priorities </span></h2>
<p />
We use <code>yum</code> priorities to ensure that we get the right packages from the OSG repositories. Please install it:
<p />
<pre class="screen">
[root@client ~]$ yum install yum-priorities
</pre>
<p />
There is <a href="http://wiki.centos.org/PackageManagement/Yum/Priorities" target="_top">good documentation</a> in the wild about yum priorities, but we'll summarize the essential bits for you. 
<p />
The basic idea of yum priorities is that if a package is found in two repositories, priorities will influence how yum chooses which package to install. We want the OSG software repository to be chosen instead of the EPEL repository so software, such as Globus, comes from our repository instead of the EPEL repository. (This is important because you will have installation errors if you get the EPEL Globus.)
<p />
Yum priorities is a <em>yum plugin</em>. Once enabled, you can set the priority of each repository (located in /etc/yum.repos.d) The lower the numerical priority, the better the priority. The default priority for a repository when it's not specified is 99. We set the priority for the OSG repository to be 98, as you can see here:
<p />
<pre class="screen">
% cat /etc/yum.repos.d/osg.repo
[osg]
name=OSG Software for Enterprise Linux 5 - $basearch
mirrorlist=http://repo.grid.iu.edu/mirror/osg-release/$basearch
failovermethod=priority
priority=<font color="#ff0000">98</font>
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OSG
</pre>
<p />
You can adjust these priorities if you have special needs at your site.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Automatic_Updates"></a> Automatic Updates </span></h2>
<p />
We strongly recommend against automatic updates for production services.  You want to only change software versions during a controlled downtime (or, at least, while a human is watching); we strive to thoroughly test software updates, but cannot guarantee new version of software will not be problematic for your site.
<p />
For testbeds, automatic updates are suggested
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Troubleshooting"></a> Troubleshooting </span></h2>
<p />
Sometimes when installing, you will get an error like this:
<p />
<pre class="screen">
http://ftp1.scientificlinux.org/linux/scientific/54/x86_64/updates/security/repodata/filelists.sqlite.bz2: <font color="#ff0000">[Errno -1] Metadata file does not match checksum</font>
</pre>
<p />
This often indicates that you have out of date information, cached by <code>yum</code>. The following command will clear the out of date information, and you can try again:
<p />
<pre class="screen">
yum --enablerepo='*' clean all
</pre> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Considerations_for_Large_Sites"></a> Considerations for Large Sites </span></h2>
<p />
While <code>yum</code> is a wonderful tool for installing software on a single server, it's a poor tool to install the same version of the software on many hosts.  We <strong>strongly</strong> recommend a cluster management tool; as far as we know, all cluster management tools provide a mechanism to create a local yum repository and have all your worker nodes use that.
<p />
If you have more than 20 worker nodes, we have the following advice: <ul>
<li> Do <strong>not</strong> use one of the OSG repositories directly for worker node installations; build a local mirror instead. (See below).
</li> <li> Distribute CRLs to the worker nodes using an HTTP proxy.
</li></ul> 
Both items are covered in this document.
<p />
In the future, we will be providing a mechanism for distributing CAs and CRLs via a shared file system; this is not quite finished.  If you choose to do this, remember that your security infrastructure will only be as safe and reliable as the shared filesystem!
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Repository_Mirrors"></a> Repository Mirrors </span></h2>
<p />
A local yum mirror allows you to reduce the amount of external bandwidth used when updating or installing packages.
<p />
Add the following to a file in <code>/etc/cron.d</code>:
<p />
<pre class="screen">
<font color="#ff0000">RANDOM</font> * * * * root rsync -aH rsync://repo.grid.iu.edu/osg/ /var/www/html/osg/
</pre>
<p />
Or, to mirror only a single repository:
<p />
<pre class="screen">
<font color="#ff0000">RANDOM</font> * * * * root rsync -aH rsync://repo.grid.iu.edu/osg/3.1/el6/development /var/www/html/osg/3.1/el6
</pre>
<p />
Replace <font color="#ff0000">RANDOM</font> with a number between 0 and 59.
<p />
On your worker node, you can replace the <code>baseurl</code> line of <code>/etc/yum.repos.d/osg.repo</code> with the appropriate URL for your mirror.
<p />
If your osg*.repo files still point to the legacy 3.0 repo layout (eg,
/3.0/el5/osg-release/ instead of the new /osg/3.1/el5/release/), they
can be updated to point to the new 3.1 layout by installing the latest version of
the 'osg-release' package:
<p />
<pre class="screen">
yum update --enablerepo=osg-testing osg-release
</pre>
<p />
<p />
If  you are interested in having your mirror be part of the OSG's default set of mirrors, <a href="https://ticket.grid.iu.edu/" target="_top">please file a GOC ticket</a>.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="CA_Certificate_Installation_Cons"></a> CA Certificate Installation Considerations </span></h2>
<p />
CAs are distributed in two ways: <ul>
<li> As an RPM that contains the set of CAs.  There are several such RPMs corresponding to different sets of CAs.
</li> <li> Through direct downloads from GOC with the <code>osg-update-certs</code> tool (provided by the <code>osg-ca-scripts</code> RPM).
</li></ul> 
<p />
As long as you use one of these two mechanisms, the OSG software will install successfully.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Certificate_Revocation_List_CRL"></a> Certificate Revocation List (CRL) Installation/Update </span></h2>
<p />
CRLs are not distributed via <code>yum</code>.  Instead, we provide the <code>fetch-crl</code> tool that downloads CRLs to the CA directory.
<p />
<p />
By default, <code>fetch-crl</code> connects directly to the remote CA; this is inefficient and potentially harmful if done simultaneously by many nodes (e.g. all the worker nodes of a big cluster).  We recommend you provide a HTTP proxy (such as squid) the worker nodes can connect to. <a href="/bin/view/Documentation/Release3/InstallFrontierSquid" class="twikiLink">Here</a> are instructions to install a squid proxy.
<p />
To configure fetch-crl to use an HTTP proxy server: <ul>
<li> If using <code>fetch-crl</code> version 2 (the <code>fetch-crl</code> package on RHEL5 only), then create the file  <code>/etc/sysconfig/fetch-crl</code> and add the following line: <pre class="file">
export http_proxy=<font color="#ff0000">http://your.squid.fqdn:port</font>
</pre> Adjust the URL appropriately for your proxy server.
</li> <li> If using <code>fetch-crl</code> version 3 on RHEL5 via the <code>fetch-crl3</code> package or on RHEL6/RHEL7 via the <code>fetch-crl</code> package, then create or edit the file <code>/etc/fetch-crl3.conf</code> (RHEL5) or <code>/etc/fetch-crl.conf</code> (RHEL6/RHEL7) and add the following line: <pre class="file">
http_proxy=<font color="#ff0000">http://your.squid.fqdn:port</font>
</pre> Again, adjust the URL appropriately for your proxy server.
</li></ul> 
<p />
Note that the <code><b>nosymlinks</b></code> option in the configuration files refers to ignoring links within the certificates directory (e.g. two different names for the same file). It is perfectly fine if the path of the CA certificates directory itself (<code>infodir</code>) is a link to a directory.
<p />
Any modifications to the configuration file will be preserved during an RPM update.
<p />
For more details, please see our <a href="/bin/view/Documentation/Release3/InstallCertAuth" class="twikiLink">fetch-crl documentation</a>.
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Removing_Large_numbers_of_RPMs"></a> Removing Large numbers of RPMs </span></h2>
<p />
Note that, in general, there is no mechanism to reverse a <code>yum install</code> command in RHEL5.  Plan accordingly.
<p />
We have prepared a <a href="/bin/view/Documentation/Release3/RemoveOSGComponents" class="twikiLink">special yum plugin</a>, <code>yum-remove-osg</code>, to assist in removing OSG RPMs.
<p />
To re-iterate: just because it removes most/all of the OSG RPMs, <code>yum remove</code> is not guaranteed to be a perfect reversal of <code>yum install</code> (things like post-scripts have side-effects that must be taken into account; these are not in general reversible).  On the upside, removal of the RPMs will be "good enough" for many sites.
<p />
If you need a bit-for-bit, exact replica of your system prior to the upgrade, you'll want to use a backup strategy and restore from backup.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Comments"></a> Comments </span></h2>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Documentation/Release3/InstallBestPractices" enctype="multipart/form-data" name="tableappend0" id="tableappend0">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="0"  /></form>
<p />
<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 <code><b>===============</b></code>
<p />
 Thank you for claiming ownership for this document! Please fill in your <span class="twikiNewLink">FirstLast<a href="/bin/edit/Documentation/Release3/FirstLast?topicparent=Documentation/Release3.InstallBestPractices" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> name here: <ul>
<li> Local OWNER = <span class="twikiNewLink">BrianBockelman<a href="/bin/edit/Documentation/Release3/BrianBockelman?topicparent=Documentation/Release3.InstallBestPractices" rel="nofollow" title="BrianBockelman (this topic does not yet exist; you can create it)">?</a></span>
</li></ul> 
<p />
 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (<span class="twikiNewLink">ComputeElement<a href="/bin/edit/Documentation/Release3/ComputeElement?topicparent=Documentation/Release3.InstallBestPractices" rel="nofollow" title="ComputeElement (this topic does not yet exist; you can create it)">?</a></span>|Storage|VO|Security|User|Monitoring|General|Trash/Trash/Integration|Operations|Tier3) <ul>
<li> Local DOC_AREA       = <span class="twikiNewLink">ComputeElement<a href="/bin/edit/Documentation/Release3/ComputeElement?topicparent=Documentation/Release3.InstallBestPractices" rel="nofollow" title="ComputeElement (this topic does not yet exist; you can create it)">?</a></span>
</li></ul> 
<p />
 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (<span class="twikiNewLink">EndUser<a href="/bin/edit/Documentation/Release3/EndUser?topicparent=Documentation/Release3.InstallBestPractices" rel="nofollow" title="EndUser (this topic does not yet exist; you can create it)">?</a></span>|Student|Developer|SysAdmin|VOManager) <ul>
<li> Local DOC_ROLE       = <span class="twikiNewLink">SysAdmin<a href="/bin/edit/Documentation/Release3/SysAdmin?topicparent=Documentation/Release3.InstallBestPractices" rel="nofollow" title="SysAdmin (this topic does not yet exist; you can create it)">?</a></span>
</li></ul> 
<p />
 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge) <ul>
<li> Local DOC_TYPE       = Installation  Please define if this document in general needs to be reviewed before release ( 1 | 0 )
</li> <li> Local INCLUDE_REVIEW = 1
</li></ul> 
<p />
 Please define if this document in general needs to be tested before release ( 1 | 0 ) <ul>
<li> Local INCLUDE_TEST   = 0
</li></ul> 
<p />
 change to 1 once the document is ready to be reviewed and back to 0 if that is not the case <ul>
<li> Local REVIEW_READY   = 0
</li></ul> 
<p />
 change to 1 only if the document has passed the review and the test (if applicable) and is ready for release <ul>
<li> Local RELEASE_READY  = 0
</li></ul> 
<p />
<p />
 DEAR DOCUMENT REVIEWER
 <code><b>==================</b></code>
<p />
 Thank you for reviewing this document! Please fill in your <span class="twikiNewLink">FirstLast<a href="/bin/edit/Documentation/Release3/FirstLast?topicparent=Documentation/Release3.InstallBestPractices" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> name here: <ul>
<li> Local REVIEWER       = <span class="twikiNewLink">SuchandraThapa<a href="/bin/edit/Documentation/Release3/SuchandraThapa?topicparent=Documentation/Release3.InstallBestPractices" rel="nofollow" title="SuchandraThapa (this topic does not yet exist; you can create it)">?</a></span> Please define the review status for this document to be in progress ( 2 ), failed ( 0 ) or passed ( 1 )
</li> <li> Local REVIEW_PASSED  = 0
</li></ul> 
<p />
<p />
 DEAR DOCUMENT TESTER
 <code><b>==================</b></code>
<p />
 Thank you for testing this document! Please fill in your <span class="twikiNewLink">FirstLast<a href="/bin/edit/Documentation/Release3/FirstLast?topicparent=Documentation/Release3.InstallBestPractices" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> name here: <ul>
<li> Local TESTER       = <span class="twikiNewLink">FirstLast<a href="/bin/edit/Documentation/Release3/FirstLast?topicparent=Documentation/Release3.InstallBestPractices" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> Please define the test status for this document to be in progress ( 2 ), failed ( 0 ) or passed ( 1 )
</li> <li> Local TEST_PASSED  = 0
</li></ul> 
<p />
############################################################################################################
-->
-- <a href="/bin/view/Main/JamesWeichel" class="twikiLink">JamesWeichel</a> - 29 Aug 2011</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Documentation/Release3<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>InstallBestPractices</span> <br />    
Topic revision: r19 - 06 Dec 2016 - 18:12:41 - <a href="/bin/view/Main/KyleGross" class="twikiLink">KyleGross</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />