<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> InstallStashCache &lt; Documentation/Release3 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Documentation/Release3/InstallStashCache?_T=16 Feb 2017" type="application/x-wiki" title="edit InstallStashCache" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Documentation/Release3/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/InstallStashCache"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFFFFF;
	}
	.patternBookView {
		border-color:#FFFFFF;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TABLEPLUGIN_table1--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
</style>
<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <style type="text/css">
code em, pre em { color: red; font-weight: normal; font-style: normal; }
</style>
<p />
<h1><a name="Installing_and_Using_StashCache"></a> Installing and Using StashCache </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Installing_and_Using_StashCache"> Installing and Using StashCache</a> <ul>
<li> <a href="?cover=print#About_This_Guide"> About This Guide</a>
</li> <li> <a href="?cover=print#Before_Starting"> Before Starting</a>
</li> <li> <a href="?cover=print#Installing_the_StashCache_metapa"> Installing the StashCache metapackage</a>
</li> <li> <a href="?cover=print#Configuring_StashCache"> Configuring StashCache</a> <ul>
<li> <a href="?cover=print#Origin_server"> Origin server</a>
</li> <li> <a href="?cover=print#Cache_server"> Cache server</a>
</li> <li> <a href="?cover=print#Common_sysconfig_xrootd_configur"> Common sysconfig/xrootd configuration</a>
</li></ul> 
</li> <li> <a href="?cover=print#Optional_configuration"> Optional configuration</a> <ul>
<li> <a href="?cover=print#Adjust_disk_utilization"> Adjust disk utilization</a>
</li> <li> <a href="?cover=print#Export_HTTP_on_StashCache_machin"> Export HTTP on StashCache machine</a>
</li> <li> <a href="?cover=print#Enable_Remote_debugging"> Enable Remote debugging</a>
</li> <li> <a href="?cover=print#Sending_monitoring_information"> Sending monitoring information</a>
</li></ul> 
</li> <li> <a href="?cover=print#Using_StashCache"> Using StashCache</a> <ul>
<li> <a href="?cover=print#Managing_StashCache_and_associat"> Managing StashCache and associated services</a>
</li> <li> <a href="?cover=print#Validating_StashCache"> Validating StashCache</a>
</li></ul> 
</li> <li> <a href="?cover=print#Registering_StashCache_and_Monit"> Registering StashCache and Monitoring</a> <ul>
<li> <a href="?cover=print#Monitoring_resources"> Monitoring resources</a>
</li> <li> <a href="?cover=print#Registering_cache_proxy"> Registering cache proxy</a>
</li> <li> <a href="?cover=print#Configuring_resource_monitoring"> Configuring resource monitoring</a>
</li></ul> 
</li> <li> <a href="?cover=print#Getting_Help"> Getting Help</a>
</li></ul> 
</li></ul> 
</div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="About_This_Guide"></a> About This Guide </span></h2>
<p />
This document describes how to install a StashCache cache, a server that caches files locally rather than serving files to the StashCache federation. The installation utilizes XRootD and HTCondor for file storage and monitoring, respectively.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Before_Starting"></a> Before Starting </span></h2>
<p />
Before starting the installation process, consider the following points:
<p /> <ul>
<li> <strong>User IDs:</strong> If they do not exist already, the installation will create the Linux user IDs <code>condor</code> and <code>xrootd</code>
</li> <li> <strong>Service certificate:</strong> The StashCache service uses a host certificate at <code>/etc/grid-security/host*.pem</code>
</li> <li> <strong>Network ports:</strong> The StashCache service must talk to the central collector on port 9619 (TCP) and XRootD services on port 1094 (TCP)
</li> <li> <strong>Hardware requirements:</strong> We recommend that a StashCache server has at least 10Gbps connectivity, 1TB of disk space, and 8GB of RAM.
</li></ul> 
<p />
As with all OSG software installations, there are some one-time steps to prepare in advance:
<p /> <ul>
<li> Ensure the host has <a href="/bin/view/Documentation/Release3/SupportedOperatingSystems" class="twikiLink">a supported operating system</a>
</li> <li> Obtain root access to the host
</li> <li> Prepare <a href="/bin/view/Documentation/Release3/YumRepositories" class="twikiLink">the required Yum repositories</a>
</li> <li> Install <a href="/bin/view/Documentation/Release3/InstallCertAuth" class="twikiLink">CA certificates</a>
</li></ul> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Installing_the_StashCache_metapa"></a> Installing the StashCache metapackage </span></h2>
<p />
The StashCache daemon consists of an XRootD server and an HTCondor-based service for collecting and reporting statistics about the cache. To simplify installation, OSG provides convenience RPMs that install all required software with a single command:
<p />
<ol>
<p />
    <li>
      <p>Clean yum cache:</p>
      <pre class="rootscreen">[root@client ~]$ yum clean all --enablerepo=*</pre>
    </li>
    <li>
      <p>Update software:</p>
      <pre class="rootscreen">[root@client ~]$ yum update</pre>
      <p>This command will update <strong>all</strong> packages on your system.</p>
    </li>
<p />
  <li>
    <p>Install the StashCache metapackage from OSG3.3 repository:</p>
    <pre class="rootscreen">[root@client ~]$ yum install stashcache-daemon fetch-crl stashcache-cache-{server || origin}</pre>
  </li>
  <li>
    <p>Mount the disk that will be used for the cache to <code>/stash</code> and set owner of the directory to <code>xrootd</code> user.
  </li>
</ol>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Configuring_StashCache"></a> Configuring StashCache </span></h2>
<p />
The following section describes required configuration to have a functional StashCache cache. StashCache packages need to be manually configured from pre-existing xrootd configuration.
<p />
<h3><a name="Origin_server"></a> Origin server </h3>
Assuming that the origin server connects only to a redirector (not directly to cache server), minimal xrootd configuration is required. The configuration file, <code>/etc/xrootd/xrootd-stashcache-origin-server.cfg</code>, in this release is overkill. Here are recommended settings to use: <pre class="file">
all.export /
set localroot = /stash
xrd.port 1094
all.role server
all.manager redirector.osgstorage.org+ 1213
oss.localroot $(localroot)
xrootd.trace emsg login stall redirect
ofs.trace none
xrd.trace conn
cms.trace all
sec.protocol  host
sec.protbind  * none
all.adminpath /var/spool/xrootd
all.pidpath /var/run/xrootd

# Sending monitoring information
xrd.report uct2-collectd.mwt2.org:9931
xrootd.monitor all auth flush 30s window 5s fstat 60 lfn ops xfr 5 dest redir fstat info user uct2-collectd.mwt2.org:9930
</pre>
<p />
<h3><a name="Cache_server"></a> Cache server </h3>
One needs to declare <code>pss.origin redirector.osgstorage.org:1024</code> instead of configuring the role manger (only the xrootd daemon, role server, is required on the cache server). Example of the configuration of cache server is as follows:
<p />
<h4><a name="XRootD_v4_4_0"></a> XRootD &lt;v4.4.0 </h4>
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  If your node is on OSG3.3 release and you have system on your node updated you might skip this config and refer to next config example in section "XRootD &gt;=v4.4.0".
</dd></dl> 
<pre class="file">
all.export  /
set cachedir = /stash
xrd.allow host *
sec.protocol  host
sec.protbind  * none
all.adminpath /var/spool/xrootd
all.pidpath /var/run/xrootd

xrootd.trace emsg login stall redirect
ofs.trace all
xrd.trace all
cms.trace all

pss.trace all

ofs.osslib  libXrdPss.so
#This is using access to data in the stash federation via redirector
pss.origin  redirector.osgstorage.org:1094
pss.cachelib libXrdFileCache.so

oss.localroot $(cachedir)

pfc.cachedir  $(cachedir)
pfc.nramprefetch 4
pfc.nramread 4

# Export HTTP on !StashCache machine
xrd.protocol http:8000 libXrdHttp.so

# Sending monitoring information
xrd.report uct2-collectd.mwt2.org:9931
xrootd.monitor all auth flush 30s window 5s fstat 60 lfn ops xfr 5 dest redir fstat info user uct2-collectd.mwt2.org:9930
</pre>
<p />
<h4><a name="XRootD_4_4_0"></a> XRootD &gt;=4.4.0 </h4>
StashCache packages (meta-package) fetch latest XRootD rpms available in OSG repository. If your node is on OSG3.3 release or you just migrated from older version than xrootd v4.4.0, cache server configuration has introduced slightly different directives in the config file than mentioned in previous section. Here is example:
<pre class="file">
all.export  /
set cachedir = /stash
xrd.allow host *
sec.protocol  host
sec.protbind  * none
all.adminpath /var/spool/xrootd

xrootd.trace emsg login stall redirect
ofs.trace all
xrd.trace all
cms.trace all

ofs.osslib  libXrdPss.so
pss.origin redirector.osgstorage.org:1094
pss.cachelib libXrdFileCache.so
pss.setopt DebugLevel 1

oss.localroot $(cachedir)

pfc.blocksize 512k
pfc.ram       32g
pfc.prefetch  10
pfc.diskusage 0.98 0.99

pss.setopt ParallelEvtLoop 10
pss.setopt RequestTimeout 25
pss.setopt ConnectTimeout 25
pss.setopt ConnectionRetry 2

# Export HTTP on !StashCache machine
xrd.protocol http:8000 libXrdHttp.so

# Sending monitoring information
xrd.report uct2-collectd.mwt2.org:9931
xrootd.monitor all auth flush 30s window 5s fstat 60 lfn ops xfr 5 dest redir fstat info user uct2-collectd.mwt2.org:9930
</pre>
<p />
<h3><a name="Common_sysconfig_xrootd_configur"></a> Common sysconfig/xrootd configuration </h3>
In both cases (origin and cach server), administrator needs to set the path of custom configuration file for its xrootd/cmds instance in <code>/etc/sysconfig/xrootd</code>. For example, for origin server change the cmds default from: <pre class="file">
CMSD_DEFAULT_OPTIONS="-l /var/log/xrootd/cmsd.log -c /etc/xrootd/xrootd-clustered.cfg -k fifo"
</pre> to <pre class="file">
CMSD_DEFAULT_OPTIONS="-l /var/log/xrootd/cmsd.log -c <span style="background-color: #FFCCFF;">/etc/xrootd/xrootd-stashcache-origin-server.cfg</span> -k fifo" 
</pre>
<p />
And, modify <code>XROOTD_DEFAULT_OPTIONS</code> in the XRootD system configuration, <code>/etc/sysconfig/xrootd</code>, so that it uses the configuration file provided by the <code>stashcache-cache-server</code> package: 
<p />
<pre class="file">
XROOTD_DEFAULT_OPTIONS="-l /var/log/xrootd/xrootd.log -c <span style="background-color: #FFCCFF;">/etc/xrootd/xrootd-stashcache-cache-server.cfg</span> -k fifo"
</pre>
<p />
<a name="OptionalConfiguration"></a>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Optional_configuration"></a> Optional configuration </span></h2>
<p />
The following configuration is not required to have a functional StashCache cache, recommended, though. The default configuration should be sufficient so you should make changes to the configuration only if you have specific reasons to do so.
<p />
<h3><a name="Adjust_disk_utilization"></a> Adjust disk utilization </h3>
To adjust the disk utilization of your StashCache cache, modify the values of <code>pfc.diskusage</code> in <code>/etc/xrootd/xrootd-stashcache-cache-server.cfg</code>:
<pre class="file">
pfc.diskusage <span style="background-color: #FFCCFF;">0.98 .99</span>
</pre>
The first value and second values correspond to the low and high usage watermarks, respectively, in percentages. When the high watermark is reached, the XRootD service will automatically purge cache objects down to the low watermark. 
<p />
<h3><a name="Export_HTTP_on_StashCache_machin"></a> Export HTTP on StashCache machine </h3>
There is possiblity to export via the HTTP protocol on the <span class="twikiNewLink">StashCache<a href="/bin/edit/Documentation/Release3/StashCache?topicparent=Documentation/Release3.InstallStashCache" rel="nofollow" title="StashCache (this topic does not yet exist; you can create it)">?</a></span> machines. One can enable adding following configuration line to <code>/etc/xrootd/xrootd-stashcache-cache-server.cfg</code> and bounce the service.
<pre class="file">
xrd.protocol http:8000 libXrdHttp.so
</pre>
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  Port 8000 must be open to public.
</dd></dl> 
<p />
<h3><a name="Enable_Remote_debugging"></a> Enable Remote debugging </h3>
This feature enables remote debugging via the digFS read-only file system
<pre class="file">
xrootd.diglib * /etc/xrootd/digauth.cf
</pre>
where <code>/etc/xrootd/digauth.cf</code> may have following content:
<pre class="file">
all allow host h=abc.org
all allow host h=*.xyz.edu
</pre>
<p />
<h3><a name="Sending_monitoring_information"></a> Sending monitoring information </h3>
We're testing Kibana based monitoring which collects xrootd information via UDP packets. It's recommended each xrootd server sets the following in the config:
<pre class="file">
all.sitename SiteName # e.g. all.sitename Nebraska
xrd.report uct2-collectd.mwt2.org:9931
xrootd.monitor all auth flush 30s window 5s fstat 60 lfn ops xfr 5 dest redir fstat info user uct2-collectd.mwt2.org:9930
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Using_StashCache"></a> Using StashCache </span></h2>
<p />
<h3><a name="Managing_StashCache_and_associat"></a> Managing StashCache and associated services </h3>
Ensure that your <code>/stash</code> disk is mounted, and then start the <code>fetch-crl</code> and <code>condor</code> service:
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <font color="#252b37">Software</font> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1"> <font color="#252b37">Service name</font> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <font color="#252b37">Notes</font> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Fetch CRL </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> On EL 6: <code>fetch-crl-boot</code> and <code>fetch-crl-cron</code> <br />     On EL 5: <code>fetch-crl3-boot</code> and <code>fetch-crl3-cron</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> See <a href="/bin/view/Documentation/Release3/InstallCertAuth#Start_Stop_fetch_crl_A_quick_gui" class="twikiAnchorLink">CA documentation</a> for more info </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> HTCondor </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1"> <code>condor</code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol"> for the sending StashCache stats to GOC htcondor collector </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> XRootD </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> <code>xrootd</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> for the cache server and origin </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> XRootD </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLast"> <code>cmsd</code> </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> for the origin only become data server in the Stash Federation </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
Start the services in the order listed and stop them in reverse order. As a reminder, here are common service commands (all run as <code>root</code>):
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <font color="#252b37">To &hellip;</font> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1 twikiLastCol"> <font color="#252b37">Run the command &hellip;</font> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Start a service </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <code>service <em>SERVICE-NAME</em> start</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Stop a service </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> <code>service <em>SERVICE-NAME</em> stop</code> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Enable a service to start during boot </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <code>chkconfig <em>SERVICE-NAME</em> on</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Disable a service from starting during boot </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> <code>chkconfig <em>SERVICE-NAME</em> off</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<h3><a name="Validating_StashCache"></a> Validating StashCache </h3>
<p />
To verify that your cache is being monitored properly, run the following command:
<p />
<pre class="screen">
[user@client ~]$ condor_status -any -l -const "Name==\"xrootd@`hostname`\""
</pre>
<p />
Where <span style="background-color: #D1CAF2;">hostname</span> is the string returned by the <code>hostname</code> command. The output of the above command should provide an HTCondor ClassAd that details the status of your cache.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Registering_StashCache_and_Monit"></a> Registering StashCache and Monitoring </span></h2>
<p />
<h3><a name="Monitoring_resources"></a> Monitoring resources </h3>
To join in on the monitoring you'll need to <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallStashCache#Registering_cache_proxy" target="_top">Register your resource</a> and send me some information about your cache instructions in the <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallStashCache#Configuring_resource_monitoring" target="_top">Configuring resource monitoring</a>.
<p />
You can see the current state of affairs here: <ul>
<li> <strong>Status history</strong>: <a href="http://tinyurl.com/pwz7tw2" target="_top">link</a>
</li> <li> <strong>Status details</strong>: <a href="http://myosg.grid.iu.edu/rgcurrentstatus/index?datasource=currentstatus&amp;rg=on&amp;rg_433=on&amp;end_type=now&amp;active=on&amp;active_value=1" target="_top">link</a> (click on the "+" sign for more detail)
</li> <li> <strong>Availability metrics</strong>: <a href="http://tinyurl.com/qx6wgq7" target="_top">link</a>
</li></ul> 
<p />
<h3><a name="Registering_cache_proxy"></a> Registering cache proxy </h3>
To register a cache instance go <a href="https://oim.grid.iu.edu/oim/resourceedit" target="_top">here</a> (with a cert in your browser). Fill in the required fields, example is displayed below:
<p /> <ul>
<li> Registering StashCache resource information: <br /> <ul>
<li> the site <strong>must be</strong> OSG-GOC <br />
</li> <li> the resource group <strong>must be</strong> Monitored Caches <br />     <img src="/twiki/pub/Documentation/Release3/InstallStashCache/resource-info.png" alt="resource-info.png" width='500' height='408' />    
</li></ul> 
</li></ul> 
<p /> <ul>
<li> Registering StashCache resource services: <br /> <ul>
<li> the service <strong>must be</strong> XRootD component <br />     <img src="/twiki/pub/Documentation/Release3/InstallStashCache/resource-services.png" alt="resource-services.png" width='500' height='330' />    
</li></ul> 
</li></ul> 
<p />
Contact Information (will be pre-filled, add or modify as you see fit) - there are several types of contact, administrative and security are the most important to the GOC - <em>DO NOT</em> check the WLCG resource box; Add a Update comment if you'd like.
<p /> <ul>
<li> Confirming and submitting StashCache resource registration: <br /> <ul>
<li> you <strong>must</strong> click the "Acceptable Use Policy" checkbox <br />     <img src="/twiki/pub/Documentation/Release3/InstallStashCache/resource-confirm.png" alt="resource-confirm.png" width='500' height='335' />  
</li></ul> 
</li></ul> 
<p />
Hit the <strong>blue</strong> submit button.
<p />
<h3><a name="Configuring_resource_monitoring"></a> Configuring resource monitoring </h3>
E.g. for the Indiana instance the status of the following command is checked:
<code>xrdcp root://redirector.osgstorage.org//stash/user/test.1M /tmp/dump</code>
<p />
If the return status is zero, the cache is working, otherwise it is not. What we need from you is: <ul>
<li> the equivalent <code>//stash/user/test.1M</code> a file you select that will always be there.
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Getting_Help"></a> Getting Help </span></h2>
<p />
To get assistance, please use the <a href="/bin/view/Documentation/HelpProcedure" class="twikiLink">this page</a>.  </div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Documentation/Release3<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>InstallStashCache</span> <br />    
Topic revision: r15 - 23 Jan 2017 - 17:42:54 - <a href="/bin/view/Main/MarianZvada" class="twikiLink">MarianZvada</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />