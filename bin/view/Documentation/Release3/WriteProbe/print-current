<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> WriteProbe &lt; Documentation/Release3 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Documentation/Release3/WriteProbe?_T=16 Feb 2017" type="application/x-wiki" title="edit WriteProbe" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Documentation/Release3/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/WriteProbe"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFFFFF;
	}
	.patternBookView {
		border-color:#FFFFFF;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="How_to_write_an_RSV_probe"></a>  How to write an RSV probe: </h1>
<p />
This page contains the technical details for how to write an RSV probe.  The <a href="/bin/view/Documentation/Release3/WriteYourOwnRSVProbe" class="twikiLink">overview of the probe writing process is here</a>.
<p />
Writing a probe has become <strong>much</strong> easier with the RSV 3.3 release! Instead of writing a script that fits into the framework of RSV you simply write a script that does the interesting work, and then the new RSV architecture will do the RSV bits automatically for you.  Specifically, the RSV framework will now  <ul>
<li> wrap your probe's status and output in the WLCG Probe Specification Output.  Now you can provide a very simple output format.
</li> <li> transfer your job to the remote CE (via Condor- G or globus-job-run) if it should execute remotely.  Your job does not need to understand job submission anymore
</li></ul> 
<p />
<a href="/bin/view/Documentation/Release3/RSVV33ProbeComparison" class="twikiLink">Compare the old and new style probes</a>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Language_constraints"> Language constraints:</a>
</li> <li> <a href="?cover=print#Naming_your_probe"> Naming your probe</a>
</li> <li> <a href="?cover=print#Probe_input"> Probe input:</a>
</li> <li> <a href="?cover=print#Probe_output"> Probe output:</a> <ul>
<li> <a href="?cover=print#Brief_format"> Brief format</a>
</li> <li> <a href="?cover=print#wlcg_format"> wlcg format</a>
</li></ul> 
</li> <li> <a href="?cover=print#Return_code"> Return code:</a>
</li> <li> <a href="?cover=print#Where_will_your_probe_run"> Where will your probe run?</a>
</li> <li> <a href="?cover=print#OSG_1_2_vs_OSG_3_0"> OSG 1.2 vs. OSG 3.0:</a>
</li></ul> 
</div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Language_constraints"></a> Language constraints: </span></h2>
Your probe can be written in any standard language that will be available on a CE or RSV installation (e.g. sh, Perl, Python).  Be careful which Perl and Python modules you use - ensure they are available in a CE install.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Naming_your_probe"></a> Naming your probe </span></h2>
<p />
Your probe must end in the suffix <code>-probe</code> to be recognized by the RSV infrastructure.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Probe_input"></a> Probe input: </span></h2>
<p />
Your probe will get the following parameters as input.  Depending on the probe it may use them or ignore them.
<p /> <ul>
<li> -m &lt;metric&gt; - the metric to run.  e.g. <code>org.osg.general.ping-host</code>.  You can use this input to differentiate what to run if your probe implements multiple metrics.
</li> <li> -u &lt;host&gt; - the fully qualified hostname to run against, e.g. <code>osg-edu.cs.wisc.edu</code>
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Probe_output"></a> Probe output: </span></h2> <ul>
<li> Your probe must return status and details on STDOUT
</li> <li> Your probe can (and should) write any other debugging info to STDERR.  STDERR can come before/after/in-the-middle of STDOUT, the order does not matter.
</li></ul> 
<p />
The status can be in one of two formats, 'brief' and 'wlcg'.
<p />
<p />
<h3><a name="Brief_format"></a> Brief format </h3>
The brief output format has been developed so that probe authors do not need to fully understand the wlcg format.  <code>rsv-control</code> will parse the brief output and create a wlcg-style record.
<p />
The brief mode is defined as follows: <ul>
<li> 1st line: 'RSV BRIEF RESULTS:' (without the quotes)
</li> <li> 2nd line: the metric status (OK, CRITICAL, etc.)
</li> <li> All remaining lines are the details
</li> <li> A trailing EOT is <strong>not</strong> necessary
</li></ul> 
<p />
Status can be one of:
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/WriteProbe?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Status</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/WriteProbe?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Description</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol0 twikiFirstCol"> OK </td>
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol1 twikiLastCol"> Service is running as expected </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" align="center" valign="top" class="twikiTableCol0 twikiFirstCol"> WARNING </td>
			<td bgcolor="#f2f3f6" align="center" valign="top" class="twikiTableCol1 twikiLastCol"> Service may be degraded in some way, or about to become degraded </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol0 twikiFirstCol"> CRITICAL </td>
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol1 twikiLastCol"> Service has a problem affecting functionality and/or availability </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" align="center" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> UNKNOWN </td>
			<td bgcolor="#f2f3f6" align="center" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> Cannot determine service status </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
Here are some examples
<p />
Metric run resulting in 'OK' status:
<pre class="screen">
RSV BRIEF RESULTS:
OK
Ping succeeded
</pre>
<p />
Metric run resulting in a non-OK status:
<pre class="screen">
RSV BRIEF RESULTS:
CRITICAL
Ping unsuccessful against host foo.cs.wisc.edu

Troubleshooting tips:
 - Is the network available?
 - Is the remote computer available?

Ping output:
ping: unknown host foo
</pre>
<p />
<h3><a name="wlcg_format"></a> wlcg format </h3>
The wlcg output mode will look familiar to anyone who has used RSV in the past.  It is provided for historical reasons and you probably want to use the brief format (see above) instead.
<p />
<pre class="screen">
metricName: org.osg.certificates.crl-expiry
metricType: status
timestamp: 2010-10-01T16:30:00Z
metricStatus: OK
serviceType: OSG-CE
serviceURI: pg.ihepa.ufl.edu
gatheredAt: pg.ihepa.ufl.edu
summaryData: OK
detailsData: OK: All CRLs have been recently updated
88 CRLs tested.
	0 had not been updated for atleast 72 hours;
	0 CRLs have not been updated for atleast 9 hours;
	88 CRLs have been updated with the last 9 hours.
EOT
</pre>
<p />
(There is probably somewhere I could link to in the twiki to fully explain the syntax but I don't know where that is currently).
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Return_code"></a> Return code: </span></h2> <ul>
<li> always return 0 if the job produced a status and details (even if the status is not OK)
</li> <li> return non-zero if the job fails for a different reason (such as bad inputs, missing exes, etc)
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Where_will_your_probe_run"></a> Where will your probe run? </span></h2>
In order to simplify probe development we have added a concept of 'local' and 'grid' metrics.  If your probe should run on the remote CE then you probably want the 'grid' option.  If your probe should run on the same computer that RSV is running you want the 'local' option.  Note which type you need, you will use this info when installing your probe.
<p /> <ul>
<li> remotely on a CE <ul>
<li> The RSV infrastructure will execute the probe via Condor-G on the host being monitored.  
</li> <li> This means that when the probe starts executing it will already be on the remote host with the appropriate environment set (e.g. OSG_LOCATION).
</li> <li> Some good candidates for this type of probe would be checking the osg-version, CA Certificates, or CE directory permissions.
</li> <li> This simplifies the probe development significantly since it does not need to understand Globus, proxies, authentication, etc.  
</li></ul> 
</li> <li> locally <ul>
<li> The probe will execute on the same computer RSV is running on.  
</li> <li> The probe must use the appropriate commands to monitor the remote host (e.g. <code>ping</code>, <code>globus-url-copy</code>, <code>srm-ping</code>).  
</li> <li> If the probe is going to run <code>globus-job-run</code> to execute some code on the remote computer, it is a good candidate to use the 'remote' universe instead (described above).  
</li></ul> 
</li> <li> remote-batch <ul>
<li> This is not supported yet, but we may add a way to run a metric on the remote batch system instead of running a fork job.  If this will be useful to you let us know.
</li></ul> 
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="OSG_1_2_vs_OSG_3_0"></a> OSG 1.2 vs. OSG 3.0: </span></h2>
Probes should support monitoring both OSG 1.2 and OSG 3.0 CEs (unless it does not make sense to support one of the versions).  The way to determine whether your probe is executing on an OSG 1.2 vs. OSG 3.0 CE is to look for OSG_LOCATION in the environment.  If OSG_LOCATION is defined, the CE is 1.2.  If OSG_LOCATION is not defined, the CE is 3.0.  
<p />
For non-CE probes, if there is a notable difference between OSG 1.2 and 3.0 then a detection method will need to be determined on a case-by-case basis. 
<p />
Here is a sample code snippet in Perl that shows what your probe should do to detect 1.2 vs. 3.0.  In this example, <code>monitor_12()</code> and <code>monitor_30()</code> would be subroutines that would do the interesting work.
<pre class="screen">
if(defined $ENV{OSG_LOCATION}) {
    monitor_12();
}
else {
    monitor_30();
}
</pre></div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Documentation/Release3<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Documentation/Release3/RsvOverview" class="twikiLink">RsvOverview</a> &gt; <a href="/bin/view/Documentation/Release3/WriteYourOwnRSVProbe" class="twikiLink">WriteYourOwnRSVProbe</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>WriteProbe</span> <br />    
Topic revision: r5 - 28 Aug 2015 - 20:04:39 - <a href="/bin/view/Main/KyleGross" class="twikiLink">KyleGross</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />