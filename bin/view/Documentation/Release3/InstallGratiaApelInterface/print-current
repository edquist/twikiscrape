<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> InstallGratiaApelInterface &lt; Documentation/Release3 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Documentation/Release3/InstallGratiaApelInterface?_T=16 Feb 2017" type="application/x-wiki" title="edit InstallGratiaApelInterface" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Documentation/Release3/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/InstallGratiaApelInterface"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFFFFF;
	}
	.patternBookView {
		border-color:#FFFFFF;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TWISTYPLUGIN_TWISTY--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.css");
</style>
<script type='text/javascript' src='https://twiki.opensciencegrid.org/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js'></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiPref.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.compressed.js"></script>
<script type="text/javascript">
// <![CDATA[
var styleText = '<style type="text/css" media="all">.twikiMakeVisible{display:inline;}.twikiMakeVisibleInline{display:inline;}.twikiMakeVisibleBlock{display:block;}.twikiMakeHidden{display:none;}</style>';
document.write(styleText);
// ]]>
</script>

<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<!--TABLEPLUGIN_table4--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
</style></head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> 
<p />
<p />
<p />
<h1><a name="Install_Gratia_APEL_Interface"></a>  Install Gratia-APEL Interface </h1>
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#About_this_Document"> About this Document</a>
</li> <li> <a href="?cover=print#Introduction"> Introduction</a>
</li> <li> <a href="?cover=print#Requirements"> Requirements</a> <ul>
<li> <a href="?cover=print#Host_and_OS"> Host and OS</a>
</li> <li> <a href="?cover=print#Users"> Users</a>
</li> <li> <a href="?cover=print#Certificates"> Certificates</a>
</li></ul> 
</li> <li> <a href="?cover=print#Installation_Procedure"> Installation Procedure</a> <ul>
<li> <a href="?cover=print#Install_the_Yum_Repositories_req"> Install the Yum Repositories required by OSG</a> <ul>
<li> <a href="?cover=print#Install_EPEL"> Install EPEL</a>
</li> <li> <a href="?cover=print#Install_the_Yum_priorities_packa"> Install the Yum priorities package</a>
</li> <li> <a href="?cover=print#Install_OSG_Repositories"> Install OSG Repositories</a>
</li></ul> 
</li> <li> <a href="?cover=print#Install_the_CA_Certificates_A_qu"> Install the CA Certificates: A quick guide</a>
</li> <li> <a href="?cover=print#Install_the_Gratia_APEL_interfac"> Install the Gratia-APEL interface</a>
</li></ul> 
</li> <li> <a href="?cover=print#Configure"> Configure</a> <ul>
<li> <a href="?cover=print#Configure_SSM_using_test_broker"> Configure SSM using test broker</a>
</li> <li> <a href="?cover=print#Configure_httpd"> Configure httpd</a>
</li> <li> <a href="?cover=print#Configure_Gratia_APEL_for_Gratia"> Configure Gratia-APEL for Gratia access</a>
</li> <li> <a href="?cover=print#Test_against_the_APEL_SSM_test_b"> Test against the APEL-SSM test brokers</a>
</li></ul> 
</li> <li> <a href="?cover=print#Configuring_for_access_to_produc"> Configuring for access to production APEL</a>
</li> <li> <a href="?cover=print#Services"> Services</a> <ul>
<li> <a href="?cover=print#Starting_and_Enabling_Services"> Starting and Enabling Services</a>
</li> <li> <a href="?cover=print#Stopping_and_Disabling_Services"> Stopping and Disabling Services</a>
</li></ul> 
</li> <li> <a href="?cover=print#Troubleshooting"> Troubleshooting</a> <ul>
<li> <a href="?cover=print#Configuration_Files"> Configuration Files</a>
</li> <li> <a href="?cover=print#Log_Files">Log Files</a>
</li></ul> 
</li> <li> <a href="?cover=print#How_to_get_Help"> How to get Help?</a>
</li> <li> <a href="?cover=print#References"> References</a>
</li> <li> <a href="?cover=print#Comments"> Comments</a>
</li></ul> 
</div>
<p />
<!-- conventions used in this document <ul>
<li> Set APEL_FAQ=<a href="https://twiki.cern.ch/twiki/bin/view/EMI/APELFAQ" target="_top">APEL FAQ and Troubleshooting</a>
</li> <li> Set APEL_SERVER=<a href="https://wiki.egi.eu/wiki/APEL/Server" target="_top">APEL Server</a>
</li> <li> Set APEL_SUMMARY_RECS=<a href="https://wiki.egi.eu/wiki/APEL/MessageFormat#Summary_Job_Records" target="_top">APEL Job Summary Records</a>
</li> <li> Set EGI_PORTAL                        = <a href="http://accounting.egi.eu/osg.php" target="_top">EGI Accounting Portal</a>
</li> <li> Set EGI_PORTAL_OSG_VIEW   = <a href="http://accounting.egi.eu/osg.php" target="_top">EGI Accounting Portal - OSG view</a>
</li> <li> Set EGI_PORTAL_TIER1_VIEW = <a href="http://accounting.egi.eu/tier1.php" target="_top">EGI Accounting Portal - Tier 1 view</a>
</li> <li> Set EGI_PORTAL_TIER2_VIEW = <a href="http://accounting.egi.eu/tier2.php" target="_top">EGI Accounting Portal - Tier 2 view</a>
</li> <li> Set EGI_PORTAL_USER_VIEW = <a href="http://www3.egee.cesga.es/gridsite/accounting/CESGA/user/user_view.html" target="_top">EGI Accounting Portal - User view</a>
</li> <li> Set EGI_PORTAL_VOMEMBER_VIEW = <a href="https://accounting.egi.eu/user/vomem.php" target="_top">EGI Accounting Portal - VO Member view</a>
</li> <li> Set OIM_HOME= <a href="http://oim.grid.iu.edu/" target="_top">OIM (OSG Information Management System)</a>
</li> <li> Set MYOSG_HOME= <a href="http://myosg.grid.iu.edu/about" target="_top">MyOSG</a>
</li> <li> Set WLCG_REPORTING = <a href="http://gratiaweb.grid.iu.edu/gratia/wlcg_reporting" target="_top">OSG WLCG Reporting</a>
</li></ul> 
<p /> <ul>
<li> Local UCL_HOST = root
</li> <li> Local UCL_USER = user
</li> <li> Local UCL_DOMAIN = opensciencegrid.org
</li> <li> Set TWISTY_OPTS_DETAILED = mode="div" showlink="Show Detailed Output" hidelink="Hide" showimgleft="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" hideimgleft="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" remember="on" start="hide" 
</li></ul> 
-->
<p />
<p />
<p />
<form name="EDITTHIS" action="/bin/edit/Documentation/Release3/InstallGratiaApelInterface" method="get"><input type="submit" value="Edit section" alt="Edit this section" title="Click to edit this section" class="twikiButton" style="font-size:0.75em;"><input type="hidden" value="1487218432" name="t"></form>
<p />
<h1><a name="About_this_Document"></a> About this Document </h1>
This document is for the individual or group responsible for running the interface between Gratia and the APEL/WLCG/EGI accounting systems.
Here we describe how to install and configure the Gratia-APEL interface on a Linux machine.
When you install this service, as described here, you get the following main components:
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Software</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Description</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> MySQL client </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> Used to access the OSG Gratia database </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> httpd </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> Provides access to the interface results </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> APEL SSM </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> Sends updates to APEL/EGI </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Gratia-APEL </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> Main software </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<p />
<h1><a name="Introduction"></a> Introduction </h1>
Accounting records collected by Gratia are forwarded to the EGI accounting system, APEL. This is important for US-LHC Tier1 and Tier2 facilities which have to demonstrate to the LHC project delivered computing resources on behalf of ATLAS, CMS and ALICE collaborations, in accordance with signed Memorandum of Understanding agreements. The software parses and analyzes Gratia accounting records for an OSG <strong><em>resource_group</em></strong> , scales wall time and cpu usage into HepSpec2006 for the processor type, and then forwards this data to the <a href="https://wiki.egi.eu/wiki/APEL/Server" target="_top">APEL Server</a> at the EGI GOC
<p />
The APEL Accounting Portal at RAL has been storing CPU accounting results for WLCG.  On behalf on the ATLAS, CMS and ALICE Tier 1 and Tier 2 that are part of OSG, OSG uploads usage information from Gratia to the APEL accounting system.  This OSG data can be viewed in the 
<a href="http://accounting.egi.eu/osg.php" target="_top">EGI Accounting Portal - OSG view</a>.  APEL is using OSG <strong><em>resource groups</em></strong>  registered in <a href="http://oim.grid.iu.edu/" target="_top">OIM (OSG Information Management System)</a> and viewable in <a href="http://myosg.grid.iu.edu/about" target="_top">MyOSG</a>
<p />
<h1><a name="Requirements"></a> Requirements </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Host_and_OS"></a> Host and OS </span></h2> <ul>
<li> A host to install the Gratia Service (Pristine node desired)
</li> <li> OS is Red Hat Enterprise Linux 5, 6, 7, and variants (see <a href="/bin/view/Documentation/Release3/SupportedOperatingSystems" class="twikiLink">details...</a>). 
</li> <li> Root access
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Users"></a> Users </span></h2>
At this time, <em>root</em> user is the only one configured to run this interface.
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=0;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">User</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=1;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Default uid</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=2;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Comment</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <code>root</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLast"> 0 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> Runs the interface (cron) and owns the service certificate and configuration files </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Certificates"></a> Certificates </span></h2>
You will need one service certificate.  This is a requirement of the APEL/SSM protocol.  
This certificate must be registered with the EGI broker network.
You can use a host certificate but the advantage of using a service certificate allows you to port the interface to another node without
re-registering it with APEL. Instructions for requesting a certificate can be found <a href="/bin/view/Trash/ReleaseDocumentationGetHostServiceCertificates" class="twikiLink">Here</a>.
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table3" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=0;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Certificate</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=1;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">User that owns certificate</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=2;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Path to certificate</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Service certificate </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLast"> <code>root</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <code>/etc/grid-security/gratia-apelcert.pem</code> <br> <code>/etc/grid-security/gratia-apelkey.pem</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<p />
Before you can send your messages to the APEL server, you must send your certificate DN to the <a href="mailto&#58;APEL&#45;SUPPORT&#64;JISCMAIL&#46;AC&#46;UK">APEL-SUPPORT&#64;JISCMAIL.AC.UK</a> 
mailing list, e.g. output from running:
<pre class="screen">
openssl x509 -subject -noout -in your_cert_pem_file
</pre>
<p />
<h1><a name="Installation_Procedure"></a> Installation Procedure </h1>
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Install_the_Yum_Repositories_req"></a> Install the Yum Repositories required by OSG </span></h2>
<p />
The OSG RPMs currently support Red Hat Enterprise Linux 5, 6, 7, and variants (see <a href="/bin/view/Documentation/Release3/SupportedOperatingSystems" class="twikiLink">details...</a>).
<p />
OSG RPMs are distributed via the OSG yum repositories. Some packages depend on packages distributed via the <a href="http://fedoraproject.org/wiki/EPEL" target="_top">EPEL</a> repositories. So both repositories must be enabled.
<p />
<h3><a name="Install_EPEL"></a> Install EPEL </h3>
<p /> <ul>
<li> Install the EPEL repository, if not already present. <strong>Note:</strong> This enables EPEL by default. Choose the right version to match your OS version. <pre class="rootscreen">
<font color="#ff0000"># EPEL 5 (For RHEL 5, CentOS 5, and SL 5) </font>
[root@root ~]$ curl -O https://dl.fedoraproject.org/pub/epel/epel-release-latest-5.noarch.rpm
[root@root ~]$ rpm -Uvh epel-release-latest-5.noarch.rpm
<font color="#ff0000"># EPEL 6 (For RHEL 6, CentOS 6, and SL 6) </font>
[root@root ~]$ rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm
<font color="#ff0000"># EPEL 7 (For RHEL 7, CentOS 7, and SL 7) </font>
[root@root ~]$ rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</pre>       <strong>WARNING</strong>: if you have your own mirror or configuration of the EPEL repository, you <strong>MUST</strong> verify that the OSG repository has a better yum priority than EPEL (<a href="/bin/view/Documentation/Release3/InstallBestPractices#YumPriorities" class="twikiAnchorLink">details</a>). Otherwise, you will have strange dependency resolution (<em>depsolving</em>) issues.
</li></ul> 
<p />
<h3><a name="Install_the_Yum_priorities_packa"></a> Install the Yum priorities package </h3>
<p />
For packages that exist in both OSG and EPEL repositories, it is important to prefer the OSG ones or else OSG software installs may fail. Installing the Yum priorities package enables the repository priority system to work.
<p /> <ol>
<li> <p>Choose the correct package name based on your operating system’s major version:</p> <ul>
<li> For EL&nbsp;5 systems, use <code>yum-priorities</code>
</li> <li> For EL&nbsp;6 and EL&nbsp;7 systems, use <code>yum-plugin-priorities</code>
</li></ul> 
</li> <li> <p>Install the Yum priorities package:</p>       <pre class="rootscreen">[root@root ~]$ yum install <em>PACKAGE</em></pre>       <p>Replace <em><code>PACKAGE</code></em> with the package name from the previous step.</p>
</li> <li> <p>Ensure that <code>/etc/yum.conf</code> has the following line in the <code>[main]</code> section (particularly when using ROCKS), thereby enabling Yum plugins, including the priorities one:</p>       <pre class="file">plugins=1</pre>       <strong>NOTE</strong>: If you do not have a required key you can force the installation using <code>--nogpgcheck</code>; e.g., <code>yum install --nogpgcheck yum-priorities</code>.
</li></ol> 
<p />
<h3><a name="Install_OSG_Repositories"></a> Install OSG Repositories </h3>
<p />
<!--   1. <p>First, determine which OSG series you will be installing; 3.1 or 3.2.  The OSG 3.1 and 3.2 series are each well tested and contain the entire OSG software stack.  The 3.1 series continues to support all packages that have been released throughout its lifetime, while the 3.2 series contains newer versions of software (including HTCondor, Hadoop, glideinWMS) and removes support for obsolete packages (including CEMonitor).  Initially, most packages are identical between 3.1 and 3.2, but we expect the new series to diverge over time. <br/><br/>Note that some packages (eg, Hadoop) do not inter-operate between 3.1 and 3.2, and therefore require all nodes to use the same series.</p> -->
<p />
<ol>
   <li>
      <p>If you are upgrading from OSG 3.1 (or 3.2) to OSG 3.2 (or 3.3), remove the old OSG repository definition files and clean the Yum cache:</p>         <pre class="rootscreen">[root@root ~]$ yum clean all
[root@root ~]$ rpm -e osg-release</pre>       <p>This step ensures that local changes to <code>*.repo</code> files will not block the installation of the new OSG repositories. After this step, <code>*.repo</code> files that have been changed will exist in <code>/etc/yum.repos.d/</code> with the <code>*.rpmsave</code> extension. After installing the new OSG repositories (the next step) you may want to apply any changes made in the <code>*.rpmsave</code> files to the new <code>*.repo</code> files.</p>
   </li>
   <li>
      <p>Install the OSG repositories using one of the following methods depending on your EL version:</p>      <ol>
         <li>
            <p>For EL versions greater than EL5, install the files directly from <code>repo.grid.iu.edu</code>:</p>            <pre class="rootscreen">[root@root ~]$ rpm -Uvh <font color="#ff0000">URL</font></pre>            <p>Where <code><font color="#ff0000">URL</font></code> is one of the following:</p><table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table4" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=0;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Series</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=1;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">EL6 URL (for RHEL 6, CentOS 6, or SL 6)</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=2;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">EL7 URL (for RHEL 7, CentOS 7, or SL 7)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <font color="#252b37">OSG 3.2</font> </th>
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol1"> <code>https://repo.grid.iu.edu/osg/3.2/osg-3.2-el6-release-latest.rpm</code> </td>
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol2 twikiLastCol"> N/A </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <font color="#252b37">OSG 3.3</font> </th>
			<td bgcolor="#f2f3f6" align="center" valign="top" class="twikiTableCol1 twikiLast"> <code>https://repo.grid.iu.edu/osg/3.3/osg-3.3-el6-release-latest.rpm</code> </td>
			<td bgcolor="#f2f3f6" align="center" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <code>https://repo.grid.iu.edu/osg/3.3/osg-3.3-el7-release-latest.rpm</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
         </li>
         <li>
            <p>For EL5, download the repo file and install it using the following:</p>
            <pre class="rootscreen">[root@root ~]$ curl -O https://repo.grid.iu.edu/osg/3.2/osg-3.2-el5-release-latest.rpm
[root@root ~]$ rpm -Uvh osg-3.2-el5-release-latest.rpm</pre>
         </li>
      </ol>
   </li>
</ol>
<p />
For more details, please see our <a href="/bin/view/Documentation/Release3/YumRepositories" class="twikiLink">yum repository documentation</a>.
<p />
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Install_the_CA_Certificates_A_qu"></a> Install the CA Certificates: A quick guide </span></h2>
<p />
You must perform one of the following <code>yum</code> commands below to select this host's CA certificates.
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table5" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=0;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Set of CAs</font></a> </th>
			<th bgcolor="#d8dde4" align="right" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=1;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">CA certs name</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/InstallGratiaApelInterface?cover=print;sortcol=2;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37"> Installation command (as root)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> OSG </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> osg-ca-certs </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> <code>yum install osg-ca-certs</code> <font color="#ff0000"><b>Recommended</b></font> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> IGTF </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1"> igtf-ca-certs </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol"> <code>yum install igtf-ca-certs</code> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> None* </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> empty-ca-certs </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> <code>yum install empty-ca-certs --enablerepo=osg-empty</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Any** </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLast"> Any </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <code>yum install osg-ca-scripts</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
* The <code>empty-ca-certs</code> RPM indicates you will be manually installing the CA certificates on the node. <br/>
** The <code>osg-ca-scripts</code> RPM provides a cron script that automatically downloads CA updates, and requires further configuration. <br/>
<p />
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  If you use options 1 or 2, then you will need to run "yum update" in order to get the latest version of CAs when they are released. With option 4 a cron service is provided which will always download the updated CA package for you.
</dd></dl> 
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  If you use services like Apache's httpd you must restart them after each update of the CA certificates, otherwise they will continue to use the old version of the CA certificates.
</dd></dl> 
For more details and options, please see our <a href="/bin/view/Documentation/Release3/InstallCertAuth" class="twikiLink">CA certificates documentation</a>. 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Install_the_Gratia_APEL_interfac"></a> Install the Gratia-APEL interface </span></h2>
:<pre class="rootscreen">
[root@root ~]$ yum install gratia-apel
</pre>
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdDocumentation/Release3InstallGratiaApelInterface1show" class="twistyRememberSetting twistyStartHide twistyTrigger twikiUnvisited twistyInited0"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show Detailed Output</span></a> </span> <span id="twistyIdDocumentation/Release3InstallGratiaApelInterface1hide" class="twistyRememberSetting twistyStartHide twistyTrigger twikiUnvisited twistyHidden twistyInited0"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdDocumentation/Release3InstallGratiaApelInterface1toggle" class="twistyRememberSetting twistyStartHide twistyContent twikiMakeHidden twistyInited0">   <pre class="rootscreen">
[root@root ~]$ yum install gratia-apel
Loaded plugins: kernel-module, priorities
Excluding Packages from SLF 5 base
Finished
Reducing SLF 5 base jdk to included packages only
Finished
Excluding Packages from SLF 5 security updates
Finished
Reducing SLF 5 security updates jdk only to included packages only
Finished
Excluding Packages from SL 5 base
Finished
Reducing SL 5 base jdk to included packages only
Finished
1106 packages excluded due to repository priority protections
Setting up Install Process
Examining /root/APEL-RPMS/gratia-apel-0.10-1.noarch.rpm: gratia-apel-0.10-1.noarch
Marking /root/APEL-RPMS/gratia-apel-0.10-1.noarch.rpm to be installed
Resolving Dependencies
--> Running transaction check
---> Package gratia-apel.noarch 0:0.10-1 set to be updated
--> Processing Dependency: fetch-crl3 for package: gratia-apel
--> Processing Dependency: httpd for package: gratia-apel
--> Processing Dependency: mysql for package: gratia-apel
--> Processing Dependency: osg-ca-certs for package: gratia-apel
--> Processing Dependency: osg-version for package: gratia-apel
--> Processing Dependency: python-daemon for package: gratia-apel
--> Processing Dependency: python-ldap for package: gratia-apel
--> Processing Dependency: stomppy for package: gratia-apel
--> Running transaction check
---> Package fetch-crl3.noarch 0:3.0.7-1.el5 set to be updated
---> Package httpd.x86_64 0:2.2.3-74.sl5 set to be updated
--> Processing Dependency: libaprutil-1.so.0()(64bit) for package: httpd
--> Processing Dependency: libapr-1.so.0()(64bit) for package: httpd
---> Package mysql.x86_64 0:5.0.95-5.el5_9 set to be updated
--> Processing Dependency: perl(DBI) for package: mysql
---> Package osg-ca-certs.noarch 0:1.33-1.osg.el5 set to be updated
---> Package osg-version.noarch 0:3.1.15-1.osg.el5 set to be updated
---> Package python-daemon.noarch 0:1.5.2-3.el5 set to be updated
--> Processing Dependency: python-lockfile for package: python-daemon
---> Package python-ldap.x86_64 0:2.2.0-2.1 set to be updated
---> Package stomppy.noarch 0:3.0.3-1.el5.1 set to be updated
--> Processing Dependency: python-ssl for package: stomppy
--> Running transaction check
---> Package apr.x86_64 0:1.2.7-11.el5_6.5 set to be updated
---> Package apr-util.x86_64 0:1.2.7-11.el5_5.2 set to be updated
--> Processing Dependency: libpq.so.4()(64bit) for package: apr-util
---> Package perl-DBI.x86_64 0:1.52-2.el5 set to be updated
---> Package python-lockfile.noarch 0:0.8-3.el5 set to be updated
---> Package python-ssl.x86_64 0:1.15-3.el5 set to be updated
--> Running transaction check
---> Package postgresql-libs.x86_64 0:8.1.23-6.el5_8 set to be updated
--> Finished Dependency Resolution
Beginning Kernel Module Plugin
Finished Kernel Module Plugin

Dependencies Resolved

================================================================================
 Package          Arch    Version             Repository                   Size
================================================================================
Installing:
 gratia-apel      noarch  0.10-1              /gratia-apel-0.10-1.noarch   28 M
Installing for dependencies:
 apr              x86_64  1.2.7-11.el5_6.5    sl-base                     119 k
 apr-util         x86_64  1.2.7-11.el5_5.2    sl-base                      79 k
 fetch-crl3       noarch  3.0.7-1.el5         epel                         45 k
 httpd            x86_64  2.2.3-74.sl5        fermi-security              1.3 M
 mysql            x86_64  5.0.95-5.el5_9      fermi-security              4.9 M
 osg-ca-certs     noarch  1.33-1.osg.el5      osg                         290 k
 osg-version      noarch  3.1.15-1.osg.el5    osg                         3.8 k
 perl-DBI         x86_64  1.52-2.el5          sl-base                     605 k
 postgresql-libs  x86_64  8.1.23-6.el5_8      fermi-security              197 k
 python-daemon    noarch  1.5.2-3.el5         epel                         29 k
 python-ldap      x86_64  2.2.0-2.1           sl-base                     123 k
 python-lockfile  noarch  0.8-3.el5           epel                         18 k
 python-ssl       x86_64  1.15-3.el5          epel                         26 k
 stomppy          noarch  3.0.3-1.el5.1       epel                         38 k

Transaction Summary
================================================================================
Install      15 Package(s)
Upgrade       0 Package(s)

Total size: 35 M
Total download size: 7.7 M
Downloading Packages:
--------------------------------------------------------------------------------
Total                                           7.2 MB/s | 7.7 MB     00:01
Running rpm_check_debug
Running Transaction Test
Finished Transaction Test
Transaction Test Succeeded
Running Transaction
Installing     : apr                                                     1/15 
Installing     : python-ldap                                             2/15 
Installing     : python-ssl                                              3/15 
Installing     : postgresql-libs                                         4/15 
Installing     : apr-util                                                5/15 
Installing     : httpd                                                   6/15 
Installing     : perl-DBI                                                7/15 
Installing     : mysql                                                   8/15 
Installing     : stomppy                                                 9/15 
Installing     : python-lockfile                                        10/15 
Installing     : python-daemon                                          11/15 
Installing     : osg-ca-certs                                           12/15 
Installing     : fetch-crl3                                             13/15 
Installing     : osg-version                                            14/15... in pre
Installing     : gratia-apel                                            15/15 

Installed:
  gratia-apel.noarch 0:0.10-1                                                   

Dependency Installed:
  apr.x86_64 0:1.2.7-11.el5_6.5            apr-util.x86_64 0:1.2.7-11.el5_5.2
  fetch-crl3.noarch 0:3.0.7-1.el5          httpd.x86_64 0:2.2.3-74.sl5
  mysql.x86_64 0:5.0.95-5.el5_9            osg-ca-certs.noarch 0:1.33-1.osg.el5
  osg-version.noarch 0:3.1.15-1.osg.el5    perl-DBI.x86_64 0:1.52-2.el5
  postgresql-libs.x86_64 0:8.1.23-6.el5_8  python-daemon.noarch 0:1.5.2-3.el5
  python-ldap.x86_64 0:2.2.0-2.1           python-lockfile.noarch 0:0.8-3.el5
  python-ssl.x86_64 0:1.15-3.el5           stomppy.noarch 0:3.0.3-1.el5.1

Complete!
</pre> </div></div> <!--/twistyPlugin-->
<p />
<h1><a name="Configure"></a> Configure </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Configure_SSM_using_test_broker"></a> Configure SSM using test broker </span></h2>
When the SSM software is initially installed, the default configuration is set to talk to the SSM
test broker/services and SSM needs to be run once to create some directories.
<p />
You will need the service certificate you previously installed and will need to modify the SSM config files
for that service certificate:
<p />
<strong><em>/etc/gratia-apel/ssm/ssm.cfg</em></strong>
<pre class="file">
   :
################################################################################
# Required: Certificate configuration
[certificates]
#certificate: /etc/grid-security/hostcert-ssm.pem
#key: /etc/grid-security/hostkey-ssm.pem
certificate: <font color="#ff0000">your_service_cert_file</font>
key: /etc/grid-security/<font color="#ff0000">your_service_cert_file</font>
cadir: /etc/grid-security/certificates
check-crls: false
   :
</pre>
<p />
SSM needs to be run once before attempting to send anything. 
This invocation will create the <strong><em>/var/lib/gratia-apel/messages</em></strong> sub-directories for SSM.
It is basically just a "ping" to the broker to verify basic communication.  Nothing is sent.
<pre class="rootscreen">
[root@root ~]$ /usr/share/gratia-apel/ssm/ssm_master.py /etc/gratia-apel/ssm/ssm.cfg
</pre>
<strong><em>/var/log/gratia-apel/ssm.log</em></strong> output on success:<br />    
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdDocumentation/Release3InstallGratiaApelInterface2show" class="twistyRememberSetting twistyStartHide twistyTrigger twikiUnvisited twistyInited0"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Show Detailed Output</span></a> </span> <span id="twistyIdDocumentation/Release3InstallGratiaApelInterface2hide" class="twistyRememberSetting twistyStartHide twistyTrigger twikiUnvisited twistyHidden twistyInited0"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdDocumentation/Release3InstallGratiaApelInterface2toggle" class="twistyRememberSetting twistyStartHide twistyContent twikiMakeHidden twistyInited0">   <pre class="file">
2013-04-09 10:15:34,696 - SSM - INFO - Starting the SSM...
2013-04-09 10:15:34,713 - SSM - INFO - Running the SSM once only.
2013-04-09 10:15:34,714 - SSM - INFO - BDII URL: ldap://lcg-bdii.cern.ch:2170
2013-04-09 10:15:34,714 - SSM - INFO - BDII broker network: TEST-NWOB
2013-04-09 10:15:35,960 - SSM - DEBUG - Found broker in BDII: test-msg02.afroditi.hellasgrid.gr:6163
2013-04-09 10:15:36,124 - stomp.py - INFO - Established connection to host test-msg02.afroditi.hellasgrid.gr, port 6163
2013-04-09 10:15:36,124 - SSM - INFO - Connecting: ('test-msg02.afroditi.hellasgrid.gr', 6163)
2013-04-09 10:15:36,126 - SSM - INFO - The SSM will not run as a consumer.
2013-04-09 10:15:36,126 - SSM - INFO - The SSM will run as a producer.
2013-04-09 10:15:36,126 - SSM - DEBUG - I will be a producer, my ack queue is: /topic/global.accounting.cpu.client.fermicloud139.fnal.gov.2315
2013-04-09 10:15:36,296 - SSM - INFO - Connected
2013-04-09 10:15:36,325 - SSM - INFO - The SSM started successfully.
2013-04-09 10:15:36,326 - SSM - DEBUG - Pinging
2013-04-09 10:15:36,326 - SSM - DEBUG - Sending ping
2013-04-09 10:15:36,326 - SSM - INFO - All outgoing messages have been processed.
2013-04-09 10:15:36,326 - SSM - INFO - SSM connection ended.
2013-04-09 10:15:36,326 - SSM - INFO - The SSM has shut down.
</pre> </div></div> <!--/twistyPlugin-->
<p />
The necessary SSM directories will have now been created in <strong><em>/var/lib/gratia-apel/messages</em></strong>:
<pre class="rootscreen">
drwxr-xr-x 2 root root 4096 Mar  6 10:35 accept
drwxr-xr-x 2 root root 4096 Mar  6 10:35 ack
drwxr-xr-x 2 root root 4096 Mar  6 10:35 incoming
<font color="#0000ff">drwxr-xr-x 2 root root 4096 Mar  6 10:35 outgoing</font>
drwxr-xr-x 2 root root 4096 Mar  6 10:35 reject
</pre>
The <strong><em>./outgoing</em></strong> directory is the only one used by this interface.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Configure_httpd"></a> Configure httpd </span></h2>
The interface software creates a set of <strong><em>.html</em></strong> and <strong><em>.dat</em></strong> available via the <strong><em>httpd</em></strong> service on your node.
This allow you to view the data collected and sent to APEL/EGI more easily.  
The <a href="http://gratiaweb.grid.iu.edu/gratia/wlcg_reporting" target="_top">OSG WLCG Reporting</a> view of the interfaced accounting data uses these <strong><em>.dat</em></strong> files for it's display.
The default port for httpd is 80.  If this port is not accessible from outside your node, it will have to be changed.
<p />
<strong><em>/etc/httpd/conf/httpd.conf</em></strong>
<pre class="file">
Listen = <font color="#ff0000">80</font>
</pre>
<p />
During the RPM installation, the files used for the <a href="http://gratiaweb.grid.iu.edu/gratia/wlcg_reporting" target="_top">OSG WLCG Reporting</a> view were installed in <strong><em>/var/lib/gratia-apel/webapps</em></strong>.
This is basically the history of the data sent to APEL/EGI by this interface.  Each time the interface is run, it creates a file of the latest
updates in this directory.  There is a script that runs in the cron entry called <strong><em>create_apel_index.sh</em></strong> that creates the <strong><em>index.html</em></strong> file
for the most recent entries.  This must be run:
<pre class="rootscreen">
[root@root ~]$  /usr/share/gratia-apel/create_apel_index.sh
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Configure_Gratia_APEL_for_Gratia"></a> Configure Gratia-APEL for Gratia access </span></h2>
The only configuration for the gratia-apel configuration is for read access to the OSG Gratia database.
This should be <strong><em>read-only</em></strong> access.
<p />
<strong><em>/etc/gratia-apel/lcg-db.conf</em></strong>
<pre class="file">
GratiaUser     <font color="#ff0000">gratia_user_id</font>
GratiaPswd    <font color="#ff0000">gratia_user_password</font>
</pre>
<strong><em>Note:</em></strong>  The Gratia database accessed is generally always production even when doing any testing.
The load is not that significant as is is read only and uses a very simple query on a small subset of the
data (the summary tables).  
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Test_against_the_APEL_SSM_test_b"></a> Test against the APEL-SSM test brokers </span></h2>
As mentioned earlier, the initial installation of the SSM interface defaults to a test
broker.  So, it is best to make an initial run against that environment.
Cut/paste the cron entry in <strong><em>/etc/cron.d/gratia-apel-cron</em></strong> for the current month
to the command line and executed it:
<pre class="rootscreen">
[root@root ~]$  [ ! -f /var/lock/subsys/gratia-apel-cron ] || (cd /usr/share/gratia-apel ; \
                    ./lcg.sh --config=/etc/gratia-apel/lcg.conf --date=current --update \
                     && ./create-apel-index.sh /etc/gratia-apel/lcg.conf) 
</pre>
<p />
<h1><a name="Configuring_for_access_to_produc"></a> Configuring for access to production APEL </h1>
When you are satisfied, with the installation in the test environment, you will need to modify the APEL SSM <strong><em>ssm.cfg</em></strong>
file to connect to the production APEL brokers.
<p />
<strong><em>Test APEL</em></strong>
<pre class="rootscreen">
[broker]
broker-network: TEST-NWOB
[producer]
consumer-dn: /C=UK/O=eScience/OU=CLRC/L=RAL/CN=raptest.esc.rl.ac.uk 
</pre>
<strong><em>Production APEL</em></strong>
<pre class="rootscreen">
[broker]
broker-network: PROD
[producer]
consumer-dn: /C=UK/O=eScience/OU=CLRC/L=RAL/CN=rap.esc.rl.ac.uk
</pre>
<p />
<h1><a name="Services"></a> Services </h1>
The following sections describe how to start/stop the required services and how to 
enable/disable them when your system is powered on.
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Starting_and_Enabling_Services"></a> Starting and Enabling Services </span></h2>
<p />
To start/enable the Gratia-APEL interface: <ol>
<li>  You need to fetch the latest CA Certificate Revocation Lists (CRLs) and you should enable the fetch-crl service to keep the CRLs up to date:<pre class="rootscreen">
<font color="#ff0000"># For RHEL 5, CentOS 5, and SL5 </font>
[root@root ~]$ /usr/sbin/fetch-crl3   # This fetches the CRLs 
[root@root ~]$ /sbin/service fetch-crl3-boot start
[root@root ~]$ /sbin/service fetch-crl3-cron start
<font color="#ff0000"># For RHEL 6, CentOS 6, and SL6, or OSG 3 _older_ than 3.1.15 </font>
[root@root ~]$ /usr/sbin/fetch-crl   # This fetches the CRLs 
[root@root ~]$ /sbin/service fetch-crl-boot start
[root@root ~]$ /sbin/service fetch-crl-cron start
<font color="#ff0000"># For RHEL 7, CentOS 7, and SL7 </font>
[root@root ~]$ /usr/sbin/fetch-crl   # This fetches the CRLs 
[root@root ~]$ systemctl start fetch-crl-boot
[root@root ~]$ systemctl start fetch-crl-cron
</pre> For more details and options, please see our <a href="/bin/view/Documentation/Release3/InstallCertAuth#Managing_Certificate_Revocation" class="twikiAnchorLink">CRL documentation</a>.  
</li> <li> <strong><em>httpd</em></strong>  service:<pre class="rootscreen">
[root@root ~]$ /sbin/service httpd start
[root@root ~]$ /sbin/chkconfig httpd on
</pre>
</li> <li> <strong><em>gratia_apel_cron</em></strong> service<pre class="rootscreen">
[root@root ~]$ /sbin/service gratia-apel-cron start 
[root@root ~]$ /sbin/chkconfig gratia-apel-cron on
</pre>
</li></ol> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Stopping_and_Disabling_Services"></a> Stopping and Disabling Services </span></h2>
<p />
To stop/disable the Gratia-APEL interface: <ol>
<li>  To stop fetch-crl:<pre class="rootscreen">
<font color="#ff0000"># For RHEL 5, CentOS 5, and SL5 </font>
[root@root ~]$ /sbin/service fetch-crl3-boot stop
[root@root ~]$ /sbin/service fetch-crl3-cron stop
<font color="#ff0000"># For RHEL 6, CentOS 6, and SL6, or OSG 3 _older_ than 3.1.15 </font>
[root@root ~]$ /sbin/service fetch-crl-boot stop
[root@root ~]$ /sbin/service fetch-crl-cron stop
<font color="#ff0000"># For RHEL 7, CentOS 7, and SL7 </font>
[root@root ~]$ systemctl stop fetch-crl-boot
[root@root ~]$ systemctl stop fetch-crl-cron
</pre> For more details and options, please see our <a href="/bin/view/Documentation/Release3/InstallCertAuth#Managing_Certificate_Revocation" class="twikiAnchorLink">CRL documentation</a>.  
</li> <li> <strong><em>httpd</em></strong>  service:<pre class="rootscreen">
[root@root ~]$ /sbin/service httpd stop
[root@root ~]$ /sbin/chkconfig httpd off
</pre>
</li> <li> <strong><em>gratia_apel_cron</em></strong> service<pre class="rootscreen">
[root@root ~]$ /sbin/service gratia-apel-cron stop
[root@root ~]$ /sbin/chkconfig gratia-apel-cron off
</pre>
</li></ol> 
<p />
<p />
<p />
<p />
<p />
<p />
<p />
<h1><a name="Troubleshooting"></a> Troubleshooting </h1>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Configuration_Files"></a> Configuration Files </span></h2>
<p />
<pre class="rootscreen">
<font color="#0000ff"><u><b>/etc/gratia-apel</u></b></font>
-rw-rw-r-- 1 root root  588 Mar  6 10:35 lcg-db.conf
-rw-rw-r-- 1 root root 5205 Mar  6 10:27 lcg-reportableSites
drwxr-xr-x 2 root root 4096 Mar  6 10:35 lcg-reportableSites.history
-rw-rw-r-- 1 root root   30 Mar  6 10:27 lcg-reportableVOs
-rw-rw-r-- 1 root root 3033 Mar 19 08:43 lcg.conf
drwxr-xr-x 2 root root 4096 Apr  4 09:17 ssm
 
<font color="#0000ff"><u><b>/etc/gratia-apel/lcg-reportableSites.history</u></b></font>
-rw-rw-r-- 1 root root 12315 Mar  6 10:27 lcg-reportableSites.200901
     : (one for each month)
-rw-rw-r-- 1 root root  5205 Mar  6 10:27 lcg-reportableSites.201402
-rw-rw-r-- 1 root root  5205 Mar  6 10:27 lcg-reportableSites.201403

<font color="#0000ff"><b><u>/etc/gratia-apel/ssm</u></b></font>
-rw-r--r-- 1 root root 4211 Jun 28  2012 README
-rw-r--r-- 1 root root 3804 Mar 25 11:53 ssm.cfg
-rw-r--r-- 1 root root  648 Mar  6 10:27 ssm.log.cfg
-rw-r--r-- 1 root root  256 May  2  2012 ssm.logrotate
</pre>
<p />
<pre class="rootscreen">
<font color="#0000ff"><u><b>/etc/httpd/conf</u></b></font>
-rw-r--r-- 1 root root 33740 Mar  6 10:35 httpd.conf
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Log_Files"></a> Log Files </span></h2>
<pre class="rootscreen">
<font color="#0000ff"><u><b>/var/log/gratia-apel</u></b></font>
-rw-rw-r-- 1 root root  58123 Feb 07 08:53 2013-01.log
  : (one per month)
-rw-rw-r-- 1 root root  58123 Mar 07 08:53 2014-02.log
-rw-rw-r-- 1 root root 170289 Mar 26 12:07 2014-03.log
-rw-r--r-- 1 root root  82936 Mar 26 12:01 ssm.log
</pre>
<p />
The httpd logs are useful if the <a href="http://gratiaweb.grid.iu.edu/gratia/wlcg_reporting" target="_top">OSG WLCG Reporting</a> system has access issues.
<pre class="rootscreen">
<font color="#0000ff"><u><b>/var/log/httpd</u></b></font>
-rw-r--r-- 1 root root    0 Mar 30 04:02 access_log
-rw-r--r-- 1 root root  250 Mar 30 04:02 error_log
</pre>
<p />
<p />
<h1><a name="How_to_get_Help"></a> How to get Help? </h1>
To get assistance, please use <a href="/bin/view/Documentation/Release3/HelpProcedure" class="twikiLink">Help Procedure</a>.
<p />
<h1><a name="References"></a> References </h1>
Gratia Documents <ul>
<li> <a href="/bin/view/Accounting/WebHome" class="twikiLink">Accounting Web/The Gratia project</a>
</li> <li> <a href="/bin/view/Accounting/GratiaInterfacesApelLcg" class="twikiLink">Gratia Interfaces- APEL/WLCG</a>
</li> <li> <a href="/bin/view/Accounting/ApelWlcgDevelopersCorner" class="twikiLink">APEL/WLCG Developers Corner twiki</a>.
</li></ul> 
<p />
APEL Documents <ul>
<li> <a href="https://wiki.egi.eu/wiki/APEL/SSM" target="_top">APEL SSM</a>
</li> <li> <a href="https://wiki.egi.eu/wiki/APEL/Server" target="_top">APEL/Servier</a>
</li></ul> 
<p />
<p />
<h1><a name="Comments"></a> Comments </h1>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Documentation/Release3/InstallGratiaApelInterface" enctype="multipart/form-data" name="tableappend0" id="tableappend0">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="0"  /></form>
<p />
<p />
<p />
<p />
<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Major_updates"></a>  Major updates </span></h2>
<!--Future editors should add their signatures beneath yours!-->
-- <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a> - 08 Apr 2013</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Documentation/Release3<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>InstallGratiaApelInterface</span> <br />    
Topic revision: r5 - 07 Feb 2017 - 19:34:17 - <a href="/bin/view/Main/BrianBockelman" class="twikiLink">BrianBockelman</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />