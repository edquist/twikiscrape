<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> InstallVomsService &lt; Documentation &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Documentation/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Documentation/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Documentation/InstallVomsService?_T=16 Feb 2017" type="application/x-wiki" title="edit InstallVomsService" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Documentation/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Documentation/InstallVomsService"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFFF99;
	}
	.patternBookView {
		border-color:#FFFF99;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <link rel="stylesheet" type="text/css" href="https://twiki.opensciencegrid.org/twiki/pub/Documentation/Tools/exercises.css">
<p />
<h1><a name="This_document_has_been_replaced"></a>  This document has been replaced by <a href="/bin/view/Documentation/Release3/InstallVoms" class="twikiLink">InstallVoms</a> in the new Release3 Web </h1>
<p />
<h1><a name="Install_Voms_Service"></a>  Install Voms Service </h1>
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Introduction"> Introduction</a>
</li> <li> <a href="?cover=print#Requirements"> Requirements</a>
</li> <li> <a href="?cover=print#Install"> Install</a>
</li> <li> <a href="?cover=print#MySQL_Database"> MySQL Database</a>
</li> <li> <a href="?cover=print#Configure"> Configure</a>
</li> <li> <a href="?cover=print#Start"> Start</a>
</li> <li> <a href="?cover=print#Test"> Test</a> <ul>
<li> <a href="?cover=print#Voms_admin_test"> Voms-admin test</a>
</li> <li> <a href="?cover=print#Voms_core_test"> Voms-core test:</a>
</li></ul> 
</li> <li> <a href="?cover=print#Stop"> Stop</a>
</li> <li> <a href="?cover=print#References"> References</a>
</li></ul> 
</div>
<h1><a name="Introduction"></a> Introduction </h1>
<!-- conventions used in this document <ul>
<li> Local UCL_HOST = voms
</li></ul> 
-->
The Virtual Organization Membership Service (VOMS - <a href="https://twiki.cnaf.infn.it/cgi-bin/twiki/view/VOMS/WebHome" target="_top">https://twiki.cnaf.infn.it/cgi-bin/twiki/view/VOMS/WebHome</a>) has three main parts:
    <span class="twikiNewLink">MySQL<a href="/bin/edit/Documentation/MySQL?topicparent=Documentation.InstallVomsService" rel="nofollow" title="MySQL (this topic does not yet exist; you can create it)">?</a></span> database which is a persistent repository for VO membership information,
    VOMS admin which provides the Web UI/services to maintain the VO membership. This requires Tomcat.
    VOMS server, a daemon process which services the voms-proxy-init requests. 
<h1><a name="Requirements"></a> Requirements </h1> <ul>
<li> Pristine node
</li> <li> Root access
</li> <li> OS is Scientific Linux 32 or 64 bit<br>In theory it should work on Red Hat Enterprise Linux 5 or CentOS 5 but we have not yet tested there.
</li> <li> Host certificate
</li> <li> Testing Requirements: <ul>
<li> The Subject and Issuer of a voms admin certificate (it could be your certificate)
</li> <li> Access to your own certificate if you want to create your  voms proxy 
</li> <li> Your certificate uploaded into a browser if you want to test voms-admin WEB UI
</li></ul> 
</li></ul> 
<h1><a name="Install"></a> Install </h1>
<p />
<p />
The OSG RPMs currently support Red Hat Enterprise Linux 5 and variants (Scientific Linux 5 and CentOS 5). Currently most of our testing has been done on Scientific Linux 5: your mileage may vary.
<p />
OSG RPMs are distributed via the OSG yum repositories. Some packages depend on packages distributed via the <a href="http://fedoraproject.org/wiki/EPEL" target="_top">EPEL</a> repositories. So both repositories must be enabled. <ol>
<li> If not already present, install EPEL: <pre class="rootscreen">
[root@voms ~]$ wget http://download.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm
[root@voms ~]$ rpm -i epel-release-5-4.noarch.rpm </pre>
</li> <li> Install the <code>yum-priorities</code> plugin: <pre class="rootscreen">
[root@voms ~]$ yum install yum-priorities</pre>
</li> <li> Install the OSG repositories: <pre class="rootscreen">
[root@voms ~]$ rpm -Uvh http://repo.grid.iu.edu/osg-release-latest.rpm</pre>       <strong>WARNING</strong>: if you have your own mirror or configuration of the EPEL repository, you <strong>MUST</strong> verify that the OSG repository has a better yum priority than EPEL.  Otherwise, you will have strange depsolving issues.<br />           <strong>COMMENT: Please provide detailed syntax for how to do this. -Horst</strong>
</li></ol> 
<p />
<p />
on    
<p />
Install OSG-VOMS: <ol>
<li> Enable OSG repos by editing <code><b>/etc/yum.repos.d/osg-testing.repo</b></code>:<pre class="file">
[osg-testing]
name=OSG Software for Enterprise Linux 5 - Testing - $basearch 
mirrorlist=http://repo.grid.iu.edu/mirror/osg-testing/$basearch
failovermethod=priority
priority=98
enabled=<font color="#ff0000">1</font>
#gpgcheck=1
#gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OSG
</pre>
</li> <li> Install osg-voms:<pre class="rootscreen">
[root@voms ~]$ yum install osg-voms
</pre>
</li> <li> Install  xml-commons-apis:<pre class="rootscreen">
[root@voms ~]$ yum install xml-commons-apis
</pre>
</li></ol> 
<img width="16" alt="warning" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/warning.gif" height="16" border="0" />from <a href="https://twiki.cern.ch/twiki/bin/view/EMI/VOMSystemAdministratorGuide" target="_top">https://twiki.cern.ch/twiki/bin/view/EMI/VOMSystemAdministratorGuide</a>
Manually install xml-commons-apis libraries (after having installed the right metapackage for your installation), as the ones provided by the JRE cause warnings when starting/stopping tomcat:
<p />
<p />
<h1><a name="MySQL_Database"></a> MySQL Database </h1>
Before you will be able configure VOMS you will need to have access to MySQL database.  The MySQL software is installed with the <code>osg-voms</code> package. By default it will be using port 3306 and will not have password for <code><b>root</b></code>. If you want to modify port you will need to edit <code><b>/etc/my.cnf</b></code> file and add a new port:<pre class="file">
[mysqld]
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
port=<font color="#ff0000">MYSQL_PORT_NUMBER</font>
</pre>  It is not necessary to change the port number if you don't want to.  It is also wise to set password for <code><b>root</b></code> user. Run the following command to set the password:<pre class="rootscreen">
[root@voms ~]$ /etc/init.d/mysqld start
[root@voms ~]$ mysqladmin -u root password <font color="#ff0000">top_secret</font>
</pre> 
<p />
<h1><a name="Configure"></a> Configure </h1>
<p />
Now, you can create database and configure VOMS-core and VOMS-admin: <ol>
<li> VOMS-core daemon is running as user <code><b>voms</b></code>. You will need to have a pair of service or host certificate for this user. You need to do the following:<pre class="rootscreen">
[root@voms ~]$ cd /etc/grid-security
[root@voms ~]$ cp http/httpcert.pem voms/vomscert.pem
[root@voms ~]$ cp http/http.pem voms/vomskey.pem
[root@voms ~]$ chown -R voms.voms voms
</pre>
</li> <li> tomcat service is running as user <code><b>tomcat</b></code>. <img width="16" alt="warning" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/warning.gif" height="16" border="0" /> If you already have service certificate in <code><b>/etc/grid-security/http</b></code> directory make sure that they belong to <code><b>tomcat</b></code> and have right permission. If you don't  have a pair of service you may do the following:<pre class="rootscreen">
[root@voms ~]$ cd /etc/grid-security
[root@voms ~]$ mkdir /etc/grid-security/http
[root@voms ~]$ cp hostcert.pem http/httpcert.pem
[root@voms ~]$ cp hostkey.pem http/httpkey.pem
[root@voms ~]$ chown -R tomcat.tomcat http
</pre>
</li></ol> 
<p />
<p /> <ol>
<li> Run <code><b>voms-admin-configure</b></code> script:<pre class="rootscreen">
[root@voms ~]$ voms-admin-configure install --dbtype mysql --vo <font color="#ff0000">VO_NAME</font> \
    --createdb --deploy-database  --dbauser root  --dbapwd <font color="#ff0000">MYSQL_ROOT_PASSD</font> \
    --dbusername  admin-<font color="#ff0000">VO_NAME</font> --dbpassword <font color="#ff0000">secret </font> \
    --port <font color="#ff0000">VOMS_PORT</font>  --mail-from <font color="#ff0000">email</font> --smtp-host <font color="#ff0000">smtp.domain</font> \
    --sqlloc /usr/lib<font color="#ff0000">64</font>/voms/libvomsmysql.so --cert /etc/grid-security/voms/vomscert.pem \
    --key  /etc/grid-security/voms/vomskey.pem --read-access-for-authenticated-clients 
</pre> For example::<pre class="rootscreen">
[root@voms ~]$ voms-admin-configure install --dbtype mysql --vo test1 --createdb \
     --deploy-database --dbauser root --dbapwd  top_secret \
     --dbusername admin_test1 --dbpassword secret 
     --port 15001 --mail-from tlevshin@fnal.gov --smtp-host smtp.fnal.gov \
     --sqlloc /usr/lib64/voms/libvomsmysql.so --cert /etc/grid-security/voms/vomscert.pem \
     --key  /etc/grid-security/voms/vomskey.pem --read-access-for-authenticated-clients 
</pre>
</li> <li> Now, you need add a local admin:<pre class="rootscreen">
[root@voms ~]$ /usr/sbin/voms-db-deploy.py add-admin --vo <font color="#ff0000">VO_NAME</font>  \
        --dn  <font color="#ff0000">HOST_CERT_SUBJECT</font> \
        --ca <font color="#ff0000">HOST_CERT_ISSUER</font> 
</pre>For example::<pre class="rootscreen">
[root@voms ~]$ /usr/sbin/voms-db-deploy.py add-admin --vo test1 \
     --dn /DC=org/DC=doegrids/OU=Services/CN=fermicloud002.fnal.gov \
     --ca "/DC=org/DC=DOEGrids/OU=Certificate Authorities/CN=DOEGrids CA 1"
</pre>
</li></ol> 
<p /> <ol>
<li> You have to configure tomcat in order to enable EMI trustmanager:<pre class="rootscreen">
[root@voms ~]$ /var/lib/trustmanager-tomcat/configure.sh
Info: using default install root: /
Info: using default configuration file: //var/lib/trustmanager-tomcat/config.properties
Info: using default configuration directory: //var/lib/trustmanager-tomcat
Info: you can clean up using the following commands
      mv -f /etc/tomcat5/server.xml.old-trustmanager /etc/tomcat5/server.xml
      rm -f /usr/share/tomcat5/server/lib/bcprov*.jar
      rm -f /usr/share/tomcat5/server/lib/log4j*.jar
      rm -f /usr/share/tomcat5/server/lib/trustmanager-*.jar
      rm -f /etc/tomcat5/log4j-trustmanager.properties
      rm -f //var/lib/trustmanager-tomcat/server.xml
</pre>
</li></ol> 
<p />
<p />
<p />
<p />
<h1><a name="Start"></a> Start </h1> <ol>
<li> You need updated CRL before you can use voms, so do<pre class="rootscreen">
[root@voms ~]$ fetch-crl
</pre>
</li></ol> 
<p /> <ol>
<li> Start voms server<pre class="rootscreen">
[root@voms ~]$ service voms start
</pre>
</li> <li> , Start tomcat:<pre class="rootscreen">
[root@voms ~]$ service tomcat5 start
</pre>
</li> <li> Start voms-admin:<pre class="rootscreen">
[root@voms ~]$ service voms-admin start
</pre>
</li></ol> 
<p />
<h1><a name="Test"></a> Test </h1>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Voms_admin_test"></a> Voms-admin test </span></h2>
Add member(yourself) to VO. Do the following:<pre class="rootscreen">
[root@voms ~]$ voms-admin --vo <font color="#ff0000">VO_NAME</font> --host <font color="#ff0000">HOST_NAME</font> \
       --nousercert create-user <font color="#ff0000">USER_CERT_SUBJECT</font> <font color="#ff0000">USRT_CERT_ISSUER</font> \
       <font color="#ff0000">USER_COMMON_NAME</font> <font color="#ff0000">email</font> 
</pre> For example:<pre class="rootscreen">
[root@voms ~]$ voms-admin --vo test1 --host fermicloud002 --nousercert create-user \
   "/DC=org/DC=doegrids/OU=People/CN=Joe Doe 12345" "/DC=org/DC=DOEGrids/OU=Certificate Authorities/CN=DOEGrids CA 1" 
   "Joe Doe" jdoe@fnal.gov
</pre>Assign VOAdmin role to yourself. Do the following:<pre class="rootscreen">
voms-admin --vo <font color="#ff0000">VO_NAME</font> --host <font color="#ff0000">HOST_NAME</font> \
    --nousercert assign-role  <font color="#ff0000">/VO_NAME</font>  VO-Admin  \
      <font color="#ff0000">USER_CERT_SUBJECT</font> <font color="#ff0000">USRT_CERT_ISSUER</font> 
</pre>For example:<pre class="rootscreen">
[root@voms ~]$ voms-admin --vo test1 --host fermicloud002 --nousercert assign-role /test1   VO-Admin  \
   "/DC=org/DC=doegrids/OU=People/CN=Joe Doe 12345" "/DC=org/DC=DOEGrids/OU=Certificate Authorities/CN=DOEGrids CA 1" </pre>Check WebUI by accessing <code><b>https://<font color="#ff0000">hostname</font>:8443/vomses</b></code>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Voms_core_test"></a> Voms-core test: </span></h2>
Use <code><b>voms-proxy-init</b></code> to generate proxy. Login as user, create <code><b>vomses</b></code> file:<pre class="file">
"<font color="#ff0000">alias</font>" "<font color="#ff0000">HOST_NAME</font>" "<font color="#ff0000">PORT</font>" "<font color="#ff0000">HOST DN</font>" "<font color="#ff0000">VO_NAME</font>"
</pre> For example:
<pre class="file">
"test1" "fermicloud002.fnal.gov" "15001" "/DC=org/DC=doegrids/OU=Services/CN=fermicloud002.fnal.gov" "test1"
</pre> Generate voms proxy<pre class="screen">
[user@voms ~]$ voms-proxy-init -voms <font color="#ff0000">VO_NAME</font> -vomses ~/vomses
</pre>
<p />
<h1><a name="Stop"></a> Stop </h1> <ol>
<li> Stop voms server<pre class="rootscreen">
[root@voms ~]$ service voms stop
</pre>
</li> <li> Stop voms-admin:<pre class="rootscreen">
[root@voms ~]$ service voms-admin stop
</pre>
</li> <li> Stop tomcat:<pre class="rootscreen">
[root@voms ~]$ service tomcat5 stop
</pre>
</li></ol> 
<p />
<p />
<h1><a name="References"></a> References </h1> <ol>
<li> <a href="https://twiki.cern.ch/twiki/bin/view/EMI/EMIVomsAdminUserGuide261" target="_top">VOMS Admin EMI Guide</a>
</li></ol> </div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Documentation<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Documentation/RPMTempDocuments" class="twikiLink">RPMTempDocuments</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>InstallVomsService</span> <br />    
Topic revision: r20 - 10 Jan 2012 - 16:09:13 - <a href="/bin/view/Main/SuchandraThapa" class="twikiLink">SuchandraThapa</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />