---+ Helpful Hints for Running At-Scale on the OSG
%DOC_STATUS_TABLE%
%STARTINCLUDE%

In no particular order, we have found the following hints useful for VOs as they grow from &quot;exploratory scale&quot; (less than 100 concurrently running jobs) to &quot;production scale&quot; (1000 or more running jobs).

   * Never try using streaming of stdout/stderr in Condor-G. Not only does it disable grid_monitor, but it is also disallowed from most sites.If you need to debug running jobs, consider [[http://jobmon.sourceforge.net/][JobMon]] instead. It is much more scalable, puts less load on the site infrastructure, and is more feature rich.
      * Always use grid_monitor. 
      * The grid_monitor is enabled by default on almost all modern versions of Condor.
   * Avoid =jobmanager-fork= except when installing software.  Even then, we heavily recommend that you *install* software through jobmanager-fork and not *compile* software.
      * Software should be compiled locally, then uploaded remotely.  If this is not an option, compile it as a job on the remote batch system, tarball the results, and then upload through jobmanager fork.
   * Minimise the number and size of files you transfer in or out of a site using =Condor-G=.  Instead, try staging large files in with your job wrapper using HTTP (if a HTTP cache is available and the input data is less than 1GB) or SRM.
      * As a rule of thumb, 10MB per job is a &quot;good size&quot;, 100MB is about the limit.  =Condor-G= won&#39;t error out, but you&#39;ll basically overload the remote server.
   * Avoid using a single !GridFTP server; use SRM, which can distribute the load amongst several servers.
   * Avoid very short- and long-running jobs.  For opportunistic use, &quot;too short&quot; jobs are those less than 30 minutes; &quot;too long&quot; jobs are those more than 8 hours.  Ideal wall clock time for a job is a few hours. Many CEs are limited to jobs shorter than 24 hours, so if you have jobs which need to run for more than 24 hours, less CEs will be available to you. One solution for longer than 24 hour jobs is to break the job up into multiple jobs. One possible solution for short-running jobs is to group several jobs into one job.
      * This advice is not applicable for short jobs; for glideinWMS, try to make sure each job is longer than 1 minute.
   * Just like that are only a subset of CEs accepting long-running jobs, most CEs are configured to not have a huge amount of RAM available per job slot. If your code requires more than 1 GB of RAM, less CEs will be able to accept your jobs.
      * The Engage team usually can provide you with an up-to-date list of sites that accept jobs which are more RAM hungry, and can provide the per-site hacks which need to be done.
   * Avoid network mounted disks for IO operations. Always remember: a cluster is a large error amplifier! If you have &gt;100 jobs running in parallel even a modest amount of IO to a network mounted disk can overwhelm the server, and can cause a large mess on the site you are running!
      * *NEVER* run jobs in =$OSG_DATA=.  Always have the working directory be a subdirectory of =$OSG_WN_TMP=.
      * *NEVER* run =find= as part of your job wrapper as a means to clean up your Globus temporary files in your home directory.  This becomes a disaster for the site when you have several hundred jobs doing this simultaneously.  This behavior will get you banned at many sites.
         * If you want to clean up your home directory, do this in a special job once a day.  If you are using OSG-MM, this would be done in your daily maintenance job.
   * Avoid a steady stream of separate job submissions at around the 1-5 Hz rate. You are better off submitting, say 10 at once, and then take a 20 seconds break, than space them equally by 2 seconds. We found that the gridmonitor is unable to handle a steady stream of submits at 0.5 Hz, while it deals with the other pattern quite well.
   * For =Condor-G= versions below 7.5.0, avoid removing all your jobs at once.  This can severely load your submit host.  Try deleting them 100 at a time.

If you have any additional questions you run into as you scale up your operations on OSG, please feel free to ask other power users for advice by sending email to =osg-sites atSign opensciencegrid DOT org=.

%STOPINCLUDE%


---++ *Comments*
%COMMENT{type=&quot;tableappend&quot;}%

&lt;!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 ===================

 Thank you for claiming ownership for this document! Please fill in your FirstLast name here:
   * Local OWNER = MatsRynge

 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (ComputeElement|Storage|VO|Security|User|Monitoring|General|Trash/Trash/Integration|Operations|Tier3)
   * Local DOC_AREA       = User

 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (EndUser|Student|Developer|SysAdmin|VOManager)
   * Local DOC_ROLE       = Scientist

 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge)
   * Local DOC_TYPE       = Knowledge

  Please define if this document in general needs to be reviewed before release ( %YES% | %NO% )
   * Local INCLUDE_REVIEW = %YES%

 Please define if this document in general needs to be tested before release ( %YES% | %NO% )
   * Local INCLUDE_TEST   = %NO%

 change to %YES% once the document is ready to be reviewed and back to %NO% if that is not the case
   * Local REVIEW_READY   = %YES%

 change to %YES% once the document is ready to be tested and back to %NO% if that is not the case
   * Local TEST_READY     = %NO%

 change to %YES% only if the document has passed the review and the test (if applicable) and is ready for release
   * Local RELEASE_READY  = %YES%


 DEAR DOCUMENT REVIEWER
 ======================

 Thank for reviewing this document! Please fill in your FirstLast name here:
   * Local REVIEWER       = BrianBockelman
 Please define the review status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local REVIEW_PASSED  = %YES%


 DEAR DOCUMENT TESTER
 ====================

 Thank for testing this document! Please fill in your FirstLast name here:
   * Local TESTER         = 
 Please define the test status for this document to be in progress ( %IN_PROGRESS% ), failed ( %NO% ) or passed ( %YES% )
   * Local TEST_PASSED    = %IN_PROGRESS%
############################################################################################################
--&gt;

