<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GlideinWMSCampusGrid &lt; ReleaseDocumentation &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/ReleaseDocumentation/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/ReleaseDocumentation/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/ReleaseDocumentation/GlideinWMSCampusGrid?_T=16 Feb 2017" type="application/x-wiki" title="edit GlideinWMSCampusGrid" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/ReleaseDocumentation/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/ReleaseDocumentation/GlideinWMSCampusGrid"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#9999FF;
	}
	.patternBookView {
		border-color:#9999FF;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">

@import url('https://twiki.opensciencegrid.org/twiki/pub/ReleaseDocumentation/GlideinWMSCampusGrid/centerpageborder-rd.css');

</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="GlideinWMS_in_a_Campus_Grid"></a>  <strong>GlideinWMS in a Campus Grid</strong> </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#About_this_Document"> About this Document</a>
</li> <li> <a href="?cover=print#Required_Software"> Required Software</a>
</li> <li> <a href="?cover=print#GlideinWMS_Frontend_Security_Con"> GlideinWMS Frontend - Security Configuration</a> <ul>
<li> <a href="?cover=print#Enabling_alternative_authenticat"> Enabling alternative authentication methods</a>
</li> <li> <a href="?cover=print#Modify_the_condor_mapfile"> Modify the condor_mapfile</a>
</li> <li> <a href="?cover=print#Authorizing_hosts"> Authorizing hosts</a>
</li> <li> <a href="?cover=print#Flocking_Configuration"> Flocking Configuration</a>
</li></ul> 
</li> <li> <a href="?cover=print#Configuration_of_the_Campus_Fact"> Configuration of the Campus Factory or existing Condor cluster</a>
</li> <li> <a href="?cover=print#Comments"> Comments</a>
</li></ul> 
</div>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="About_this_Document"></a> About this Document </span></h2>
This document will describe how to configure a GlideinWMS frontend to run in a Campus Grid.  This will show how jobs submitted to the Frontend can flock to campus resources as well as going out to the OSG using GlideinWMS.  The GlideinWMS Frontend install document can be found <a href="/bin/view/Trash/ReleaseDocumentationGlideinWMSFrontendInstall" class="twikiLink">here</a>. For <strong>help</strong> and <strong>references</strong> please refer to the <a href="/bin/view/Trash/ReleaseDocumentationGlideinWMSFrontendInstall" class="twikiLink">GlideinWMS Frontend install document</a>.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Required_Software"></a> Required Software </span></h2> <ol>
<li> <a href="/bin/view/Trash/ReleaseDocumentationGlideinWMSFrontendInstall" class="twikiLink">GlideinWMS Frontend</a>
</li></ol> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="GlideinWMS_Frontend_Security_Con"></a> GlideinWMS Frontend - Security Configuration </span></h2>
The configuration of the GlideinWMS Frontend must allow other hosts to communicate with the frontend.  By default, the GlideinWMS Frontend has very strong security, requiring GSI certs to communicate.  In this example, a campus factory or condor cluster is running at condor.unl.edu.  This section will describe the configuration of the GlideinWMS Frontend.
<p />
<h3><a name="Enabling_alternative_authenticat"></a> Enabling alternative authentication methods </h3>
It is necessary to enable authentication methods that are acceptable to the campus.  CLAIMTOBE is recommended in the <a href="/bin/view/Documentation/CampusFactoryInstall" class="twikiLink">Campus Factory Install</a> guide, and will be used to implement host (ip address) based security in this document.  
<p />
First enable the CLAIMTOBE method.  Copy and paste the below into your local condor configuration file.  It will append the existing authentication methods to include CLAIMTOBE.  
<pre class="file">
SEC_DEFAULT_AUTHENTICATION_METHODS = $(SEC_DEFAULT_AUTHENTICATION_METHODS), CLAIMTOBE
</pre>
<p />
<h3><a name="Modify_the_condor_mapfile"></a> Modify the <code>condor_mapfile</code> </h3>
The <code>condor_mapfile</code> is used by Condor to map a authenticated user to a human readable identity to be used in authentication rules. 
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  The <code>condor_mapfile</code> uses regular expressions to map from authentication methods to users.  This is why there are many escapes (<code>\</code>) in the below example.
</dd></dl> 
<p />
Add the following important line, that most hosts attempting to authenticate will use:<pre class="file">
CLAIMTOBE .* anonymous@claimtobe</pre>  
This means that any machine using <code>CLAIMTOBE</code> authentication method will be mapped to user <a href="mailto&#58;anonymous&#64;claimtobe">anonymous&#64;claimtobe</a> (The user does not have to exist on the machine).  Therefore all authorization rules will use <code>anonymous@claimtobe</code> to refer to this user and can be more restrictive than the rules for GSI authenticated users.
<p />
The file, including the part already there from the GlideinWMS Frontend install, should look similar to the following example:<pre class="file">
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=host\/hcc\-grid\.unl\.edu$" dweitzel
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=host\/cpass\.unl\.edu$" dweitzel
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=host\/(.*)\.unl\.edu$" \1@daemon.unl.edu
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=host\/(.*)\.rcac\.purdue\.edu$" \1@daemon.purdue.edu
GSI (.*) anonymous
FS (.*) \1
CLAIMTOBE .* anonymous@claimtobe
</pre>
<p />
<h3><a name="Authorizing_hosts"></a> Authorizing hosts </h3>
Below is an example security configuration file from the HCC GlideinWMS Frontend.
<p />
<pre class="file">
DENY_WRITE = anonymous@* 
ALLOW_WRITE = *@unl.edu *@glidein.unl.edu execute-side@matchsession *@daemon.unl.edu *@daemon.purdue.edu <strong>*/condor.unl.edu</strong>
DENY_ADVERTISE_SCHEDD = anonymous@*
DENY_ADMINISTRATOR = anonymous@*
DENY_DAEMON = anonymous@glidein.unl.edu 
ALLOW_DAEMON = *@unl.edu *@glidein.unl.edu  execute-side@matchsession *@daemon.unl.edu *@daemon.purdue.edu 
DENY_NEGOTIATOR = anonymous@glidein.unl.edu 
ALLOW_NEGOTIATOR = */*.unl.edu *@daemon.purdue.edu <strong>*/condor.unl.edu</strong></pre>
<p />
Some quick definitions: <dl>
<dt> <code>ALLOW_WRITE</code> </dt><dd> Hosts that are able to write to the local Condor instance.  This should include all hosts running the Campus Factory and condor clusters you wish to flock to.
</dd> <dt> <code>ALLOW_NEGOTIATOR</code> </dt><dd> Hosts that run Negotiators that we should trust.  This should include all hosts running the Campus Factory and condor clusters you wish to flock to.
</dd></dl> 
<p />
Breaking down the file some:
<pre class="file">
DENY_WRITE = anonymous@* 
ALLOW_WRITE = *@unl.edu *@glidein.unl.edu execute-side@matchsession *@daemon.unl.edu *@daemon.purdue.edu <strong>*/condor.unl.edu</strong></pre>
The <code>DENY_WRITE</code> statement causes Condor to disallow write access to anyone not explicitly listed in the <code>condor_mapfile</code>.  The <code>ALLOW_WRITE</code> line allows explicitly listed people access to write, along with anyone and everyone from <code>condor.unl.edu</code>.
<hr />
<p />
<pre class="file">
ALLOW_NEGOTIATOR = */*.unl.edu *@daemon.purdue.edu <strong>*/condor.unl.edu</strong> </pre>
Allow condor.unl.edu to negotiate jobs submitted at this host.
<p />
<p />
<h3><a name="Flocking_Configuration"></a> Flocking Configuration </h3>
Set the flocking to the hostname of each campus factory and the central manager of existing condor clusters.
<pre class="file">
FLOCK_TO = condor.unl.edu
</pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Configuration_of_the_Campus_Fact"></a> Configuration of the Campus Factory or existing Condor cluster </span></h2>
For all the Campus Factories and any existing Condor cluster that you'd like to use, the submit host needs to be added to the <code>FLOCK_FROM</code> configuration value.   Either find the  FLOCK_FROM variable in the Condor configuration, or append it to the end of the local Condor config file:<pre class="file">
FLOCK_FROM = $(FLOCK_FROM) <font color="#ff0000">submit.host</font>
</pre>
Replacing <font color="#ff0000">submit.host</font> with the full hostname or IP of the submit host.
<p />
<hr />
Additionally, the existing Condor cluster must have the <code>CLAIMTOBE</code> authentication method enabled.  The Campus Factory has this method enabled by default.
<pre class="file">
SEC_DEFAULT_AUTHENTICATION_METHODS = $(SEC_DEFAULT_AUTHENTICATION_METHODS), CLAIMTOBE
</pre>
<hr />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Comments"></a> <strong>Comments</strong> </span></h2>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/ReleaseDocumentation/GlideinWMSCampusGrid" enctype="multipart/form-data" name="tableappend0" id="tableappend0">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="0"  /></form>
<p />
<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 <code><b>===============</b></code>
<p />
 Thank you for claiming ownership for this document! Please fill in your <span class="twikiNewLink">FirstLast<a href="/bin/edit/ReleaseDocumentation/FirstLast?topicparent=ReleaseDocumentation.GlideinWMSCampusGrid" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> name here: <ul>
<li> Local OWNER = <span class="twikiNewLink">DerekWeitzel<a href="/bin/edit/ReleaseDocumentation/DerekWeitzel?topicparent=ReleaseDocumentation.GlideinWMSCampusGrid" rel="nofollow" title="DerekWeitzel (this topic does not yet exist; you can create it)">?</a></span>
</li></ul> 
<p />
 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (<span class="twikiNewLink">ComputeElement<a href="/bin/edit/ReleaseDocumentation/ComputeElement?topicparent=ReleaseDocumentation.GlideinWMSCampusGrid" rel="nofollow" title="ComputeElement (this topic does not yet exist; you can create it)">?</a></span>|Storage|VO|Security|User|Monitoring|General|Trash/Trash/Integration|Operations|Tier3) <ul>
<li> Local DOC_AREA       = User
</li></ul> 
<p />
 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (<span class="twikiNewLink">EndUser<a href="/bin/edit/ReleaseDocumentation/EndUser?topicparent=ReleaseDocumentation.GlideinWMSCampusGrid" rel="nofollow" title="EndUser (this topic does not yet exist; you can create it)">?</a></span>|Student|Developer|SysAdmin|VOManager) <ul>
<li> Local DOC_ROLE       = <span class="twikiNewLink">SysAdmin<a href="/bin/edit/ReleaseDocumentation/SysAdmin?topicparent=ReleaseDocumentation.GlideinWMSCampusGrid" rel="nofollow" title="SysAdmin (this topic does not yet exist; you can create it)">?</a></span>
</li></ul> 
<p />
 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge) <ul>
<li> Local DOC_TYPE       = Installation  Please define if this document in general needs to be reviewed before release ( 1 | 0 )
</li> <li> Local INCLUDE_REVIEW = 1
</li></ul> 
<p />
 Please define if this document in general needs to be tested before release ( 1 | 0 ) <ul>
<li> Local INCLUDE_TEST   = 1
</li></ul> 
<p />
 change to 1 once the document is ready to be reviewed and back to 0 if that is not the case <ul>
<li> Local REVIEW_READY   = 1
</li></ul> 
<p />
 change to 1 once the document is ready to be tested and back to 0 if that is not the case <ul>
<li> Local TEST_READY     = 1
</li></ul> 
<p />
 change to 1 only if the document has passed the review and the test (if applicable) and is ready for release <ul>
<li> Local RELEASE_READY  = 0
</li></ul> 
<p />
<p />
 DEAR DOCUMENT REVIEWER
 <code><b>==================</b></code>
<p />
 Thank for reviewing this document! Please fill in your <span class="twikiNewLink">FirstLast<a href="/bin/edit/ReleaseDocumentation/FirstLast?topicparent=ReleaseDocumentation.GlideinWMSCampusGrid" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> name here: <ul>
<li> Local REVIEWER       = <span class="twikiNewLink">MarcoMambelli<a href="/bin/edit/ReleaseDocumentation/MarcoMambelli?topicparent=ReleaseDocumentation.GlideinWMSCampusGrid" rel="nofollow" title="MarcoMambelli (this topic does not yet exist; you can create it)">?</a></span> 	 Please define the review status for this document to be in progress ( 2 ), failed ( 0 ) or passed ( 1 )
</li> <li> Local REVIEW_PASSED  = 1
</li></ul> 
<p />
<p />
 DEAR DOCUMENT TESTER
 <code><b>================</b></code>
<p />
 Thank for testing this document! Please fill in your <span class="twikiNewLink">FirstLast<a href="/bin/edit/ReleaseDocumentation/FirstLast?topicparent=ReleaseDocumentation.GlideinWMSCampusGrid" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> name here: <ul>
<li> Local TESTER         = <span class="twikiNewLink">MarcoMambelli<a href="/bin/edit/ReleaseDocumentation/MarcoMambelli?topicparent=ReleaseDocumentation.GlideinWMSCampusGrid" rel="nofollow" title="MarcoMambelli (this topic does not yet exist; you can create it)">?</a></span> 	 Please define the test status for this document to be in progress ( 2 ), failed ( 0 ) or passed ( 1 )
</li> <li> Local TEST_PASSED    = 2
</li></ul> 
############################################################################################################
--></div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: ReleaseDocumentation<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><span class="twikiNewLink">Trash/Trash/Integration<a href="/bin/edit/Trash/Trash/Integration/WebHome?topicparent=ReleaseDocumentation.GlideinWMSCampusGrid" rel="nofollow" title="Trash/Trash/Integration (this topic does not yet exist; you can create it)">?</a></span> &gt; <a href="/bin/view/ReleaseDocumentation/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a> &gt; <a href="/bin/view/Trash/ReleaseDocumentationGlideinWMSFrontendInstall" class="twikiLink">ReleaseDocumentationGlideinWMSFrontendInstall</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GlideinWMSCampusGrid</span> <br />    
Topic revision: r16 - 07 Feb 2017 - 19:42:06 - <a href="/bin/view/Main/BrianBockelman" class="twikiLink">BrianBockelman</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />