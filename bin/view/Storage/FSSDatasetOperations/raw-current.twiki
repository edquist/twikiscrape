---+!! *&lt;noop&gt;%SPACEOUT{ &quot;%TOPIC%&quot; }%*
%TOC%

---++ Dataset Operations

---+++ Defining Datasets

Defining datasets ensures that all files in a dataset are directed to the same storage resource. It also allows for copies and deletions of datasets, and for dataset-based allocations.

Dataset parameters and membership are defined in the Dataset Catalog portion of PSC. Information on the location and state of the files in a dataset are saved in the Replica Catalog. In the dataset catalog there is one object per dataset. In the replica catalog there is a dataset object for every allocation on which members of a dataset exist.  

Datasets may be defined by specifying a directory. However, members of a dataset may not all be in the same directory structure, or it may be desired that some files in a directory structure be considered as members a set and others, not. Therefore, it is possible to define dataset membership on individual files as well as on directories.


   1. The user/VOA invokes the [[FSSCommandReference#Dataset_registration_tool][dataset registration tool]] with the dataset handle as an argument. 
   * A directory or file path can be specified as an option. Its namespace object must exist.
   * The expected size of the dataset can be specified as an option. 
   * Requesting a space reservation within the allocation is an option. The expected size must be specified.
   * The expected number of files can be specified as an option. 
   * The desired expiration of the dataset can be specified as an option. 

To check whether a file is a member of a dataset, its namespace object is first checked for a dataset reference. If there is no value, each directory in the file’s path is checked for a dataset reference. The lowest such reference, if any, defines the file’s dataset membership by path. There are four consequences to this rule. 

   * Dataset membership may be defined directly in a file’s dataset reference attribute, overriding any membership defined by path. 
   * All files (recursively) below a dataset directory in the filesystem are part of the dataset, except if there are other datasets defined by path below that dataset directory.
   * If any directory below a dataset directory is given a dataset handle, all files below it become part of the new dataset. 
   * If any directory above a dataset directory is given a dataset handle, there is no effect on the original dataset’s membership.

It is allowable to have files and directories with the same dataset handle, in which case when referred to by handle they are considered as being in the same dataset. It is allowable to have more than one directory with the same dataset handle, in which case when referred to by handle they are considered as being in the same dataset. When referred to by path in the dataset context, only the members below the directory are included.


---+++ Datasets in the Replica Catalog

The state of a dataset on a storage resource is maintained in a replica catalog object.

   1. The [[FSSCommandReference#Dataset_replica_update_utility][dataset replica update utility]] is invoked, which creates or updates an object in the Replica Catalog with attributes specified on the command line, or their defaults. 


---+++ Requesting a Suballocation for a Dataset

Part of an allocation may be assigned to a dataset as a suballocation. A suballocation for a dataset will also be called a “space reservation”, and is consistent with the SRM definition of the same. To make a space reservation, the user or VOA first makes a request as described here, then the VOA meets the request with the steps described in [[FSSUserAdministration#Granting_Suballocations_and_Defi][Granting Suballocations and Defining Quotas]].

   1. To request a space reservation, the user or VOA runs the [[FSSCommandReference#Allocation_request_tool][allocation request tool]] with arguments of
   * The dataset handle.
   * The size of the suballocation.
   * Optionally, the maximum  number of files of the suballocation.
   * Optionally, the desired expiration of the suballocation. The default is that of the allocation.
   * Optionally, the specific site or storage resource on which the allocation is to be made.

Dataset suballocation (space reservation) requests are different from user or group suballocation requests (see [[FSSUserAdministration#Requesting_a_Suballocation_for_a][Requesting a Suballocation for a User or Group]]) in that, if replicas of a dataset already exist, then a suballocation request is made for each of them, whereas for a user or group at most one suballocation request is made at a time.




---+++ Dataset Deletion

   1. To delete a dataset, the [[FSSCommandReference#Dataset_operation_tool][dataset operation tool]] is invoked with the “delete” flag and dataset handle. For the case of multiple replicas, the storage resource may be specified.
   1. The dataset operation tool invokes the [[FSSCommandReference#Public_storage_delete][public storage delete]] command for each file in each dataset replica.
   * If the dataset has space reservation on a storage resource, it is updated.

---+++ Dataset Replication

   1. To replicate a dataset, the [[FSSCommandReference#Dataset_operation_tool][dataset operation tool]] is invoked with the “replicate” flag and dataset handle. The source and/or destination storage resources may optionally be specified. After any resource selection, the following is done.
   1. For each file, the [[FSSCommandReference#Public_storage_copy][public storage copy command]] is called with source and destination storage resources as either specified or selected.


-- Main.TedHesselroth - 20 Sep 2010
