---+ Proposed Change to configure-osg.py for Gratia

&lt;!--

   * Set VIEWTHISTOPIC = &lt;div class=&quot;twikiSmall&quot;&gt;&lt;a href=&quot;%TOPIC%&quot;&gt;View this section&lt;/a&gt;&lt;/div&gt; 
 --&gt;

%TOC%

%STARTINCLUDE%

---++ Description
%VIEWTHISTOPIC%

The configuration of the !ProbeConfig file is performed by the VDT _configure_gratia_ script with is run each time the _configure-osg.py/sh_ script is run.  Recent changes have been made to the _configure_gratia_ script to avoid the overwriting (as in changing various attributes) that may have been manually changed.

These modifications were required because the _configure-osg.py_ .ini file does not contain these attributes.  So when _configure-osg.py_ is executed for other changes, it spawns _configure_gratia_ with default values thus overwriting manual changes. 

The &quot;--force-probe-config&quot; option that was added to the _configure_gratia_ is really a band-aid solution.  The critical gratia attributes should be added to the _configure-osg.py_ .ini files for a more effective long-term solution.

Currently, the only attribute the OSG _full-config.ini_ file has for Gratia is:
   * enable_gratia = %(disable)s

If Gratia is enabled, the configure-osg.py script will execute _configure_gratia_ twice, once for the batch queue manager probe and once for the rsv metric probe:
&lt;verbatim&gt;
Configuring Gratia now.
Configuring Gratia to report to ITB server
Executing configure_gratia as:
/usr/local/osg-ce/vdt/setup/configure_gratia
--probe-cron
--site-name ITB_INSTALL_TEST_2
--report-to gratia.opensciencegrid.org:8881
--probe condor

Configuring Gratia to report to ITB server
Executing configure_gratia as:
/usr/local/osg-ce/vdt/setup/configure_gratia
--probe-cron
--site-name ITB_INSTALL_TEST_2
--report-to gratia.opensciencegrid.org:8881
--report-to rsv-itb.grid.iu.edu:8880
--probe metric
&lt;/verbatim&gt;

_Note:_ In the above execution of the rsv metric probe, there appears to be a bug as _configure_gratia_ is executed with 2 &#39;--report-to&#39; arguments.  It does not affect the results since the rsv &#39;report-to&#39; is last.


The current attributes of the various gratia configuration file that are affected by _configure_gratia_ are:
   1 job manager probes (condor, lsf, sge, pbs)
      &lt;verbatim&gt;
    SSLHost=&quot;gratia.opensciencegrid.org:8881&quot;
    SSLRegistrationHost=&quot;gratia.opensciencegrid.org:8881&quot;
    SOAPHost=&quot;gratia.opensciencegrid.org:8881&quot;
    SiteName=&quot;ITB_INSTALL_TEST_2&quot;
    MeterName=&quot;condor:cms-xen1.fnal.gov&quot;
      &lt;/verbatim&gt;
      * !SSLHost / !SSLRegistrationHost / !SOAPHost -   set by the &#39;--report-to&#39; argument and based on whether the Site Information section / group attribute of the .ini file is OSG or OSG-ITB
      * !SiteName - set based based on the Site Information section / site_name attribute of the .ini file
      * !MeterName - set based on the &#39;enabled&#39; attribute of the batch queue manager section of the .ini file.

---++ History of configure-osg.py/sh
The various services (e.g., Gratia, Trash.ReleaseDocumentationMonALISA, GIP, RSV, gridftp, etc)  that run on a given node, in many cases, share some common information.  Each has its own configuration file(s).  Insuring consistency of the common data across these various services was a serious problem.

The _configure-osg.py/sh_ scripts were created to provide a single point of configuration data for a node and handled the consistency issue. The _configure-osg.sh_ script is being deprecated in favor of _configure-osg.py_ which uses an editable configuration file in place of a question/answer  method.   So these changes are directed at the _configure-osg.py_ script and configuration files.

---++ Current Problems
As the Gratia probes evolved and multiplied, data needed in its configuration files were addressed solely in the VDT _configure_gratia_ script.  Since the _configure-osg-py_ is run any time a change is made to configuration data, changes to gratia confguration data was affected.  This was fine unless an administrator made manual changes to one of the configuration files.  It would then get over-written by the default values in _configure-osg.py_ .

While the &#39;--force-probe-config&#39; option allows you to make changes to the !ProbeConfig file independent of the _configure-osg.py_ _full-config.ini_ file, it defeats the original intent  of that file and process.

---++ Proposed Change
I am proposing that the following attributes be added to the OSG&#39;s _full-config.ini_ file for Gratia:
   * enable_gratia = %(disable)s
   * gratia_report_to_host = %(default)s%BR%
      . defaults:%BR%
          Site Information section / group attribute = OSG, then gratia.opensciencegrid.org:8880%BR%
          Site Information section / group attribute = OSG-ITB, then gratia.opensciencegrid.org:8881%BR%
          If &#39;default not specified, use the value.%BR%
         This change is especially critical if Gratia gets deployed at site(s) for collection of local accounting data.




%STOPINCLUDE%


-- Main.JohnWeigand - 18 Nov 2008
