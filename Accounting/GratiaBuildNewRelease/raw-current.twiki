---+ Gratia - Building a New Release For Distribution

&lt;!--
   * Set RELEASE_TAR_REPOSITORY = /afs/fnal.gov/files/expwww/gratia/html/Files/.      
   * Set RELEASE_DATE = 5/14/08      
   * Set CURRENT_RELEASE = v1.04.00
   * Set RELEASE_TAG = v1-04-0
   * Set NEXT_DEVEL_VERSION = v1.05
   * Set BUILD_DIRECTORY = /home/gratia/gratia-releases/gratia-%CURRENT_RELEASE%      
   * Set GRATIA_RELEASES = /home/gratia/gratia-releases      
   * Set VIEWTHISTOPIC = &lt;div class=&quot;twikiSmall&quot;&gt;&lt;a href=&quot;%TOPIC%&quot;&gt;View this section&lt;/a&gt;&lt;/div&gt; 
 --&gt;

%TOC%

%STARTINCLUDE%

---+ Building a new release for distribution

%VIEWTHISTOPIC%

This section describes the steps for building a release of Gratia tomcat services for distribution.
---++ Verify and update Gratia for the new release

*As yourself*, make sure your build area contains all _committed_ changes:
   * cd [PATH_TO_GRATIA]/gratia 
   * svn update 

*As yourself*, in _gratia/build-scripts/Makefile_ , change the _version_default_ to:
   * version_default = %NEXT_DEVEL_VERSION% 
   * commit the change 

---++ Tag and build the new release

*As yourself*, tag the release. This make a svn copy of the current state of the trunk.
   * svn cp https://gratia.svn.sourceforge.net/svnroot/gratia/trunk https://gratia.svn.sourceforge.net/svnroot/gratia/tags/%RELEASE_TAG%
and prepare the patch branch:
   * svn cp https://gratia.svn.sourceforge.net/svnroot/gratia/tags/%RELEASE_TAG% https://gratia.svn.sourceforge.net/svnroot/gratia/branches/%RELEASE_TAG%-patches

For patches release do
   * svn cp https://gratia.svn.sourceforge.net/svnroot/gratia/branches/%RELEASE_TAG%-patches https://gratia.svn.sourceforge.net/svnroot/gratia/tags/%RELEASE_TAG%-%MINOR_VERSION%

*As gratia user*, build it for the release (this insures that tar files are produced for VDT):
   * cd /home/gratia/gratia-releases 
   * svn export https://gratia.svn.sourceforge.net/svnroot/gratia/tags/%RELEASE_TAG% gratia-%CURRENT_RELEASE%
   * cd gratia-%CURRENT_RELEASE%/build-scripts 
   * source setup-jdk15.sh 
   * make release 

*As gratia user*, copy the tarballs for this release to a &#39;save&#39; area:
   * cd /home/gratia/gratia-releases/gratia-%CURRENT_RELEASE%/target
   * cp -p gratia_reporting_%CURRENT_RELEASE%.tar   /home/gratia/gratia-releases/tarballs/.
   * cp -p gratia_services_%CURRENT_RELEASE%.tar   /home/gratia/gratia-releases/tarballs/.

---++ Make the new release available for inclusion in the VDT

*As yourself*, copy the built tar files to the VDT release area:
   * cd /home/gratia/gratia-releases/gratia-%CURRENT_RELEASE%/target 
   * scp gratia_reporting_%CURRENT_RELEASE%.tar flxi07.fnal.gov:%RELEASE_TAR_REPOSITORY% 
   * scp gratia_services_%CURRENT_RELEASE%.tar flxi07.fnal.gov:%RELEASE_TAR_REPOSITORY% 

*As yourself*,update the version number on the [[InstallationGuideVDT][services release TWiki page]]:
   * Edit and update the TWiki variable _ReleaseVersion_. 

*As yourself*, create a VDT support ticket via email so it gets prioritized with the VDT team:
   * Example: 

&lt;table width=&quot;451&quot; height=&quot;77&quot; border=&quot;0&quot;&gt; &lt;tbody&gt;&lt;tr&gt;&lt;td&gt;To: &lt;/td&gt;&lt;td&gt;vdt-support@opensciencegrid.org &lt;br /&gt; &lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt; Reply-to:&lt;/td&gt;&lt;td&gt;gratia-operation@fnal.gov&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt; Subject&lt;/td&gt;&lt;td&gt;Gratia %CURRENT_RELEASE% available for inclusion in next VDT release&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt; Content:&lt;/td&gt;&lt;td&gt; &lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt; &lt;/table&gt;

%STOPINCLUDE%

-- Main.JohnWeigand - 18 Jul 2008

