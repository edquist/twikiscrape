<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GratiaInterfacesApelLcg &lt; Accounting &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Accounting/GratiaInterfacesApelLcg?_T=16 Feb 2017" type="application/x-wiki" title="edit GratiaInterfacesApelLcg" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Accounting/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Accounting/GratiaInterfacesApelLcg"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TWISTYPLUGIN_TWISTY--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.css");
</style>
<script type='text/javascript' src='https://twiki.opensciencegrid.org/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js'></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiPref.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.compressed.js"></script>
<script type="text/javascript">
// <![CDATA[
var styleText = '<style type="text/css" media="all">.twikiMakeVisible{display:inline;}.twikiMakeVisibleInline{display:inline;}.twikiMakeVisibleBlock{display:block;}.twikiMakeHidden{display:none;}</style>';
document.write(styleText);
// ]]>
</script>

<!--TABLEPLUGIN_table1--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
.twikiTable#table1 th {background-color:#99CCCC;}
.twikiTable#table1 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table1 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table1 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<!--TABLEPLUGIN_twikiAttachmentsTable--><style type="text/css" media="all">
.twikiTable#twikiAttachmentsTable td {border-style:solid none;}
.twikiTable#twikiAttachmentsTable th {border-style:solid none;}
.twikiTable#twikiAttachmentsTable td {vertical-align:middle;}
.twikiTable#twikiAttachmentsTable th {vertical-align:middle;}
.twikiTable#twikiAttachmentsTable td {vertical-align:top;}
.twikiTable#twikiAttachmentsTable th {background-color:#eceef2;}
.twikiTable#twikiAttachmentsTable th.twikiSortedCol {background-color:#e0e3e9;}
.twikiTable#twikiAttachmentsTable tr.twikiTableRowdataBg0 td {background-color:#ffffff;}
.twikiTable#twikiAttachmentsTable tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#f2f3f6;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol0 {text-align:center;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol1 {text-align:left;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol2 {text-align:left;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol3 {text-align:right;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol4 {text-align:left;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol5 {text-align:left;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol6 {text-align:left;}
.twikiTable#twikiAttachmentsTable td.twikiTableCol7 {text-align:center;}
</style>
<!--TABLEPLUGIN_table4--><style type="text/css" media="all">
.twikiTable#table4 th {background-color:#99CCCC;}
.twikiTable#table4 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table4 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table4 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table4 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table4 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style></head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Gratia_Interfaces_APEL_WLCG"></a>  Gratia Interfaces - APEL/WLCG </h1>
<p />
<!-- <ul>
<li> Set OIM_HOME= <a href="http://oim.grid.iu.edu/" target="_top">OIM (OSG Information Management System)</a>
</li> <li> Set MYOSG_HOME= <a href="http://myosg.grid.iu.edu/about" target="_top">MyOSG</a>
</li></ul> 
<p /> <ul>
<li> Set GRATIA_APEL_UI = <a href="http://gratia-osg-prod-reports.opensciencegrid.org/gratia-data/interfaces/apel-lcg/" target="_top">Gratia-APEL WLCG Interface</a>
</li> <li> Set OSG_WLCG_REPORTING = <a href="http://gratiaweb.grid.iu.edu/gratia/wlcg_reporting" target="_top">OSG WLCG Reporting</a>
</li></ul> 
<p /> <ul>
<li> Set EGI_PORTAL                        = <a href="http://accounting.egi.eu/osg.php" target="_top">EGI Accounting Portal</a>
</li> <li> Set EGI_PORTAL_OSG_VIEW   = <a href="http://accounting.egi.eu/osg.php" target="_top">EGI Accounting Portal - OSG view</a>
</li> <li> Set EGI_PORTAL_TIER1_VIEW = <a href="http://accounting.egi.eu/tier1.php" target="_top">EGI Accounting Portal - Tier 1 view</a>
</li> <li> Set EGI_PORTAL_TIER2_VIEW = <a href="http://accounting.egi.eu/tier2.php" target="_top">EGI Accounting Portal - Tier 2 view</a>
</li> <li> Set EGI_PORTAL_USER_VIEW = <a href="http://www3.egee.cesga.es/gridsite/accounting/CESGA/user/user_view.html" target="_top">EGI Accounting Portal - User view</a>
</li> <li> Set EGI_PORTAL_VOMEMBER_VIEW = <a href="https://accounting.egi.eu/user/vomem.php" target="_top">EGI Accounting Portal - VO Member view</a>
</li></ul> 
<p /> <ul>
<li> Set APEL_FAQ=<a href="https://twiki.cern.ch/twiki/bin/view/EMI/APELFAQ" target="_top">APEL FAQ and Troubleshooting</a>
</li> <li> Set APEL_SERVER=<a href="https://wiki.egi.eu/wiki/APEL/Server" target="_top">APEL Server</a>
</li> <li> Set APEL_SUMMARY_RECS=<a href="https://wiki.egi.eu/wiki/APEL/MessageFormat#Summary_Job_Records" target="_top">APEL Job Summary Records</a>
</li></ul> 
<p /> <ul>
<li> Set WLCG_REBUS_TOPOLOGY = <a href="http://wlcg-rebus.cern.ch/apps/topology/" target="_top">EGI REBUS topology</a>
</li></ul> 
<p /> <ul>
<li> Set REPORTABLE_SITES = <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Reportable_resource_groups" class="twikiCurrentTopicLink twikiAnchorLink">lcg-reportableSites</a> 
</li> <li> Set REPORTABLE_VOS    = <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Reportable_VO_data" class="twikiCurrentTopicLink twikiAnchorLink">lcg-reportableVOs</a>
</li> <li> Set GRATIA_QUERY    = <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Gratia_query" class="twikiCurrentTopicLink twikiAnchorLink">Gratia sql query</a>
</li> <li> Set NORMALIZATION_FACTOR = <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Normalization_Factor" class="twikiCurrentTopicLink twikiAnchorLink">normalization factor</a>
</li></ul> 
<p /> <ul>
<li> Set ACCOUNTING_DATA = <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Accounting_Data" class="twikiCurrentTopicLink twikiAnchorLink">APEL accounting data</a>
</li></ul> 
-->
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Description"> Description</a>
</li> <li> <a href="?cover=print#Contact_Information"> Contact Information</a>
</li> <li> <a href="?cover=print#Frequency"> Frequency</a>
</li> <li> <a href="?cover=print#Accounting_Data"> Accounting Data</a>
</li> <li> <a href="?cover=print#The_Process"> The Process</a> <ul>
<li> <a href="?cover=print#Reportable_resource_groups"> Reportable resource groups</a>
</li> <li> <a href="?cover=print#Normalization_Factor"> Normalization Factor</a>
</li> <li> <a href="?cover=print#Reportable_VO_data"> Reportable VO data </a>
</li> <li> <a href="?cover=print#Gratia_query"> Gratia query</a>
</li></ul> 
</li> <li> <a href="?cover=print#Validation_Verifications"> Validation/Verifications</a> <ul>
<li> <a href="?cover=print#Sites_resources_are_reporting"> Sites/resources are reporting.</a>
</li> <li> <a href="?cover=print#MyOSG_and_EGI_REBUS_topology_agr"> MyOSG and EGI REBUS topology agree</a>
</li> <li> <a href="?cover=print#Other_warning_error_messages"> Other warning/error messages</a>
</li></ul> 
</li> <li> <a href="?cover=print#Maintaining_the_Normalization_Fa"> Maintaining the Normalization Factors</a>
</li> <li> <a href="?cover=print#Maintaining_the_Reportable_Sites"> Maintaining the Reportable Sites and VOs</a>
</li> <li> <a href="?cover=print#Would_like_to_have_enhancements"> Would like to have enhancements</a> <ul>
<li> <a href="?cover=print#Move_the_manually_maintained_con"> Move the manually maintained configuration files to MyOsg</a>
</li></ul> 
</li> <li> <a href="?cover=print#Open_issues_To_Do_s"> Open issues / To-Do's</a> <ul>
<li> <a href="?cover=print#Synchronization_of_OIM_MyOSG_wit"> Synchronization of OIM/MyOSG with Gratia</a>
</li> <li> <a href="?cover=print#Validation_verification_of_month"> Validation/verification of monthly MOU reports</a>
</li> <li> <a href="?cover=print#Normalization_factor_issues"> Normalization factor issues</a>
</li></ul> 
</li> <li> <a href="?cover=print#History"> History</a>
</li> <li> <a href="?cover=print#More_information"> More information</a> <ul>
<li> <a href="?cover=print#Sending_Data_to_EGI_Based_on_VO"> Sending Data to EGI Based on VO Only</a>
</li> <li> <a href="?cover=print#APEL_SSM_ActiveMQ_Interface"> APEL SSM/ActiveMQ Interface</a>
</li> <li> <a href="?cover=print#Developers_Corner"> Developers Corner</a>
</li> <li> <a href="?cover=print#EGI"> EGI </a>
</li></ul> 
</li></ul> 
</div>
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Description"></a> Description </span></h2>
Accounting records collected by Gratia are forwarded to the EGI accounting system, APEL. This is important for US-LHC Tier1 and Tier2 facilities which have to demonstrate to the LHC project delivered computing resources on behalf of ATLAS, CMS and ALICE collaborations, in accordance with signed Memorandum of Understanding agreements. A service outside the OSG software infrastructure (VDT) runs at Fermilab, parses and analyzes accounting records for a resource, scales wall time and cpu usage into HepSpec2006 for the processor type, and then forwards this data to the <a href="https://wiki.egi.eu/wiki/APEL/Server" target="_top">APEL Server</a> at the EGI GOC
<p />
The APEL Accounting Portal at RAL has been storing CPU accounting results for WLCG.  On behalf on the ATLAS, CMS and ALICE Tier 1 and Tier 2 that are part of OSG, OSG uploads usage information from Gratia to the APEL accounting system.  This OSG data can be viewed in the 
<a href="http://accounting.egi.eu/osg.php" target="_top">EGI Accounting Portal - OSG view</a>.  APEL is using OSG <strong><em>resource groups</em></strong>  registered in <a href="http://oim.grid.iu.edu/" target="_top">OIM (OSG Information Management System)</a> and viewable in <a href="http://myosg.grid.iu.edu/about" target="_top">MyOSG</a>
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Contact_Information"></a> Contact Information </span></h2>
For support issues on this interface, the contacts are: <ul>
<li> Gratia Operations <a href="mailto&#58;gratia&#45;operations&#64;opensciencegrid&#46;org">gratia-operations&#64;opensciencegrid.org</a>
</li> <li> APEL-WLCG Operations: <a href="mailto&#58;apel&#45;support&#64;jiscmail&#46;ac&#46;uk">apel-support&#64;jiscmail.ac.uk</a>
</li> <li> <a href="https://twiki.cern.ch/twiki/bin/view/EMI/APELFAQ" target="_top">APEL FAQ and Troubleshooting</a>
</li></ul> 
<p />
For non-support general type issues on this interface, the contacts are: <ul>
<li> <a href="mailto&#58;osg&#45;wlcg&#45;reports&#64;opensciencegrid&#46;org">osg-wlcg-reports&#64;opensciencegrid.org</a>
</li></ul> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Frequency"></a> Frequency </span></h2>
The update to APEL from Gratia is performed daily, aggregating usage information for the current month on a per <strong><em>resource group</em></strong>  and VO basis (and effective 11/1/2009 by User Distinguished Name).  Each update is a complete refresh of the current month's usage.  
<p />
In order to insure completeness of the previous month's usage, a special update is performed for the previous month for the 1st 5 days of the current month.  This special update allows for any late reporting to Gratia that may occur.   In addition, this been set  to coincide with the LCG Accounting Office extract of the data from the EGI accounting portal for the monthly MOU reports.  This occurs on the 8th of each month.
<p />
These are cron jobs running between 00:00 and 02:00 Central Time daily. The update is performed by deleting the entire months data and then re-inserting (all using sql dml statements) the new summaries.  
<p />
The APEL system then performs an aggregation of all the accounting data collected from all sites (inclusive of OSG) and updates the <a href="http://accounting.egi.eu/osg.php" target="_top">EGI Accounting Portal</a> at least once per day.  As this process involves a lot of aggregation over a large database the actual time this occurs can vary.  The last update time can be viewed at the bottom of the <a href="http://accounting.egi.eu/osg.php" target="_top">EGI Accounting Portal</a> page.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Accounting_Data"></a> Accounting Data </span></h2>
Since Gratia handles the collection of detailed accounting data for OSG, this interface sends only monthly summaries for select OSG <strong><em>resource_groups</em></strong> and <strong><em>VOs</em></strong> as shown below:
<p />
<blockquote>
<table cellspacing="1" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" align="center" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Data</font></a> </th>
			<th bgcolor="#99CCCC" align="center" valign="top" class="twikiTableCol1 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Description</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Month </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLastCol"> &nbsp; </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Year </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLastCol"> &nbsp; </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Resource Group </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLastCol"> APEL/EGI Site is equivalent to OSG's OIM resource group </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> VO </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLastCol"> VO </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> User Name </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLastCol"> User's DN </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Number of jobs </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLastCol"> Total jobs for the period </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> CPU time </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLastCol"> Total CPU time (in hours) </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Wall Time </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLastCol"> Total Wall time (in hours) </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Normalized CPU </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLastCol"> CPU Time normalized by the resource group's HEPSPEC06 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Normalized Wall </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLastCol"> Wall Time normalized by the resource group's HEPSPEC06 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Earliest End Time </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLastCol"> End time of the  first job in the month </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Latest End Time </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> End time of the last job in the month </td>
		</tr></table>
</blockquote>
<p />
Details on the complete set of summary data accepted can be found here: <a href="https://wiki.egi.eu/wiki/APEL/MessageFormat#Summary_Job_Records" target="_top">APEL Job Summary Records</a>.
It should be noted that APEL/EGI is designed to accept VOMS group and role attributes but, as of this time, we have not been asked to provide them.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="The_Process"></a> The Process </span></h2>
As mentioned earlier, the interface reports Gratia accounting data to APEL/EGI for select  <strong><em>resource_groups</em></strong> and for only specific VO data for those <strong><em>resource_groups</em></strong>  using normalization factors at the <strong><em>resource_group</em></strong> level.  Since, at this time, <a href="http://myosg.grid.iu.edu/about" target="_top">MyOSG</a> does not provide information on this, two manually maintained configuration files are required: <ul>
<li> <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Reportable_resource_groups" class="twikiCurrentTopicLink twikiAnchorLink">lcg-reportableSites</a>  which contains the <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Normalization_Factor" class="twikiCurrentTopicLink twikiAnchorLink">normalization factor</a> for the <strong><em>resource_group</em></strong>.
</li> <li> <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Reportable_VO_data" class="twikiCurrentTopicLink twikiAnchorLink">lcg-reportableVOs</a>
</li></ul> 
<p />
For each <strong><em>resource_group</em></strong>, a <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Gratia_query" class="twikiCurrentTopicLink twikiAnchorLink">Gratia sql query</a> will be constructed using the following filters: <ul>
<li> Using the <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Reportable_resource_groups" class="twikiCurrentTopicLink twikiAnchorLink">lcg-reportableSites</a>  file, the process queries <a href="http://myosg.grid.iu.edu/about" target="_top">MyOSG</a> to determine the  set of <strong><em>resources</em></strong> within each <strong><em>resource_group</em></strong> to determine if that <strong><em>resource's</em></strong> accounting data is to be included.  It uses the WLCGInformation InteropAccounting flag (True) for this determination.
</li> <li> The <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Reportable_resource_groups" class="twikiCurrentTopicLink twikiAnchorLink">lcg-reportableSites</a>  file provides the <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Normalization_Factor" class="twikiCurrentTopicLink twikiAnchorLink">normalization factor</a> to be applied.
</li> <li> The <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Reportable_VO_data" class="twikiCurrentTopicLink twikiAnchorLink">lcg-reportableVOs</a> file provides the list of VOs whose data is to be reported.
</li></ul> 
<p />
THE <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Gratia_query" class="twikiCurrentTopicLink twikiAnchorLink">Gratia sql query</a> data is then formatted and transmitted  to APEL via the SSM protocal.
<p />
The sub-sections that follow provide more detail.
<p />
<p />
<h3><a name="Reportable_resource_groups"></a> Reportable resource groups </h3>
This is a manually maintained configuration file (<strong><em>lcg-reportableSites</em></strong>) identifying  the <strong><em>resource_groups</em></strong> that are interfaced to APEL/WLCG.   This file contains the <strong><em>resource_group</em></strong> and normalization factor used.   
<blockquote><pre>
#--- CMS Tier 1 ----
USCMS-FNAL-WC1   10264
#--- CMS Tier 2 ----
CIT_CMS_T2          12944
GLOW                9632
    :
#--- ATLAS Tier 1 ----
BNL_ATLAS          12372
#--- ATLAS Tier 2 ----
AGLT2               8500
HU_ATLAS_Tier2      8872
    :
#--- ALICE Tier 2 ---- 
NERSC-PDSF          13920
LC-glcc             15680
</blockquote></pre>
<p />
<h3><a name="Normalization_Factor"></a> Normalization Factor </h3>
As you've seen in the <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Accounting_Data" class="twikiCurrentTopicLink twikiAnchorLink">APEL accounting data</a> section, the data sent to the APEL/WLCG data base contains both a raw and normalized value.  The WLCG requires a normalization factor to be applied.  It is felt that this is the only fair means of comparing data across a wide variety of grid clusters.   Prior to January 2011, the normalization factor was based on SpecInt2000 benchmark values for a  processor and the monthly MOU reports reflected that.  Starting in January 2011, the MOU reports and Tier 1 spreadsheets reflect HepSpec2006 benchmarks.
<p />
The normalization factor is basically a simple weighted average of a <strong><em>resource_group's</em></strong>  sub-cluster configuration.  For example:
<p />
<table cellspacing="0" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=0;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Processor</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=1;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Cores</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=2;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Benchmark</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol3 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=3;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">(Cores * Benchmark)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Intel(R) Pentium(R) 4 CPU 2.60GHz </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> 120 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2"> 978 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol3 twikiLastCol"> 117,360 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Dual Core AMD Opteron(tm) Processor 270 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1"> 102 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2"> 1,452 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol3 twikiLastCol"> 148,104 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Summary:  (2 Subclusters) - Totals </td>
			<td bgcolor="#ffffff" colspan="2" valign="top" class="twikiTableCol1"> 222 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol3"> 265,464 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" colspan="3" valign="top" class="twikiFirstCol twikiLast"> Normalization Factor (265464 / 222) </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol3 twikiLast"> 1,196 </td>
		</tr></table>
<p />
As newer processors were put into production, a problem started to emerge in that SpecInt benchmarks were unavailable and only HepSpec benchmarks were. On the other side, there were no HepSpec values available for the older processors.  In addition, given the current interface, there was no way of distinguishing between a SpecInt and HepSpec derived normalization factors and there was really no way to compare the two values, a decision was made by the WLCG to apply a factor of 4 as an arbitrary equalization factor for the two benchmarks.   
<p />
However, the interface, as described in the <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Accounting_Data" class="twikiCurrentTopicLink twikiAnchorLink">APEL accounting data</a> section, only provides for normalized data using a HEPSpec2006 benchmark: <ul>
<li> if the processor has a SpecInt2000 value, we mdiultiply by 4 and use that.
</li> <li> if the processor has a HEPSpec2006 value, we use that.
</li></ul> 
<p />
Then, when the data is sent to APEL and subsequently to the EGI portal, the HEPSpec2006 normalized values are divided by 4 to reflect the SpecInt200 normalized values.   This can be seen under any of the views in the EGI Accounting portal like <a href="http://accounting.egi.eu/osg.php" target="_top">EGI Accounting Portal - OSG view</a> when you select the <em>Data to graph</em> pull down at the top.  At some point, SpecInt2000 should be totally deprecated, however, that will be transparent to Gratia and this interface.
<p />
<p />
<h3><a name="Reportable_VO_data"></a> Reportable VO data </h3>
     A manually maintained configuration file (<strong><em>lcg-reportableVOs</em></strong>) identifying the VOs whose accounting data is interfaced. Only accounting data for the CMS, ATLAS and ALICE VOs is sent to APEL/WLCG for each of the <strong><em>resource_groups</em></strong> at this time.
<blockquote><pre>
cms
uscms
atlas
usatlas
alice
</blockquote></pre>
<p />
<p />
<h3><a name="Gratia_query"></a> Gratia query </h3>
This is the Gratia sql query used for each <strong><em>resource_group</em></strong> defined in the <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Reportable_resource_groups" class="twikiCurrentTopicLink twikiAnchorLink">lcg-reportableSites</a>  file.  The criteria, defined in the previous sections, is highlighted in <font color="red">red</font>.
<blockquote><pre>
SELECT '<font color="red">RESOURCE_GROUP</font>'   as Site,
   VOName   as "Group",
   min(UNIX_TIMESTAMP(EndTime))  as EarliestEndTime,
   max(UNIX_TIMESTAMP(EndTime)) as LatestEndTime,
   date_format(min(EndTime),"%m") as Month,
   date_format(min(EndTime),"%Y")  as Year,
   IF(DistinguishedName NOT IN (\"\", \"Unknown\"),
      IF(INSTR(DistinguishedName,\":/\")>0,
      LEFT(DistinguishedName,INSTR(DistinguishedName,\":/\")-1), DistinguishedName),CommonName) as GlobalUserName,
   Round(Sum(WallDuration)/3600)                        as WallDuration,
   Round(Sum(CpuUserDuration+CpuSystemDuration)/3600)   as CpuDuration,
   Round((Sum(WallDuration)/3600) * <font color="red">NORMALIZATION_FACTOR</font> ) as NormalisedWallDuration,
   Round((Sum(CpuUserDuration+CpuSystemDuration)/3600) * <font color="red">NORMALIZATION_FACTOR</font>) as NormalisedCpuDuration,
   Sum(NJobs) as NumberOfJobs
from
     Site,
     Probe,
     VOProbeSummary Main
where
      Site.SiteName in (<font color="red">LIST_OF_MYOSG_RESOURCES_WITH_INTEROPACCOUNTING_FLAG_TRUE</font>)
  and Site.siteid = Probe.siteid
  and Probe.ProbeName  = Main.ProbeName
  and Main.VOName in ( <font color="red">LIST_OF_REPORTABLE_VOS</font> )
  and %(period)s
  and Main.ResourceType = "Batch"
group by Site,
         VOName,
         Month,
         Year,
         GlobalUserName
</pre></blockquote>
<p />
The reason for the complexity in extracting DistinguishedName in Gratia is two-fold: <ol>
<li> the check for empty or 'Unknown' is because the DistinguishedName was not available in Gratia until 11/1/2009
</li> <li> the even more complex exclusion of everything after the first ":/' was  to compensate for a new feature in Condor 7.3.2 and 7.4 that captured the VOMS proxies extended attributes and appended them to the <em>x509userproxysubject</em> attribute which is the source of the data.
</li></ol> 
<p />
The filter on ResourceType was due to a change in the condor probes (v1.00.3) to distinguish between the actual grid jobs (Batch) and the grid monitoring job (GridMonitor) when jobs are submitted using condor_submit. Any 'local' job used to submit a job on the CE node will be filtered, but should they at some point be passed to Gratia, these will be identified as 'Local'. 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Validation_Verifications"></a> Validation/Verifications </span></h2>
There are several integrity checks that the LCG.py process makes to insure all data is being reported correctly.
<p />
<h3><a name="Sites_resources_are_reporting"></a> Sites/resources are reporting. </h3>
As a part of the interface process, a check is made at the site/resource level (not individual probes) to determine if data is being reported to Gratia every day.  If a site/resource has missing data for any day,  checks are made to see if this is due to planned maintenance or if a site/resource has gone inactive based on OIM/MyOSG data.  If after these checks are made  and a site/resource still has missing data for more than 2 days in the month, an email "WARNING" notification is issued to initiate an OSG GOC ticket.  Example:
<blockquote><pre>
WARNING/ADVISORY: Resource: UCSDT2-B in Resource Group: UCSDT2  missing data for more than 2 days: ['2014-03-19', '2014-03-20', '2014-03-21',]
</pre></blockquote>
<b>Note: this is a manual ticket initiation.</b>
<p />
If, for whatever reason <a href="http://myosg.grid.iu.edu/about" target="_top">MyOSG</a> is unavailable, an additional warning message will be generated advising of this.  This is not a critical problem unless it persists for several.  When this occurs, any messages regarding sites not reporting should not be acted upon. <ul>
<li> WARNING: Unable to determine planned shutdowns 
</li></ul> 
<p />
<p />
<h3><a name="MyOSG_and_EGI_REBUS_topology_agr"></a> MyOSG and <a href="http://wlcg-rebus.cern.ch/apps/topology/" target="_top">EGI REBUS topology</a> agree </h3>
Since, at the current time, only those OSG <strong><em>resource_groups</em></strong> registered in the <a href="http://wlcg-rebus.cern.ch/apps/topology/" target="_top">EGI REBUS topology</a> will be reported for MOU purposes, a validation is made to insure <a href="http://myosg.grid.iu.edu/about" target="_top">MyOSG</a> and the <a href="http://wlcg-rebus.cern.ch/apps/topology/" target="_top">EGI REBUS topology</a> are in sync.  The terminology between the two is slightly different:
<blockquote>
<p />
<table cellspacing="0" id="table3" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=0;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Rebus</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=1;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">MyOsg</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Federation Accounting Name </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> WLCGInformation Accounting Name </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Site </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> resource group </td>
		</tr></table>
</blockquote>
A query is made to <a href="http://wlcg-rebus.cern.ch/apps/topology/" target="_top">EGI REBUS topology</a> and against <a href="http://myosg.grid.iu.edu/about" target="_top">MyOSG</a> comparing the MyOSG WLCGInformation AccountingName with the Rebus AccountingName to insure that monthly MOU reporting will be accurately for the <strong><em>resource_group's</em></strong> data the interfaced sends to APEL.  This should be investigated and a goc ticket should be generated to take correct the descrepancy.   There are too many combination of conditions to highlight here.  They are self explanatory as to the problem.
<p />
<b>Note: this is a manual ticket initiation/process</b>
<p />
The following warning can occur and are not immediately critical unless they persist: <ul>
<li> WARN: The WLCG REBUS topology was not accessible today. We are using a previous days data for validations
</li></ul> 
<p />
<h3><a name="Other_warning_error_messages"></a> Other warning/error messages </h3>
On the first day of each month, a warning message will be generated advising that the following files should be added to svn: <ul>
<li> the current months lcg-reportableSites file
</li> <li> These files should be checked to see if any updates should be made to SVN/CVS in order to retain their history.
</li></ul> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Maintaining_the_Normalization_Fa"></a> Maintaining the Normalization Factors </span></h2>
Updating of the normalization factor for a <strong><em>resource_group</em></strong> is a manual process.
<p />
<p />
The ALICE and CMS  sites provide their own normalization factor.<br />    
ATLAS maintains their own calculations manually and can be viewed here: <ul>
<li> <a href="http://www.usatlas.bnl.gov/twiki/bin/view/Admins/CapacitySummary.html" target="_top">http://www.usatlas.bnl.gov/twiki/bin/view/Admins/CapacitySummary.html</a>
</li></ul> 
<p />
<p />
A goc ticket should be generated to initiate a change.
<p />
When a change is made, svn should be updated for both the main <em>/etc/gratia-apel/lcg-reportableSites</em> file and the appropriate <em>/etc/gratia-apel/lcg-reportableSites.history</em> file.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Maintaining_the_Reportable_Sites"></a> Maintaining the Reportable Sites and VOs </span></h2>
This is also a manual process.  As seen in the section on warning messages, there is a process which checks <a href="http://myosg.grid.iu.edu/about" target="_top">MyOSG</a> at the <strong><em>resource</em></strong> level for the InteropAccounting flag and warns if a site says it is reporting but has not yet been added to the <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Reportable_resource_groups" class="twikiCurrentTopicLink twikiAnchorLink">lcg-reportableSites</a>  file.  
<p />
A goc ticket should be generated to investigate.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Would_like_to_have_enhancements"></a> Would like to have enhancements </span></h2>
<h3><a name="Move_the_manually_maintained_con"></a> Move the manually maintained configuration files to MyOsg </h3>
Eventually  the <a href="/bin/view/Accounting/GratiaInterfacesApelLcg#Reportable_resource_groups" class="twikiCurrentTopicLink twikiAnchorLink">lcg-reportableSites</a>  file should be replaced with data in <a href="http://myosg.grid.iu.edu/about" target="_top">MyOSG</a>.
<p />
The areas that would have to be addressed are: <ol>
<li> Identification of the <strong><em>resource_groups</em></strong> that are to be reported/interfaced.
</li> <li> Maintenance of the normalization factor at the <strong><em>resource_group</em></strong> level
</li> <li> Identification of the VOs to be reported/interfaced
</li></ol> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Open_issues_To_Do_s"></a> Open issues / To-Do's </span></h2>
<p />
<h3><a name="Synchronization_of_OIM_MyOSG_wit"></a> Synchronization of OIM/MyOSG with Gratia </h3>
The intent of this initiative is to align OIM/MyOSG with Gratia and, additionally, extend that to the APEL/WLCG interface. The motivation is to eliminate the manual intervention required when new resources (Gratia sites) are added or removed from service.  Currently, there does not exist any true relationship between resources in OIM/MyOsg and Gratia.  The OIM/MyOSG resource name should correspond to a Gratia site name.  In the following paragraphs, when the term 'resource' is used, it is considered synonymous with Gratia 'site name'.
<p />
In OIM/MyOSG, the ability to define resources that are involved in the APEL/WLCG interface currently exists  This data is at the resource level and contained in the WLCG Information section: <ol>
<li> Interop Accounting flag - True if the resource is interfaced to APEL/WLCG for accounting purposes
</li> <li> Accounting Name - if the Interop Accounting flag is True, this contains the Tier 1 or 2 WLCG federation name (e.g., T2-US-Caltech)
</li></ol> 
<p />
From an APEL/WLCG perspective, we need to handle the following use cases: <ol>
<li> Addition of a new resource for a Tier1/2 Federation
</li> <li> Removal of a resource from a Tier1/2 Federation (aka, disabling a resource in OIM/MyOSG terms).  This requires preserving the historical data for that resource.
</li></ol> 
<p />
<p />
<h3><a name="Validation_verification_of_month"></a> Validation/verification of monthly MOU reports </h3>
When the Tier 2 monthly reports are issued by the LCG accounting office (e.g, <a href="http://lcg.web.cern.ch/LCG/accounting/Tier-2/2010/january-10/Tier2_Accounting_Report_January2010.pdf" target="_top">http://lcg.web.cern.ch/LCG/accounting/Tier-2/2010/january-10/Tier2_Accounting_Report_January2010.pdf</a>), a validation of the OSG federation resource is being performed manually.  It would be "nice" to be able to able perform some form of automated validation and eliminate this manual effort.  I am not sure if this is totally viable.
<p />
<p />
<h3><a name="Normalization_factor_issues"></a> Normalization factor issues </h3>
<OL>
<LI>As far as Gratia/Accounting is concerned, we would like to get to a point where each job usage record contain the type of cpu  that the job ran on.  This would give Gratia the most flexibility to normalize the result (normalization is required by WLCG and is the only way to fairly compare the result). 
<p />
However, at this point the batch system does not gives us enough information (Condor 6.9 might be able to make the information available).   So for now we will rely for  normalization on a rougher estimate.  Currently the estimate comes from the average on one existing farm for which I know the actual hardware.  When the GLUE schema is properly filled, we will use the average for  the Site the job ran on.
</LI>
<p />
<LI>
The normalization factor is currently reflecting the latest cluster configuration.  As these clusters are upgraded over time, these factors will change.  In order to be able to re-create the normalized view of past periods, these configurations/factors will need to be keyed by time period somehow.
</LI>
</OL>
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="History"></a> History </span></h2>
This section just documents when major changes to the interface took place:
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table4" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" align="center" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=0;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Date</font></a> </th>
			<th bgcolor="#99CCCC" align="center" valign="top" class="twikiTableCol1 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=1;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Description</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> September 2008 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLastCol"> Added methods to create xml/hmtl/dat files to provide visibility to the data sent and displayed at <a href="http://gratia-osg-prod-reports.opensciencegrid.org/gratia-data/interfaces/apel-lcg/" target="_top">Gratia-APEL WLCG Interface</a> and <a href="http://gratiaweb.grid.iu.edu/gratia/wlcg_reporting" target="_top">OSG WLCG Reporting</a> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> November 2008 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLastCol"> Added an additional filter on the selection criterea. Only selecting ResourceType='Batch'.  Changes to the condor probes (v1.00.3) will result in distinguishing between the actual  grid jobs (Batch) and the grid monitoring job (GridMonitor) when jobs are submitted using condor_submit. Any 'local' job used to submit a job on the CE node will be filtered, but should they at some point be passed to Gratia, these will be identified as Local. </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> March 2009 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLastCol"> Started saving the configuration file for reportable sites and normalization factors for each month.  This provided the capability to re-send prior months data in the event a site had problems and still retain that period's configuration. </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> May 2009 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLastCol"> Added the User's Distinguished Name (DN) as part of the summary criterea and data sent. </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> June 2009 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLastCol"> Started checking for Gratia sites that had stopped reporting data to Gratia.  This provided a pro-active means of identifying problems rather than waiting for the monthly MOU reports to be issued. </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> July 2009 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLastCol"> Added an extract of OIM downtimes to use  when determining if a Gratia site failed to report </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> December 2009 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLastCol"> Added use of a new class (InactiveResources) to query <span class="twikiNewLink">MyOsg<a href="/bin/edit/Accounting/MyOsg?topicparent=Accounting.GratiaInterfacesApelLcg" rel="nofollow" title="MyOsg (this topic does not yet exist; you can create it)">?</a></span> for Resource that have been marked inactive.  This is used in conjunction with the Downtimes class when checking why a site/resourcehas not reported </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> January 2010 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLastCol"> APEL/EGI started reporting MOU reports using HEPSpec2006 normalization factors in place of the SpecInt2000 values we are reporting.  We still use SpecInt2000.  They apply a factor of 4x as means of adjusting until all sites report using HEPSpec2006.  When we have HEPSpec2006 available we divide by 4 to maintain consistency. </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> December 2010 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLastCol"> The ALICE VO was added to the list of reportable VOs and sites. </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> August 2011 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLastCol"> This represents a major change to the interface.  All OSG reporting to WLCG has been in reference to MyOsg resource group.  However, the MyOsg InteropAccounting flag for WLCG Information is at the resource, not resource group, level.  The changes made in this revision will now:<br />    1. treat the lcg-reportableSites config file entries as resource groups. This also means the Normalization Factors should be calculated at the resource group level.<br />    2. determine which resources within that resource group should have their gratia data reported to APEL/EGI.<br />    3. summarize (using sql) the accounting data for the month for all interfaced resources for the resource group. A new class, InteropAccounting(.py), provides the access to MyOsg. </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> June 2012 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> Changed the APEL interface from a direct update of the APEL database to the use of a messaging system (SSM) </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
More detail information related to code, reportable sites and normalization factors can be found in the <a href="/bin/view/Accounting/GratiaInterfacesApelLcgHistory" class="twikiLink">Gratia Interfaces - APEL/WLCG - History twiki</a>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="More_information"></a> More information </span></h2>
<h3><a name="Sending_Data_to_EGI_Based_on_VO"></a> Sending Data to EGI Based on VO Only </h3> <ul>
<li> <a href="/bin/view/Accounting/GratiaInterfacesApelEgiByVo" class="twikiLink">Sending Data to EGI Based on VO Only</a>
</li></ul> 
<h3><a name="APEL_SSM_ActiveMQ_Interface"></a> APEL SSM/ActiveMQ Interface </h3> <ul>
<li> <a href="/bin/view/Interoperability/AccountingInteropQuestionsAndIssues" class="twikiLink">APEL SSM/ActiveMQ Interface</a>
</li></ul> 
<p />
<h3><a name="Developers_Corner"></a> Developers Corner </h3> <ul>
<li> <a href="/bin/view/Accounting/ApelWlcgDevelopersCorner" class="twikiLink">APEL/WLCG Developers Corner twiki</a>.
</li></ul> 
<p />
<h3><a name="EGI"></a> EGI </h3> <ul>
<li>  <a href="http://accounting.egi.eu/osg.php" target="_top">EGI Accounting Portal - OSG view</a>
</li> <li>  <a href="http://accounting.egi.eu/tier1.php" target="_top">EGI Accounting Portal - Tier 1 view</a>
</li> <li>  <a href="http://accounting.egi.eu/tier2.php" target="_top">EGI Accounting Portal - Tier 2 view</a>
</li> <li>  <a href="http://www3.egee.cesga.es/gridsite/accounting/CESGA/user/user_view.html" target="_top">EGI Accounting Portal - User view</a>
</li> <li>  <a href="https://accounting.egi.eu/user/vomem.php" target="_top">EGI Accounting Portal - VO Member view</a>   
</li> <li>  <a href="http://wlcg-rebus.cern.ch/apps/topology/" target="_top">EGI REBUS topology</a>
</li></ul> 
<p />
<p />
<p />
<p />
<p />
<p />
<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Major_updates"></a>  Major updates </span></h2>
<!--Future editors should add their signatures beneath yours!-->
-- <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a> - 19 Nov 2009: Updated for implementation of User Distinguished Name on 11/1/2009<br />    
-- <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a> - 08 Feb 2010: Split the developers corner (doc) out as a separate twiki (ApelWlcgDevelopersCorner) <br />    </div><!-- /patternTopic-->
<p />
<p />
<div class="twikinetRounded twikinetRoundedAttachments"><div class="rCRounded"><div class="rCTR"><div class="rCTL"></div><!--/rCTL--><div class="twikiAttachments">
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="topicattachmentslistshow" class="twistyRememberSetting twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Attachments</span></a> </span> <span id="topicattachmentslisthide" class="twistyRememberSetting twistyTrigger twikiUnvisited twistyHidden twistyInited"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Attachments</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="topicattachmentslisttoggle" class="twistyRememberSetting twistyContent twikiMakeHidden twistyInited">
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table summary="Topic attachments" cellspacing="0" id="twikiAttachmentsTable" cellpadding="0" class="twikiTable" rules="rows" border="1"><caption>Topic attachments</caption>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=0;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">I</font></a> </th>
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=1;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Attachment</font></a> </th>
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=2;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Action</font></a> </th>
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=3;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size</font></a> </th>
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=4;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Date</font></a> </th>
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol5"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=5;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Who</font></a> </th>
			<th bgcolor="#eceef2" valign="middle" class="twikiTableCol6 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaInterfacesApelLcg?cover=print;sortcol=6;table=5;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Comment</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol0 twikiFirstCol"> <img width="16" alt="xls" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/xls.gif" height="16" border="0" /><span class="twikiHidden">xls</span> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol1"> <a href="/twiki/pub/Accounting/GratiaInterfacesApelLcg/Normalization-factors.xls">Normalization-factors.xls</a> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol2"> <a href="/bin/attach/Accounting/GratiaInterfacesApelLcg?filename=Normalization-factors.xls;revInfo=1" title="change, update, previous revisions, move, delete..." rel="nofollow">manage</a> </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol3"> 38.0&nbsp;K </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol4"> <span class="twikiNoBreak">21 Mar 2008 - 20:30</span> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol5"> <a href="/bin/view/Main/UnknownUser" class="twikiLink">UnknownUser</a> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol6 twikiLastCol"> Normalization factor calculations </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol0 twikiFirstCol"> <img width="16" alt="xls" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/xls.gif" height="16" border="0" /><span class="twikiHidden">xls</span> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol1"> <a href="/twiki/pub/Accounting/GratiaInterfacesApelLcg/OIM-registered-resource-3-5-2009.xls">OIM-registered-resource-3-5-2009.xls</a> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol2"> <a href="/bin/attach/Accounting/GratiaInterfacesApelLcg?filename=OIM-registered-resource-3-5-2009.xls;revInfo=1" title="change, update, previous revisions, move, delete..." rel="nofollow">manage</a> </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol3"> 48.2&nbsp;K </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol4"> <span class="twikiNoBreak">19 Mar 2009 - 16:11</span> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol5"> <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol6 twikiLastCol"> OIM Registered Resources 3/5/2009 (.xls format) </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <img width="16" alt="else" align="top" src="/twiki/pub/TWiki/TWikiDocGraphics/else.gif" height="16" border="0" /><span class="twikiHidden">EXT</span> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol1 twikiLast"> <a href="/twiki/pub/Accounting/GratiaInterfacesApelLcg/lcg-reportableSites">lcg-reportableSites</a> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol2 twikiLast"> <a href="/bin/attach/Accounting/GratiaInterfacesApelLcg?filename=lcg-reportableSites;revInfo=1" title="change, update, previous revisions, move, delete..." rel="nofollow">manage</a> </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol3 twikiLast"> 6.8&nbsp;K </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol4 twikiLast"> <span class="twikiNoBreak">21 Mar 2008 - 20:29</span> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol5 twikiLast"> <a href="/bin/view/Main/UnknownUser" class="twikiLink">UnknownUser</a> </td>
			<td bgcolor="#ffffff" align="left" valign="top" class="twikiTableCol6 twikiLastCol twikiLast"> APEL/WLCG site table </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
</div></div> <!--/twistyPlugin--></div><!--//twikiAttachments--></div><!--/rCTR--><div class="rCBR"><div class="rCBL"></div><!--/rCBL--></div><!--/rCBR--></div><!--/rCRounded--></div><!--/twikinetRounded--></div><!-- /patternContent-->
<hr />
This topic: Accounting<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GratiaInterfacesApelLcg</span> <br />    
Topic revision: r66 - 27 Mar 2014 - 15:21:59 - <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />