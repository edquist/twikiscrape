<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GratiaReleaseV0dot34 &lt; Accounting &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Accounting/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Accounting/GratiaReleaseV0dot34?_T=16 Feb 2017" type="application/x-wiki" title="edit GratiaReleaseV0dot34" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Accounting/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Accounting/GratiaReleaseV0dot34"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#D0D0D0;
	}
	.patternBookView {
		border-color:#D0D0D0;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TABLEPLUGIN_table13--><style type="text/css" media="all">
.twikiTable#table13 th {background-color:#99CCCC;}
.twikiTable#table13 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table13 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table13 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table13 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table13 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--TABLEPLUGIN_table2--><style type="text/css" media="all">
.twikiTable#table2 th {background-color:#99CCCC;}
.twikiTable#table2 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table2 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table2 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table2 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table2 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--TABLEPLUGIN_table6--><style type="text/css" media="all">
.twikiTable#table6 th {background-color:#99CCCC;}
.twikiTable#table6 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table6 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table6 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table6 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table6 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--TABLEPLUGIN_table4--><style type="text/css" media="all">
.twikiTable#table4 th {background-color:#99CCCC;}
.twikiTable#table4 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table4 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table4 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table4 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table4 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--EDITTABLEPLUGIN--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/EditTablePlugin/edittable.css");
</style>

<!--TABLEPLUGIN_table3--><style type="text/css" media="all">
.twikiTable#table3 th {background-color:#99CCCC;}
.twikiTable#table3 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table3 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table3 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table3 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table3 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--TABLEPLUGIN_table14--><style type="text/css" media="all">
.twikiTable#table14 th {background-color:#99CCCC;}
.twikiTable#table14 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table14 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table14 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table14 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table14 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style>
<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<!--TABLEPLUGIN_table1--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
.twikiTable#table1 th {background-color:#99CCCC;}
.twikiTable#table1 th.twikiSortedCol {background-color:#99CCCC;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td {background-color:#FFFFCC;}
.twikiTable#table1 tr.twikiTableRowdataBg1 td {background-color:#FFFFFF;}
.twikiTable#table1 tr.twikiTableRowdataBg0 td.twikiSortedCol {background-color:#FFFFCC;}
.twikiTable#table1 tr.twikiTableRowdataBg1 td.twikiSortedCol {background-color:#FFFFFF;}
</style></head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <!--
These are general in nature and should be changed in the this template if the location changes: <ul>
<li> Set CURRENT_TOMCAT = <code><b>gratia09</b></code>
</li> <li> Set CURRENT_MYSQL = <strong><em>gratia06</em></strong>
</li> <li> Set NEW_TOMCAT = <code><b>gratia07</b></code>
</li> <li> Set NEW_MYSQL = <em>_ gratia07_</em>
</li> <li> Set TOMCAT_ALIAS = <code><b>gratia.opensciencegrid.org</b></code>
</li> <li> Set MYSQL_ALIAS = <code><b>gratia-db01.fnal.gov</b></code>
</li> <li> Set RELEASE_TAR_REPOSITORY = /afs/fnal.gov/files/expwww/gratia/html/Files
</li></ul> 
<p />
These are specific to a release and require changing: <ul>
<li> Set RELEASE_DATE = 5/14/08
</li> <li> Set CURRENT_RELEASE = v0.34.10
</li> <li> Set RELEASE_TAG = v0-34-10
</li> <li> Set NEXT_DEVEL_VERSION = v0.35
</li> <li> Set BUILD_DIRECTORY = /home/weigand/cdcvs/gratia-v0.34.10
</li> <li> Set GRATIA_RELEASES = /home/gratia/gratia-releases
</li></ul> 
<p /> <ul>
<li> Set EDITTHISTEXT = <div class="twikiSmall"><a href="GratiaReleaseV0dot34">edit this section</a></div>
</li></ul> 
-->
<h1><a name="Gratia_Release_v0_34_and_v0_34_1"></a>  Gratia Release v0.34 and v0.34.10 (5/14/08 - 5/29/2008)<br /> </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Overview"> Overview</a> <ul>
<li> <a href="?cover=print#Reporter_Improvements_v0_34_9"> Reporter Improvements (v0.34.9)</a>
</li> <li> <a href="?cover=print#Collector_Improvements_v0_34_7"> Collector Improvements (v0.34.7)</a>
</li> <li> <a href="?cover=print#Probe_Improvements_v0_34_1"> Probe Improvements (v0.34.1)</a>
</li></ul> 
</li> <li> <a href="?cover=print#Anticipated_downtime"> Anticipated downtime</a>
</li> <li> <a href="?cover=print#Build_the_v0_34_10_for_distribut"> Build the v0.34.10 for distribution</a>
</li> <li> <a href="?cover=print#Collectors_and_Databases_Affecte"> Collectors and Databases Affected</a>
</li> <li> <a href="?cover=print#Shutdown_and_database_backup"> Shutdown and database backup.</a>
</li> <li> <a href="?cover=print#Small_DB_Upgrade_and_implementat"> Small DB - Upgrade and implementation</a> <ul>
<li> <a href="?cover=print#Status_v0_34_through_v0_34_7"> Status v0.34. through v0.34.7</a>
</li> <li> <a href="?cover=print#Status_v0_34_9"> Status v0.34.9</a> <ul>
<li> <a href="?cover=print#gratia08_services"> gratia08 services</a> <ul>
<li> <a href="?cover=print#tomcat_qcd"> tomcat-qcd</a>
</li> <li> <a href="?cover=print#tomcat_psacct"> tomcat-psacct</a>
</li> <li> <a href="?cover=print#tomcat_fermi_osg"> tomcat-fermi_osg</a>
</li></ul> 
</li> <li> <a href="?cover=print#gratia09_services"> gratia09 services</a> <ul>
<li> <a href="?cover=print#osg_transfer"> osg_transfer</a>
</li> <li> <a href="?cover=print#osg_daily"> osg_daily</a>
</li> <li> <a href="?cover=print#osg_integration"> osg_integration</a>
</li> <li> <a href="?cover=print#gratia_itb"> gratia_itb</a>
</li></ul> 
</li></ul> 
</li></ul> 
</li> <li> <a href="?cover=print#Post_mortem"> Post-mortem</a>
</li> <li> <a href="?cover=print#Main_gratia_DB_Upgrade_to_v0_34"> Main gratia DB - Upgrade to v0.34.9</a> <ul>
<li> <a href="?cover=print#Create_a_copy_of_the_current_dat"> Create a copy of the current database on gratia07</a> <ul>
<li> <a href="?cover=print#Create_the_gratia07_gratia_datab"> Create the gratia07:gratia database using the ZRM backup</a>
</li> <li> <a href="?cover=print#Configure_gratia08_data_tomcat_c"> Configure gratia08:/data/tomcat-conversion to use the gratia07:gratia database</a>
</li> <li> <a href="?cover=print#Upgrade_gratia08_data_tomcat_con"> Upgrade gratia08:/data/tomcat-conversion to v0-34-9</a>
</li> <li> <a href="?cover=print#Bring_the_gratia07_database_up_t"> Bring the gratia07 database up to current</a>
</li> <li> <a href="?cover=print#Update_the_Replication_services"> Update the Replication services on gratia06 to gratia07</a>
</li></ul> 
</li> <li> <a href="?cover=print#Stop_gratia09_data_tomcat_gratia"> Stop gratia09:/data/tomcat-gratia and gratia08:/data/tomcat-conversion</a>
</li> <li> <a href="?cover=print#Upgrade_the_current_gratia09_dat"> Upgrade the current gratia09:/data/tomcat-gratia to v0.34.9</a>
</li> <li> <a href="?cover=print#Switch_gratia09_data_tomcat_grat"> Switch gratia09:/data/tomcat-gratia to use the gratia07/gratia database</a>
</li> <li> <a href="?cover=print#Backups"> Backups</a>
</li> <li> <a href="?cover=print#Crons"> Crons</a> <ul>
<li> <a href="?cover=print#Cron_processes_during_upgrade"> Cron processes during upgrade</a>
</li> <li> <a href="?cover=print#Nebraska_Brian_Bockelman_interfa"> Nebraska (Brian Bockelman) interfaces</a>
</li></ul> 
</li> <li> <a href="?cover=print#Upgrade_the_gratia06_database"> Upgrade the gratia06 database</a> <ul>
<li> <a href="?cover=print#Manual_mysql_client_updates"> Manual mysql client updates</a>
</li></ul> 
</li> <li> <a href="?cover=print#Switch_the_current_gratia08_data"> Switch the current gratia08:/data/tomcat-conversion to use the gratia06/gratia database</a>
</li> <li> <a href="?cover=print#Backup_the_gratia06_gratia_datab"> Backup the gratia06/gratia database</a>
</li> <li> <a href="?cover=print#2nd_Upgrade_of_gratia08_data_tom"> 2nd Upgrade of gratia08:/data/tomcat-conversion to v0.36</a>
</li> <li> <a href="?cover=print#Start_replication_from_productio"> Start replication from production collector to upgrade collector.</a>
</li> <li> <a href="?cover=print#Monitor_catch_up_progress_on_gra"> Monitor "catch-up" progress on gratia06/gratia and stop replication when done</a>
</li> <li> <a href="?cover=print#Switch_the_current_gratia09_data"> Switch the current gratia09:/data/tomcat-gratia to use the gratia06/gratia database</a>
</li> <li> <a href="?cover=print#Backups_for_switchback"> Backups for  switchback</a>
</li> <li> <a href="?cover=print#Crons_switchback"> Crons - switchback</a> <ul>
<li> <a href="?cover=print#Cron_processes"> Cron processes</a>
</li> <li> <a href="?cover=print#Nebraska_Brian_Bockelman_int_AN1"> Nebraska (Brian Bockelman) interfaces</a>
</li></ul> 
</li></ul> 
</li> <li> <a href="?cover=print#Post_mortem_AN1"> Post-mortem</a>
</li></ul> 
</div>
<p />
<p />
<h1><a name="Overview"></a> Overview </h1>
 The main purpose of this release (v0.34.10) is the DN/FQAN collection improvements and the requirement for authentication for administrating the Collector.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Reporter_Improvements_v0_34_9"></a> Reporter Improvements (v0.34.9) </span></h2>
 <!--   * Move to pre-release of BIRT 2.3 to support Firefox 3.0. -->  <ul>
<li> Report displaying those jobs that have been running more than X days by VO. where X is a week and a month (RR23) 
</li> <li> Report displaying those sites that show 0 Wall Duration for more than X days - where X is a week and a month. (RR24) 
</li> <li> Update the osg daily report for Birt 2.2 
</li> <li> Periodically generated (daily, weekly and/or monthly) csv files that are available for immediate view without need to read db records  <ol>
<li> CPUday per day for the last month/30 days for each VO 
</li> <li> CPUday per day for the last month/30 days for each site 
</li> <li> total CPUweeks per week for the last 52 weeks (year) 
</li></ol> 
</li> <li> Extend User daily report to include VO name. 
</li> <li> Enable easy selection/reporting of CMS-Tier-2 sites. 
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Collector_Improvements_v0_34_7"></a> Collector Improvements (v0.34.7) </span></h2> <ul>
<li> Enable authentication in the administration pages 
</li> <li> Implement looking up the DN, Role and VO directly from certificate 
</li> <li> Update of the record checksum to exclude DN, Role, VO" 
</li> <li> Review and improve the Summary table creation mechanism 
</li> <li> Update Collector to Collector connection to send more than one record on each connection 
</li> <li> Add VO to User Summary Table 
</li> <li> Replace pre-duplicate check by exception handling 
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Probe_Improvements_v0_34_1"></a> Probe Improvements (v0.34.1) </span></h2> <ul>
<li> Document on the issues related to full and complete probe black-out detection. 
</li> <li> Globus patched to interrogate delegated proxies wherever available for DN and FQAN information. 
</li> <li> Condor probe updated:  <ol>
<li> to get information on WS jobs; 
</li> <li> to use ClassAds generated by PER_JOB_HISTORY_DIR (if available) to avoid expensive calls to condor_history. Will fall back on condor_history; 
</li> <li> to facilitate "local" probes by means of a constraint option so probes only process certain types of job. 
</li> <li> avoid double-counting when information about the same job is received from multiple sources. 
</li></ol> 
</li> <li> Package dCache probe as RPM.  <ol>
<li> dCache / SRM probes now available (see dCache release notes). 
</li></ol> 
</li> <li> Minor improvements to SGE probe from Shreyas Cholia. 
</li> <li> PBS/LSF probes improved to prevent misreading an incomplete line in the batch manager log. 
</li></ul> 
<p />
<!--   -------------------------------------------- -->
<h1><a name="Anticipated_downtime"></a> Anticipated downtime </h1>
 It is expected that this release will require the Gratia services and reporting to be unavailable beginning at:  <ul>
<li> Start: 5/14/08 hh:mm CST 
</li> <li> Available: 5/14/08 hh:mm CST 
</li></ul> 
<p />
The changes affecting downtime for this release are: <ol>
<li> Length of time to make a backup of the database to the backup area using <code>mysqlhotcopy</code> 
</li> <li> Installation and validation on the 6 Gratia schemas 
</li></ol> 
<p />
<!-- BUILD DISTRIBUTION -------------------- -->
<h1><a name="Build_the_v0_34_10_for_distribut"></a> Build the v0.34.10 for distribution </h1>
 This release was done in 2 stages and a couple interim stages when problems were detected:  <ul>
<li> v0.34 - for the VDT 1.10.1 distribution (ITB 0.9.0) 
</li> <li> v0.34.1 - for local distribution. Changes were required to the local scripts/configurations for the actual conversion at FNAL on gratia08 and gratia09 collectors. 
</li></ul> 
<p /> <ol>
<li> Make sure your build area contains all <em>committed</em> changes.  <ul>
<li> cvs update
</li></ul> 
</li> <li> In <em>gratia/build-scripts/Makefile</em> , change the <em>version_default</em> to:  <ul>
<li> version_default = v0.35
</li> <li> commit the change
</li></ul> 
</li> <li> Tag the release:  <ul>
<li> cvs tag -R v0-34 gratia This tags everything that is in your build directory and presumably tested. 
</li></ul> 
</li> <li> <em>Into a <strong>new</strong> area</em>, export the tagged release:  <ul>
<li> cvs export -d gratia-v0.34 -r v0-34 gratia
</li></ul> 
</li> <li> Build it for the release (this insures that tar files are produced for VDT):  <ul>
<li> cd gratia-v0.34/build-scripts
</li> <li> source setup-jdk15.sh
</li> <li> make release
</li></ul> 
</li> <li> Copy the build/release area to the <em>gratia</em> home directory for posterity: <p> </p>  <ul>
<li> mkdir /home/gratia/gratia-releases/v0.34 
</li> <li> cp -pr /home/weigand/cdcvs/gratia-v0.34/* /home/gratia/gratia-releases/v0.34/.  <p> </p>
</li></ul> 
</li> <li> Copy the built tar files to the release area:  <ul>
<li> scp ../target/*_v0.34.tar flxi07.fnal.gov:/afs/fnal.gov/files/expwww/gratia/html/Files/
</li></ul> 
</li> <li> Update the version number on the <a href="/bin/view/Accounting/InstallationGuideVDT" class="twikiLink">services release TWiki page</a>: <ul>
<li> Edit and update the TWiki variable <em>ReleaseVersion</em>. <font color="#008000">Status: Completed on 5/10/2008 08:00 CDT</font>
</li></ul> 
</li></ol> 
<p />
<font color="#0000ff"> <!-- ------------------------------------- -->
<hr />
 *Update: 5/11/2008 14:45 CDT:*<br />     Had to modify Makefile to include the voms_servers and voms-server.sh files in the Gratia-Services distribution for VDT. Re-tagged, rebuilt, moved to the flxi07.fnal.gov site.
<p />
<!-- ------------------------------------- -->
<hr />
 *Update: 5/12/2008 14:15 CDT:*<br />     Problems encountered when working with an <em>empty</em> database. Previous testing was done with an existing database. The following programs required modification:
<p /> <ul>
<li> collector/gratia-services/net/sf/gratia/services/ListenerThread.java 
</li> <li> collector/gratia-services/net/sf/gratia/services/NewVOUpdate.java 
</li> <li> collector/gratia-services/net/sf/gratia/storage/DatabaseMaintenance.java 
</li> <li> common/configuration/hibernate.cfg.xml 
</li></ul> 
<p />
Steps 3 through 6 were repeated for these modules. Note: To tag the individual module (example): <ul>
<li> cvs tag -F v0-34 collector/gratia-services/net/sf/gratia/services/ListenerThread.java 
</li></ul> 
<p />
Provided a new <em>configure_gratia</em> to VDT. This was tested in a condor environment as best we could especially for the validation of the condor environment relevant to the PER_JOB_HISTORY_DIR that is critical.
<p />
This is the v0.34 used in VDT 1.10.1 (ITB 0.9.0).
<p />
<!-- ------------------------------------- -->
<hr />
 *Update: 5/14/2008 15:45 CDT: Tagged as v0-34-1*<br />     The following modules were modified for changes to local (non-VDT) installations/upgrades. Tests are currently being run by Chris Green and a gratia instance on <em>gratia07:/test/data/mysqldb/gratia</em> using this software:
<p /> <ul>
<li> gratia/build-scripts/Makefile 
</li> <li> gratia/common/configuration/cleanup_server_lib 
</li> <li> gratia/common/configuration/configure-collector 
</li> <li> gratia/common/configuration/update-gratia-local 
</li></ul> 
<p />
Steps 3 through 6 were repeated for these modules. Note: The tagging was done as: <ul>
<li> cvs tag -R v0-34.1 gratia  and the export done as: 
</li> <li> cvs export -d gratia-v0.34.1 -r v0-34.1 gratia  and the build done as: 
</li> <li> cd gratia-v0.34.1/build-scripts 
</li> <li> source setup-jdk15.sh 
</li> <li> make release  and the copy to the release area: 
</li> <li> scp ../target/*_v0.34.1.tar flxi07.fnal.gov:/afs/fnal.gov/files/expwww/gratia/html/Files/. 
</li> <li> updated the version number on the <a href="/bin/view/Accounting/InstallationGuideVDT" class="twikiLink">services release TWiki page</a> 
</li></ul> 
<p />
Also note these changes do not affect the current VDT 1.10.1 release of Gratia v0.34. The latest version was copied in as in step 6 and 7, but VDT does not need to access this version.
<p />
<!-- ------------------------------------- -->
<hr />
 <strong>Update: 5/20/2008 14:42 CDT: Tagged as v0-34-2</strong> <br />     <pre>
U collector/gratia-services/net/sf/gratia/storage/DatabaseMaintenance.java
U collector/gratia-services/net/sf/gratia/storage/JobUsageRecord.java
U collector/gratia-services/net/sf/gratia/storage/SummaryUpdater.java
U collector/gratia-services/net/sf/gratia/storage/Utils.java
U common/configuration/collector-pro.dat
U common/configuration/service-configuration.properties
U probe/build/gratia-probe.spec
U probe/common/Gratia.py
U probe/common/GRAM/JobManagerGratia.pm
U probe/condor/condor&#95;meter.pl
U reporting/summary/PSACCTReport.py
</pre>
<p />
cvs tag -R v0-34-2 gratia<br />    
<p />
<!-- ------------------------------------- -->
<hr />
 <strong>5/20/2008 16:46 CDT</strong> <pre>
cvs tag -F v0-34-2  collector/gratia-services/net/sf/gratia/services/CollectorService.java
cvs tag -F v0-34-2  collector/gratia-services/net/sf/gratia/storage/DatabaseMaintenance.java
cvs tag -F v0-34-2  common/configuration/summary-procedures.sql
</pre>
<p />
<!-- ------------------------------------- -->
<hr />
 <strong>5/21/2008 11:03 CDT</strong> <pre>
Since the osg&#95;daily record does not have a jobid or anything similar, we must keep the 
UserIdentity field in the md5 calculation otherwise we find many false duplicate
U collector/gratia-services/net/sf/gratia/storage/JobUsageRecord.java

Add support for DN comming from cron 
(/DC&#61;gov/DC&#61;fnal/O&#61;Fermilab/OU&#61;Robots/CN&#61;fermigrid0.fnal.gov/CN&#61;cron/CN&#61;Keith Chadwick/CN&#61;UID:chadwick).  
In that case, use the 3rd CN
U collector/gratia-services/net/sf/gratia/storage/JobUsageRecordUpdater.java

Re-add VOName Correction link
U collector/gratia-administration/WebContent/dashboard.jsp

use full md5 for ps accounting too
U common/configuration/collector-pro.dat
</pre>
<p />
cvs tag -R v0-34-3 gratia<br />    
<p />
<!-- ------------------------------------- -->
<hr />
 <strong>5/22/2008 10:45 CDT</strong> Changes: <pre>
Re-add missing Host field lookup needed by psacct
U collector/gratia-services/net/sf/gratia/storage/DatabaseMaintenance.java
U common/configuration/summary-procedures.sql

actually use the common name we just found
U collector/gratia-services/net/sf/gratia/storage/JobUsageRecordUpdater.java

</pre>
<p />
cvs tag -R v0-34-4 gratia<br />    
<p />
<!-- ------------------------------------- -->
<hr />
 <strong>5/27/2008 13:10 CDT</strong> Changes for gratia_psacct <pre>
report library is in production-osg only
  reporting/gratia-reports/WebContent/reports/production-fermi/gratia-lib1.rptlibrary is no longer in the repository
  reporting/gratia-reports/WebContent/reports/production-osgdaily/gratia-lib1.rptlibrary is no longer in the repository
U reporting/gratia-reports/WebContent/reports/production-osg/gratia-lib1.rptlibrary
</pre>
<p />
cvs tag -R v0-35-5 gratia<br />    
<p />
One more change:
<pre>
Give up trying to guess which CN is the &#34;right&#34; one: record them all.
  U collector/gratia-services/net/sf/gratia/storage/JobUsageRecordUpdater.java

cvs tag -F v0-34-5  collector/gratia-services/net/sf/gratia/storage/JobUsageRecordUpdater.java
</pre>
<p />
<!-- ------------------------------------- -->
<hr />
 <strong>5/28/2008 12:16 CDT</strong> Changes: <pre>
Config change to address &#34;APPARENT DEADLOCK&#34; problem.
  U common/configuration/hibernate.cfg.xml
</pre>
<p />
cvs tag -R v0-34-6 gratia<br />    
<p />
<strong>More 5/28/2008 13:00 CDT</strong>
<pre>
uncomment WeeklyUsageByVO and comment out WeeklyUsageByVORanked (as intended in previsous ci)
  U common/configuration/create&#95;build-stored-procedures-sql

Update DB version to trigger stored procedure reload.
  U collector/gratia-services/net/sf/gratia/storage/DatabaseMaintenance.java

Add collector&#95;host to enable SSL operation. Configure ITB to run 5 threads.
Add conversion collector for gratia-fermi on 8884.
   U common/configuration/collector-pro.dat

Need to cope with a previous incomplete upgrade (DB 34 did &#42;not&#42; reload
the triggers like it was supposed to IFF the existing DB version was
already 33).
  U collector/gratia-services/net/sf/gratia/storage/DatabaseMaintenance.java

cvs tag -F v0-34-6 common/configuration/create&#95;build-stored-procedures-sql
cvs tag -F v0-34-6 collector/gratia-services/net/sf/gratia/storage/DatabaseMaintenance.java
cvs tag -F v0-34-6 common/configuration/collector-pro.dat
</pre>
<p />
<!-- ------------------------------------- -->
<hr />
 <strong>5/29/2008 10:00 CDT</strong> Changes: <pre>
Summary table rebuild required to correct discrepancies with ResourceType filtering
  U collector/gratia-services/net/sf/gratia/storage/DatabaseMaintenance.java

Trigger filter logic from ResourceType should match summary table build.
  U common/configuration/summary-procedures.sql

Expand the list of ResourceType values allowed in the summary table to Batch and RawCPU
  U common/configuration/build-summary-tables.sql 
</pre>
<p />
cvs tag -R v0-34-7 gratia<br />    
<p />
<!-- ------------------------------------- -->
<hr />
 <strong>6/3/2008 17:00 CDT</strong> Changes: <pre>
Remove (after verification) grouping from views and trigger reload of views.
  gratia/common/configuration build-summary-view.sql
  gratia/collector/gratia-services/net/sf/gratia/storage/DatabaseMaintenance.java,

Fix problem with old job data removal.
  gratia/probe/common Gratia.py
  
More statistics when operating in verbose mode.
Only set Grid&#61;Local if we&#39;re sure that the ClassAd attribute should have
been added by the JobManager (assuming it passed through same) but was
not (indicating a local job).
Improved logic testing whether we can rely on the check for the
JobManager in the case that the site is running Condor for managed fork
and PBS for standard batch jobs.
  gratia/probe/condor condor&#95;meter.pl

Turn verbose mode on by default and use DebugPrint.py
  gratia/probe/condor condor&#95;meter.cron.sh

Fix behavior upon receiving blank lines (would truncate input).
  gratia/probe/common DebugPrint.py

Incorporate fixes for condor and common packages:
- Correct cleanup of no-longer-useful files in gratia/var/data.
- Improve DebugPrint.py in the case that input contains blank lines.
- Improve logic used in condor probe to decide whether we can use the absence
-  of the GratiaJobOrigin ClassAd attribute to infer that a job is local.
- Condor probe is now verbose but prints to main Gratia log.
- Condor probe only assigns grid&#61;Local to jobs it&#39;s really sure are local.
Bump version number to correct local permissions problem with DebugPrint.py.
  gratia/probe/build gratia-probe.spec
</pre>
<p />
cvs tag -R v0-34-8 gratia<br />    
<p />
<!-- ------------------------------------- -->
<hr />
 <strong>6/6/2008 12:00 CDT</strong> Changes: <pre>
Fixed birt &#34;Export Data&#34;: shows all columns (penelope)
  gratia/reporting/gratia-reports/WebContent/reports/production-osg/WeeklyUsageByVO-ranked.rptdesign,
  gratia/reporting/gratia-reports/WebContent/reports/production-osg/UsageBySiteByDate-ranked.rptdesign
  gratia/reporting/gratia-reports/WebContent/reports/production-osg/2007WeeklyUsageByVO-ranked.rptdesign

First attempt to correct the parsing of the bundled records sent by replicator.  
Also fix the content of the replication admin page (rowcount).
Clarify debug message list number of input message and records
Change the envelope for bunching to be record type independent.  Fix the test for adding it
U collector/gratia-services/net/sf/gratia/services/ChecksumUpgrader.java
U collector/gratia-services/net/sf/gratia/services/ListenerThread.java
U collector/gratia-services/net/sf/gratia/services/ReplicationDataPump.java
U collector/gratia-services/net/sf/gratia/storage/MetricRecordLoader.java
U collector/gratia-services/net/sf/gratia/storage/UsageRecordLoader.java


Updated to create a gratia-release file in the top level of every deployable
war file and in the gratia directory. The gratia-release file contains, for example:
Gratia release: v0.34.x 
  Build date: Thu Jun  5 14:40:53 CDT 2008 
  Build host: gratia06.fnal.gov 
  Build path: /home/weigand/cdcvs/gratia
  Builder: uid&#61;9789(weigand)
U gratia/build-scripts Makefile


Added the service.admin.DN.0 attribute so manual modification is not
required on each install.  This needs to be changed later to use a
VOMS fermigrid role.
U gratia/common/configuration collector-pro.dat,

Unique index on old md5 column is no longer needed after upgrade is complete.
Update TableStatistics triggers to not attempt to put a null value into a non-null column.
U collector/gratia-services/net/sf/gratia/services/ChecksumUpgrader.java
U collector/gratia-services/net/sf/gratia/storage/DatabaseMaintenance.java
U common/configuration/JobUsage.hbm.xml
U common/configuration/post-install.sh

Fix problem with history replay.
U collector/gratia-services/net/sf/gratia/services/ListenerThread.java

Probe changes not affecting collector:
U probe/build/gratia-probe.spec
U probe/common/GRAM/JobManagerGratia.pm
U probe/glexec/README
U probe/psacct/gratia-psacct

save only the part of bundle that describe the current record
U collector/gratia-services/net/sf/gratia/services/ListenerThread.java
</pre>
<p />
cvs tag -R v0-34-10 gratia<br />    
<p />
<strong>6/10/2008 12:00 CDT</strong>
<pre>
Changes:

Remove Grid from attributes taken into account for checksum.
New column for GridDescription.
Improve debug messages when handling duplicates.
Correct minor problem in warning message.
U collector/gratia-services/net/sf/gratia/services/ListenerThread.java
U collector/gratia-services/net/sf/gratia/storage/JobUsageRecord.java
U collector/gratia-services/net/sf/gratia/storage/UsageRecordLoader.java
U common/configuration/JobUsage.hbm.xml
</pre>
<p /> <ul>
<li> cvs tag -F v0-34-10 collector/gratia-services/net/sf/gratia/services/ListenerThread.java 
</li> <li> cvs tag -F v0-34-10 collector/gratia-services/net/sf/gratia/storage/JobUsageRecord.java 
</li> <li> cvs tag -F v0-34-10 collector/gratia-services/net/sf/gratia/storage/UsageRecordLoader.java 
</li> <li> cvs tag -F v0-34-10 common/configuration/JobUsage.hbm.xml 
</li></ul> 
<p />
<strong>6/11/2008 09:00 CDT</strong>
<pre>
Changes:

Refrain from overwriting the locally-generated ExtraXML attribute with
that received from an external source.
P collector/gratia-services/net/sf/gratia/services/ListenerThread.java
</pre>
<p /> <ul>
<li> cvs tag -F v0-34-10 collector/gratia-services/net/sf/gratia/services/ListenerThread.java 
</li></ul> 
<p />
<u>Status of checksum differences</u><br />     Philippe and Chris have ascertained that the reason for the difference between the checksums is benign: the ExtraXML which is used in the checksum calculation is different due to legitimate differences in the make-up of the incoming record. The fact that there are no differences in checksum for anything received since 5/27 on gratiax33 is encouraging.
<p />
One change was made to ListenerThread.java in that previous behavior was to overwrite the ExtraXML produced from the bits that the receiving server couldn't understand with the incoming ExtraXML from the replicated (or history) record. This has been changed such that the lately-generated ExtraXml is used and any previous occupant of that title is ignored.
<p />
Steps 3 through 6 were repeated for these modules.<br />     Note: the export done <strong>as yourself</strong> : <ul>
<li> cvs export -d gratia-v0.34.10 -r v0-34-10 gratia  and copy it to the /home/gratia/gratia-releases area (as <strong>gratia</strong> user): 
</li> <li> cp -pr /home/weigand/cdcvs/gratia-v0.34.10 /home/gratia/gratia-releases/.  and build it (as <strong>gratia</strong> user): 
</li> <li> cd /home/gratia/gratia-releases/gratia-v0.34.10/build-scripts 
</li> <li> source setup-jdk15.sh 
</li> <li> make release  and make a copy of the tarballs in the /home/gratia/gratia-releases directory (as <strong>gratia</strong> user) 
</li> <li> cp -p /home/gratia/gratia-releases/gratia-v0.34.10/target/*_v0.34.10.tar /home/gratia/gratia-releases/tarballs/.  and the copy to the release distribution area ( <strong>as yourself</strong> ): 
</li> <li> scp /home/gratia/gratia-releases/gratia-v0.34.10/target/*_v0.34.10.tar flxi07.fnal.gov:/afs/fnal.gov/files/expwww/gratia/html/Files/. 
</li> <li> updated the version number on the <a href="/bin/view/Accounting/InstallationGuideVDT" class="twikiLink">services release TWiki page</a> 
</li></ul> 
<p />
</font>
<p />
<font color="#008000">Status: Finally Completed v0.34.9 on 6/11/2008 09:00 CDT</font>
<p />
<!--   -------------------------------------------- -->
<h1><a name="Collectors_and_Databases_Affecte"></a> Collectors and Databases Affected </h1>
<p />
The following Gratia collectors and databases will be converted with this release: 
 
<p />
<a name="edittable1"></a>
<div class="editTable">
<form name="edittable1" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV0dot34#edittable1" method="post">
<input type="hidden" name="ettablenr" value="1" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Schema</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">MySql port</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=2;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Collector URL</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=3;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (bytes)</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=4;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size (rows)</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=5;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Max dbid</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol6 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=6;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Duplicates</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_transfer </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> gratia06.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia08.fnal.gov:8886 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 5.2M </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4"> 0 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5"> 0 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6 twikiLastCol"> 0 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_transfer </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> gratia06.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> gratia09.fnal.org:8886 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> 5.2M </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol4"> 0 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol5"> 0 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol6 twikiLastCol"> 0 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_daily </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> gratia06.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia09.fnal.gov:8884 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 89M </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 84,437 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5"> 85117 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6 twikiLastCol"> 0 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> gratia06.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> gratia08.fnal.gov:8881 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> 558M </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 58,082 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5"> 159187 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol6 twikiLastCol"> 92,879 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_qcd </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> gratia06.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia08.fnal.gov:8883 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 4.3G </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 1,210,400 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5"> 1588366 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6 twikiLastCol"> 0 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_integration </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> gratia06.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> gratia09.fnal.gov:8885 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> 8.1G </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 1,438,686 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5"> 2561449 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol6 twikiLastCol"> 691,626 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_psacct </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> gratia06.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia08.fnal.gov:8882 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 13G </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 7,763,036 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5"> 7792895 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6 twikiLastCol"> 0 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> gratia06.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> gratia09.fnal.gov:8881 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> 21G </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 8,327,662 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5"> 8958895 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol6 twikiLastCol"> 101,365 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_osg </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> gratia06.fnal.gov:3320 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> gratia08.fnal.gov:8880 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 24G </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 8,707,956 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5"> 8712636 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol6 twikiLastCol"> 3,652 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> gratia06.fnal.gov:3320 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> gratia09.fnal.gov:8880 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3 twikiLast"> 117G </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4 twikiLast"> 68,418,063 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5 twikiLast"> 70987563 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol6 twikiLastCol twikiLast"> 2,231,774 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="11" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<!-- ----------------- SHUTDOWN AND DATABASE BACKUP ------------- -->
<h1><a name="Shutdown_and_database_backup"></a> Shutdown and database backup. </h1>
 The nightly backups will suffice for this implementation.
<p />
<!-- ----------------- UPGRADE AND IMPLEMENTATION ------------- -->
<h1><a name="Small_DB_Upgrade_and_implementat"></a> Small DB - Upgrade and implementation </h1>
 The <strong><em>upgrades should be single-threaded</em></strong> , that is, performed for each database schema one at a time.
<p />
We will perform these upgrades based on the size of the individual database schema, in ascending order.
<p />
The <em>DupRecord</em> table (duplicates) should be removed before starting the upgrade.
<p />
The general procedure for this upgrade is: <ol>
<li> Stop the tomcat service  <ul>
<li> service TOMCAT_INITD_SERVICE stop 
</li></ul> 
</li> <li> Install the new software on the Gratia tomcat instance:  <ul>
<li> pswd=xxx 
</li> <li> source=/home/weigand/cdcvs/gratia-v0.34.10 
</li> <li> pgm=/home/weigand/cdcvs/gratia-v0.34.10/common/configuration/update-gratia-local 
</li> <li> $pgm -d $pswd -S $source -s DATABASE 
</li></ul> 
</li> <li> Tar the existing log files and save to a backup area. Then clean the log file directory.  <ul>
<li> date=`date '+%Y%m%d'` 
</li> <li> cd TOMCAT_LOCATION/logs/ 
</li> <li> tar zcf /data/gratia_tomcat_logs_backups/tomcat-TOMCAT_INITD_SERVICE.$date.tgz * 
</li> <li> rm -f * 
</li></ul> 
</li> <li> Effective with this release, there is an administrative login process that, by default, does not allow access to the admin functions. You will need to update the <strong><em>TOMCAT_LOCATION/gratia/service-configuration.properties</em></strong> file with the following attributes. (Note that if you forget to do this, the administrator can be added at anytime without restarting the tomcat service):  <ul>
<li> service.admin.DN.0=/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Philippe G. Canal/CN=UID:pcanal 
</li> <li> service.admin.DN.1=/DC=org/DC=doegrids/OU=People/CN=Christopher H. Green 851859 
</li> <li> service.admin.DN.2=/DC=org/DC=doegrids/OU=People/CN=John Weigand 458491 
</li> <li> service.admin.DN.3=/DC=org/DC=doegrids/OU=People/CN=Steven Timm 74183 
</li> <li> service.admin.DN.4=/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Steven C. Timm/CN=UID:timm 
</li> <li> service.admin.DN.5=/DC=org/DC=doegrids/OU=People/CN=Dan Yocum 346615 
</li> <li> service.admin.DN.6=/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Dan Yocum/CN=UID:yocum 
</li></ul> 
</li> <li> Start the tomcat service  <ul>
<li> service TOMCAT_INITD_SERVICE start <br />    When the tomcat service initializes, it will detect any schema changes have been effected and a conversion process will begin. 
</li> <li> <em>tail</em> the log files in _TOMCAT_LOCATION/logs. When the conversion process completes the log will show the following message: - "INFO: Server startup in _xxx_ms" 
</li> <li> In your browser, access the <em>gratia-administrative</em> web service, select the <em>System / Administration</em> menu option in the left menu, Then scroll down to the <em>Starting/Stopping Database Update Services</em> section and select the <em>Stop Update Services</em> link 
</li></ul> 
</li> <li> <strong><em>Wait until the schema upgrade is complete</em></strong> , then, <em>start</em> the Gratia <em>update</em> services for the database schema just upgraded.  <ul>
<li> In your browser, connect to the Gratia administrative services url for each of the databases. 
</li> <li> Select the <em>System / Administration</em> menu option in the left menu 
</li> <li> Then scroll down to the <em>Starting/Stopping Database Update Services</em> section and select the <em>Start Update Services</em> link. 
</li> <li> As the collector/tomcat host update service is started, monitor the tomcat logs files for any errors. 
</li> <li> Bring up the gratia <em>administration</em> web interface and verify that the collectors are processing the data on the status page. 
</li> <li> Bring up the gratia <em>reporting</em> web interface and verify that the reports look reasonable while still <em>tail'ing</em> the log files. 
</li></ul> 
</li> <li> Run the static reports cron as <em>root</em> and verify these reports are generated:  <ul>
<li> 3 pdf files and 3 csv files 
</li></ul> 
</li> <li> If satisifed, you may continue to the next one. 
</li></ol> 
<p />
<font color="#0000ff"> Did not have to do the stop/start of update service as you those services never got started 
</font>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Status_v0_34_through_v0_34_7"></a> Status v0.34. through v0.34.7 </span></h2>
<p />
 
<p />
<a name="edittable2"></a>
<div class="editTable">
<form name="edittable2" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV0dot34#edittable2" method="post">
<input type="hidden" name="ettablenr" value="2" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=0;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Database</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=1;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Tomcat node</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=2;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">init.d service</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=3;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">tomcat location</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=4;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=5;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Start</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol6 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=6;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Complete</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_transfer </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol1"> gratia08.fnal.gov:8886 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> tomcat-fermi_transfer </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> /data/tomcat-fermi_transfer </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 5.2M </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5"> 5/18 09:00 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6 twikiLastCol"> 5/22 13:05 v0.34.4 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_itb </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol1"> gratia08.fnal.gov:8881 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> tomcat-fermi_itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3"> /data/tomcat-fermi_itb </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 558M </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol5"> 5/18 10:10 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol6 twikiLastCol"> 5/22 12:54 v0.34.4 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_qcd </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol1"> gratia08.fnal.gov:8883 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> tomcat-qcd </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> /data/tomcat-qcd </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 4.3G </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5"> 5/18 11:20 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6 twikiLastCol"> 5/22 12:59 v0.34.4 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_psacct </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol1"> gratia08.fnal.gov:8882 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> tomcat-ps </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3"> /data/tomcat-ps </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 13G </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol5"> 5/18 11:58 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol6 twikiLastCol"> 5/27 16:00 v0.34.5 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> fermi_osg </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol1 twikiLast"> gratia08.fnal.gov:8880 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLast"> fermi_osg </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3 twikiLast"> /data/tomcat-fermi_osg </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4 twikiLast"> 24G </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5 twikiLast"> 5/19 07:51 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6 twikiLastCol twikiLast"> 5/22 12:44 v0.34.4 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="6" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
 
<p />
<a name="edittable3"></a>
<div class="editTable">
<form name="edittable3" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV0dot34#edittable3" method="post">
<input type="hidden" name="ettablenr" value="3" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table3" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=0;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Database</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=1;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Tomcat node</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=2;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">init.d service</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=3;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">tomcat location</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=4;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=5;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Start</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol6 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=6;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Complete</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_transfer </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol1"> gratia09.fnal.org:8886 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> tomcat-osg_transfer </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> /data/tomcat-osg_transfer </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 5.2M </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5"> 5/18 13:55 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6 twikiLastCol"> 5/22 13:12 v0.34.4 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_daily </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol1"> gratia09.fnal.gov:8884 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> tomcat-osg_daily </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3"> /data/tomcat-osg_daily </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 89M </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol5"> 5/18 14:28 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol6 twikiLastCol"> 5/22 13:15 v0.34.4 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_integration </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol1"> gratia09.fnal.gov:8885 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> tomcat-osg_integration </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> /data/tomcat-osg_integration </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 8.1G </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5"> 5/18 18:20 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6 twikiLastCol"> 5/22 13:18 v0.34.4 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia_itb </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol1 twikiLast"> gratia09.fnal.gov:8881 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> tomcat-itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLast"> /data/tomcat-itb </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4 twikiLast"> 21G </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol5 twikiLast"> 5/18 18:48 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol6 twikiLastCol twikiLast"> 5/29 10:32 v0.34.7 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="5" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<font color="#ff0000"> <strong>Issues/Problems:</strong> <ol>
<li> No host certificate. So administratiion functions disabled. Will have to wait until Monday to request host and http certificates from Steve.  <ul>
<li> <font color="#008000">Installed host certificate on 5/12</font> 
</li></ul> 
</li> <li> Static reports not working on fermi_transfer and osg_transfer. These databases are completely empty (zero records) and this is causing the problem. 
</li> <li> The <em>update_gratia_local</em> adds a cron entry for static reports every time it is run. You have to manually edit the crontab of the old entries.  <ul>
<li> It is also adding it with the ssl port number where in the past it was using the non-ssl port. <font color="#008000">Resolved on 6/6</font> <pre>
42 0 &#42; &#42; &#42; &#39;/data/tomcat-fermi&#95;osg/gratia/staticReports.py&#39;
                 &#39;/data/tomcat-fermi&#95;osg&#39; 
                 &#39;http://gratia-fermi.fnal.gov:&#60;b&#62;8880&#60;/b&#62;/gratia-reporting/&#39; 
&#60;b&#62;One below added new:&#60;/b&#62;
##42 0 &#42; &#42; &#42; &#39;/data/tomcat-fermi&#95;osg/gratia/staticReports.py&#39; 
                 &#39;/data/tomcat-fermi&#95;osg&#39; 
                 &#39;https://gratia-fermi.fnal.gov:&#60;b&#62;8845&#60;/b&#62;/gratia-reporting/&#39; 
</pre> 
</li></ul> 
</li> <li> osg_daily catalina.out logs  <ul>
<li> May 18, 2008 2:33:26 PM org.eclipse.birt.chart.script.ScriptHandler register<br />    WARNING: An invalid Chart Java event handler class [class net.sf.gratia.reporting.GratiaBirtReportEH] has been detected and ignored. 
</li> <li> Reporting menu is entirely different. 
</li> <li> should the static reports even be run for these 
</li></ul> 
</li> <li> gratia_psacct  <ul>
<li> Appears to be hung in the <strong>post-install.sh summary</strong> . Killed tomcat around 5/19 07:47 with an explicit kill and restart. It is hung again in the same step. 
</li></ul> 
</li> <li> fermi_osg  <ul>
<li> Encountered this error with <strong>index12</strong> : <pre>
FINE: Command: Error: alter table ProbeDetails&#95;Meta add unique index index12(md5) : 
com.mysql.jdbc.exceptions.MySQLIntegrityConstraintViolationException: 
     Duplicate entry &#39;E6A2B4DC7D3C910EF4D584CAEB6F10FA&#39; for key 2
      </pre> 
</li> <li> This are the <strong>alter table..</strong> statements in the gratia-0.log <pre>
380:FINE: Executing: alter table MetricRecord&#95;Meta add unique index index12(md5)
382:FINE: Command: OK: alter table MetricRecord&#95;Meta add unique index index12(md5)
388:FINE: Executing: alter table ProbeDetails&#95;Meta add unique index index12(md5)
390:FINE: Command: Error: alter table ProbeDetails&#95;Meta add unique index index12(md5) :
    com.mysql.jdbc.exceptions.MySQLIntegrityConstraintViolationException: 
    Duplicate entry &#39;E6A2B4DC7D3C910EF4D584CAEB6F10FA&#39; for key 2
470:FINE: Executing: alter table ProbeDetails&#95;Meta add unique index index12(md5)
472:FINE: Command: Error: alter table ProbeDetails&#95;Meta add unique index index12(md5) :
    com.mysql.jdbc.exceptions.MySQLIntegrityConstraintViolationException: 
    Duplicate entry &#39;E6A2B4DC7D3C910EF4D584CAEB6F10FA&#39; for key 2
590:FINE: Executing: alter table ProbeDetails&#95;Meta add unique index index12(md5)
592:FINE: Command: Error: alter table ProbeDetails&#95;Meta add unique index index12(md5) :
    com.mysql.jdbc.exceptions.MySQLIntegrityConstraintViolationException: 
    Duplicate entry &#39;E6A2B4DC7D3C910EF4D584CAEB6F10FA&#39; for key 2
618:FINE: Executing: alter table JobUsageRecord&#95;Meta add index index17(md5v2
      </pre> 
</li></ul> 
</li> <li> osg_daily  <ul>
<li> 5/20 08:00 noticed java exceptions <pre>
FINEST: fixDuplicatesOnce: resolving 3 duplicates 
with checksum C7E72574A5A891270BF2F6ECA1127A10
May 20, 2008 9:12:45 AM net.sf.gratia.util.Logging debug
FINEST: fixDuplicatesOnce: deleting record 54646 in favor of record 54704
May 20, 2008 9:12:45 AM net.sf.gratia.util.Logging warning
WARNING: fixDuplicatesOnce: caught exception resolving duplicates 
with checksum C7E72574A5A891270BF2F6ECA1127A10
com.mysql.jdbc.exceptions.MySQLSyntaxErrorException: 
PROCEDURE gratia&#95;osg&#95;daily.del&#95;JUR&#95;from&#95;summary does not exist
      </pre> 
</li> <li> Philippe reports that the checksum calculation is wrong for this instance and is looking into it 
</li> <li> stopped the instance 5/20 09:12 
</li></ul> 
</li> <li> gratia_itb  <ul>
<li> hibernate got in a deadlock state. Recycle on 5/20 09:08. Waiting to see if it occurs again. <pre>
2008-05-19 08:22:50,075 com.mchange.v2.async.ThreadPoolAsynchronousRunner &#91;WARN]:
 com.mchange.v2.async.ThreadPoolAsynchronousRunner$DeadlockDetector&#64;e39068 
-- APPARENT DEADLOCK!!! Creating emergency threads for unassigned pending tasks!
2008-05-19 08:22:50,091 com.mchange.v2.async.ThreadPoolAsynchronousRunner &#91;WARN]:
 com.mchange.v2.async.ThreadPoolAsynchronousRunner$DeadlockDetector&#64;e39068 
-- APPARENT DEADLOCK!!! Complete Status:
        Managed Threads: 3
        Active Threads: 3
        Active Tasks:

2008-05-20 10:16:50,019 com.mchange.v2.async.ThreadPoolAsynchronousRunner &#91;WARN]:
 com.mchange.v2.async.ThreadPoolAsynchronousRunner$DeadlockDetector&#64;d7f3b9 
-- APPARENT DEADLOCK!!! Creating emergency threads for unassigned pending tasks!
2008-05-20 10:16:50,048 com.mchange.v2.async.ThreadPoolAsynchronousRunner &#91;WARN]:
 com.mchange.v2.async.ThreadPoolAsynchronousRunner$DeadlockDetector&#64;d7f3b9 
-- APPARENT DEADLOCK!!! Complete Status:
        Managed Threads: 3
        Active Threads: 3
        Active Tasks:
      </pre> 
</li></ul> 
</li></ol> 
<p />
</font>
<p />
<font color="#0000ff"> <strong>Notes</strong> <ol>
<li> The tmp directory being used by MySql on gratia06 is defined on the command line and not by the my.cnf value <pre>
gratia    6415 14500 42 Apr25 ?        10-01:17:45 
          /fnal/ups/prd/mysql/v5&#95;0&#95;22/Linux-2-4/libexec/mysqld 
         --basedir&#61;/fnal/ups/prd/mysql/v5&#95;0&#95;22/Linux-2-4 
         --datadir&#61;/data/mysqldb/ --user&#61;gratia 
         --pid-file&#61;/data/mysqldb//gratia06.fnal.gov.pid --skip-locking 
         --port&#61;3320 --socket&#61;/data/mysqldb/mysql.sock 
         --tmpdir&#61;/data/mysqltmp/tmp
   </pre> 
</li> <li> <strong>gratia_psacct</strong>  <ul>
<li> Had to perform an InnoDB conversion in the beginning. (Start 12:59 Completed: 13:09, elapsed 01:11) 
</li> <li> Then it had to create the new table for the JobUsageRecord_Meta table column. (Start 13:11 Complete:14:26 elapsed 01:15) 
</li> <li> Adding the index (Start 15:21 ). No clue when it ended 
</li> <li> At 15:46 running gratia/build-summary-tables.sql 
</li></ul> 
</li> <li> <strong>fermi_osg</strong>  <ul>
<li> Creating the JobUsageRecord_Meta table column and index (Start 5/19 09:32 Completed: 5/19 11:57 Elapsed: 02:25) 
</li> <li> Summary table creation (Start: 11:57 Completed: Elapsed: ) 
</li></ul> 
</li> <li> Philippe changed the creation of the summary tables ( <em>build-summary-tables.sql</em> )  <ul>
<li> This was to eliminate glexec records from the tables due to a large number of bad records in the main database when glexec first fired up. 
</li> <li> Ran from gratia-vm02:/data/tomcat-greenc_test area against the gratia07:/test/data/mysqldb/gratia database 
</li> <li> Started 5/19 14:40 Completed 5/20 04:52 Elapsed: 12:12 
</li> <li> Reduced time by 4 hours 
</li></ul> 
</li></ol> 
<p />
<strong>Certificates on gratia08 and graita09</strong> <ol>
<li> Installed pacman  <ul>
<li> mkdir /usr/local/pacman 
</li> <li> cd /usr/local/pacman 
</li> <li> wget <a href="http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-3.24.tar.gz" target="_top">http://physics.bu.edu/pacman/sample_cache/tarballs/pacman-3.24.tar.gz</a> 
</li> <li> tar zxf pacman-3.24.tar.gz 
</li> <li> cd pacman-3.24 
</li> <li> source setup.sh 
</li></ul> 
</li> <li> Installed VDT CA-Certifcates  <ul>
<li> mdkir /etc/grid-securtiy 
</li> <li> mkdir /usr/local/vdt-certificates.1101 
</li> <li> cd /usr/local/vdt-certificates.1101 
</li> <li> pacman -get VDT:CA-Certificates 
</li> <li> (answer yes to all questions and "r (root)" when asked where you want to install them. This puts them directly in /etc/grid-security. 
</li></ul> 
</li> <li> Enable the VDT services (crons in his release) to maintain the certificates and crls  <ul>
<li> source /usr/local/vdt-certificates.1101/setup.sh 
</li> <li> vdt-control --on 
</li></ul> 
</li></ol> 
<p />
</font>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Status_v0_34_9"></a> Status v0.34.9 </span></h2>
 Since changes have been made to the checksum calculation and these instances have already been upgraded for the new md5 (md5v2) value, the upgrade to v0.34.9 will require the following. This is so a new checksum (md5v2) value is calculated.
<p />
The general procedure for this upgrade is: <ol>
<li> Stop the tomcat service  <ul>
<li> service TOMCAT_INITD_SERVICE stop 
</li></ul> 
</li> <li> Tar the existing log files and save to a backup area. Then clean the log file directory.  <ul>
<li> date=`date '+%Y%m%d'` 
</li> <li> cd TOMCAT_LOCATION/logs/ 
</li> <li> tar zcf /data/gratia_tomcat_logs_backups/tomcat-TOMCAT_INITD_SERVICE.$date.tgz * 
</li> <li> rm -f * 
</li></ul> 
</li> <li> In MySql client ( <strong>as root</strong> ), we need to force the recalculation of the new checksum values:  <ul>
<li> show index from JobUsageRecord_Meta; 
</li> <li> alter table JobUsageRecord_Meta drop index index17; <br />     (index17 should be the md5v2 unique index. If not, drop the one that is.) 
</li> <li> update JobUsageRecord_Meta set md5v2 = null; 
</li> <li> delete from SystemProplist where car = 'gratia.database.disableChecksumUpgrade'; 
</li></ul> 
</li> <li> Install the new software on the Gratia tomcat instance:  <ul>
<li> pswd=xxx 
</li> <li> source=/home/gratia/gratia-releases/gratia-v0.34.10 
</li> <li> pgm=/home/gratia/gratia-releases/gratia-v0.34.10/common/configuration/update-gratia-local 
</li> <li> $pgm -d $pswd -S $source -s DATABASE 
</li></ul> 
</li> <li> Effective with this release, there is an administrative login process that, by default, does not allow access to the admin functions. You will need to update the <strong><em>TOMCAT_LOCATION/gratia/service-configuration.properties</em></strong> file with the following attributes. (Note that if you forget to do this, the administrator can be added at anytime without restarting the tomcat service):  <ul>
<li> service.admin.DN.0=/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Philippe G. Canal/CN=UID:pcanal 
</li> <li> service.admin.DN.1=/DC=org/DC=doegrids/OU=People/CN=Christopher H. Green 851859 
</li> <li> service.admin.DN.2=/DC=org/DC=doegrids/OU=People/CN=John Weigand 458491 
</li> <li> service.admin.DN.3=/DC=org/DC=doegrids/OU=People/CN=Steven Timm 74183 
</li> <li> service.admin.DN.4=/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Steven C. Timm/CN=UID:timm 
</li> <li> service.admin.DN.5=/DC=org/DC=doegrids/OU=People/CN=Dan Yocum 346615 
</li> <li> service.admin.DN.6=/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Dan Yocum/CN=UID:yocum 
</li></ul> 
</li> <li> AND change these attributes as well to either <strong>gratia-fermi.fnal.gov</strong> (gratia08) or <strong>gratia.opensciencegrid.org</strong> (gratia09). <strong>Note</strong> : the port number should be correct, but double-check it.  <ul>
<li> service.open.connection=http://localhost:8884 
</li> <li> service.secure.connection=https://localhost:8860 
</li></ul> 
</li> <li> Start the tomcat service  <ul>
<li> service TOMCAT_INITD_SERVICE start <br />    When the tomcat service initializes, it will detect any schema changes have been effected and a conversion process will begin. 
</li> <li> <em>tail</em> the log files in _TOMCAT_LOCATION/logs. When the conversion process completes the log will show the following message: - "INFO: Server startup in _xxx_ms" 
</li> <li> In your browser, access the <em>gratia-administrative</em> web service, select the <em>System / Administration</em> menu option in the left menu, Then scroll down to the <em>Starting/Stopping Database Update Services</em> section and select the <em>Stop Update Services</em> link 
</li></ul> 
</li> <li> <strong><em>Wait until the schema upgrade is complete</em></strong> , then, <em>start</em> the Gratia <em>update</em> services for the database schema just upgraded.  <ul>
<li> In your browser, connect to the Gratia administrative services url for each of the databases. 
</li> <li> Select the <em>System / Administration</em> menu option in the left menu 
</li> <li> Then scroll down to the <em>Starting/Stopping Database Update Services</em> section and select the <em>Start Update Services</em> link. 
</li> <li> As the collector/tomcat host update service is started, monitor the tomcat logs files for any errors. 
</li> <li> Bring up the gratia <em>administration</em> web interface and verify that the collectors are processing the data on the status page. 
</li> <li> Bring up the gratia <em>reporting</em> web interface and verify that the reports look reasonable while still <em>tail'ing</em> the log files. 
</li></ul> 
</li> <li> Run the static reports cron as <em>root</em> and verify these reports are generated:  <ul>
<li> 3 pdf files and 3 csv files 
</li></ul> 
</li> <li> If satisifed, you may continue to the next one. 
</li></ol> 
<p />
<h3><a name="gratia08_services"></a> gratia08 services </h3>
<p />
 
<p />
<a name="edittable4"></a>
<div class="editTable">
<form name="edittable4" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV0dot34#edittable4" method="post">
<input type="hidden" name="ettablenr" value="4" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table4" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=0;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Database</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=1;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Tomcat node</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=2;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">init.d service</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=3;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">tomcat location</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=4;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=5;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Rows</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol6"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=6;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Start</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol7"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=7;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Complete</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol8"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=8;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Alter table</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol9 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=9;table=4;up=0#sorted_table" title="Sort by this column"><font color="#252b37">checksum</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_transfer </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol1"> gratia08.fnal.gov:8886 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> tomcat-fermi_transfer </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> /data/tomcat-fermi_transfer </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 5.2M </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5"> 0 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6"> 6/12 11:20 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol7"> 6/12 11:39 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol8"> n/a </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol9 twikiLastCol"> n/a </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> fermi_itb </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol1"> gratia08.fnal.gov:8881 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> tomcat-fermi_itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3"> /data/tomcat-fermi_itb </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 513M </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol5"> 59K </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol6"> 6/12 11:40 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol7"> 6/12 12:02 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol8"> n/a </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol9 twikiLastCol"> 00:11 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_qcd </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol1"> gratia08.fnal.gov:8883 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> tomcat-qcd </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> /data/tomcat-qcd </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 4.6G </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5"> 1.2M </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6"> 6/12 12:33 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol7"> 6/12 17:24 </td>
			<td bgcolor="#FFFFCC" align="center" valign="top" class="twikiTableCol8"> 00:08 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol9 twikiLastCol"> 29:00 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_psacct </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol1"> gratia08.fnal.gov:8882 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> tomcat-ps </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3"> /data/tomcat-ps </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 19G </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol5"> 8.5M </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol6"> 6/13 09:54 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol7"> 6/18 08:45 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol8"> 04:23 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol9 twikiLastCol"> started 6/18 08:45 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> fermi_osg </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol1 twikiLast"> gratia08.fnal.gov:8880 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLast"> fermi_osg </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3 twikiLast"> /data/tomcat-fermi_osg </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4 twikiLast"> 26G </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5 twikiLast"> 9.5M </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6 twikiLast"> 6/13 10:00 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol7 twikiLast"> 6/14 12:48 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol8 twikiLast"> unknown </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol9 twikiLastCol twikiLast"> unknown </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="6" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<h4><a name="tomcat_qcd"></a> tomcat-qcd </h4>
 Started 06/12 12:46 Complete:6/12 17:24 Elapsed: 04:38 <pre>
Jun 12, 2008 5:19:13 PM net.sf.gratia.util.Logging info
INFO: ChecksumUpgrader: main duplicate resolution phase complete in 1 iterations.
INFO: ChecksumUpgrader: resolved duplicates for a total of 65 duplicated checksums.
FINEST: fixDuplicatesOnce: starting duplicate resolution cycle
FINEST: fixDuplicatesOnce: this cycle detected 0 duplicated checksums
INFO: ChecksumUpgrader: make index on md5v2 unique (could take some time)

Jun 12, 2008 5:21:56 PM net.sf.gratia.util.Logging log
FINE: Executing: alter table JobUsageRecord&#95;Meta drop index index12
Jun 12, 2008 5:24:01 PM net.sf.gratia.util.Logging log
FINE: Command: OK: alter table JobUsageRecord&#95;Meta drop index index12
INFO: ChecksumUpgrader: reactivating listener threads
FINE: ListenerThread: ListenerThread: 0:Duplicate Check: true
   </pre>
<p />
<h4><a name="tomcat_psacct"></a> tomcat-psacct </h4>
 <pre>
-rw-rw----  1 gratia gratia   209715200 Jun 13 23:29 MasterSummaryData.ibd
-rw-rw----  1 gratia gratia   155189248 Jun 14 10:48 NodeSummary.ibd

Jun 13, 2008 11:28:09 PM net.sf.gratia.util.Logging log
FINE: OUTPUT&#62;post-install.sh: loading /data/tomcat-ps/gratia/build-summary-tables.sql ... OK
Jun 13, 2008 11:28:10 PM net.sf.gratia.util.Logging log
FINE: OUTPUT&#62;post-install.sh: loading /data/tomcat-ps/gratia/build-summary-view.sql ... OK

2008-06-13 22:01:21,483 org.hibernate.tool.hbm2ddl.SchemaUpdate &#91;INFO]: schema update complete
</pre>
<p />
<strong>Restarted on 6/15</strong>
<pre>
Jun 15, 2008 1:47:00 PM net.sf.gratia.util.Logging log
FINE: DatabaseMaintenance: calling post-install script for action &#34;summary&#34;
Jun 15, 2008 2:23:39 PM net.sf.gratia.util.Logging log
FINE: OUTPUT&#62;post-install.sh: loading /data/tomcat-ps/gratia/build-summary-tables.sql ... OK
Jun 15, 2008 2:23:39 PM net.sf.gratia.util.Logging log
FINE: OUTPUT&#62;post-install.sh: loading /data/tomcat-ps/gratia/build-summary-view.sql ... OK
Jun 17, 2008 7:27:11 PM net.sf.gratia.util.Logging log
FINE: OUTPUT&#62;post-install.sh: loading /data/tomcat-ps/gratia/build-ps-node-summary-table.sql ... OK
Jun 17, 2008 7:27:11 PM net.sf.gratia.util.Logging log
FINE: exitValue: 0
Jun 17, 2008 7:27:11 PM net.sf.gratia.util.Logging log
FINE: Executing: select count(&#42;) from SystemProplist where car &#61; &#34;gratia.database.summaryTableVersion&#34;
Jun 17, 2008 7:27:11 PM net.sf.gratia.util.Logging log
FINE: Command: Error: select count(&#42;) from SystemProplist where car &#61; &#34;gratia.database.summaryTableVersion&#34; : com.mysql.jdbc.CommunicationsException: Communications link failure due to underlying exception:
java.io.EOFException
</pre>
<p />
<strong>6/18 08:30</strong> - The above error occurred because of the timeout on the connection. The <strong>SystemProplist</strong> table has to be updated manually for this entry:
<pre>
use gratia&#95;psacct;
update SystemProplist set cdr&#61;38 where car &#61; &#34;gratia.database.summaryTableVersion&#34;;
   </pre>
<p />
<strong>6/18 08:35</strong> - restarted tomcat-psacct service
<p />
<strong>6/16/13:05</strong> - Philippe questioning why the summary tables had to be rebuilt
<pre>
Chris&#39; reply: 
For the first 0.34 upgrade: if the upgrade &#34;failed&#34; due to the connection timeout 
during summary table production, the DB entry should have been updated. 
If that didn&#39;t happen, that&#39;s where the problem is.
   - summaryTableVersion is 33.
   - Table reload required at v36
   </pre>
<p />
<h4><a name="tomcat_fermi_osg"></a> tomcat-fermi_osg </h4>
 <pre>
-rw-rw----  1 gratia gratia    98304 Jun 14 12:48 SystemProplist.ibd
-rw-rw----  1 gratia gratia 12582912 Jun 14 12:38 MasterSummaryData.ibd
(appears no more updates occurred against the summary table as all are glexec records 
   </pre>
<p />
<strong>6/18 10:00</strong> - checksum calculation is doing one of its resolutions. Appears to be 10 hours into this query. Do not want to do anything against gratia06 database until this completes. Apears to be all done in memory. Output of <em>show processlist</em> :
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table5" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> fermi_osg </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLast"> Execute </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLast"> 36353 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol3 twikiLast"> Sending data </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol4 twikiLastCol twikiLast"> select md5v2, count(*) as `Count` from JobUsageRecord _Meta where md5v2 is not null group by md5v2 .. </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<strong>6/18 13:20</strong>
<pre>
FINEST: fixDuplicatesOnce: this cycle detected 0 duplicated checksums
Jun 18, 2008 1:16:51 PM net.sf.gratia.util.Logging info
INFO: ChecksumUpgrader: main duplicate resolution phase complete in 1 iterations.
Jun 18, 2008 1:16:51 PM net.sf.gratia.util.Logging info
INFO: ChecksumUpgrader: resolved duplicates for a total of 34 duplicated checksums.
Jun 18, 2008 1:16:51 PM net.sf.gratia.util.Logging info
INFO: ChecksumUpgrader: final pass on duplicates
Jun 18, 2008 1:16:51 PM net.sf.gratia.util.Logging debug
FINEST: fixDuplicatesOnce: starting duplicate resolution cycle
Jun 18, 2008 1:20:36 PM net.sf.gratia.util.Logging debug
FINEST: fixDuplicatesOnce: this cycle detected 0 duplicated checksums
Jun 18, 2008 1:20:36 PM net.sf.gratia.util.Logging info
INFO: ChecksumUpgrader: make index on md5v2 unique (could take some time)

      </pre>
<p />
<h3><a name="gratia09_services"></a> gratia09 services </h3>
<p />
 
<p />
<a name="edittable5"></a>
<div class="editTable">
<form name="edittable5" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaReleaseV0dot34#edittable5" method="post">
<input type="hidden" name="ettablenr" value="5" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table6" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=0;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Database</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=1;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Tomcat node</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=2;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">init.d service</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol3"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=3;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">tomcat location</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol4"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=4;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Size</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol5"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=5;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Rows</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol6"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=6;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Start</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol7"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=7;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Complete</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol8"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=8;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Alter table</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol9 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=9;table=6;up=0#sorted_table" title="Sort by this column"><font color="#252b37">checksum</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_transfer </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol1"> gratia09.fnal.org:8886 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> tomcat-osg_transfer </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> /data/tomcat-osg_transfer </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 5.2M </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5"> 0 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6"> 6/19 7:20 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol7"> 6/19 9:00 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol8"> n/a </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol9 twikiLastCol"> n/a </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_daily </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol1"> gratia09.fnal.gov:8884 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> tomcat-osg_daily </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3"> /data/tomcat-osg_daily </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4"> 155M </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5"> 86K </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol6"> 6/19 09:50 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol7"> 6/19 10:15 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol8"> n/a </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol9 twikiLastCol"> n/a </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia_osg_integration </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol1"> gratia09.fnal.gov:8885 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> tomcat-osg_integration </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> /data/tomcat-osg_integration </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol4"> 7.1G </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5"> 1.4M </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6"> 6/19 10:35 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol7"> 6/19 11:37 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol8"> &nbsp; </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol9 twikiLastCol"> &nbsp; </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia_itb </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol1 twikiLast"> gratia09.fnal.gov:8881 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> tomcat-itb </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol3 twikiLast"> /data/tomcat-itb </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol4 twikiLast"> 23G </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5 twikiLast"> 8.2M </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol6 twikiLast"> 6/19 13:05 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol7 twikiLast"> 6/19 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol8 twikiLast"> &nbsp; </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol9 twikiLastCol twikiLast"> &nbsp; </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="5" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
<h4><a name="osg_transfer"></a> osg_transfer </h4>
 Got this stacktrace shortly after startup: <pre> *In catalina.out:* java.rmi.ServerException: RemoteException occurred in server thread;  nested exception is:         java.rmi.AccessException: Registry.Registry.rebind disallowed;  origin /131.225.107.75 is non-local host  *In gratia-0.log:* Jun 19, 2008 7:41:42 AM net.sf.gratia.util.Logging warning WARNING: java.rmi.server.ExportException: Port already in use: 21000;  nested exception is:  java.net.BindException: Address already in use </pre>
<p />
A look at <strong>collector-pro.dat</strong> shows: <ul>
<li> gratia09 collectors: <pre>gratia => { http_port => 8880, rmi_port => 17000, itb => { http_port => 8881, rmi_port => 18000, osg_daily => { http_port => 8884, rmi_port => 20000, osg_integration => { http_port => 8885, rmi_port => 21000, osg_transfer => { http_port => 8886, rmi_port => 21000, </pre> 
</li> <li> gratia08 collectors: <pre>fermi_osg => { http_port => 8880, rmi_port => 17000, fermi_itb => { http_port => 8881, rmi_port => 18000, ps => { http_port => 8882, rmi_port => 19000, qcd => { http_port => 8883, rmi_port => 21000, fermi_transfer => { http_port => 8886, rmi_port => 22000, conversion => { http_port => 8884, rmi_port => 20000, </pre> 
</li> <li> The <strong>osg_transfer</strong> is the only one with conflicting ports. Changing manually to 22000 in /data/tomcat-osg_transfer and in CVS. 
</li></ul> 
<p />
<strong>6/19 08:30</strong> <ul>
<li> Now got this error on startup in catalina.out: <pre>java.rmi.ServerException: RemoteException occurred in server thread; nested exception is: java.rmi.AccessException: Registry.Registry.rebind disallowed; origin /131.225.107.75 is non-local host </pre> 
</li> <li> caused by this alias in the *service-configuration.properties file <pre>service.rmi.rmibind=//gratia-transfer.opensciencegrid.org:22000 service.rmi.rmilookup=rmi://gratia-transfer.opensciencegrid.org:22000 </pre> 
</li> <li> these were changed as well <pre>monitor.subject=gratia-transfer.opensciencegrid.org:8886 service.open.connection=http://gratia-transfer.opensciencegrid.org:8886 service.secure.connection=https://gratia-transfer.opensciencegrid.org:8840 </pre> 
</li> <li> Changed to gratia.opensciencegrid.org Changing manually in /data/tomcat-osg_transfer and in CVS. 
</li></ul> 
<p />
<font color="#008000">Done at 6/19 09:00</font>
<p />
<h4><a name="osg_daily"></a> osg_daily </h4>
 No problems. <pre>Jun 19, 2008 11:53:42 AM net.sf.gratia.util.Logging info INFO: ChecksumUpgrader: make index on md5v2 unique (could take some time) Jun 19, 2008 11:53:55 AM net.sf.gratia.util.Logging info INFO: ChecksumUpgrader: drop index on old md5 column  FINE: Command: OK: alter table JobUsageRecord_Meta drop index index12 Jun 19, 2008 11:54:03 AM net.sf.gratia.util.Logging info INFO: ChecksumUpgrader: reactivating listener threads  Jun 19, 2008 11:54:04 AM net.sf.gratia.util.Logging info INFO: ChecksumUpgrader: checksum upgrade operation complete  </pre>
<p />
<h4><a name="osg_integration"></a> osg_integration </h4>
<p />
<pre>alter table JobUsageRecord_Meta drop index index17; elapsed: 00:10  update JobUsageRecord_Meta set md5v2 = null; Started 11:17  Ended: 11:19  Jun 19, 2008 11:23:50 AM net.sf.gratia.util.Logging log FINE: Executing: alter table JobUsageRecord_Meta add index index17(md5v2)  Jun 19, 2008 11:27:19 AM net.sf.gratia.util.Logging info INFO: ChecksumUpgrader: updating all checksums in JobUsageRecord_Meta     </pre>
<p />
<h4><a name="gratia_itb"></a> gratia_itb </h4>
<p />
<!-- ----------------- POST MORTEM  ------------- -->
<h1><a name="Post_mortem"></a> Post-mortem </h1>
 At this time, this will appear to be random notes. After the conversion, they may be organized.
<p />
 <!-- <ul>
<li> Set EDITTHISTEXT = <div class="twikiSmall"><a href="GratiaDbUpgradeV0dot34dot7">edit this section</a></div>
</li></ul> 
-->
<p />
<h1><a name="Main_gratia_DB_Upgrade_to_v0_34"></a> Main gratia DB - Upgrade to v0.34.9 </h1>
<div class="twikiSmall"><a href="GratiaDbUpgradeV0dot34dot7">edit this section</a></div>
<p />
The main Gratia database ( <strong>gratia</strong> ) served by the <strong>gratia09:/data/tomcat-gratia</strong> instance will require a very long conversion time. So to maximize availability we will: <ol>
<li> create a current copy of the <strong>gratia06/gratia</strong> database on <strong>gratia07</strong> 
</li> <li> using a temporary Gratia collector on <strong>gratia08:/data/tomcat-conversion</strong>  <ul>
<li> this collector will be upgraded to v0.34.9 allowing the new summary table and md5v2 checksums to be calculated. 
</li> <li> we will then replicate from <strong>gratia06</strong> to <strong>gratia07</strong> to "catch up" the database before we switch the production <strong>gratia09:/data/tomcat-gratia</strong> over to using it. 
</li></ul> 
</li> <li> switch the current <strong>gratia09:/data/tomcat-gratia</strong> to use the <strong>gratia07/gratia</strong> database 
</li> <li> perform the upgrade of the <strong>gratia06/gratia</strong> database to v0.34.9 using the Gratia collector on <strong>gratia08:/data/tomcat-conversion</strong> . 
</li> <li> While the checksum upgrades are occurring, we will replicate from <strong>gratia07</strong> to <strong>gratia06</strong> so the "catch up" time to make it current is reduced. 
</li> <li> when the upgrade is complete (inclusive of the conversion to the new md5 key), we will switch the <strong>gratia09:/data/tomcat-gratia</strong> instance back to using the <strong>gratia06/gratia</strong> database 
</li></ol> 
<p />
During the upgrade period, this will be the tomcat/database environement for the <strong>gratia</strong> database: 
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table7" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=0;table=7;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Tomcat instance</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=1;table=7;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Database instance</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia09:/data/tomcat-gratia port 8880 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> gratia07:/data/mysqldb/gratia port 3320 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> gratia08:/data/tomcat-conversion port 8884 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> gratia06:/data/mysqldb/gratia port 3320 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
The above is a high level summary of the process. The details are contained in subsequent sections.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Create_a_copy_of_the_current_dat"></a> Create a copy of the current database on <strong>gratia07</strong> </span></h2>
 On 5/28, the <strong>gratia07:/data/mysqldb</strong> was re-partitioned into a single 200Gb area to provide the required space for the <strong>gratia</strong> database.
<p />
<h3><a name="Create_the_gratia07_gratia_datab"></a> Create the <strong>gratia07:gratia</strong> database using the ZRM backup </h3>
 This is in process now (5/30) and a finalized procedure will be included when it completes.
<p />
<font color="#008000">Done - 6/3/08 08:00 CDT</font> <br />    
<p />
<h3><a name="Configure_gratia08_data_tomcat_c"></a> Configure <strong>gratia08:/data/tomcat-conversion</strong> to use the <strong>gratia07:gratia</strong> database </h3>
 On <strong>gratia08</strong>, edit the <strong>/data/tomcat-conversion/gratia/service-configuration.properties</strong> file for this resulting attribute:  <ul>
<li> service.mysql.url=jdbc:mysql://gratia07.fnal.gov:3320/gratia 
</li></ul> 
<p />
<font color="#008000">Done - 6/3/08 12:37 CDT (John Weigand)</font> <br />     <font color="#008000">Re-confirmed - 6/11/08 10:30 CDT (John Weigand)</font>
<p />
<h3><a name="Upgrade_gratia08_data_tomcat_con"></a> Upgrade <strong>gratia08:/data/tomcat-conversion</strong> to <strong>v0-34-9</strong> </h3>
 On <strong>gratia08</strong> :  <ol>
<li> Stop the tomcat service  <ul>
<li> service tomcat-conversion stop 
</li> <li> <font color="#008000">Done - 6/11/08 14:48 CDT</font> 
</li></ul> 
</li></ol> 
<p />
On <strong>gratia07</strong> : <ol>
<li> Disable the checksum upgrade on <strong>gratia07/gratia</strong> database. In a MySql client:  <ul>
<li> update SystemProplist set cdr=1 where car='gratia.database.disableChecksumUpgrade'; 
</li> <li> <font color="#008000">Done - 6/11/08 14:51 CDT</font> 
</li></ul> 
</li></ol> 
<p />
Back on <strong>gratia08</strong> : <ol>
<li> Perform the upgrade to v0.34.9  <ul>
<li> pswd=xxx 
</li> <li> source=/home/gratia/gratia-releases/gratia-v0.34.9 
</li> <li> pgm=/home/gratia/gratia-releases/gratia-v0.34.9/common/configuration/update-gratia-local 
</li> <li> $pgm -d $pswd -S $source -s conversion 
</li></ul> 
</li> <li> Effective with this release, there is an administrative login process that, by default, does not allow access to the admin functions. You will need to update the <strong><em>TOMCAT_LOCATION/gratia/service-configuration.properties</em></strong> file with the following attributes. You will also need to change 2 connection attributes, as well. (Note that if you forget to do this, the administrator can be added at anytime without restarting the tomcat service):  <ul>
<li> service.admin.DN.0=/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Philippe G. Canal/CN=UID:pcanal 
</li> <li> service.admin.DN.1=/DC=org/DC=doegrids/OU=People/CN=Christopher H. Green 851859 
</li> <li> service.admin.DN.2=/DC=org/DC=doegrids/OU=People/CN=John Weigand 458491 
</li> <li> service.admin.DN.3=/DC=org/DC=doegrids/OU=People/CN=Steven Timm 74183 
</li> <li> service.admin.DN.4=/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Steven C. Timm/CN=UID:timm 
</li> <li> service.admin.DN.5=/DC=org/DC=doegrids/OU=People/CN=Dan Yocum 346615 
</li> <li> service.admin.DN.6=/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Dan Yocum/CN=UID:yocum 
</li> <li> 
</li> <li> service.open.connection=http://gratia-fermi.fnal.gov:8884 
</li> <li> service.secure.connection=https://gratia-fermi.fnal.gov:8860 
</li></ul> 
</li> <li> <strong>IMPORTANT IMPORTANT... THESE MUST BE CHANGED</strong>  <ul>
<li> <font color="#ff0000">service.mysql.url=jdbc:mysql:// <strong>gratia07</strong>.fnal.gov:3320/gratia</font> in the <strong>service-configuration.properties</strong> file 
</li> <li> in <strong>post-install.sh</strong>, change the mysql client execution <strong>from</strong> <font color="#ff0000">gratia-db01</font> <strong>to</strong> <font color="#ff0000">gratia07</font>. 
</li></ul> 
</li> <li> Start the tomcat service  <ul>
<li> service tomcat-conversion start 
</li></ul> 
</li></ol> 
<p />
<font color="#008000">Done - 6/11/08 14:55 CDT</font> <br />     <font color="#ff0000">First shot was against the production database. I did not realize the <em>collector-pro.dat</em> file set the mysql to gratia_db01:3320/gratia. Chris bailed me out and confirmed that no damage had occured. Chris changed the <em>collector-pro.dat</em> for the <em>conversion</em> instance to garbage data to avoid this on future releases forcing manually changing the file. I will add this to the upgrade instructions for the <strong>gratia09:tomcat-gratia</strong> . </font> <br />     <font color="#008000">Re-Done - 6/11/08 15:21 CDT</font>
<p />
<font color="#0000ff">First thing it does is add the <em>GridDescription</em> to the <em>JobUsageRecord_Meta</em> table.<br />     In MySql client ( <em>show processlist;</em> ):
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table8" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Id </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> User </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2"> Host </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol3"> db </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol4"> Command </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol5"> Time </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol6"> State </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol7 twikiLastCol"> Info </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> 2786 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLast"> gratia </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLast"> gratia08.fnal.gov:11262 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol3 twikiLast"> gratia </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol4 twikiLast"> Query </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol5 twikiLast"> 57891 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol6 twikiLast"> copy to tmp table </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol7 twikiLastCol twikiLast"> alter table JobUsageRecord _Meta add column GridDescription varchar(255) </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
 Started: 6/11 15:20 CDT<br />     Status as of 6/12 07:27 CDT  <ul>
<li> -rw-rw---- 1 gratia gratia 23G Jun 5 09:08 JobUsageRecord_Meta.ibd 
</li> <li> -rw-rw---- 1 gratia gratia 14K Jun 11 15:20 #sql-3275_ae2.frm 
</li> <li> -rw-rw---- 1 gratia gratia 16G Jun 12 07:27 #sql-3275_ae2.ibd 
</li></ul> 
</font>
<p />
<font color="#008000"> GridDescription add to JobUsageRecord _Meta table <ul>
<li> Started - 6/11 15:21 CDT Ended - 6/12 22:30 CDT Elapsed - 31:09 md5v2 and index add to JobUsageRecord _Meta 
</li> <li> Started - 6/12 23:26 CDT Ended - 6/14 10:07 CDT Elapsed -34:41 MasterSummary table creation (started tomcat-conversion service) 
</li> <li> Started - 6/14 10:45 CDT Ended - 6/12 CDT Elapsed <pre>
Jun 14, 2008 10:55:21 AM net.sf.gratia.util.Logging log
FINE: Executing: /data/tomcat-conversion/gratia/post-install.sh summary
ABOVE ONE WAS AGAINST THE gratia06 database as the post-install.sh script needed to be changed too

Jun 14, 2008 11:21:24 AM net.sf.gratia.util.Logging log
FINE: Executing: /data/tomcat-conversion/gratia/post-install.sh summary

&#60;b&#62;Jun 15, 2008 3:01:31 AM net.sf.gratia.util.Logging log
FINE: ERROR - ERROR 1206 (HY000) at line 45: The total number of locks exceeds the lock table size&#60;/b&#62;

In the grati07.fnal.gov.err file....
080615  2:47:28  InnoDB: WARNING: over 67 percent of the buffer pool is occupied by
InnoDB: lock heaps or the adaptive hash index! Check that your
InnoDB: transactions do not set too many row locks.
InnoDB: Your buffer pool size is 512 MB. Maybe you should make
InnoDB: the buffer pool bigger?
InnoDB: Starting the InnoDB Monitor to print diagnostics, including
InnoDB: lock heap and hash index sizes.


Jun 15, 2008 13:30
Set increased my.cnf variable:
innodb&#95;buffer&#95;pool&#95;size &#61; 512M
to
innodb&#95;buffer&#95;pool&#95;size &#61; 768M

also stopped mysql&#95;test instance... restarted mysql ... restarted tomcat-conversion

Jun 15, 2008 1:34:57 PM net.sf.gratia.util.Logging log
FINE: Executing: /data/tomcat-conversion/gratia/post-install.sh summary
Jun 16, 2008 9:27:50 AM net.sf.gratia.util.Logging log
FINE: OUTPUT&#62;post-install.sh: loading /data/tomcat-conversion/gratia/build-summary-tables.sql ... OK 
Jun 16, 2008 9:27:51 AM net.sf.gratia.util.Logging log
FINE: OUTPUT&#62;post-install.sh: loading /data/tomcat-conversion/gratia/build-summary-view.sql ... OK
Jun 16, 2008 9:27:51 AM net.sf.gratia.util.Logging log
FINE: exitValue: 0
Jun 16, 2008 9:27:51 AM net.sf.gratia.util.Logging log
FINE: Executing: select count(&#42;) from SystemProplist where car &#61; &#34;gratia.database.summaryTableVersion&#34;
Jun 16, 2008 9:27:51 AM net.sf.gratia.util.Logging log
FINE: Command: Error: select count(&#42;) from SystemProplist where car &#61; &#34;gratia.database.summaryTableVersion&#34; : com.mysql.jdbc.CommunicationsException: Communications link failure due to underlying exception:
&#42;&#42; BEGIN NESTED EXCEPTION &#42;&#42;
java.io.EOFException
   </pre> 
</li></ul> 
<p />
Apparently connection timed-out around 6/16 09:27. The summary table and views were updated successfully. Just failed in the update of the SystemProplist table entries. Chris updated them manually. Then we recycled the <strong>tomcat-conversion</strong> service on gratia08.
<pre>
Jun 16, 2008 9:27:51 AM net.sf.gratia.util.Logging warning
WARNING: Command: Error: insert into SystemProplist(car,cdr) values(&#34;gratia.database.summaryTableVersion&#34;, &#34;38&#34;)

root      7218     1 20 10:05 ?        00:32:35 /data/jre/bin/java 
   </pre> 
</font>
<p />
<strong>WAIT</strong> until the summary tables have been created. Then you can proceed to the next step of "catching up" the <strong>gratia07</strong> database.
<p />
<h3><a name="Bring_the_gratia07_database_up_t"></a> Bring the <strong>gratia07</strong> database up to current </h3>
 Since the <strong>gratia07</strong> database is based on a nightly backup and production has been collecting data from the CE nodes, it needs to be brought up to current by replicating from <strong>gratia06</strong> to <strong>gratia07</strong> using the administrative services <strong>Replication</strong> menu.  <ul>
<li> on <a href="http://gratia.opensciencegrid.org:8880/gratia-administration" target="_top">http://gratia.opensciencegrid.org:8880/gratia-administration</a> 
</li> <li> both <strong>Job Usage</strong> and <strong>Metric</strong> replication services should be activated to replicate to:<br />     - http://gratia-fermi.fnal.gov:8884 
</li> <li> The starting <strong>dbid</strong> should be determined ( <strong>once only</strong> after the backup is restored) using the mysql client on <strong>gratia07</strong> <br />     - select max(dbid) from JobUsageRecord_Meta; <br />     - select max(dbid) from MetricRecord_Meta; <br />     
</li></ul> 
<p />
<font color="#008000"> <strong>Partially done</strong> - 6/3/08 13:45 CDT (John Weigand)
<pre>select max(dbid) from JobUsageRecord_Meta;  +-----------+ | max(dbid) | +-----------+ |  75242300 |  +-----------+  select max(dbid) from MetricRecord_Meta;  +-----------+ | max(dbid) | +-----------+ |      1506 |  +-----------+  *On gratia06:* update Replication set dbid=75242300  where openconnection='http://gratia-fermi.fnal.gov:8884' and replicationid=52;  update Replication set dbid=1506  where openconnection='http://gratia-fermi.fnal.gov:8884' and replicationid=54;  </pre>
<p />
Starting point (approx 6/3/08 14:00 CDT)
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table9" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia06 max(dbid) </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> 75,851,594 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> gratia07 max(dbid) </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> 75,242,300 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> catch up </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> 609,294 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
Catch up complete around 6/3/08 23:00 CDT
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table10" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> hour UTC </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> updates </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 12 </td>
			<td bgcolor="#f2f3f6" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 7715 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 11 </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 8224 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 10 </td>
			<td bgcolor="#f2f3f6" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 8435 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 09 </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 6962 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 08 </td>
			<td bgcolor="#f2f3f6" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 7869 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 07 </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 8005 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 06 </td>
			<td bgcolor="#f2f3f6" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 7753 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 05 </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 6874 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 04 </td>
			<td bgcolor="#f2f3f6" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 7944 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 03 </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 9629 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 02 </td>
			<td bgcolor="#f2f3f6" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 14588 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 01 </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 92283 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 080604 00 </td>
			<td bgcolor="#f2f3f6" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 89794 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 080603 23 </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 87849 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 080603 22 </td>
			<td bgcolor="#f2f3f6" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 70699 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 080603 21 </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 89476 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 080603 20 </td>
			<td bgcolor="#f2f3f6" align="right" valign="top" class="twikiTableCol1 twikiLastCol"> 89201 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> 080603 19 </td>
			<td bgcolor="#ffffff" align="right" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> 32873 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
</font>
<p />
<font color="#008000"> <strong>2nd round of "catchup" statistics</strong> <ul>
<li> started at 6/16 10:10 
</li> <li> 2M records to process 
</li> <li> at 6/16 12:46 these are the counts. 
</li></ul> 
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table11" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Period </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> JobUsage </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> Metric </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 1 hours ago </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1"> 43173 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol"> 0 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 2 hour ago </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> 35046 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> 0 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> 3 hours ago </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLast"> 7590 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> 25 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
</font>
<p />
<strong>Wait</strong> until the <strong>gratia07</strong> is caught up to the <strong>gratia06</strong> database. You can monitor this by: <ul>
<li> on <strong>gratia06</strong> <br />     - select max(dbid) from JobUsageRecord_Meta; <br />     - select max(dbid) from MetricRecord_Meta; <br />     
</li> <li> on <strong>gratia07</strong> <br />     - select max(dbid) from JobUsageRecord_Meta; <br />     - select max(dbid) from MetricRecord_Meta; <br />     
</li></ul> 
<p />
When they are close, stop the <strong>administrative update service</strong> on <ul>
<li> <a href="http://gratia.opensciencegrid.org:8880/gratia-administration" target="_top">http://gratia.opensciencegrid.org:8880/gratia-administration</a> 
</li></ul> 
<p />
The replication services should still be running to ensure we "catch up" the last of the updates on <strong>gratia06</strong> to <strong>gratia07</strong>. The replication activity shall be complete when both replication data pumps (as shown by <code>gratia-0.log</code> on gratia08) have been through at least one check-duplicate cycle without uploading records.
<p />
Then, turn off both the <strong>Job Usage</strong> and <strong>Metric</strong> replication services on: <ul>
<li> <a href="http://gratia.opensciencegrid.org:8880/gratia-administration" target="_top">http://gratia.opensciencegrid.org:8880/gratia-administration</a> for http://gratia-fermi.fnal.gov:8884. 
</li> <li> Do <strong>not</strong> delete the entries at this time.<br />     
</li></ul> 
<p />
Take note of max(dbid) in <code>JobUsageRecord_Meta</code> and <code>MetricRecord_Meta</code> on <strong>gratia07</strong>, as these numbers will be used to set up replication from <strong>gratia07</strong> back to <strong>gratia06</strong> while checksums are being upgraded on <strong>gratia06</strong>.
<p />
<h3><a name="Update_the_Replication_services"></a> Update the Replication services on <strong>gratia06</strong> to <strong>gratia07</strong> </h3>
 On <strong>gratia06</strong>, if there are <strong>Job Usage</strong> and <strong>Metric</strong> replication services active, we will need to create entries in the <strong>gratia07</strong> instance as this will shortly become our production database.
<p />
When creating these entries, we will need to insure that we start with the last record replicated from <strong>gratia06</strong>, which may not have the same dbid on gratia06 as it did on gratia07.
<p />
Instructions for doing this will be provided later if this needs to be performed for this release.
<p />
This should be done <strong>before</strong> we switch the <strong>gratia09:/data/tomcat-gratia</strong> to use the <strong>gratia07/gratia</strong> database.
<p />
The entries should be added and <strong>only</strong> a test that the entry is correct made at this time. We will set the <strong>starting dbid</strong> later and activate the entry after we switch the tomcat collectors.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Stop_gratia09_data_tomcat_gratia"></a> Stop <strong>gratia09:/data/tomcat-gratia</strong> and <strong>gratia08:/data/tomcat-conversion</strong> </span></h2>
 Stop each collector:  <ol>
<li> on <strong>gratia08</strong>  <ul>
<li> service tomcat-conversion stop 
</li></ul> 
</li> <li> on <strong>gratia09</strong>  <ul>
<li> service tomcat-gratia stop 
</li></ul> 
</li></ol> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Upgrade_the_current_gratia09_dat"></a> Upgrade the current <strong>gratia09:/data/tomcat-gratia</strong> to <strong>v0.34.9</strong> </span></h2>
 <strong>REMEMBER:  <ol>
<li> on gratia07 my.cnf, we need to eliminate the binary log files.... NO BACKUPS WILL NOT WORK W/O BINARY LOGS... AT LEAST SO FAR. 
</li> <li> on gratia06 my.cnf, we need to change the buffer size as we did on gratia07. Also need to eliminate the binary log files. This will mean stopping all collectors and bouncing the mysql. BE CAREFUL THAT BACKUPS HAVE COMPLETED. 
</li> <li> backups on gratia07 
</li></ol> 
</strong>
<p />
On gratia09: <ol>
<li> Perform the upgrade to v0.34.9  <ul>
<li> pswd=xxx 
</li> <li> source=/home/gratia/gratia-releases/gratia-v0.34.9 
</li> <li> pgm=/home/gratia/gratia-releases/gratia-v0.34.9/common/configuration/update-gratia-local 
</li> <li> $pgm -d $pswd -S $source -s gratia 
</li></ul> 
</li> <li> Effective with this release, there is an administrative login process that, by default, does not allow access to the admin functions. You will need to update the <strong><em>/data/tomcat-gratia/gratia/service-configuration.properties</em></strong> file with the following attributes. You will also need to change 2 connection attributes, as well. (Note that if you forget to do this, the administrator can be added at anytime without restarting the tomcat service):  <ul>
<li> service.admin.DN.0=/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Philippe G. Canal/CN=UID:pcanal 
</li> <li> service.admin.DN.1=/DC=org/DC=doegrids/OU=People/CN=Christopher H. Green 851859 
</li> <li> service.admin.DN.2=/DC=org/DC=doegrids/OU=People/CN=John Weigand 458491 
</li> <li> service.admin.DN.3=/DC=org/DC=doegrids/OU=People/CN=Steven Timm 74183 
</li> <li> service.admin.DN.4=/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Steven C. Timm/CN=UID:timm 
</li> <li> service.admin.DN.5=/DC=org/DC=doegrids/OU=People/CN=Dan Yocum 346615 
</li> <li> service.admin.DN.6=/DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Dan Yocum/CN=UID:yocum 
</li> <li> 
</li> <li> service.open.connection=http://gratia.opensciencegrid.org:8880 
</li> <li> service.secure.connection=https://gratia.opensciencegrid.org:8845 
</li></ul> 
</li> <li> Change the <strong>post_install.sh</strong> script to point to <strong>gratia07.fnal.gov</strong> 
</li></ol> 
<p />
<font color="#008000">Started 6/24 08:17 Done 6/24 08:24</font>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Switch_gratia09_data_tomcat_grat"></a> Switch <strong>gratia09:/data/tomcat-gratia</strong> to use the <strong>gratia07/gratia</strong> database </span></h2>
 Update the <strong>service-configuration.properties</strong> file to change the database that the production instance points to: <strong>IMPORTANT IMPORTANT... THIS MUST BE CHANGED</strong>  <ol>
<li> In <strong>gratia09:/data/tomcat-gratia/gratia/service-configuration.properties</strong>  <ul>
<li> service.mysql.url=jdbc:mysql://<font color="#ff0000">gratia07</font>.fnal.gov:3320/gratia <font color="#008000">Done 6/24 08:24</font> 
</li></ul> 
</li> <li> In <strong>gratia09:/data/tomcat-gratia/gratia/post-install.sh</strong>, change the mysql client execution <strong>from</strong> <font color="#ff0000">gratia-db01</font> <strong>to</strong> <font color="#ff0000">gratia07</font>. 
</li> <li> Start the <strong>gratia09</strong> production collector <strong>only</strong> (it will be using the <strong>gratia07</strong> database  <ul>
<li> service tomcat-gratia start 
</li></ul> 
</li></ol> 
<p />
At this point we have production gratia reporting and services back on-line and available. Verify there are no problems by tailing the log files in <strong>gratia09:/data/tomcat-gratia/logs</strong> .
<p />
<font color="#008000">Done 6/24 08:30</font>
<p />
<font color="#ff0000">Problems: <ol>
<li> <strong>catalina.out</strong> exceptions <pre>command: select T.SiteName, P.currenttime, P.probename from Probe P, Site T where P.active = 1 and T.siteid = P.siteid order by T.SiteName,P.currenttime desc java.lang.ArrayIndexOutOfBoundsException </pre> 
</li> <li> <strong>gratia-rmi-servlet0.log</strong> - coming every 10 minutes. Chris thinks from a probe. <pre>INFO: RMIHandlerServlet: Error: Problematic req: org.apache.catalina.connector.RequestFacade@564a38 Jun 24, 2008 2:29:25 PM net.sf.gratia.util.Logging info </pre>  <ul>
<li> A v0.34.9a was installed (not put in CVS) as 11:35am to trouble-shoot the problem. 
</li> <li> A new v0.34.a installed (11:47 - 11:51) with problem fixed hopefully 
</li></ul> 
</li> <li> Static reports appear to be truncating... should be landscape to fit in or scaled differently. 
</li></ol> 
</font>
<p />
If all is well, we can proceed to the v0.34.9 upgrade of the <strong>gratia06:gratia</strong> database.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Backups"></a> Backups </span></h2>
 We will need to take backups on the <strong>gratia07</strong> database for the <strong>gratia</strong> database.
<p />
And also <strong>stop</strong> the backups on <strong>gratia06</strong> for the <strong>gratia</strong> database.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Crons"></a> Crons </span></h2>
 This section can be delayed depending on the time of day.
<p />
<h3><a name="Cron_processes_during_upgrade"></a> Cron processes during upgrade </h3>
 There are several processes (cron) that will need to be copied/modified on <em>gratia06</em> and <em>gratia09</em> for reports and interfaces.  <ol>
<li> gratia06 - user gratia  <ul>
<li> APEL-WLCG interface <pre> dir=/home/gratia/interfaces/apel-lcg; cd $dir; ./lcg.sh --config=lcg.conf --date=current --update </pre> This cron process can remain on <strong>gratia06</strong>. The only modification required is to the <strong>/home/gratia/interfaces/apel-lcg/lcg-db.conf</strong> file for the following parameter:  <ul>
<li> <span class="twikiNewLink">GratiaHost<a href="/bin/edit/Accounting/GratiaHost?topicparent=Accounting.GratiaReleaseV0dot34" rel="nofollow" title="GratiaHost (this topic does not yet exist; you can create it)">?</a></span> <strong>gratia07</strong>.fnal.gov <p> <font color="#008000">Done - 6/24 13:19</font> </p> <p> </p> 
</li></ul> 
</li> <li> OSG daily reports <pre>
/home/gratia/gratia-summary/gratiaSum.cron.sh
/home/gratia/gratia-summary/daily&#95;mail&#95;cron.sh
/home/gratia/gratia-summary/range&#95;mail&#95;cron.sh --weekly
/home/gratia/gratia-summary/range&#95;mail&#95;cron.sh --monthly
/home/gratia/gratia-summary/rungratia.sh --production 
</pre> 
</li> <li> CMS weekly reports <pre>/home/gratia/gratia-summary/cms&#95;mail&#95;cron.sh --weekly</pre> <p> </p> <p> Change in /home/gratia/gratia-summary/PSACCTReport.py the </p><pre>gMySQLConnectString &#61; &#34; -h gratia-db01.fnal.gov -u reader --port&#61;3320 --password&#61;reader &#34;</pre> <font color="#008000">Done - 6/24 13:20</font> <p> </p> <p> </p> <p> </p> 
</li></ul> 
</li> <li> gratia06 - user root<br /> Database backups on <strong>gratia06</strong> will need to be changed to exclude the <strong>gratia</strong> database. This includes the purging of log files by the zrm process. <pre>/usr/local/bin/gratia_backup_cron.sh /usr/bin/mysql-zrm --action purge </pre> 
</li></ol> 
<font color="#008000">Done 06/24 12:43 - commented the <strong>gratia</strong> database backup.
<p />
However, could not really stop the purging. So copied them to <strong>/backup/mysqldb/gratia/zrm.20080624.backup</strong> to preserve them.<br />     Done 6/24 13:05 
</font>
<p /> <ol>
<li> gratia09 - user root<br /> The static reports cron on gratia09 <strong>does not</strong> require changing as it references the gratia09 gratia collector which will be pointing to the gratia07 database. 
</li> <li> gratia07 - user root<br /> A database backup cron entry needs to be <strong>added</strong> to this cron. The appropriate zrm configuration files have already been added. <pre>/usr/local/bin/gratia_backup_cron.sh /usr/bin/mysql-zrm --action purge </pre> The <strong>/usr/local/bin/gratia_backup_cron.sh</strong> script needs to be copied over from <strong>gratia06</strong> to <strong>gratia07</strong> and modified to only backup the <strong>gratia</strong> database. There should be no copies made to other machines. <p> </p> <p> </p> 
</li></ol> 
<font color="#008000">Done 6/24/08 12:40
<p />
The backups are being performed in /test/backup and then copied to /backup/zrm.gratia07 after they are compressed. This is being done as the /test file system is the only one with sufficient space for the uncompressed dump. 
</font>
<p />
<h3><a name="Nebraska_Brian_Bockelman_interfa"></a> Nebraska (Brian Bockelman) interfaces </h3>
 Notify Brian to effect the changes necessary for his processes to use the <strong>gratia07:3320</strong> database
<p />
<font color="#008000">Done on 6/20. Had Brian do this early. Re-verified on 6/24</font>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Upgrade_the_gratia06_database"></a> Upgrade the gratia06 database </span></h2>
<h3><a name="Manual_mysql_client_updates"></a> Manual mysql client updates </h3>
 The first thing that has to be done is to bounce the gratia06 database to allow the new my.cnf entries to take affect. <pre>innodb_buffer_pool_size = 768M </pre> This parameter was expended from 512 to 768 to hopefully avoid the table lock problem experienced on gratia07 last week.
<p />
The use of binary log files has been left in effect as they are needed for backups.
<p />
<font color="#008000">Started: 6/24 14:03 Ended: 6/14 14:06</font>
<p />
Perform a manual mysql client execution of the following so we reduce the time for the tables to be changed. The hibernate instance single threads these.
<pre>alter table JobUsageRecord_Meta add column GridDescription varchar(255),  add column md5v2 varchar(255), add index index17(md5v2);    </pre>
<p />
<strong>MUST WAIT FOR THIS TO FINISH</strong>
<p />
<font color="#008000">Started: 6/24 14:20 Completed: 6/26 12:59 Elapsed: 46:39 </font>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Switch_the_current_gratia08_data"></a> Switch the current <strong>gratia08:/data/tomcat-conversion</strong> to use the <strong>gratia06/gratia</strong> database </span></h2>
 Update <strong>gratia08:/data/tomcat-conversion/gratia/service-configuration.properties</strong> to point to the <strong>gratia06/gratia</strong> database:  <ul>
<li> service.mysql.url=jdbc:mysql:// <strong>gratia06</strong>.fnal.gov:3320/gratia 
</li></ul> 
<p />
In <strong>post-install.sh</strong>, change the mysql client execution <strong>from</strong> <font color="#ff0000">gratia-db01</font> <strong>to</strong> <font color="#ff0000">gratia06</font>.
<p />
On <strong>gratia08</strong> ,start the newly-upgraded tomcat-conversion collector <ul>
<li> service tomcat-conversion start 
</li></ul> 
<p />
<strong>MUST WAIT FOR THE SUMMARY TABLE TO BE BUILT AND THE NEW CHECKSUM CALCULATIONS TO START.</strong>
<p />
<font color="#008000">Started: 6/26 14:05 Ended: 6/27 15:00 Elapsed: 24:55
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table12" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Table </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> Started </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2"> Completed </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol3 twikiLastCol"> Elapsed </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> ProbeStatus </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1"> 6/26 14:05 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2"> 6/26 16:31 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol3 twikiLastCol"> 02:26 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> MasterSummaryData </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLast"> 6/26 16:31 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLast"> 6/27 15:00 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol3 twikiLastCol twikiLast"> 22:29 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
</font>
<p />
<font color="#008000"> <strong>Checksum calculation progress (number of records: 76,015,870 ):</strong> 
 
<p />
<div class="editTable">
<form name="edittable1_Accounting_GratiaReleaseV0dot34" action="https://twiki.opensciencegrid.org/bin/viewauth/Accounting/GratiaDbUpgradeV0dot34dot7#edittable1" method="post">
<input type="hidden" name="ettablenr" value="1" />
<input type="hidden" name="etedit" value="on" />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table13" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=0;table=13;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Time</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=1;table=13;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Current record</font></a> </th>
			<th bgcolor="#99CCCC" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Accounting/GratiaReleaseV0dot34?cover=print;sortcol=2;table=13;up=0#sorted_table" title="Sort by this column"><font color="#252b37">% Complete</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Jun 27 15:00 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> &nbsp; </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> &nbsp; </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Jun 30 09:34:12 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 18,995,566 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol"> 23% </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 1 16:01 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 27,331,103 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> 24% </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 2 08:39 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 29,731,103 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol"> 39% </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 2 04:13 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 30,831,203 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> 40% </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 2 08:16 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 31,841,303 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol"> 42% </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 3 08:35 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 38,686,103 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> 50% </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 7 13:20 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 66,110,503 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol"> 86% </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 8 09:23 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 71,132,503 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol"> 93% </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 9 01:24 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 75,226,303 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLastCol"> 99% </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Jul 9 03:30 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1 twikiLast"> approximately </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> 100% </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<input type="hidden" name="etrows" value="12" />
<input class="twikiButton editTableEditButton" type="submit" value="Edit table" /> </form>
</div><!-- /editTable -->
<p />
</font>
<p />
<font color="#ff0000">June 30 10:15 - Logging was turned down from FINEST to FINE on the tomcat-collector so progress can no longer be measured using the log file. This was done in attempt to improve performance. The alternative is to perform a query on the database "Select cnt(*) from JobUsageRecord _Meta where md5v2 is NULL;</font>
<p />
<font color="#ff0000">July 9 08:30 - Logging turned back up from FINE to FINEST to be able to view progress in duplicate resolution phase of the checksum upgrade. <br /></font>
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="1" id="table14" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Date </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> Total </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> Dups </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol3"> Remaining </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4"> %_Compl </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol5"> Elapsed_Hrs </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol6"> Processed </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol7"> Rate_per_hr </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol8 twikiLastCol"> ETC </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 09 03:30 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFFF" colspan="7" valign="top"> Started </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 09 08:50 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFCC" colspan="7" valign="top"> 24,722 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 09 10:58 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFFF" colspan="7" valign="top"> 30,737 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 09 13:02 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFCC" colspan="7" valign="top"> 40,737 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 09 20:00 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> 160741 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> 948348 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol4"> 14.4931 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5"> 7.6514 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol6"> 130004 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol7"> 16990.9022 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol8 twikiLastCol"> 55 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 10 00:00 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> 229742 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 879347 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4"> 20.7145 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5"> 11.6514 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol6"> 199005 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol7"> 17079.9380 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol8 twikiLastCol"> 51 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 10 04:00 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> 280744 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> 828345 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol4"> 25.3130 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5"> 15.6517 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol6"> 250007 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol7"> 15973.1871 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol8 twikiLastCol"> 51 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 10 08:00 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> 290744 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 818345 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4"> 26.2147 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5"> 19.6514 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol6"> 260007 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol7"> 13230.9732 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol8 twikiLastCol"> 61 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 10 12:00 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> 349228 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> 759861 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol4"> 31.4878 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5"> 23.6511 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol6"> 318491 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol7"> 13466.2172 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol8 twikiLastCol"> 56 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 10 16:00 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> 417513 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 691576 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4"> 37.6447 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5"> 27.6517 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol6"> 386776 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol7"> 13987.4390 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol8 twikiLastCol"> 49 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 10 20:00 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> 480748 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> 628341 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol4"> 43.3462 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5"> 31.6514 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol6"> 450011 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol7"> 14217.7331 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol8 twikiLastCol"> 44 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 11 00:00 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> 542463 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 566626 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4"> 48.9107 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5"> 35.6514 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol6"> 511726 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol7"> 14353.6063 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol8 twikiLastCol"> 39 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 11 04:00 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2"> 590750 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3"> 518339 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol4"> 53.2644 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5"> 39.6517 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol6"> 560013 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol7"> 14123.3155 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol8 twikiLastCol"> 36 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol0 twikiFirstCol"> Jul 11 08:00 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol1"> 1109089 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol2"> 600750 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol3"> 508339 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol4"> 54.1661 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol5"> 43.6514 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol6"> 570013 </td>
			<td bgcolor="#FFFFCC" align="right" valign="top" class="twikiTableCol7"> 13058.3016 </td>
			<td bgcolor="#FFFFCC" valign="top" class="twikiTableCol8 twikiLastCol"> 38 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Jul 13 12:00 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol1 twikiLast"> 1109089 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol2 twikiLast"> 1100758 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol3 twikiLast"> 8331 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol4 twikiLast"> 99.2488 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol5 twikiLast"> 95.6514 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol6 twikiLast"> 1070021 </td>
			<td bgcolor="#FFFFFF" align="right" valign="top" class="twikiTableCol7 twikiLast"> 11186.6750 </td>
			<td bgcolor="#FFFFFF" valign="top" class="twikiTableCol8 twikiLastCol twikiLast"> 0 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
Started: Jul 09 03:30 Completed: Jul 13 12:00 Elapsed: 4 days 08:00 hours
<p />
</font>
<p />
<strong>MUST WAIT FOR CHECKSUM CALCULATIONS TO COMPLETE ALL THE WAY THROUGH THE FINAL RESOLUTION PHASE.</strong>
<p />
<font color="#008000"> <strong>Created unique index on md5v2:</strong>
<p />
Started: Jul 13 12:00 Completed: Jul 21 17:20 Elapsed: 8 days 05:20 hours
<p />
Comment: This took unexpectedly long presumably because this entailed a complete reorg of the JobUsageRecord _Meta table which had grown in size to 45Gb during the checksum resolution phase. Upon completion (with the optimization), it was reduced to 31Gb in size.
<p />
</font>
<p />
<font color="#008000"> <strong>Drop old md5 index:</strong>
<p />
Started: Jul 21 17:20 Completed: Jul 23 14:20 Elapsed: 1 day 21:00 hrs
<p />
</font>
<p />
<strong>MUST WAIT FOR THIS TO COMPLETE</strong>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Backup_the_gratia06_gratia_datab"></a> Backup the gratia06/gratia database </span></h2>
<p />
At this point and considering the length of time to get here, a database backup is critical.
<p />
As the other databases on gratia06 already have cron scheduled backups occuring, we may have to improvise a little on how we do this depending on the time of day.
<p />
The cron job that is executed nightly is: <ul>
<li> 43 2 * * * /usr/local/bin/gratia_backup_cron.sh 
</li></ul> 
<p />
At this point, the specifics on the "how" will be left open as it will depend on when the step can be started. Running from cron is recommended however to avoid any problems should the machine go down during the upgrade.
<p />
<strong>MUST WAIT FOR THE BACKUP TO COMPLETE THE MYSQLDUMP PHASE.</strong>
<p />
<font color="#008000">
<p />
Started: Jul 23 14:45
mysqldump phase ended Jul 23 18:41
Elapsed: 3:56
<p />
</font>
<p />
<strong>WE CAN PROCEED ONCE IT GETS INTO THE COMPRESSION PHASE.</strong>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="2nd_Upgrade_of_gratia08_data_tom"></a> 2nd Upgrade of gratia08:/data/tomcat-conversion to v0.36 </span></h2>
<p />
Due to the extraordinary duration of the v0.34.9 upgrade and due to some new features in v0.36 that will improve performance during the "catch-up" phase, we will upgrade the <strong><em>gratia08:/data/tomcat-conversion</em></strong> services to v0.36 before activating the replication in the next step.
<p />
To install the new software on the Gratia <strong><em>gratia08:tomcat-conversion</em></strong> instance, run the following script on <strong><em>gratia08</em></strong> as <strong><em>root</em></strong> user: <ul>
<li> /home/gratia/gratia-builds/gratia-latest/build-scripts/gratia-upgrade.sh 
</li></ul> 
<p />
The responses to the questions are: <ul>
<li> collector?: <strong><em>tomcat-conversion</em></strong> 
</li> <li> source directory?: <strong><em>releases</em></strong> 
</li> <li> release?: <strong><em>v0.36</em></strong> 
</li> <li> root MySql password: <strong><em>(you better know it)</em></strong> 
</li></ul> 
<p />
<strong>Do not start the collector until the following are verified</strong>: <ul>
<li> it is pointing to gratia06 mysql database and NOT gratia07 
</li> <li> the lifetime parameters on JobUsageRecord retention are the desired ones 
</li></ul> 
<p />
<font color="#008000">
<p />
Parameter changes: <ul>
<li> DB connection parameters verified to be gratia06:3320.
</li> <li> JUR lifetime set to 6 months.
</li> <li> Procedure-specific Trace lifetime setting removed to avoid triggering (minor) bug.
</li> <li> Log files set to 5 vs 3.
</li> <li> Queue size set to 100K.
</li> <li> Safe mode set to 1.
</li></ul> 
</font>
<p />
With v0.36, the upgrade will require the following schema changes: <ul>
<li> the addition of a new column ( <strong><em>SummaryID</em></strong>) to the <strong><em>MasterSummaryData</em></strong> table with a new <strong><em>unique index</em></strong> on this column as it will be the primary key. 
</li> <li> addition of a new table ( <strong><em>NodeSummary</em></strong>) 
</li></ul> 
<p />
<strong>MUST WAIT FOR THESE SCHEMA CHANGES TO COMPLETE.</strong>
<p />
<font color="#008000">
Collector started at Jul 23 20:21:43<br />    
<font color="#ff0000">Upgrade FAILED at Jul 23 20:28:22 due to mis-configured post-install.sh</font><br />    
Collector restarted at Jul 23 20:33:38, went into safe-start at Jul 23 20:34:41.
</font>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Start_replication_from_productio"></a> Start replication from production collector to upgrade collector. </span></h2>
<p />
Before we can switch production back to using <strong>gratia06/gratia</strong>, we need to perform a "catch-up" by replicating from <strong>gratia07/gratia</strong> to <strong>gratia06/gratia</strong>.
<p />
To do this we need to activate the replication of JobUsageRecord table records using the <strong>gratia09:/data/tomcat-gratia</strong> service.
<p />
The dbid to start with was determined in an earlier step when we switched to using gratia07. <ul>
<li> the last dbid at that time on gratia07 was <strong>79801016</strong>    <font color="#008000">  <strong>VERIFIED</strong>  CG 2008/07/23 </font>
</li> <li> We do not have to do MetricRecords as there should be no MetricRecords. Those that are there are a mistake 
</li></ul> 
<p />
Using the UI on <a href="http://gratia.opensciencegrid.org:8880/gratia-administration" target="_top">http://gratia.opensciencegrid.org:8880/gratia-administration</a> (this is pointing to the <strong>gratia07</strong> database): <ul>
<li> create a replication entry pointing to <strong><a href="http://gratia08.fnal.gov:8884" target="_top">http://gratia08.fnal.gov:8884</a></strong> (this is pointing to the <strong>gratia06</strong> database). 
</li> <li> test it 
</li> <li> then using a MySql client, update the dbid to <strong>79801016</strong>:    <pre>update Replication set dbid=79801016 where openconnection='http://gratia-fermi.fnal.gov:8884'; </pre> 
</li> <li> start the replication in the UI 
</li></ul> 
<p />
<font color="#008000">Replication started from <a href="http://gratia.opensciencegrid.org:8880" target="_top">http://gratia.opensciencegrid.org:8880</a> to <a href="http://gratia08.fnal.gov:8884" target="_top">http://gratia08.fnal.gov:8884</a> at Jul 23 21:15<br />    
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table15" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> Date </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> count(*) </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 2008-07-24 13:00:00 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> 24658 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 2008-07-24 12:00:00 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> 57519 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 2008-07-24 11:00:00 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> 50869 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 2008-07-24 10:00:00 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> 44378 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 2008-07-24 09:00:00 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> 37886 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 2008-07-24 08:00:00 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> 42897 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 2008-07-24 07:00:00 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> 74025 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 2008-07-24 06:00:00 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> 80757 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 2008-07-24 05:00:00 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> 89247 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> 2008-07-24 04:00:00 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> 85363 </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> 2008-07-24 03:00:00 </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> 77831 </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> 2008-07-24 02:00:00 </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> 35706 </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
Replication completed: Jul 30 06:00 (approx)<br />    
Elapsed: 6 days 09:15 hours   (153.5 hrs)<br />    
Records replicated: 8,522,056  as of Jul 30 08:50<br />    
Average Rate: 55,518 / hr<br />    
<p />
</font>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Monitor_catch_up_progress_on_gra"></a> Monitor "catch-up" progress on gratia06/gratia and stop replication when done </span></h2>
Towards the end of the upgrade of <strong>gratia06/gratia</strong>, updates to the DB will be stopped pending a final duplicate resolution phase and conversion of the index on <code>md5v2</code> to unique.
<p />
Between this happening and the listener queue hitting its threshold, replication from <strong>gratia09:/data/tomcat-gratia</strong> to <strong>gratia08:/data/tomcat-conversion/gratia</strong> should be stopped.  <font color="#008000"> DONE: 7/30 18:45</font>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Switch_the_current_gratia09_data"></a> Switch the current <strong>gratia09:/data/tomcat-gratia</strong> to use the <strong>gratia06/gratia</strong> database </span></h2>
 To switch-over the tomcat collectors:  <ol>
<li> Delete the replication data entries in both collectors so they are no longer pointing to each other <ul>
<li> gratia08:/tomcat-conversion <font color="#008000">Has already beed removed (7/30 19:13 confirmed JGW)</font>
</li> <li> gratia09:/tomcat-gratia <font color="#008000"> Removed entry 7/30 19:14   Last dbid replicated: 89980675 </font>
</li></ul> 
</li> <li> Stop each collector  <ul>
<li> on <strong>gratia08</strong> <br />     - service tomcat-conversion stop  <font color="#008000">  Jul 30 19:19   </font>
</li> <li> on <strong>gratia09</strong> <br />     - service tomcat-gratia stop  <font color="#008000">  Jul 30 19:21   </font>
</li></ul> 
</li> <li> Upgrade tthe gratia09:tomcat-gratia to v0.36 (do not start)  <font color="#008000">  Jul 30 19:23   </font>
</li> <li> Update the <strong>service-configuration.properties</strong> file to change the databases they point to  <ul>
<li> on <strong>gratia08:/data/tomcat-conversion/gratia</strong> <br />     - service.mysql.url=jdbc:mysql:// <strong>xxxxx</strong>.fnal.gov:3320/xxxxx  <font color="#008000">  Jul 30 19:19   </font>
</li> <li> on <strong>gratia09:/data/tomcat-gratia/gratia</strong> <br />     - service.mysql.url=jdbc:mysql:// <strong>gratia06</strong>.fnal.gov:3320/gratia   <font color="#008000"> Verified (JGW) Jul 30 19:27   </font>
</li>  </ul><ol>
<li> Start the <strong>gratia09</strong> production collector <strong>only</strong> (it will be using the <strong>gratia06</strong> database 
</li>  </ol><ul>
<li> on <strong>gratia09</strong> <br />     - service tomcat-gratia start   <font color="#008000">  Jul 30 19:29   </font>
</li> <li> turn housekeeping off <font color="#008000">  Jul 30 19:33  </font>
</li></ul> 
</li> <li> Verified gratia08:tomcat-conversion is not set to restart at any run level      <pre>
[root@gratia08 init.d]# chkconfig --list tomcat-conversion
tomcat-conversion       0:off   1:off   2:off   3:off   4:off   5:off   6:off
</pre>
</li></ol> 
<p />
<p />
<p />
At this point production gratia reporting and services area back on-line and available and using the <strong>gratia06</strong> database
<p />
Verify there are no problems by tailing the log files in <strong>gratia09:/data/tomcat-gratia/logs</strong> .<br />     
<font color="#008000">EVERYTHING LOOKS GOOD!  HOORAY!!!  07/30 07:35 </font>
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Backups_for_switchback"></a> Backups for  switchback </span></h2>
 We will need to <strong>start</strong> the backups on <strong>gratia06</strong> for the <strong>gratia</strong> database.<br />    
<font color="#008000">They were started back when we started the "catchup" phase</font>
<p />
And <strong>deactivate</strong> the backups on the <strong>gratia07</strong> database for the gratia database.<br />    
<font color="#008000"> Commented root cron for backups on gratia07   -  Jul 30 19:56</font>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Crons_switchback"></a> Crons - switchback </span></h2>
<h3><a name="Cron_processes"></a> Cron processes </h3>
 There are several processes (cron) that will need to be copied/modified on <em>gratia06</em> and <em>gratia09</em> for reports and interfaces.  <ol>
<li> gratia06 - user gratia  <ul>
<li> APEL-WLCG interface - This cron process remained on <strong>gratia06</strong>. The only modification required is to the <strong>/home/gratia/interfaces/apel-lcg/lcg-db.conf</strong> file for the following parameter to point it back to the <strong>gratia06</strong> database.  <ul>
<li> <span class="twikiNewLink">GratiaHost<a href="/bin/edit/Accounting/GratiaHost?topicparent=Accounting.GratiaReleaseV0dot34" rel="nofollow" title="GratiaHost (this topic does not yet exist; you can create it)">?</a></span> <strong>gratia-db01</strong>.fnal.gov <p> </p>  %COLOR%7/30 20:03</font>
</li></ul> 
</li> <li> OSG daily reports  - <font color="#008000"> in /home/gratia/gratia-summary/Gratia.C changed '   static TSQLServer *db = TSQLServer::Connect("mysql://gratia06.fnal.gov:3320/gratia","reader", "reader");' - Jul 30 20:18 </font>
</li></ul> 
</li></ol> 
<pre>
/home/gratia/gratia-summary/gratiaSum.cron.sh
/home/gratia/gratia-summary/daily&#95;mail&#95;cron.sh
/home/gratia/gratia-summary/range&#95;mail&#95;cron.sh --weekly
/home/gratia/gratia-summary/range&#95;mail&#95;cron.sh --monthly
/home/gratia/gratia-summary/rungratia.sh --production 
</pre>  <ul>
 <li>
 <ul>
<li> CMS weekly reports <font color="#008000"> 7/30 20:12 - Moved /home/gratia/gratia-summary/PSACCTReport.py.gratia06.2  PSACCTReport.py</font>      <pre>
/home/gratia/gratia-summary/cms&#95;mail&#95;cron.sh --weekly
</pre> 
</li></ul> 
</li>  </ul><ol>
<li> gratia06 - user root<br /> Database backups on <strong>gratia06</strong> will need to be changed to now include the <strong>gratia</strong> database. This includes the purging of log files by the zrm process.  <font color="#008000">These were activated when the catchup phase started.</font>
</li></ol> 
<pre>/usr/local/bin/gratia_backup_cron.sh /usr/bin/mysql-zrm --action purge </pre> 
<p> </p> <p> </p>  <ol>
<li> gratia09 - user root<br /> The static reports cron on gratia09 <strong>did not</strong> require changing as it references the gratia09 gratia collector which will now be pointed back to the gratia06 database. <p> </p> <p> </p> 
</li> <li> gratia07 - user root<br /> This database backup cron entry needs to be <strong>removed</strong> from this cron.  The <strong>/usr/local/bin/gratia_backup_cron.sh</strong> script can be removed as well.  <font color="#008000"> root cron commented out - 7/30 20:14 </font> 
</li></ol> 
<pre>/usr/local/bin/gratia_backup_cron.sh /usr/bin/mysql-zrm --action purge </pre>
<p />
<p />
<h3><a name="Nebraska_Brian_Bockelman_int_AN1"></a> Nebraska (Brian Bockelman) interfaces </h3>
 Notify Brian to switch back to using <strong>gratia-db01:3320</strong> database. <font color="#008000"> DONE: 7/30 20:07 </font>
<p />
<!-- ----------------- POST MORTEM  ------------- -->
<h1><a name="Post_mortem_AN1"></a> Post-mortem </h1>
 At this time, this will appear to be random notes. After the conversion, they may be organized.
<p /> <ol>
<li> <strong>catalina.out</strong> exceptions <pre>command: select T.SiteName, P.currenttime, P.probename from Probe P, Site T where P.active = 1 and T.siteid = P.siteid order by T.SiteName,P.currenttime desc java.lang.ArrayIndexOutOfBoundsException </pre> <p> </p> <p> Chris is creating a patched v0.34.9a without putting things in CVS so we can troubleshoot this and not destroy our real v0.34.9 set. </p> <p> </p> <p> </p> 
</li> <li> <strong>gratia-rmi-servlet0.log</strong> - coming every 10 minutes. Chris thinks from a probe. <pre>INFO: RMIHandlerServlet: Error: Problematic req: org.apache.catalina.connector.RequestFacade@564a38 Jun 24, 2008 2:29:25 PM net.sf.gratia.util.Logging info </pre> <p> </p>  <ul>
<li>  <ul>
<li> 11:35 - 11:39: A v0.34.9a was installed (not put in CVS) to trouble-shoot the problem. 
</li> <li> 11:47 - 11:51: A new v0.34.a installed with problem fixed hopefully. Chris fix. 
</li> <li> 13:34 - 13:51: another new install 
</li></ul> 
</li></ul> 
</li></ol> 
<p />
<p /> <ol>
<li> Static reports appear to be truncating... should be landscape to fit in or scaled differently. 
</li></ol> 
<p />
<p />
<p />
<p />
<p />
<!-- MAJOR UPDATES
For significant updates to the topic, consider adding your 'signature' (beneath this editing box) !-->
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Major_updates"></a>  Major updates </span></h2>
 <!--Future editors should add their signatures beneath yours!--> -- <a href="/bin/view/Main/JohnWeigand" class="twikiLink">JohnWeigand</a> - 15 May 2008</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Accounting<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Accounting/WebHome" class="twikiCurrentWebHomeLink twikiLink">WebHome</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GratiaReleaseV0dot34</span> <br />    
Topic revision: r69 - 11 Dec 2008 - 18:51:44 - <a href="/bin/view/Main/KyleGross" class="twikiLink">KyleGross</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />