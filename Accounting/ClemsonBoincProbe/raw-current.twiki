---+!!Clemson Gratia Probe Development Documentation

This is an article designed to facilitate the general creation of Gratia probes by aggregating the information gathered from the development of one specific probe. The probe in question was made for boinc jobs run via Condor on Clemson University&#39;s network. The Gratia program has dependencies that keep it running on Linux systems, but for non-rpm-based package managers (like ones on Arch,) manual setup of the probe is necessary. Since the Condor pool on Clemson consists of mostly windows machines, it was necessary to make a script to upload the logs to a central location. 

&lt;center&gt;
&lt;img src=&quot;%ATTACHURL%/boincprobediagram.png&quot; width=&quot;25%&quot; height=&quot;25%&quot;&gt;
&lt;/center&gt;

It is useful to take a look at the Gratia API before starting. There is a minimal example located on that page that will give you a vague outline of how a probe is structured. The general rule of thumb is that the more data the better, but not everything is necessary. In order to create a valid Gratia submission, one needs the following fields:

&lt;table&gt;
&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;EndTime&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        The epoch time that the job ended.
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;ProbeName&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        The name of your probe. Typically entered in the ProbeConfig file.
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;ResourceType&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        The type of resource that is being logged. Redundant when the UsageRecord function is called.
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;Njobs&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        Number of jobs run.
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;WallDuration&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        Wallclock seconds that the job was run
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;CpuUserDuration&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        Interchangeable with CpuDuration(self, time, &#39;user&#39;), defines amount of processor time spent on 	the job
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;CpuSystemDuration&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        Interchangeable with CpuDuration(self, time, &#39;system&#39;), defines amount of processor time spent 	not working on the job while the job was pending completion.
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;UsageRecord&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        Defines the type of record to be sent. In the Clemson probe, this field is set to &#39;Condor.&#39;
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;LocalJobId&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        The job ID for the local computation system. In the Clemson probe, this is is the Condor job ID.
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;StartTime&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        The time epoch at the beginning of the job&#39;s submission.
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;LocalUserId&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        The user responsible for the local job submission. In the Clemson probe, all boinc jobs launched via condor run from the &#39;labuser&#39; user. 
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;MachineName&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        The name of the overall compute resource that the probe is reporting statistics from. Set to 	&#39;clemson-boinc.&#39; 
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;Host&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        The actual machine hostname on which the job ran. 
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;pre&gt;VOName&lt;/pre&gt;&lt;/td&gt;&lt;td&gt;
        The Virtual Organization in which the computation statistics are to be attributed.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;


In addition to those fields, it is recommended that this line be added to the very beginning of your submission script:

&lt;pre&gt;
 rev = &quot;$Revision: 1.2 $&quot; 
 Gratia.RegisterReporterLibrary(&quot;&lt;Name of Probe File&gt;&quot;,Gratia.ExtractSvnRevision(rev))
&lt;/pre&gt;
           ** Note: The two fields (CpuUserDuration and CpuSystemDuration) are very useful to OSG, but the logs that the Clemson pool is generating do not facilitate this kind of information. Therefore, the user time is set to the walltime and the system time is set to zero. This is a workaround and should be avoided if possible. Also, Some of these fields require either an int or a dateTime string.


[[http://gratia.svn.sourceforge.net/viewvc/gratia/trunk/probe/boinc/ The probe code itself can be found here]]


-- Main.BenjaminSterrett - 19 Jan 2010

