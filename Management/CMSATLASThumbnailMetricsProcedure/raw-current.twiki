&lt;table width=&quot;100%&quot;&gt;
&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;
&lt;/td&gt;
&lt;td valign=&quot;top&quot;&gt;
---+!! Documentation for CMS &amp; ATLAS Thumbnail Metrics
%TOC%
&lt;/td&gt;
&lt;td valign=&quot;top&quot; align=&quot;right&quot; width=&quot;25%&quot;&gt;
%TABLE{ sort=&quot;off&quot; dataalign=&quot;left&quot; tableborder=&quot;0&quot; cellpadding=&quot;1&quot; cellspacing=&quot;3&quot; headerbg=&quot;#F3EDE7&quot; databg=&quot;#F3EDE7&quot;}%
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
%STARTINCLUDE%



Every month Thumbnails and Images are posted to www.opensciencegrid.org for CMS and ATLAS.  The following steps outline the procedure for turning the data into the appropriate images and uploading them to the website. 

---++Scope
To make available and accessible to the public the trend in CMS and ATLAS usage of OSG in various parameters over the past six months. 

---++ Getting the Monthly Data
Attached to the bottom of this page is a python script named &quot;osg_metric_thumbnails.py.txt&quot;.  Download this script to any Linux system and rename it &quot;osg_metric_thumbnails.py&quot;.

Execute the script using python specifying the start and end dates (&quot;python osg_metric_thumbnails.py 2009-09 2009-10&quot;; months are inclusive).  This will take approximately 5 minutes to run for 1 month.  Below is an example command-line session using flxi02.fnal.gov:

&lt;verbatim&gt;
$ curl https://twiki.grid.iu.edu/twiki/pub/Management/CMSATLASThumbnailMetricsProcedure/osg_metric_thumbnails.py.txt &gt; osg_metric_thumbnails.txt
$ python osg_metric_thumbnails.py 2009-09 2009-09
Job Statistics for 2009-09-01 to 2009-10-01.
	CMS total wall hours: 6488434
	ATLAS total wall hours: 5765080
	CMS 6 months total wall hours: 31391877
	ATLAS 6 months total wall hours: 31305248
	CMS job count: 1755269
	ATLAS job count: 3008177
	% non-CMS work on CMS sites: 22
	% non-ATLAS work on ATLAS sites: 27
	CMS % wall time on owned sites: 96.88
	ATLAS % wall time on owned sites: 99.23
	CMS Average # of CPUs used: 9011
	ATLAS Average # of CPUs used: 8007
	From US sites: 2.473 PB
	To US sites: 1.540 PB
	T0 to BNL: 0 GB
	BNL to/from USATLAS T2s: 253037 GB
	ATLAS Transfer Total: 0.253 PB
&lt;/verbatim&gt;

---++Formatting the Excel Charts from the Data
The Area Coordinator for Metrics and Measurements (contact available at http://www.opensciencegrid.org/Consortium_Mailing_Lists  with OSG-WLCG-REPORTS email extension), will send via email monthly metrics for both CMS &amp; ATLAS after the 1st of each month.  The data in the excel spreadsheet is then converted into an Excel Chart Graph.  Below is a detailed explanation of the procedure for converting the data into the excel charts.  
   
   A. Receive the data formatted by each type of graph with the corresponding information and dates.  
&lt;img align=&quot;right&quot; src=&quot;%ATTACHURLPATH%/CMSATLAS_Thumbnail_picture.png&quot;/&gt;
   
   B. Listed are the 6 types of graphs for both CMS and ATLAS, as well as the chart type used for display.
	   1. Wall Clock Hours – Stacked Column
	   1. Six Month Sum of Wall Clock Hours – Stacked Column
	   1. Number of Jobs – Stacked Column
	   1. Usage Type at CMS/ATLAS Sites – 100% Stacked Column	
	   1. Average Number of CPUs Delivered – Stacked Column
	   1. Petabytes Moved – Stacked Column

   C. Use the following when creating the charts:
	   a. Type (Indicated above): Stacked Column
	   a. Data Range: By Rows
	   a. Gridlines: Value Y Major Gridlines
	   a. Axes: 
		   i. Category X - Automatic
		   i. Category Y – Yes
	   a. Formatting
		   i. Axis: Calibri Regular, Size 10 Font
		   i. Plot Area: White color
		   i. Chart Title: Calibri Bold, Size 18 Font, Centered
	   a. Size each graph so that all 6 can fit within one window.



---++Posting CMS &amp; ATLAS Images on OSG Web
MAT 6/1/09


*Working with the images*
   1. In Excel, select the sheet for the appropriate graph.
   1. Save the file as PDF
   1. Send the saved PDF to the Executive Director (contact available at http://www.opensciencegrid.org/About/Contact_Us/Contacts) and osg-wlcg-reports@opensciencegrid.org.  
   1. Wait one week for any response, if nothing than continue with process to post. 
   1. Open the file in Adobe Acrobat, then re-save the file as a PNG.
   1. In Photoshop, open the PNG image and crop off the extra white space.  
   1. Create a new image with dimensions 800px wide with a white background.
   1. Save the 800-pixel-width image to CMS_jan09.png or as appropriate. 
   1. Using the above image, resize it to be 158 px high. 
   1. Create a new image with a white background that is 254 px wide x 158 px high. Copy and paste the reduced-size image from previous step into this window. There will be extra white space on the sides. Move the image so that it is close to the left border, like this:
   1. Save the above image as ATLAS.png or CMS.png. (They are case-sensitive.)
   1. Follow the same procedures for the next graph.


*Moving images to gratia server*
   1. Using AFS Client, you will want to copy the files, CMS.png, ATLAS.png, CMS_jan09.png and ATLAS_jan09.png to your AFS home directory: /afs/fnal.gov/files/home/room1/jemise.
   1. Using WRQ, open a connection to flxi02.fnal.gov. 
   1. Go to gratia LHC Metrics directory. Type:

cd /afs/fnal.gov/files/expwww/gratia/html/Files/osg_gratia_ display/LHC_Metrics

cp ~/ATLAS.png . 
cp ~/CMS.png .
cp ~/ATLAS_jan09.png .
cp ~/CMS_jan09.png .


*Editing web archive page*
   1. Login to CMS: www.opensciencegrid.org/Login
   1. Go to www.opensciencegrid.org/?pid=1000346, and edit
   1. Click ‘insert image’ icon:

Image URL (should always stay the same) [[http://gratia.fnal.gov/Files/osg_gratia_display/LHC_Metrics/ATLAS_sept08.png][http://gratia.fnal.gov/Files/osg_gratia_display/LHC_Metrics/ATLAS.png ]]

   * Image Description: ATLAS Metrics
   * Click “Appearance” tab.
   * Set Dimensions to 201 px wide x 158 px high. 
   * Click “Insert” button.
   * Follow the same procedures for CMS image.

   2. Link thumbnails to full-size images:

   * Select ATLAS image and click hyperlink icon
   * Link URL: [[http://gratia.fnal.gov/Files/osg_gratia_display/LHC_Metrics/ATLAS_sept08.png][http://gratia.fnal.gov/Files/osg_gratia_display/LHC_Metrics/ATLAS_sept08.png ]](substitute ‘sept08’ for correct month and year)
   * Target:  “Open in new window (_blank)
   * Click “Insert” button.
   * Follow same procedure for CMS image.
   * Click “Save” to save web page.


*Confirmation Process*
&lt;BR&gt;To confirm the process was complete and the updated documents were uploaded to the server be sure to check your work. 

   1. Wait atleast one hour, or until the next day in order to give the server time to load.
   1. Go to www.opensciencegrid.org
   1. Open all relevant pages and check that the updated documents are available. 



-- Main.MarciaTeckenbrock - 13 Jan 2010

