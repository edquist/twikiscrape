<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> HTCondorCERoutes &lt; Documentation &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Documentation/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Documentation/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Documentation/HTCondorCERoutes?_T=16 Feb 2017" type="application/x-wiki" title="edit HTCondorCERoutes" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Documentation/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Documentation/HTCondorCERoutes"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFFF99;
	}
	.patternBookView {
		border-color:#FFFF99;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <link rel="stylesheet" type="text/css" href="https://twiki.opensciencegrid.org/twiki/pub/Documentation/Tools/exercises.css">
<p />
<h1><a name="HTCondor_CERoutes"></a>  HTCondor CERoutes </h1>
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Customization_using_the_Config_F"> Customization using the Config File</a>
</li> <li> <a href="?cover=print#Customization_using_Job_Hooks"> Customization using Job Hooks</a>
</li> <li> <a href="?cover=print#Customizing_Submit_Files"> Customizing Submit Files</a>
</li></ul> 
</div>
<p />
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Customization_using_the_Config_F"></a> Customization using the Config File </span></h2>
<p />
A job is localized by the JobRouter, which matches it to one <strong>job route</strong>, then applying the transformations specified in the route.  The most common way to specify a route is via the HTCondor configuration file.  See the <a href="http://research.cs.wisc.edu/htcondor/manual/v8.0/5_4HTCondor_Job.html" target="_top">HTCondor documentation</a> for a full reference on job routes. Note: it refers to the current stable realease of HTCondor v8.0.x.
<p />
Assuming HTCondor collector for grid pool running on the same host, for example here is the default route for a HTCondor site:
<pre>
JOB&#95;ROUTER&#95;ENTRIES &#61; \
   &#91; \
     GridResource &#61; &#34;condor localhost localhost&#34;; \
     eval&#95;set&#95;GridResource &#61; strcat(&#34;condor &#34;, $(FULL&#95;HOSTNAME), $(FULL&#95;HOSTNAME)); \
     TargetUniverse &#61; 5; \
     name &#61; &#34;Local&#95;Condor&#34;; \
   ]
</pre>
<p />
If HTCondor collector for grid pool is NOT same host, here appropriate lines has to be part of the route configuration:
<pre>
JOB&#95;ROUTER&#95;SCHEDD2&#95;POOL&#61;&#60;Condor Collector for grid pool&#62;
JOB&#95;ROUTER&#95;ENTRIES &#61; \
   &#91; \
     GridResource &#61; &#34;condor localhost localhost&#34;; \
     eval&#95;set&#95;GridResource &#61; strcat(&#34;condor &#34;, &#34;$(FULL&#95;HOSTNAME)&#34;, &#34; $(JOB&#95;ROUTER&#95;SCHEDD2&#95;POOL)&#34;); \
     TargetUniverse &#61; 5; \
     set&#95;InputRSL &#61; FALSE; \
     name &#61; &#34;Condor&#95;grid&#95;pool&#34;; \
   ] 
</pre>
<p />
Note all routes should have a name and set the GridResource attribute (the reason for the latter is vestigial and may be removed in the future).  Each route is a HTCondor ClassAd.  When writing a new route, three grammatical things to check are: <ul>
<li> Each route begins and ends with a square bracket,
</li> <li> Each attribute ends with a semicolon, and
</li> <li> Comments are specified with a C-style comment (<code>/* ... */</code>), as opposed to a configuration file comment (<code>#</code>).
</li></ul> 
<p />
Multiple routes may be specified, one after another.  The first matching route is used; a route matches if its Requirements expression evaluates to true and it is within its MaxJobs setting.  For example, the following route places the job in the accounting group "hcc" if it carries a VOMS attribute and the accounting group "other" otherwise.
<p />
<pre>
JOB&#95;ROUTER&#95;ENTRIES &#61; \
   &#91; \
     GridResource &#61; &#34;condor localhost localhost&#34;; \
     eval&#95;set&#95;GridResource &#61; strcat(&#34;condor &#34;, $(FULL&#95;HOSTNAME), $(FULL&#95;HOSTNAME)); \
     TargetUniverse &#61; 5; \
     name &#61; &#34;Condor&#95;hcc&#34;; \
     Requirements &#61; regexp(&#34;^/hcc/&#34;, x509UserProxyFirstFQAN); \
     eval&#95;set&#95;AccountingGroup &#61; strcat(&#34;hcc.&#34;, Owner); \
   ] \
   &#91; \
     GridResource &#61; &#34;condor localhost localhost&#34;; \
     eval&#95;set&#95;GridResource &#61; strcat(&#34;condor &#34;, $(FULL&#95;HOSTNAME), $(FULL&#95;HOSTNAME)); \
     TargetUniverse &#61; 5; \
     name &#61; &#34;Condor&#95;other&#34;; \
     Requirements &#61; regexp(&#34;^/hcc/&#34;, x509UserProxyFirstFQAN) &#61;!&#61; TRUE; \
     eval&#95;set&#95;AccountingGroup &#61; strcat(&#34;other.&#34;, Owner); \
   ]
</pre>
<p />
Some sites may want to set a default attribute (such as a memory request) if not present in the ClassAd.  Here is an example:
<p />
<pre>
JOB&#95;ROUTER&#95;ENTRIES &#61; \
   &#91; \
     GridResource &#61; &#34;condor localhost localhost&#34;; \
     eval&#95;set&#95;GridResource &#61; strcat(&#34;condor &#34;, $(FULL&#95;HOSTNAME), $(FULL&#95;HOSTNAME)); \
     TargetUniverse &#61; 5; \
     name &#61; &#34;Condor&#95;hcc&#34;; \
     Requirements &#61; regexp(&#34;^/hcc/&#34;, x509UserProxyFirstFQAN); \
     eval&#95;set&#95;AccountingGroup &#61; strcat(&#34;hcc.&#34;, Owner); \
     eval&#95;set&#95;RequestMemory &#61; ifThenElse(isUndefined(RequestMemory), 1000, RequestMemory); \  &#61;/&#42; &#61;&#61;&#62; for HTCondor-CE &#60;&#61;v0.6.1 &#42;/&#61;
     set&#95;default&#95;maxMemory &#61; 1000; \ &#61;/&#42; &#61;&#61;&#62; supported in &#62;&#61;v0.6.2 &#42;/&#61;
   ]
</pre>
<p />
This example sets the RequestMemory/maxMemory attribute to 1000MB of memory if not explicitly requested by the user. Example shows config implementation for HTCondor-CE builds &lt;=v0.6.1 and &gt;=v0.6.2. For builds &gt;=v0.6.2: if maxMemory is not defined in the config default value is set to 2000.
<p />
For PBS, SGE, LSF, or SLURM sites, it is often useful to request a specific queue (differs in builds &lt;=v0.6.1 and &gt;=v0.6.2, see below.  Here's an example for a PBS site:
<p />
<pre>
JOB&#95;ROUTER&#95;ENTRIES &#61; \
   &#91; \
     GridResource &#61; &#34;batch pbs&#34;; \
     TargetUniverse &#61; 9; \
     name &#61; &#34;Local&#95;PBS&#95;cms&#34;; \
     set&#95;remote&#95;queue &#61; &#34;cms&#34;; \ &#61;/&#42; &#61;&#61;&#62; for HTCondor-CE &#60;&#61;v0.6.1 &#42;/&#61;
     set&#95;default&#95;queue &#61; &#34;cms&#34;;  \ &#61;/&#42; &#61;&#61;&#62; supported in &#62;&#61;v0.6.2 &#42;/&#61;
     Requirements &#61; target.x509UserProxyVOName &#61;?&#61; &#34;cms&#34;; \
   ]
</pre>
<p />
The route turns the CE job into a PBS grid-universe job, which will in turn be submitted to PBS.  <a href="http://research.cs.wisc.edu/htcondor/manual/v8.0/5_3Grid_Universe.html#SECTION00635000000000000000" target="_top">See the relevant HTCondor documentation</a>.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Customization_using_Job_Hooks"></a> Customization using Job Hooks </span></h2>
<p />
Some sites may not be able to specify their desired policy solely through the ClassAd language.  For example, they may decide to alter the accounting group based on the contents of a separate file on disk, or conduct in-depth transformations of a particular attribute.  In this case, HTCondor provides <a href="http://research.cs.wisc.edu/htcondor/manual/v8.0/4_4Hooks.html#SECTION00542000000000000000" target="_top">JobRouter hooks</a>; these provide the site admin with a means to transform the job via an arbitrary script.
<p />
The job hooks currently work but are relatively difficult to work with.  Site admins are welcome to follow along the activity on <a href="https://htcondor-wiki.cs.wisc.edu/index.cgi/tktview?tn=3380" target="_top">this ticket</a>.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Customizing_Submit_Files"></a> Customizing Submit Files </span></h2>
<p />
For PBS, SGE, SLURM, and LSF, the blahp submit scripts have a callout hook which allows the site to add default attributes.
<p />
For PBS, the file is located at <code>/usr/libexec/blahp/pbs_local_submit_attributes.sh</code>.  The following example shows how to set a default walltime (10 minutes) for jobs:
<p />
<pre>
&#91;root&#64;example-ce1 ~]# cat /usr/libexec/blahp/pbs&#95;local&#95;submit&#95;attributes.sh 
echo &#34;#PBS -l walltime&#61;00:10:00&#34;
</pre>
<p />
This may be used for adding default attributes, but cannot customize the submit files more than that.</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Documentation<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Documentation/InstallHTCondorCE" class="twikiLink">InstallHTCondorCE</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>HTCondorCERoutes</span> <br />    
Topic revision: r7 - 28 Feb 2014 - 15:54:06 - <a href="/bin/view/Main/MarianZvada" class="twikiLink">MarianZvada</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />