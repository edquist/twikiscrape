---+ Edg-Mkgridmap
(This is obsolete. Please go [[https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/Edg-mkgridmap][here]] for latest information )

This document aims to describe in detail how you can authorize the users accessing the resources that you provide using =edg-mkgridmap= 
 
---++ Configuration
   * First, you need to tell =edg-mkgridmap=, which Virtual Organizations (VOs) you wish to support. 
      For this, edit the =/etc/edg-mkgridmap.conf= such that all VOs that you wish to support are present and uncommented and all VOs that you do not wish to support are either commented or not present.
Example in which =cdf= VO is disabled and =fermilab= VO is enabled
&lt;pre class=&quot;file&quot;&gt;
[root@fermicloud046 ~]# cat /etc/edg-mkgridmap.conf 
#### GROUP: group URI [lcluser]
#
#-------------------
# USER-VO-MAP cdf CDF -- 1 -- Dennis Box (dbox@fnal.gov)     
#group vomss://voms.fnal.gov:8443/voms/cdf cdf
#group vomss://voms.cnaf.infn.it:8443/voms/cdf cdf
#-------------------
# USER-VO-MAP fermilab FERMILAB -- 2 -- Fermilab Service Desk (servicedesk@fnal.gov)  
group vomss://voms.fnal.gov:8443/voms/fermilab fermilab
[root@fermicloud046 ~]#
&lt;/pre&gt;
---++ Execution/Enabling
   * Second, you need to configure ==edg-mkgridmap== to run automatically via a cron job. To enable this, you need to run the following command.

     &lt;pre class=&quot;rootscreen&quot;&gt;
[root@fermicloud046 ~]# /sbin/service edg-mkgridmap start
Enabling periodic edg-mkgridmap:                           [  OK  ]
[root@fermicloud046 ~]#
     &lt;/pre&gt;
     The entry in cron file (=/etc/cron.d/edg-mkgridmap-cron=) looks like
     &lt;pre class=&quot;file&quot;&gt;
     [root@fermicloud046 ~]# cat /etc/cron.d/edg-mkgridmap-cron 
# Cron job running by default every 6 hours.
# The lock file can be enabled or disabled via a
# service edg-mkgridmap start
# chkconfig edg-mkgridmap on

# Note the lock file not existing is success hence the the slightly odd logic
# below.
# run every 6 hours but sleep for random time every 5 hours

0 */6 * * * root perl -e &#39;sleep rand 18000&#39;; [ ! -f /var/lock/subsys/edg-mkgridmap ] || /usr/sbin/edg-mkgridmap
[root@fermicloud046 ~]#
     &lt;/pre&gt;
*Note*: As you can see above, that this cron will run every 6 hours. If you do not want to wait that long, you can execute the command =/usr/sbin/edg-mkgridmap= directly on command line

You can also chkconfig it on, so it automatically starts if the machine was rebooted
&lt;pre class=&quot;rootscreen&quot;&gt;
[root@fermicloud046 ~]# chkconfig edg-mkgridmap on
[root@fermicloud046 ~]# chkconfig --list edg-mkgridmap
edg-mkgridmap  	0:off	1:off	2:on	3:on	4:on	5:on	6:off
[root@fermicloud046 ~]# chkconfig edg-mkgridmap off
[root@fermicloud046 ~]# chkconfig --list edg-mkgridmap
edg-mkgridmap  	0:off	1:off	2:off	3:off	4:off	5:off	6:off
[root@fermicloud046 ~]#
&lt;/pre&gt;
---++ Disabling
     If, for some reason, you want to disable the automatic execution of =edg-mkgridmap=, run following command
     &lt;pre class=&quot;rootscreen&quot;&gt;
[root@fermicloud046 ~]# /sbin/service edg-mkgridmap stop
Disabling periodic edg-mkgridmap:                          [  OK  ]
[root@fermicloud046 ~]#
     &lt;/pre&gt;

---++ When =edg-mkgridmap= runs, what does it do?
    It reads the =/etc/edg-mkgridmap.conf= configuration file, and contacts VOMS server (for each VO that is uncommented ) to retrieve list of all users that belong to that VO.
    It then, reads =/etc/osg/local-user-vo-map= file to see if there are any local users that you may have defined on your site. If you have defined such local users, it will append them to the list of users that it already has. The resulting file =/var/lib/osg/user-vo-map= will contain the complete list. Each line in this file is a mapping between the user DN and the local user to which the user got mapped to.

---++ Gridmap file

---+++ Configuring Gridmap Support

By default, !GridFTP uses a gridmap file, found in =/etc/grid-security/gridmap-file=.
This file is not generated by default.  There are two ways you can generate this file.
You can generate this file manually, by including DN/username combinations.  This is most useful for debugging.  Otherwise, you can use =edg-mkgridmap=, which will periodically contact a list of VOMS servers that you specify. It assembles a list of users from those servers and creates a grid-mapfile.  This grid-mapfile serves both as a list of authorized users and provides a mapping from user dns to local user ids.  edg-mkgridmap is already installed with 

In order to use edg-mkgridmap, review =/etc/edg-mkgridmap.conf= to make sure that it has all VOs that you are interested in and also to comment out any VOs that you do not wish to support. 
&lt;pre class=&quot;rootscreen&quot;&gt;
vi /etc/edg-mkgridmap.conf
&lt;/pre&gt;
This utility =edg-mkgridmap= runs as a cronjob =/etc/cron.d/edg-mkgridmap-cron= (by default every 6 hours). You can also run =edg-mkgridmap= manually to see that it generates =/etc/grid-security/gridmap-file=.  
&lt;pre class=&quot;rootscreen&quot;&gt;
edg-mkgridmap
&lt;/pre&gt;
Then, you can enable/start the service.
&lt;pre class=&quot;rootscreen&quot;&gt;
/sbin/service edg-mkgridmap start
/sbin/chkconfig edg-mkgridmap on
&lt;/pre&gt;

Troubleshooting information on edg-mkgridmap can be found [[https://www.opensciencegrid.org/bin/view/ReleaseDocumentation/EdgMkgridmapTroubleshootingGuide][here]]

-- Main.NehaSharma - 13 Jun 2012
