<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GlideinWMSCampusGrid &lt; Documentation/Release3 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Documentation/Release3/GlideinWMSCampusGrid?_T=16 Feb 2017" type="application/x-wiki" title="edit GlideinWMSCampusGrid" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Documentation/Release3/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/GlideinWMSCampusGrid"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFFFFF;
	}
	.patternBookView {
		border-color:#FFFFFF;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TABLEPLUGIN_table2--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
</style>
<!--TWISTYPLUGIN_TWISTY--><style type="text/css" media="all">
@import url("https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.css");
</style>
<script type='text/javascript' src='https://twiki.opensciencegrid.org/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js'></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiPref.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TwistyContrib/twist.compressed.js"></script>
<script type="text/javascript">
// <![CDATA[
var styleText = '<style type="text/css" media="all">.twikiMakeVisible{display:inline;}.twikiMakeVisibleInline{display:inline;}.twikiMakeVisibleBlock{display:block;}.twikiMakeHidden{display:none;}</style>';
document.write(styleText);
// ]]>
</script>

<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="GlideinWMS_in_a_Campus_Grid"></a>  <strong>GlideinWMS in a Campus Grid</strong> </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#About_this_Document"> About this Document</a>
</li> <li> <a href="?cover=print#Introduction"> Introduction</a>
</li> <li> <a href="?cover=print#Requirements"> Requirements </a> <ul>
<li> <a href="?cover=print#Required_Hardware_and_Software">Required Hardware and Software</a>
</li> <li> <a href="?cover=print#Users"> Users</a>
</li> <li> <a href="?cover=print#Certificates"> Certificates</a>
</li> <li> <a href="?cover=print#Networking"> Networking</a>
</li></ul> 
</li> <li> <a href="?cover=print#GlideinWMS_VO_Frontend_Flocking"> GlideinWMS VO Frontend - Flocking Configuration </a>
</li> <li> <a href="?cover=print#GlideinWMS_VO_Frontend_Security"> GlideinWMS VO Frontend - Security Configuration</a> <ul>
<li> <a href="?cover=print#Using_GSI_authentication_recomme"> Using GSI authentication (recommended) on the Frontend</a> <ul>
<li> <a href="?cover=print#Modify_the_condor_mapfile_for_GS"> Modify the condor_mapfile for GSI authenticated hosts </a>
</li></ul> 
</li> <li> <a href="?cover=print#Enabling_alternative_authenticat"> Enabling alternative authentication methods on the Frontend</a> <ul>
<li> <a href="?cover=print#Modify_the_condor_mapfile_for_CL"> Modify the condor_mapfile for CLAIMTOBE</a>
</li> <li> <a href="?cover=print#Authorizing_hosts"> Authorizing hosts</a>
</li></ul> 
</li></ul> 
</li> <li> <a href="?cover=print#Submit_host_Flocking_Configurati"> Submit host - Flocking Configuration </a>
</li> <li> <a href="?cover=print#Submit_host_Security_Configurati"> Submit host - Security Configuration</a> <ul>
<li> <a href="?cover=print#Using_GSI_authentication_on_the"> Using GSI authentication on the Submit host</a> <ul>
<li> <a href="?cover=print#Install_the_CA_Certificates"> Install the CA Certificates</a>
</li> <li> <a href="?cover=print#Configure_HTCondor_to_use_GSI_au"> Configure HTCondor to use GSI authentication</a>
</li></ul> 
</li> <li> <a href="?cover=print#Enabling_alternative_authent_AN1"> Enabling alternative authentication methods on the Submit host</a>
</li></ul> 
</li> <li> <a href="?cover=print#Adding_OSG_Gratia_Accounting"> Adding OSG Gratia Accounting </a>
</li> <li> <a href="?cover=print#Validation_of_Success"> Validation of Success</a>
</li> <li> <a href="?cover=print#Troubleshooting"> Troubleshooting</a>
</li> <li> <a href="?cover=print#References"> References</a>
</li> <li> <a href="?cover=print#Comments"> Comments</a>
</li></ul> 
</div>
<p />
<h1><a name="About_this_Document"></a> About this Document </h1>
To submit jobs from a Campus Grid to Open Science Grid using the GlideinWMS system you have two options: <ol>
<li> Use an existing VO Frontend submitting to OSG (e.g. HCC, OSG-XSEDE)  and flock to it
</li> <li> Use your own VO Frontend and configure your submit hosts to use it.
</li></ol> 
<p />
Both these options use HTCondor <em>flocking</em>, a mechanism that allows jobs to overflow from a HTCondor pool to a second one. Jobs migrate from a <em>schedd</em> of a pool to a <em>collector</em> and <em>negotiator</em> of a different pool.
Option 1 is covered in <span class="twikiNewLink">InstallCondorFlockSubmit<a href="/bin/edit/Trash/Trash/CampusGrids/InstallCondorFlockSubmit?topicparent=Documentation/Release3.GlideinWMSCampusGrid" rel="nofollow" title="InstallCondorFlockSubmit (this topic does not yet exist; you can create it)">?</a></span>. This document describe option 2, how to configure a GlideinWMS VO Frontend and submit hosts in a Campus Grid. This will show how jobs submitted to the submit host can flock to campus resources as well as going out to the OSG using GlideinWMS.
<p />
<p />
<h1><a name="Introduction"></a> Introduction </h1>
Being familiar with the <a href="http://research.cs.wisc.edu/htcondor/manual/v8.0/3_6Security.html" target="_top">HTCondor security model</a> and its configuration will help configuring everything correctly.
Anyway here are few notes that will help understand the configuration below and avoid pitfalls. <dl>
<dt> HTCondor user id </dt><dd> it is how HTCondor manages identities, it may vary depending on the type of authentication and in its short form may be an identifier <code>condor_name</code> or in its extended form will look like <code>condor_name@condor_UID_DOMAIN/host_name.domain</code> , where the last part may be also an IP address. These ID are used in the condor_mapfile and configuration file and are independent from the OS: the condor_name does not have to be a Unix user.
</dd> <dt> Authentication </dt><dd> the authentication process accomplishes the proper identification of a user.
</dd> <dt> Authorization </dt><dd> specifies who is allowed to do what. 
</dd> <dt> Security negotiation </dt><dd> is the process used by HTCondor to decide which type of security is needed and wether is met. The <strong>Access level</strong> is used to specify which actions are possible. HTCondor has many access levels <a href="http://research.cs.wisc.edu/htcondor/manual/v8.0/3_6Security.html#SECTION00461100000000000000" target="_top">described in the manual</a>: READ, WRITE, ADMINISTRATOR, SOAP, CONFIG, OWNER, DAEMON, NEGOTIATOR, ADVERTISE_MASTER, ADVERTISE_STARTD, ADVERTISE_SCHEDD, CLIENT. A <strong>Policy</strong> specifies which aspect of the interaction is covered: AUTHENTICATION, ENCRYPTION, INTEGRITY, NEGOTIATION. The <strong>Value</strong> specifies how to negotiate a certain security requirement. Valid values in HTCondor are: REQUIRED, PREFERRED, OPTIONAL, NEVER.
</dd></dl> 
The <a href="http://research.cs.wisc.edu/htcondor/manual/v8.0/3_6Security.html" target="_top">Security section</a> of the HTCondor manual specifies in detail how all interactions are regulated.
<p />
<p />
<h1><a name="Requirements"></a> Requirements </h1>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Required_Hardware_and_Software"></a> Required Hardware and Software </span></h2> <ol>
<li> <a href="/bin/view/Documentation/Release3/InstallGlideinWMSFrontend" class="twikiLink">GlideinWMS Frontend</a> (<code>gwms-vofe.mydomain.edu</code> in the examples below). You must have installed and configured a VO Frontend as described in <a href="/bin/view/Documentation/Release3/InstallGlideinWMSFrontend" class="twikiLink">the document</a>. Refer to that document for further requirements (hardware, users, network, ...) on the frontend host.
</li> <li> HTCondor submit node (<code>campus-submit.mydomain.edu</code> in the examples below). You must have installed and configured a HTCondor submit node. <a href="/bin/view/Documentation/Release3/InstallCondor" class="twikiLink">InstallCondor</a> provides instructions to install HTCondor off the OSG Yum repository, follow the instructions for the Submit node. This document works also if you choose a <a href="/bin/view/Documentation/Release3/CondorInformation" class="twikiLink">different option to install HTCondor</a>, including a personal HTCondor not installed as <code>root</code>, even <a href="http://bosco.opensciencegrid.org/" target="_top">BOSCO</a>. 
</li></ol> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Users"></a> Users </span></h2>
Refer to the frontend installation or the HTCondor installation for the required users
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Certificates"></a> Certificates </span></h2>
All hosts using GSI authentication, e.g. <code>campus-submit.mydomain.edu</code> in the example below, must have a valid host certificate. <a href="/bin/view/Trash/ReleaseDocumentationGetHostServiceCertificates" class="twikiLink">Check this document</a> to see what host certificates are and how to request them.
You may need also a user certificate to operate the frontend.
There is no necessity of a user certificate to submit jobs on the HTCondor submit host.
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/GlideinWMSCampusGrid?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Certificate</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/GlideinWMSCampusGrid?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">User that owns certificate</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/GlideinWMSCampusGrid?cover=print;sortcol=2;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Path to certificate</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Host certificate </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLast"> <code>root</code> </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <code>/etc/grid-security/hostcert.pem</code> <br> <code>/etc/grid-security/hostkey.pem</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Networking"></a> Networking </span></h2>
From the submit host you must have outgoing connectivity to the frontend host and the worker nodes.
<p />
Check the <a href="/bin/view/Documentation/Release3/InstallGlideinWMSFrontend" class="twikiLink">frontend installation</a> for the frontend network requirements.
<p />
<p />
<h1><a name="GlideinWMS_VO_Frontend_Flocking"></a> GlideinWMS VO Frontend - Flocking Configuration </h1>
The VO Frontend hosts a HTCondor pool with the job slots of the glideins sent by the GlideinWMS Factory.
To receive jobs form other pools via flocking the  configuration of VO Frontend, e.g. <code>gwms-vofe.mydomain.edu</code>, must contain a FLOCK_FROM line including the submit host, like: <pre class="file">
FLOCK_FROM = $(FLOCK_FROM) <font color="#ff0000">campus-submit.mydomain.edu</font>
</pre>
<p />
<h1><a name="GlideinWMS_VO_Frontend_Security"></a> GlideinWMS VO Frontend - Security Configuration </h1>
The configuration of the GlideinWMS VO Frontend must allow other hosts to communicate with the frontend.  By default, the GlideinWMS Frontend has very strong security, requiring GSI certs to communicate.  In this example, a campus submit host is running at <code>campus-submit.mydomain.edu</code>.  This section will describe the configuration of the GlideinWMS Frontend.
<p />
Choose between GSI or alternate authentication and follow the corresponding instructions, no need to do both (unless you use one with some hosts and the other with others)
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Using_GSI_authentication_recomme"></a> Using GSI authentication (recommended) on the Frontend </span></h2>
If you can use GSI authentication to connect all your submit hosts (schedd) to the frontend we recommend to use it.
In this case you can skip the section about alternate authentication methods.
If one of the submit hosts cannot use GSI authentication, then you'll have to enable some of the other methods.
<p />
<h3><a name="Modify_the_condor_mapfile_for_GS"></a> Modify the <code>condor_mapfile</code> for GSI authenticated hosts </h3>
The <a href="http://research.cs.wisc.edu/htcondor/manual/v8.1/3_6Security.html#SECTION00464000000000000000" target="_top">=condor_mapfile=</a> (normally <code>/etc/condor/certs/condor_mapfile</code>, use <code><b>condor_config_val certificate_mapfile</b></code> to find the exact path) is used by Condor to map an authenticated user to a human readable identity to be used in authentication rules. 
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  The <code>condor_mapfile</code> uses regular expressions to map from authentication methods to users.  This is why there are many escapes (<code>\</code>) in the below example.
</dd></dl> 
<p />
For each GSI authenticated submit host that you want to submit (flock) to the the VO Frontend find out the DN of its certificate (<code><b>openssl x509 -noout -subject -in /etc/grid-security/hostcert.pem</b></code>) and add the following line to the <code>condor_mapfile</code>:<pre class="file">
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=campus\-submit\.mydomain\.edu$" schedd
</pre>  
<p />
<!-- should it be <a href="mailto&#58;anonymous&#64;hostname">anonymous&#64;hostname</a> ? 
<p />
   <pre class="file">
GSI "^\/<font color="#ff0000">DN of proxy identifying VO FE owned by frontend</font>$" frontend
GSI "^\/<font color="#ff0000">DN of User (pilot) proxy owned by frontend, </font>$" frontend
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=gfactory\-1\.t2\.ucsd\.edu$" frontend
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=host\submit\-host1\.mydomain\.edu$" frontend
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=personal\-submit\-host2\.mydomain\.edu$" myuser2
GSI (.*) anonymous
FS (.*) \1 </pre>
-->
<p />
The file, including the part already there from the GlideinWMS Frontend install, should look similar to the following example:<pre class="file">
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=campus\-submit\.mydomain\.edu$" schedd
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=gwms\-vofe\.mydomain\.edu$" frontend
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=Name Familyname 12345$" frontendpilot
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=gfactory\-1\.t2\.ucsd\.edu$" factory
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=submit\-host1\.mydomain\.edu$" schedd2
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=personal\-submit\-host2\.mydomain\.edu$" myuser2
GSI (.*) anonymous
FS (.*) \1 </pre>
<p />
If all your hosts use GSI now you can jump to the Submit host configuration, configure the flocking and remember to follow the instructions for GSI authentication.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Enabling_alternative_authenticat"></a> Enabling alternative authentication methods on the Frontend </span></h2>
It is necessary to enable authentication methods that are acceptable to the campus. If you are on a safe network and no GSI authentication is possible with the submit hosts, then you can use CLAIMTOBE . It will be used to implement host (ip address) based security in this document.  
<p />
First enable the CLAIMTOBE method.  Copy and paste the below into your local condor configuration file.  It will append the existing authentication methods to include CLAIMTOBE.  
<pre class="file">
SEC_DEFAULT_AUTHENTICATION_METHODS = $(SEC_DEFAULT_AUTHENTICATION_METHODS), CLAIMTOBE
</pre>
<p />
<h3><a name="Modify_the_condor_mapfile_for_CL"></a> Modify the <code>condor_mapfile</code> for CLAIMTOBE </h3>
Also here you have o modify the <code>condor_mapfile</code> like in the GSI authentication. This time add the following line, that most hosts attempting to authenticate will use:<pre class="file">
CLAIMTOBE .* anonymous@claimtobe</pre>  
This means that any machine using <code>CLAIMTOBE</code> authentication method will be mapped to user <a href="mailto&#58;anonymous&#64;claimtobe">anonymous&#64;claimtobe</a> (The user does not have to exist on the machine, it is use for HTCondor identification and accounting).  Therefore all authorization rules will use <code>anonymous@claimtobe</code> to refer to this user and can be more restrictive than the rules for GSI authenticated users.
<p />
The file, including the part already there from the GlideinWMS Frontend install, should look similar to the following example:<pre class="file">
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=Name Familyname 12345$" frontendpilot
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=gwms\-vofe\.mydomain\.edu" frontend
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=gfactory\-1\.t2\.ucsd\.edu$" factory
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=submit\-host1\.mydomain\.edu$" schedd2
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=personal\-submit\-host2\.mydomain\.edu$" myuser2
GSI (.*) anonymous
FS (.*) \1
CLAIMTOBE .* anonymous@claimtobe
</pre>
<p />
<h3><a name="Authorizing_hosts"></a> Authorizing hosts </h3>
Below is an example security configuration file from the HCC GlideinWMS Frontend.
<p />
<pre class="file">
DENY_WRITE = anonymous@* 
ALLOW_WRITE = *@mydomain.edu *@glidein.mydomain.edu execute-side@matchsession *@daemon.mydomain.edu *@daemon.guestdomain.edu <strong>*/campus-submit.mydomain.edu</strong>
DENY_ADVERTISE_SCHEDD = anonymous@*
DENY_ADMINISTRATOR = anonymous@*
DENY_DAEMON = anonymous@glidein.mydomain.edu 
ALLOW_DAEMON = *@mydomain.edu *@glidein.mydomain.edu  execute-side@matchsession *@daemon.mydomain.edu *@daemon.guestdomain.edu 
DENY_NEGOTIATOR = anonymous@glidein.mydomain.edu 
ALLOW_NEGOTIATOR = */*.mydomain.edu *@daemon.guestdomain.edu <strong>*/campus-submit.mydomain.edu</strong></pre>
<p />
Some quick definitions: <dl>
<dt> <code>ALLOW_WRITE</code> </dt><dd> Hosts that are able to write to the local HTCondor instance.  This should include all hosts running HTCondor clusters you wish to flock to or from.
</dd> <dt> <code>ALLOW_NEGOTIATOR</code> </dt><dd> Hosts that run Negotiators that we should trust.  This should include all hosts running the Campus Factory and HTCondor clusters you wish to flock to.
</dd></dl> 
<p />
Breaking down the file some:
<pre class="file">
DENY_WRITE = anonymous@* 
ALLOW_WRITE = *@mydomain.edu *@glidein.mydomain.edu execute-side@matchsession *@daemon.mydomain.edu *@daemon.guestdomain.edu <strong>*/campus-submit.mydomain.edu</strong></pre>
The <code>DENY_WRITE</code> statement causes Condor to disallow write access to anyone not explicitly listed in the <code>condor_mapfile</code>.  The <code>ALLOW_WRITE</code> line allows explicitly listed people access to write, along with anyone and everyone from <code>campus-submit.mydomain.edu</code>.
<hr />
<p />
<pre class="file">
ALLOW_NEGOTIATOR = */*.mydomain.edu *@daemon.guestdomain.edu <strong>*/campus-submit.mydomain.edu</strong> </pre>
Allow <code>campus-submit.mydomain.edu</code> to negotiate jobs submitted at this host.
<p />
<p />
<h1><a name="Submit_host_Flocking_Configurati"></a> Submit host - Flocking Configuration </h1>
This configuration refer to the Submit host, <code>campus-submit.mydomain.edu</code>, and any other host that should flock jobs to the VO Frontend and the OSG
The HTCondor configuration must contain a FLOCK_TO line with a space separated line with the VO Frontend and all the HTCondor pools the submit host should flock to. 
<pre class="file">
FLOCK_TO = $(FLOCK_TO) <font color="#ff0000">gwms-vofe.mydomain.edu</font>
</pre>
Replacing <font color="#ff0000">gwms-vofe.mydomain.edu</font> with the full hostname or IP of the VO Frontend.
<p />
To list all the pools the jobs will flock to type <code>condor_config_val FLOCK_TO</code>.
If multiple hosts are listed, flocking happens in the order the hosts appear in the line, from left to right
<p />
<h1><a name="Submit_host_Security_Configurati"></a> Submit host - Security Configuration </h1>
The configuration of the Submit host must allow its communication with the frontend.  By default, the GlideinWMS Frontend has very strong security, requiring GSI certs to communicate also for the submit host. Submit hosts instead normally do not use GSI authentication, so you'll have to do some extra work to use it. This section will describe the configuration of the Submit host. The authentication methods should match: if you chose GSI authentication above for the VO Frontend you must choose GSI authentication also for the Submit host and vice-versa.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Using_GSI_authentication_on_the"></a> Using GSI authentication on the Submit host </span></h2>
GSI authentication is based on x509 certificates and requires some infrastructure to work correctly.
Normally HTCondor submit hosts are not configured to use GSI authentication and some of the required software, like the CA certificates, may not be installed.
<p />
<h3><a name="Install_the_CA_Certificates"></a> Install the CA Certificates </h3>
If you have no CA certificates in <code>/etc/grid-security/certificates</code> (e.g. if that directory does not exist or is empty) then you must setup the OSG Yum repositories (you may have them already if you installed other OSG software on this host) and install the CA certificates.
<p />
<div class="twistyPlugin twikiMakeVisibleInline">  <span id="twistyIdDocumentation/Release3GlideinWMSCampusGrid1show" class="twistyRememberSetting twistyStartHide twistyTrigger twikiUnvisited twistyInited0"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleopen-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Click to expand how to install the CA certificates...</span></a> </span> <span id="twistyIdDocumentation/Release3GlideinWMSCampusGrid1hide" class="twistyRememberSetting twistyStartHide twistyTrigger twikiUnvisited twistyHidden twistyInited0"><a href="#"><img src="/twiki/pub/TWiki/TWikiDocGraphics/toggleclose-small.gif" border="0" alt="" /><span class="twikiLinkLabel twikiUnvisited">Hide Full Output</span></a> </span>  </div><!--/twistyPlugin twikiMakeVisibleInline--> <div class="twistyPlugin"><div id="twistyIdDocumentation/Release3GlideinWMSCampusGrid1toggle" class="twistyRememberSetting twistyStartHide twistyContent twikiMakeHidden twistyInited0">
<p />
<p />
<h4><a name="Install_the_Yum_Repositories_req"></a> Install the Yum Repositories required by OSG </h4>
<p />
The OSG RPMs currently support Red Hat Enterprise Linux 5, 6, 7, and variants (see <a href="/bin/view/Documentation/Release3/SupportedOperatingSystems" class="twikiLink">details...</a>).
<p />
OSG RPMs are distributed via the OSG yum repositories. Some packages depend on packages distributed via the <a href="http://fedoraproject.org/wiki/EPEL" target="_top">EPEL</a> repositories. So both repositories must be enabled.
<p />
<h5><a name="Install_EPEL"></a> Install EPEL </h5>
<p /> <ul>
<li> Install the EPEL repository, if not already present. <strong>Note:</strong> This enables EPEL by default. Choose the right version to match your OS version. <pre class="rootscreen">
<font color="#ff0000"># EPEL 5 (For RHEL 5, CentOS 5, and SL 5) </font>
[root@client ~]$ curl -O https://dl.fedoraproject.org/pub/epel/epel-release-latest-5.noarch.rpm
[root@client ~]$ rpm -Uvh epel-release-latest-5.noarch.rpm
<font color="#ff0000"># EPEL 6 (For RHEL 6, CentOS 6, and SL 6) </font>
[root@client ~]$ rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm
<font color="#ff0000"># EPEL 7 (For RHEL 7, CentOS 7, and SL 7) </font>
[root@client ~]$ rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</pre>       <strong>WARNING</strong>: if you have your own mirror or configuration of the EPEL repository, you <strong>MUST</strong> verify that the OSG repository has a better yum priority than EPEL (<a href="/bin/view/Documentation/Release3/InstallBestPractices#YumPriorities" class="twikiAnchorLink">details</a>). Otherwise, you will have strange dependency resolution (<em>depsolving</em>) issues.
</li></ul> 
<p />
<h5><a name="Install_the_Yum_priorities_packa"></a> Install the Yum priorities package </h5>
<p />
For packages that exist in both OSG and EPEL repositories, it is important to prefer the OSG ones or else OSG software installs may fail. Installing the Yum priorities package enables the repository priority system to work.
<p /> <ol>
<li> <p>Choose the correct package name based on your operating system’s major version:</p> <ul>
<li> For EL&nbsp;5 systems, use <code>yum-priorities</code>
</li> <li> For EL&nbsp;6 and EL&nbsp;7 systems, use <code>yum-plugin-priorities</code>
</li></ul> 
</li> <li> <p>Install the Yum priorities package:</p>       <pre class="rootscreen">[root@client ~]$ yum install <em>PACKAGE</em></pre>       <p>Replace <em><code>PACKAGE</code></em> with the package name from the previous step.</p>
</li> <li> <p>Ensure that <code>/etc/yum.conf</code> has the following line in the <code>[main]</code> section (particularly when using ROCKS), thereby enabling Yum plugins, including the priorities one:</p>       <pre class="file">plugins=1</pre>       <strong>NOTE</strong>: If you do not have a required key you can force the installation using <code>--nogpgcheck</code>; e.g., <code>yum install --nogpgcheck yum-priorities</code>.
</li></ol> 
<p />
<h5><a name="Install_OSG_Repositories"></a> Install OSG Repositories </h5>
<p />
<!--   1. <p>First, determine which OSG series you will be installing; 3.1 or 3.2.  The OSG 3.1 and 3.2 series are each well tested and contain the entire OSG software stack.  The 3.1 series continues to support all packages that have been released throughout its lifetime, while the 3.2 series contains newer versions of software (including HTCondor, Hadoop, glideinWMS) and removes support for obsolete packages (including CEMonitor).  Initially, most packages are identical between 3.1 and 3.2, but we expect the new series to diverge over time. <br/><br/>Note that some packages (eg, Hadoop) do not inter-operate between 3.1 and 3.2, and therefore require all nodes to use the same series.</p> -->
<p />
<ol>
   <li>
      <p>If you are upgrading from OSG 3.1 (or 3.2) to OSG 3.2 (or 3.3), remove the old OSG repository definition files and clean the Yum cache:</p>         <pre class="rootscreen">[root@client ~]$ yum clean all
[root@client ~]$ rpm -e osg-release</pre>       <p>This step ensures that local changes to <code>*.repo</code> files will not block the installation of the new OSG repositories. After this step, <code>*.repo</code> files that have been changed will exist in <code>/etc/yum.repos.d/</code> with the <code>*.rpmsave</code> extension. After installing the new OSG repositories (the next step) you may want to apply any changes made in the <code>*.rpmsave</code> files to the new <code>*.repo</code> files.</p>
   </li>
   <li>
      <p>Install the OSG repositories using one of the following methods depending on your EL version:</p>      <ol>
         <li>
            <p>For EL versions greater than EL5, install the files directly from <code>repo.grid.iu.edu</code>:</p>            <pre class="rootscreen">[root@client ~]$ rpm -Uvh <font color="#ff0000">URL</font></pre>            <p>Where <code><font color="#ff0000">URL</font></code> is one of the following:</p><table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/GlideinWMSCampusGrid?cover=print;sortcol=0;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Series</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/GlideinWMSCampusGrid?cover=print;sortcol=1;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">EL6 URL (for RHEL 6, CentOS 6, or SL 6)</font></a> </th>
			<th bgcolor="#d8dde4" align="center" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/GlideinWMSCampusGrid?cover=print;sortcol=2;table=2;up=0#sorted_table" title="Sort by this column"><font color="#252b37">EL7 URL (for RHEL 7, CentOS 7, or SL 7)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <font color="#252b37">OSG 3.2</font> </th>
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol1"> <code>https://repo.grid.iu.edu/osg/3.2/osg-3.2-el6-release-latest.rpm</code> </td>
			<td bgcolor="#ffffff" align="center" valign="top" class="twikiTableCol2 twikiLastCol"> N/A </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> <font color="#252b37">OSG 3.3</font> </th>
			<td bgcolor="#f2f3f6" align="center" valign="top" class="twikiTableCol1 twikiLast"> <code>https://repo.grid.iu.edu/osg/3.3/osg-3.3-el6-release-latest.rpm</code> </td>
			<td bgcolor="#f2f3f6" align="center" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <code>https://repo.grid.iu.edu/osg/3.3/osg-3.3-el7-release-latest.rpm</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
         </li>
         <li>
            <p>For EL5, download the repo file and install it using the following:</p>
            <pre class="rootscreen">[root@client ~]$ curl -O https://repo.grid.iu.edu/osg/3.2/osg-3.2-el5-release-latest.rpm
[root@client ~]$ rpm -Uvh osg-3.2-el5-release-latest.rpm</pre>
         </li>
      </ol>
   </li>
</ol>
<p />
For more details, please see our <a href="/bin/view/Documentation/Release3/YumRepositories" class="twikiLink">yum repository documentation</a>.
<p />
<p />
<p />
<h4><a name="Install_the_CA_Certificates_A_qu"></a> Install the CA Certificates: A quick guide </h4>
<p />
You must perform one of the following <code>yum</code> commands below to select this host's CA certificates.
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table3" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/GlideinWMSCampusGrid?cover=print;sortcol=0;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Set of CAs</font></a> </th>
			<th bgcolor="#d8dde4" align="right" valign="top" class="twikiTableCol1"> <a rel="nofollow" href="/bin/view/Documentation/Release3/GlideinWMSCampusGrid?cover=print;sortcol=1;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37">CA certs name</font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol2 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/GlideinWMSCampusGrid?cover=print;sortcol=2;table=3;up=0#sorted_table" title="Sort by this column"><font color="#252b37"> Installation command (as root)</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> OSG </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> osg-ca-certs </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> <code>yum install osg-ca-certs</code> <font color="#ff0000"><b>Recommended</b></font> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> IGTF </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1"> igtf-ca-certs </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol"> <code>yum install igtf-ca-certs</code> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> None* </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1"> empty-ca-certs </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol2 twikiLastCol"> <code>yum install empty-ca-certs --enablerepo=osg-empty</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> Any** </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLast"> Any </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol2 twikiLastCol twikiLast"> <code>yum install osg-ca-scripts</code> </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
* The <code>empty-ca-certs</code> RPM indicates you will be manually installing the CA certificates on the node. <br/>
** The <code>osg-ca-scripts</code> RPM provides a cron script that automatically downloads CA updates, and requires further configuration. <br/>
<p />
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  If you use options 1 or 2, then you will need to run "yum update" in order to get the latest version of CAs when they are released. With option 4 a cron service is provided which will always download the updated CA package for you.
</dd></dl> 
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  If you use services like Apache's httpd you must restart them after each update of the CA certificates, otherwise they will continue to use the old version of the CA certificates.
</dd></dl> 
For more details and options, please see our <a href="/bin/view/Documentation/Release3/InstallCertAuth" class="twikiLink">CA certificates documentation</a>. 
<p />
<p />
End of the section about CA certificates installation.
</div></div> <!--/twistyPlugin-->
<p />
<p />
<h3><a name="Configure_HTCondor_to_use_GSI_au"></a> Configure HTCondor to use GSI authentication </h3>
Now you can configure HTCondor to use GSI authentication. The hostname and the DN of the VO Frontend, in  <font color="#ff0000">red</font>, must be changed to match yours. The path of the host certificate and key, also in  <font color="#ff0000">red</font>, may need to be changed if you used a different file name. The example uses the default location (in <code>/etc/grid-security</code>).
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  A host certificate is required. If you don't have one, before proceeding <a href="/bin/view/Trash/ReleaseDocumentationGetHostServiceCertificates" class="twikiLink">check this document</a> to see what host certificates are and how to request them.
</dd></dl> 
<pre class="file">
# VO Frontend hostname (FQDN) and Distinguished Name (subject of the certificate)
MY_VOFE = <font color="#ff0000">gwms-vofe.mydomain.edu</font>
MY_VOFE_DN = <font color="#ff0000">/DC=org/DC=doegrids/OU=Services/CN=host\gwms-vofe.mydomain.edu</font>

# If you have other pools using GSI authentication and that you'd like to flock to 
# you can add the hostname, DN and add them  to the flock_to and gsi_daemon_name lists

# Who to trust?  Include all the DN that the submit host should trust (comma separated)
GSI_DAEMON_NAME = $(GSI_DAEMON_NAME), $(MY_VOFE_DN)


# Host certificates
# Change the path of the host certificate and key if you put them in a different location
GSI_DAEMON_CERT = <font color="#ff0000">/etc/grid-security/hostcert.pem</font>
GSI_DAEMON_KEY = <font color="#ff0000">/etc/grid-security/hostkey.pem</font>
# Change if you installed the CA certificates in a non standard location
GSI_DAEMON_TRUSTED_CA_DIR = /etc/grid-security/certificates


# Enable authentication from tne Negotiator (This is required to run on glidein jobs)
SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION = TRUE

# Enable GSI authentication (It is already in the default: FS, KERBEROS, GSI
SEC_DEFAULT_AUTHENTICATION_METHODS = GSI, $(SEC_DEFAULT_AUTHENTICATION_METHODS)

# Mapping of users
CERTIFICATE_MAPFILE = /etc/condor/certs/condor_mapfile
</pre>
<p />
Write a certificate mapfile with the DNs mapped to nicknames. In the case of a Submit node or Execute node running as root, the user nicknames must represent actual Unix account.
In all other cases, the nicknames have no special meaning, and are there just for use in configuration and log files.
<p />
Make sure that the frontend DN is there: <pre class="file">GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=gwms\-vofe\.mydomain\.edu$" schedd
</pre>  
Here is an example:<pre class="file">
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=campus\-submit\.mydomain\.edu$" schedd
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=gwms\-vofe\.mydomain\.edu$" frontend
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=Name Familyname 12345$" frontendpilot
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=gfactory\-1\.t2\.ucsd\.edu$" factory
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=submit\-host1\.mydomain\.edu$" schedd2
GSI "^\/DC\=org\/DC\=doegrids\/OU\=Services\/CN\=personal\-submit\-host2\.mydomain\.edu$" myuser2
GSI (.*) anonymous
FS (.*) \1 </pre>
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Enabling_alternative_authent_AN1"></a> Enabling alternative authentication methods on the Submit host </span></h2>
If you decided to authenticate your hosts with CLAIMTOBE you must enable it also on the Submit host.
Copy and paste the line below into your local condor configuration file.  It will append the existing authentication methods to include CLAIMTOBE.  
<pre class="file">
SEC_DEFAULT_AUTHENTICATION_METHODS = $(SEC_DEFAULT_AUTHENTICATION_METHODS), CLAIMTOBE
</pre>
<p />
<a name="GratiaAccounting"></a>
<h1><a name="Adding_OSG_Gratia_Accounting"></a> Adding OSG Gratia Accounting </h1>
You must report to Gratia if you are running on OSG more than a few test jobs.
<p />
<a href="/bin/view/Accounting/ProbeConfigGlideinWMS" class="twikiLink">ProbeConfigGlideinWMS</a> explains how to instal and configure the HTCondor Gratia probe. If you are on a Campus Grid without x509 certificates pay attention to the <a href="/bin/view/Accounting/ProbeConfigGlideinWMS#Users_without_Certificates" class="twikiAnchorLink">Users without Certificates part</a> in the Unusual Use Cases section.
<p />
<p />
<h1><a name="Validation_of_Success"></a> Validation of Success </h1>
The job submission is an excellent test if the submission is working correctly.  
<p />
<h1><a name="Troubleshooting"></a> Troubleshooting </h1>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Where_to_look_for_information"></a> Where to look for information </span></h2>
If any of these steps have failed, errors will be written by HTCondor to log files.  Log files are by default in <code>/var/log/condor</code> and can be found by querying HTCondor:
<pre class="screen">
[user@client ~]$ condor_config_val LOG </pre> 
<p />
On the submit host, the relevant log files are the <code>SchedLog</code>.  On the frontend, the <code>CollectorLog</code> and <code>NegotiatorLog</code> are relevant.  
<p />
On the frontend, HTCondor should have a record of the submission host when there are idle jobs on the submission host (with a few minute delay).  To query Condor for this information, run the command: <pre class="screen">
[user@client ~]$ condor_status -schedd </pre>
You should see the hostname of the submission host.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="What_to_look_for_in_the_Log_File"></a> What to look for in the Log Files </span></h2>
If there is a problem, it is likely a security issue.  Look in the logs for <code>DENIED</code>.  For example, on the frontend:
<pre class="screen">[user@client ~]$ grep DENIED /path/to/logs/CollectorLog </pre>
<p />
Or on the submission host.
<pre class="screen">[user@client ~]$ grep DENIED /path/to/logs/SchedLog </pre>
<p />
<p />
<h1><a name="References"></a> References </h1>
Other possible components of a Campus Grid <ul>
<li> <a href="/bin/view/Documentation/Release3/InstallGlideinWMSFrontend" class="twikiLink">GlideinWMS VO Frontend</a>
</li> <li> <span class="twikiNewLink">A HTCondor Submit host using OGS run Front-ends<a href="/bin/edit/Trash/Trash/CampusGrids/InstallCondorFlockSubmit?topicparent=Documentation/Release3.GlideinWMSCampusGrid" rel="nofollow" title="A HTCondor Submit host using OGS run Front-ends (this topic does not yet exist; you can create it)">?</a></span>
</li> <li> <span class="twikiNewLink">Another document about a HTCondor remote submit host<a href="/bin/edit/Trash/Trash/CampusGrids/ConfiguringRemoteSubmissionHost?topicparent=Documentation/Release3.GlideinWMSCampusGrid" rel="nofollow" title="Another document about a HTCondor remote submit host (this topic does not yet exist; you can create it)">?</a></span>
</li> <li> <a href="/bin/view/Accounting/ProbeConfigGlideinWMS" class="twikiLink">HTCondor Gratia probe</a>, specially check the <a href="/bin/view/Accounting/ProbeConfigGlideinWMS#Users_without_Certificates" class="twikiAnchorLink">Users without Certificates part</a>
</li></ul> 
OSG Software <ul>
<li> <a href="/bin/view/Documentation/Release3/YumRepositories" class="twikiLink">How to setup OSG Yum repositories</a>
</li> <li> <a href="/bin/view/Documentation/Release3/InstallCertAuth" class="twikiLink">How to install and use the CA certificates and other components of the x509 PKI infrastructure</a>
</li></ul> 
HTCondor documents: <ul>
<li> <a href="http://research.cs.wisc.edu/htcondor/manual/v8.1/3_6Security.html" target="_top">HTCondor security</a>
</li> <li> <a href="http://research.cs.wisc.edu/htcondor/manual/v8.1/3_6Security.html#sec:GSI-Authentication" target="_top">GSI Authentication in HTCondor</a>
</li> <li> <a href="http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS/doc.prd/components/gsi.html" target="_top">GSI authentication in Glidein WMS systems</a>
</li></ul> 
<p />
<h1><a name="Comments"></a> Comments </h1>
<form method="post" action="https://twiki.opensciencegrid.org/bin/save/Documentation/Release3/GlideinWMSCampusGrid" enctype="multipart/form-data" name="tableappend0" id="tableappend0">
<p />
<div class="commentPlugin commentPluginPromptBox">
<table><tr valign="middle"><td><textarea  rows="3" cols="70" name="comment" wrap="soft" onfocus="if(this.value=='')this.value=''" onblur="if(this.value=='')this.value=''"></textarea></td><td><input  type="submit" value="Add comment" /></td></tr></table>
</div><!--/commentPlugin-->
<p />
<input type="hidden" name="comment_action" value="save"  />
<input type="hidden" name="comment_type" value="tableappend"  />
<input type="hidden" name="comment_index" value="0"  /></form>
<p />
<p />
<p />
<!-- CONTENT MANAGEMENT PROJECT
############################################################################################################
 DEAR DOCUMENT OWNER
 <code><b>===============</b></code>
<p />
 Thank you for claiming ownership for this document! Please fill in your <span class="twikiNewLink">FirstLast<a href="/bin/edit/Documentation/Release3/FirstLast?topicparent=Documentation/Release3.GlideinWMSCampusGrid" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> name here: <ul>
<li> Local OWNER = <span class="twikiNewLink">MarcoMambelli<a href="/bin/edit/Documentation/Release3/MarcoMambelli?topicparent=Documentation/Release3.GlideinWMSCampusGrid" rel="nofollow" title="MarcoMambelli (this topic does not yet exist; you can create it)">?</a></span>
</li></ul> 
<p />
 Please define the document area, choose one of the defined areas from the next line
 DOC_AREA = (<span class="twikiNewLink">ComputeElement<a href="/bin/edit/Documentation/Release3/ComputeElement?topicparent=Documentation/Release3.GlideinWMSCampusGrid" rel="nofollow" title="ComputeElement (this topic does not yet exist; you can create it)">?</a></span>|Storage|VO|Security|User|Monitoring|General|Trash/Trash/Integration|Operations|Tier3) <ul>
<li> Local DOC_AREA       = User
</li></ul> 
<p />
 define the primary role the document serves, choose one of the defined roles from the next line
 DOC_ROLE = (<span class="twikiNewLink">EndUser<a href="/bin/edit/Documentation/Release3/EndUser?topicparent=Documentation/Release3.GlideinWMSCampusGrid" rel="nofollow" title="EndUser (this topic does not yet exist; you can create it)">?</a></span>|Student|Developer|SysAdmin|VOManager) <ul>
<li> Local DOC_ROLE       = <span class="twikiNewLink">SysAdmin<a href="/bin/edit/Documentation/Release3/SysAdmin?topicparent=Documentation/Release3.GlideinWMSCampusGrid" rel="nofollow" title="SysAdmin (this topic does not yet exist; you can create it)">?</a></span>
</li></ul> 
<p />
 Please define the document type, choose one of the defined types from the next line
 DOC_TYPE = (Troubleshooting|Training|Installation|HowTo|Planning|Navigation|Knowledge) <ul>
<li> Local DOC_TYPE       = Installation  Please define if this document in general needs to be reviewed before release ( 1 | 0 )
</li> <li> Local INCLUDE_REVIEW = 1
</li></ul> 
<p />
 Please define if this document in general needs to be tested before release ( 1 | 0 ) <ul>
<li> Local INCLUDE_TEST   = 1
</li></ul> 
<p />
 change to 1 once the document is ready to be reviewed and back to 0 if that is not the case <ul>
<li> Local REVIEW_READY   = 1
</li></ul> 
<p />
 change to 1 once the document is ready to be tested and back to 0 if that is not the case <ul>
<li> Local TEST_READY     = 1
</li></ul> 
<p />
 change to 1 only if the document has passed the review and the test (if applicable) and is ready for release <ul>
<li> Local RELEASE_READY  = 0
</li></ul> 
<p />
<p />
 DEAR DOCUMENT REVIEWER
 <code><b>==================</b></code>
<p />
 Thank for reviewing this document! Please fill in your <span class="twikiNewLink">FirstLast<a href="/bin/edit/Documentation/Release3/FirstLast?topicparent=Documentation/Release3.GlideinWMSCampusGrid" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> name here: <ul>
<li> Local REVIEWER       = <span class="twikiNewLink">MarcoMambelli<a href="/bin/edit/Documentation/Release3/MarcoMambelli?topicparent=Documentation/Release3.GlideinWMSCampusGrid" rel="nofollow" title="MarcoMambelli (this topic does not yet exist; you can create it)">?</a></span> 	 Please define the review status for this document to be in progress ( 2 ), failed ( 0 ) or passed ( 1 )
</li> <li> Local REVIEW_PASSED  = 2
</li></ul> 
<p />
<p />
 DEAR DOCUMENT TESTER
 <code><b>================</b></code>
<p />
 Thank for testing this document! Please fill in your <span class="twikiNewLink">FirstLast<a href="/bin/edit/Documentation/Release3/FirstLast?topicparent=Documentation/Release3.GlideinWMSCampusGrid" rel="nofollow" title="FirstLast (this topic does not yet exist; you can create it)">?</a></span> name here: <ul>
<li> Local TESTER         = <span class="twikiNewLink">MarcoMambelli<a href="/bin/edit/Documentation/Release3/MarcoMambelli?topicparent=Documentation/Release3.GlideinWMSCampusGrid" rel="nofollow" title="MarcoMambelli (this topic does not yet exist; you can create it)">?</a></span> 	 Please define the test status for this document to be in progress ( 2 ), failed ( 0 ) or passed ( 1 )
</li> <li> Local TEST_PASSED    = 2
</li></ul> 
############################################################################################################
--></div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Documentation/Release3<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span><a href="/bin/view/Documentation/Release3/NavTechGlideinWMS" class="twikiLink">NavTechGlideinWMS</a> &gt; <a href="/bin/view/Documentation/Release3/InstallGlideinWMSFrontend" class="twikiLink">InstallGlideinWMSFrontend</a><span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GlideinWMSCampusGrid</span> <br />    
Topic revision: r19 - 07 Feb 2017 - 19:34:16 - <a href="/bin/view/Main/BrianBockelman" class="twikiLink">BrianBockelman</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />