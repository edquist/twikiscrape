<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> TroubleshootingGratia_DRAFT &lt; Documentation/Release3 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Documentation/Release3/TroubleshootingGratia_DRAFT?_T=16 Feb 2017" type="application/x-wiki" title="edit TroubleshootingGratia_DRAFT" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Documentation/Release3/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/TroubleshootingGratia_DRAFT"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFFFFF;
	}
	.patternBookView {
		border-color:#FFFFFF;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--TABLEPLUGIN_table2--><style type="text/css" media="all">
.tableSortIcon img {padding-left:.3em; vertical-align:text-bottom;}
</style>
<!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Gratia_Troubleshooting_Guide"></a> Gratia Troubleshooting Guide </h1>
<p />
<div class="twikiToc"> <ul>
<li> <a href="?cover=print#Gratia_Troubleshooting_Guide"> Gratia Troubleshooting Guide</a> <ul>
<li> <a href="?cover=print#About_This_Guide"> About This Guide</a>
</li> <li> <a href="?cover=print#General_Troubleshooting_Items"> General Troubleshooting Items</a> <ul>
<li> <a href="?cover=print#Making_sure_packages_are_up_to_d"> Making sure packages are up-to-date</a>
</li> <li> <a href="?cover=print#Verifying_package_contents"> Verifying package contents</a>
</li></ul> 
</li> <li> <a href="?cover=print#Gratia_Troubleshooting_Items"> Gratia Troubleshooting Items</a> <ul>
<li> <a href="?cover=print#One_or_more_Gratia_probes_are_no"> One or more Gratia probes are not sending data</a>
</li> <li> <a href="?cover=print#Does_the_SiteName_name_match_the"> Does the SiteName name match the resource in OIM?</a>
</li> <li> <a href="?cover=print#Did_the_site_name_change"> Did the site name change?</a>
</li> <li> <a href="?cover=print#Is_a_site_reporting_data"> Is a site reporting data?</a>
</li> <li> <a href="?cover=print#Not_collecting_HTCondor_accounti"> Not collecting HTCondor accounting data</a>
</li> <li> <a href="?cover=print#Gratia_log_files_bad_Gratia_host"> Gratia log files: bad Gratia hostname</a>
</li></ul> 
</li> <li> <a href="?cover=print#Getting_Help"> Getting Help</a>
</li> <li> <a href="?cover=print#Reference"> Reference</a>
</li></ul> 
</li></ul> 
</div>
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="About_This_Guide"></a> About This Guide </span></h2>
<p />
Gratia is OSG software that gathers resource usage data (e.g., number and duration of jobs run, number and size of file transfers) from a site and ultimately transmits it to a central OSG storage system for reporting. The individual software tools that gather data are called <em>Gratia probes</em>, and the most common type of problem with Gratia at a site is that one or more probes stop sending data&nbsp;&mdash; either because they fail to run, fail to collect data properly, or fail to send collected data. If you are running an optional <em>Gratia Collector</em> at your site to collect site probe data and forward it to the central OSG system, it may have problems, too.
<p />
Use this document to troubleshoot common problems with Gratia at your site, especially Gratia probes that have stopped sending data.
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="General_Troubleshooting_Items"></a> General Troubleshooting Items </span></h2>
<p />
Before continuing with Gratia-specific troubleshooting, ensure that your Gratia packages are up-to-date and unmodified.
<p />
<h3><a name="Making_sure_packages_are_up_to_d"></a> Making sure packages are up-to-date </h3>
<p />
A common source of software problems is out-of-date software. Make sure that your Gratia RPMs are up-to-date:
<p />
<pre class="rootscreen">[root@client ~]$ yum update "gratia-*"</pre>
<p />
If you just want to see the packages to update, but do not want to perform the update now, answer <code>N</code> at the prompt.
<p />
<h3><a name="Verifying_package_contents"></a> Verifying package contents </h3>
<p />
If the contents of your Gratia packages have changed since they were installed, the software may not work properly. Verify the contents of your packages (ignoring changes to configuration files):
<p />
<pre class="screen">[user@client ~]$ rpm -qa | grep ^gratia | xargs rpm -q --verify | awk '$2 != "c"'</pre>
<p />
If the verification command returns output, this means that your package contents have changed. To fix this, you can reinstall the packages:
<p />
<pre class="rootscreen">[root@client ~]$ yum reinstall "gratia-*"</pre>
<p />
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  The <code>reinstall</code> command may place original versions of configuration files alongside the versions that you have modified. If this is the case, the reinstall command will notify you that the original versions will have an <code>.rpmnew</code> suffix. Compare any <code>.rpmnew</code> files to their corresponding configuration files and decide whether to merge contents.
</dd></dl> 
<p />
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Gratia_Troubleshooting_Items"></a> Gratia Troubleshooting Items </span></h2>
<p />
Use this section to identify and try to fix common Gratia software problems at your site.
<p />
First, it may be helpful to increase the logging level in your <code>/etc/gratia/<font color="#ff0000">PROBE-NAME</font>/ProbeConfig</code> files (either specific ones that have problems, or all of them to catch a broad range of problems):
<p />
<pre class="file">LogLevel="<span style="background-color: #FFCCFF;">5</span>"</pre>
<p />
After troubleshooting, be sure to reset the log level:
<p />
<pre class="file">LogLevel="<span style="background-color: #FFCCFF;">2</span>"</pre>
<p />
<h3><a name="One_or_more_Gratia_probes_are_no"></a> One or more Gratia probes are not sending data </h3>
<p />
By far, the most commonly observed problem with Gratia at a site is that one or more probes stop sending data. There are several possible root causes for this problem, so check through all of the following subsections as needed.
<p />
<h4><a name="Stopped_probes_1_Are_Gratia_prob"></a> Stopped probes #1: Are Gratia probes enabled to run? </h4>
<p />
Each Gratia probe runs periodically from a <code>cron</code> entry, and there is a service to manage the overall status of the Gratia probe system. At least one probe plus the service itself must be enabled for anything to run. Use the following process to check whether the Gratia probe system and individual probes are enabled to run.
<p /> <ol>
<li> Verify that Gratia probes are enabled to run in general:      <pre class="rootscreen">[root@client ~]$ /sbin/service gratia-probes-cron status</pre>      <p>The output shows whether <code>gratia probes cron</code> is <code>enabled</code> or <code>disabled</code>.</p>
</li> <li> If <code>gratia probes cron is disabled</code>, then enable the Gratia probes <code>cron</code> system in general:      <pre class="rootscreen">[root@client ~]$ /sbin/service gratia-probes-cron start</pre>
</li> <li> Ensure that one or more Gratia probes are enabled:      <pre class="rootscreen">[root@client ~]$ grep EnableProbe /etc/gratia/*/ProbeConfig</pre>      <p>For each probe path, <code>EnableProbe="1"</code> means that the probe is enabled and <code>EnableProbe="0"</code> means that it is disabled.</p>
</li></ol> 
<p />
Ensure that <code>EnableProbe="1"</code> in each of your <code>ProbeConfig</code> files:       <pre class="rootscreen">[root@client ~]$ grep EnableProbe /etc/gratia/*/ProbeConfig
/etc/gratia/condor/ProbeConfig:    EnableProbe="1"</pre>
<p />
<strong>If Gratia is enabled</strong>, running the command specified in <code>/etc/cron.d/gratia-probe*.cron</code> may provide insight into the failures. The following steps use <code>gratia-probe-condor</code> as an example but apply to all Gratia probes:
<p /> <ol>
<li> Here are the contents of <code>/etc/cron.d/gratia-probe-condor.cron</code>, with the relevant command highlighted (dropping the <code>-s</code> option):   <pre class="file">0,15,30,45 * * * * root <span style="background-color: #FFCCFF;">/usr/share/gratia/common/cron_check  /etc/gratia/condor/ProbeConfig && /usr/share/gratia/condor/condor_meter</span> -s 900</pre>
</li> <li> Run the command from the previous step:   <pre class="rootscreen">[root@client ~]$ /usr/share/gratia/common/cron_check  /etc/gratia/condor/ProbeConfig && /usr/share/gratia/condor/condor_meter</pre>
</li></ol> 
<p />
The output of the above command determines your next actions:
<p /> <ul>
<li> <strong>If you don't see any output and a log file is created</strong>, check if that solved your original problem. If not, continue with the rest of the troubleshooting document.
</li> <li> <strong>If you see a <code>Parse error in /etc/gratia/condor/ProbeConfig...</code> message,</strong> there is an error in your configuration and you will need to verify the correctness of its XML syntax.
</li> <li> <strong>If you see other errors,</strong> continue with the rest of the troubleshooting document.
</li> <li> <strong>If you don't see any output and a log file is NOT created</strong>, <a href="/bin/view/Documentation/Release3/TroubleshootingGratia_DRAFT#OsgSupport" class="twikiCurrentTopicLink twikiAnchorLink">contact us for help</a>
</li></ul> 
<p />
<h3><a name="Does_the_SiteName_name_match_the"></a> Does the SiteName name match the resource in OIM? </h3>
<p />
The value of <code>SiteName</code> in your <a href="/bin/view/Documentation/Release3/InstallGratia_DRAFT#FilesAndDirs" class="twikiAnchorLink">ProbeConfig</a> must match the resource in OIM. Here is an example of a site topology from <a href="http://oim.opensciencegrid.org" target="_top">OIM</a>:
<p />
<img src="/twiki/pub/Documentation/Release3/TroubleshootingGratia_DRAFT/oim_topology.png"/> 
<p />
In the above example, <code>WIPAC</code> is the site, <code>IceCube</code> is the resource group, <code>NPX</code> is the CE's resource name. To set <code>SiteName</code> properly, choose one of the following options:
<p /> <ul>
<li> <strong>If you are configuring a CE,</strong> edit the value of <code>resource</code> in <code>/etc/osg/config.d/40-siteinfo.ini</code> and run <code>osg-configure</code>:   <pre class="rootscreen">[root@client ~]$ osg-configure -c</pre>
</li> <li> <strong>If you are configuring any other type of node,</strong> edit the value of <code>SiteName</code> in your <code>/etc/gratia/<font color="#ff0000">PROBE-NAME</font>/ProbeConfig</code> to match the resource name in OIM corresponding to your host.
</li></ul> 
<p />
<h3><a name="Did_the_site_name_change"></a> Did the site name change? </h3>
Was the site previously reporting data, but the site name (not host name, but site name) changed? When the site name changes, you need to ask the Gratia operations team to update the name of your site at the Gratia collector. To do this:
<p /> <ol>
<li> Open a ticket at <a href="https://ticket.grid.iu.edu/goc/submit" target="_top">the GOC ticket web page</a>
</li> <li> Under "Optional Details", select "Software or Service"
</li> <li> After you do, another popup will appear. Select "Gratia (Collector Issue)"
</li> <li> Type a friendly email that asks the Gratia team to change your site name at the collector. Make sure to tell them the old name and the new name. 
</li></ol> 
<p />
<h3><a name="Is_a_site_reporting_data"></a> Is a site reporting data? </h3>
<p />
You can see if the OSG Gratia Server is getting data from a site by going to <a href="http://gratiaweb.grid.iu.edu/gratia/bysite/" target="_top">GratiaWeb</a>:
<p /> <ol>
<li> Specify the site name in Facility under Data Filter.
</li> <li> Click "Refine".
</li></ol> 
<p />
<h3><a name="Not_collecting_HTCondor_accounti"></a> Not collecting HTCondor accounting data </h3>
<p />
HTCondor must be configured to put information about each job into a special directory. Gratia will read and remove the files in order to collect the accounting information. If left unconfigured, Gratia will not publish accounting information about jobs. 
<p />
The configuration variable is called <code>PER_JOB_HISTORY_DIR</code>. If you install the OSG RPM for HTCondor, the Gratia probe will extend its configuration by adding a file to <code>/etc/condor/config.d</code>, and will set this variable to <code>/var/lib/gratia/data</code>. If you are using a different installation method, you will need to set the variable yourself.
<p />
Either way, you can check if it's set by using <code>condor_config_val</code>, like this:
<p />
<pre class="screen">
[user@client ~]$ condor_config_val -v PER_JOB_HISTORY_DIR
PER_JOB_HISTORY_DIR: /var/lib/gratia/data
  Defined in '/etc/condor/config.d/99_gratia.conf', line 5.
</pre>
<p />
<strong>If the above command returns <code>Not defined: PER_JOB_HISTORY_DIR</code>,</strong> you will need to set it and report any old HTCondor data using the following commands:
<p /> <ol>
<li> Set <code>PER_JOB_HISTORY_DIR = /var/lib/gratia/data</code> in any file in <code>/etc/condor/config.d/</code>.
</li> <li> Restart condor so that your configuration changes take effect (<code>condor_reconfigure</code> is insufficient in this case):   <pre class="rootscreen">[root@client ~]$ condor_restart</pre>
</li> <li> Turn off the <code>gratia-probes-cron</code> service: <ul>
<li> On EL6:      <pre class="rootscreen">[root@client ~]$ service gratia-probes-cron stop</pre>
</li> <li> On EL7:      <pre class="rootscreen">[root@client ~]$ systemctl stop gratia-probes-cron</pre>
</li></ul> 
</li> <li> Report the old HTCondor data: <ul>
<li> <strong>If you know the time period of the missing data</strong>, run the following command, specifying start and end times in <code>YYYY-MM-DD</code> format:<pre class="rootscreen">[root@client ~]$ /usr/share/gratia/condor/condor_meter --history --start-time="&lt;START DATE&gt;</span>" --end-time="&lt;END DATE&gt;</span>" --verbose</pre>
</li> <li> <strong>If you do not know the time period of missing data,</strong> run the following command:   <pre class="rootscreen">[root@client ~]$ /usr/share/gratia/condor/condor_meter --history --verbose</pre>
</li></ul> 
</li> <li> Not much is printed to the screen, but you can see progress in the <a href="/bin/view/Documentation/Release3/InstallGratia_DRAFT#FilesAndDirs" class="twikiAnchorLink">Gratia log file</a>.
</li> <li> Start the <code>gratia-probes-cron</code> service: <ul>
<li> On EL6:      <pre class="rootscreen">[root@client ~]$ service gratia-probes-cron start</pre>
</li> <li> On EL7:      <pre class="rootscreen">[root@client ~]$ systemctl start gratia-probes-cron</pre>
</li></ul> 
</li></ol> 
<p />
<p /> <dl>
<dt> <img src="/twiki/pub/TWiki/TWikiDocGraphics/help.gif" alt="HELP" title="HELP" width="16" height="16" border="0" />     <strong><font color="#ff0000"> NOTE </font></strong> </dt><dd>  HTCondor rotates history files, so you can only report what HTCondor has kept. Controlling the HTCondor history is documented in the <a href="http://research.cs.wisc.edu/htcondor/manual/v8.4/4_5Logging_in.html#51346" target="_top">HTCondor manual</a>. In particular, see the options for <a href="http://research.cs.wisc.edu/htcondor/manual/v8.4/3_3Configuration.html#20361" target="_top">MAX_HISTORY_LOG</a> and <a href="http://research.cs.wisc.edu/htcondor/manual/v8.4/3_3Configuration.html#20366" target="_top">MAX_HISTORY_ROTATIONS</a>.
</dd></dl> 
<p />
<h3><a name="Gratia_log_files_bad_Gratia_host"></a> Gratia log files: bad Gratia hostname </h3>
<p />
This is an example problem where the configuration was bad: there was an incorrect hostname for the Gratia server. You can check if this problem occurred in the past month with the following command:
<p />
<pre class="rootscreen">grep socket.gaierror /var/log/gratia/`date +%Y-%m`*.log</pre>
<p />
<h4><a name="Recovering_from_bad_Gratia_hostn"></a> Recovering from bad Gratia hostname </h4>
<p />
If you accidentally had a bad Gratia hostname, you probably want to recover your Gratia data. This can be done, though it's not simple. There are a few things you need to do. But first, you need to understand exactly where Gratia stores files. 
<p />
When a Gratia extracts accounting information, it creates one file per record and stores it in a directory. The directory is a long name that contains the type of the probe (such as <code>condor</code>), the name of the host you're running on, and the name of the Gratia host you're sending the information to. For simplicity, lets call that name <em>probe-records</em>, but you'll see what it really looks like below. Within this directory, you'll see some subdirectories:
<p />
<table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
<table cellspacing="0" id="table1" cellpadding="0" class="twikiTable" rules="cols" border="1">
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/TroubleshootingGratia_DRAFT?cover=print;sortcol=0;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37"> Directory </font></a> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1 twikiLastCol"> <a rel="nofollow" href="/bin/view/Documentation/Release3/TroubleshootingGratia_DRAFT?cover=print;sortcol=1;table=1;up=0#sorted_table" title="Sort by this column"><font color="#252b37">Purpose</font></a> </th>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> /var/lib/gratia/tmp/gratiafiles/<font color="#ff0000">probe-records</font>/outbox </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> The usual location for the accounting records </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> /var/lib/gratia/tmp/gratiafiles/<font color="#ff0000">probe-records</font>/staged/store </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> An overflow location when there are problems </td>
		</tr></table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
<p />
When you recover old records, you need to: <ol>
<li> Before trying to transfer any old records, check if they are more than three months old. If they are, the server will not accept them. This is a policy that is enforced strictly by the admins.
</li> <li> Move files from the outbox of the incorrect <em>probe-records</em> directory into the outbox of the correctly named <em>probe-records</em> directory.
</li> <li> Move tarred and compressed files from the staged/store of the incorrect <em>probe-records</em> directory into the staged/store of the correctly named <em>probe-records</em> directory. Then you uncompress them and remove the compressed version.
</li></ol> 
<p />
In the examples below, the hostname for gratia was "accidentally" spelled backwards. Instead of <code>gratia-osg-itb.opensciencegrid.org</code>, it was <code>aitarg-osg-itb.opensciencegrid.org</code>. 
<p />
<h5><a name="Correct_the_hostname"></a> Correct the hostname </h5>
First you need to fix the hostname. For a CE, you can edit <code>/etc/osg/config.d/30-gratia.ini</code> and rerun <code>osg-configure -c</code>. In other installations, you have to edit the appropriate <code>ProbeConfig</code> file. 
<p />
<h5><a name="Run_one_job"></a> Run one job </h5>
<p />
Next, submit a job via HTCondor-CE to your batch system, then run the appropriate Gratia probe. This will create the properly named directories in <code>/var/lib/gratia/tmp/gratiafiles/</code>:
<p />
<ol>
   <li>
      <p>Submit the job:</p>
      <pre class="screen">[user@client ~]$ condor_ce_trace -d `hostname`</pre>
   </li>
   <li>
      <p>Run the Gratia probe for your batch system manually:</p>
 <table cellspacing="0" cellpadding="0" border="0" class="twikinetWrapperTable" rules="none">
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableT twikinetWrapperTableTL"></td>
<td class="twikinetWrapperTableT twikinetWrapperTableTR"></td>
</tr>
<tr class="twikinetWrapperTableRow">
<td colspan="2" class="twikinetWrapperTableMain">
            <table cellspacing="0" id="table2" cellpadding="0" class="twikiTable" rules="cols" border="1">      
		<tr class="twikiTableOdd twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol0 twikiFirstCol"> <font color="#252b37">If your batch system is...</font> </th>
			<th bgcolor="#d8dde4" valign="top" class="twikiTableCol1 twikiLastCol"> <font color="#252b37">Then run the following command...</font> </th>
		</tr>      
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> HTCondor </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <code>/usr/share/gratia/condor/condor_meter</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> Slurm </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> <code>/usr/share/gratia/slurm/slurm_meter</code> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol"> PBS/Torque </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol"> <code>/usr/share/gratia/pbs-lsf/pbs-lsf_meter.cron.sh</code> </td>
		</tr>
		<tr class="twikiTableOdd twikiTableRowdataBgSorted1 twikiTableRowdataBg1">
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol0 twikiFirstCol"> LSF </td>
			<td bgcolor="#f2f3f6" valign="top" class="twikiTableCol1 twikiLastCol"> <code>/usr/share/gratia/pbs-lsf/pbs-lsf_meter.cron.sh</code> </td>
		</tr>
		<tr class="twikiTableEven twikiTableRowdataBgSorted0 twikiTableRowdataBg0">
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol0 twikiFirstCol twikiLast"> SGE </td>
			<td bgcolor="#ffffff" valign="top" class="twikiTableCol1 twikiLastCol twikiLast"> <code>/usr/share/gratia/sge/sge_meter.cron.sh</code> </td>
		</tr>      </table>
</td>
</tr>
<tr class="twikinetWrapperTableRow">
<td class="twikinetWrapperTableB twikinetWrapperTableBL"></td>
<td class="twikinetWrapperTableB twikinetWrapperTableBR"></td>
</tr>
</table>
   </li>
</ol>
<p />
<h5><a name="Restore_the_individual_Gratia_re"></a> Restore the individual Gratia records </h5>
First, find the Gratia records that can be easily uploaded. They are located in a a directory with an unwieldly name that includes your hostname and the incorrect name of the Gratia host. You can see the directory name in the Gratia log: the misspelled name is noted in red below, but <em>it will be different on your computer</em>. 
<p />
<pre class="file">
[user@client ~]$ less /var/log/gratia/2012-04-06
...
16:04:29 CDT Gratia: Response indicates failure, the following files will not be deleted:
16:04:29 CDT Gratia:    /var/lib/gratia/tmp/gratiafiles/
    subdir.condor_fermicloud084.fnal.gov_<font color="#ff0000">aitarg</font>-osg-itb.opensciencegrid.org_80/
    outbox/r.916.condor_fermicloud084.fnal.gov_aitarg-osg-itb.opensciencegrid.org_80.gratia.xml__JDlHbNb918
</pre>
<p />
(The filename was wrapped for legibility.)
<p />
You can simply copy these to the correct directory. Wait for the Gratia cron job to run, or force it to run.
<p />
<pre class="rootscreen">
[root@client ~]$ cd /var/lib/gratia/tmp/gratiafiles/subdir.condor_fermicloud084.fnal.gov_<font color="#ff0000">aitarg</font>-osg-itb.opensciencegrid.org_80/outbox/.
[root@client ~]$ mv * /var/lib/gratia/tmp/gratiafiles/subdir.condor_fermicloud084.fnal.gov_<font color="#ff0000">gratia</font>-osg-itb.opensciencegrid.org_80/outbox/.
</pre>
<p />
<h5><a name="Restore_compressed_Gratia_record"></a> Restore compressed Gratia records </h5>
If this has been a persistent problem, you might have many records. After a while, they are put into a compressed files in another directory. You can move those files, then uncompress them. This is a long name: note that the path ends in "staged/store" instead of "outbox" as above:
<p />
<pre class="rootscreen">
<font color="#ff0000"># Find the old files</font>
[root@client ~]$ cd /var/lib/gratia/tmp/gratiafiles/subdir.condor_fermicloud084.fnal.gov_<font color="#ff0000">aitarg</font>-osg-itb.opensciencegrid.org_80/staged/store

<font color="#ff0000"># Move them to the correct directory</font>
[root@client ~]$ mv tz* /var/lib/gratia/tmp/gratiafiles/subdir.condor_fermicloud084.fnal.gov_<font color="#ff0000">gratia</font>-osg-itb.opensciencegrid.org_80/outbox/.
[root@client ~]$ cd !$

<font color="#ff0000"># For each tz file:</font>
[root@client ~]$ tar xf tz.1223.... [name shortened for legibility]
[root@client ~]$ rm tz.1223....
</pre>
<p />
When you've done this, you can re-run the Gratia probe by hand, or wait for it to run via cron.
<p />
<a name="OsgSupport"></a>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Getting_Help"></a> Getting Help </span></h2>
<p />
If you are still experiencing issues after using this document, please let us know!
<p /> <ol>
<li> <p>Gather basic Gratia and related information (relevant configuration, problem description, etc.)</p>
</li> <li> <p>Gather system information:</p>       <pre class="screen">osg-system-profiler</pre>
</li> <li> <p>Start a support request using <a href="https://ticket.grid.iu.edu/submit" target="_top">a web interface</a> or by email to <a href="mailto&#58;goc&#64;opensciencegrid&#46;org">goc&#64;opensciencegrid.org</a></p> <ul>
<li> Describe issue and expected or desired behavior
</li> <li> Include basic Gratia and related information
</li> <li> Attach the osg-system-profiler output
</li></ul> 
</li></ol> 
<p />
<a name="ReferenceSection"></a>
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Reference"></a> Reference </span></h2>
<p />
Here are some other Gratia documents that might be helpful:
<p /> <ul>
<li> <a href="/bin/view/Documentation/Release3/GratiaIntroduction_DRAFT" class="twikiLink">Gratia Probe Introduction</a>
</li> <li> <a href="/bin/view/Documentation/Release3/InstallGratia_DRAFT" class="twikiLink">Installing and Maintaining Gratia Probes</a>
</li> <li> <a href="/bin/view/Documentation/Release3/GratiaReference_DRAFT" class="twikiLink">Gratia Probe Reference</a>
</li> <li> You can get daily emails with OSG accounting reports in them. Join the <a href="/bin/view/Accounting/ContactUs" class="twikiLink">osg-accounting-info</a> mailing list. 
</li> <li> <a href="/bin/view/Accounting/WebHome" class="twikiLink">The Gratia group's web page</a>
</li> <li> <a href="/bin/view/Documentation/Release3/NavTechGratia" class="twikiLink">Gratia's technical documentation index</a>
</li></ul> </div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Documentation/Release3<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>TroubleshootingGratia_DRAFT</span> <br />    
Topic revision: r8 - 22 Nov 2016 - 19:56:01 - <a href="/bin/view/Main/TimCartwright" class="twikiLink">TimCartwright</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />