<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
<link rel="stylesheet" href="https://twiki.opensciencegrid.org/twiki/pub/TWiki/HeadlinesPlugin/style.css" type="text/css" media="all" />
<title> GlexecPilotCert &lt; Documentation/Release3 &lt; TWiki    </title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="shortcut icon" href="/twiki/pub/Documentation/Release3/WebPreferences/favicon.ico    " type="image/x-icon" />
<link rel="alternate" href="https://twiki.opensciencegrid.org/bin/edit/Documentation/Release3/GlexecPilotCert?_T=16 Feb 2017" type="application/x-wiki" title="edit GlexecPilotCert" />
<meta name="SCRIPTURLPATH" content="/bin" />
<meta name="SCRIPTSUFFIX" content="" />
<meta name="TEXT_JUMP" content="Jump" />
<meta name="TEXT_SEARCH" content="Search" />
<meta name="TEXT_NUM_TOPICS" content="Number of topics:" />
<meta name="TEXT_MODIFY_SEARCH" content="Modify search" />
<meta name="robots" content="noindex" /><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/bin/view/Documentation/Release3/WebRss" />    
<base href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/GlexecPilotCert"></base>
<!--BEHAVIOURCONTRIB--><script type="text/javascript" src="/twiki/pub/TWiki/BehaviourContrib/behaviour.compressed.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikilib.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiWindow.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiEvent.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiHTML.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiCSS.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiForm.js"></script>
<script type="text/javascript" src="/twiki/pub/TWiki/PatternSkin/pattern.js"></script><style type="text/css" media="all">
@import url('/twiki/pub/TWiki/TWikiTemplates/base.css');
</style><script type="text/javascript" src="/twiki/pub/TWiki/TWikiJavascripts/twikiStyles.js"></script><style type="text/css" media="all">


</style>
<style type="text/css" media="all">
@import url("/twiki/pub/TWiki/TWikiNetSkin/layout.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/style.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/colors.css");
@import url("/twiki/pub/TWiki/TWikiNetSkin/rounded_corners.css");
</style>
<style type="text/css" media="all">
	/* Styles that are set using variables */
	#patternLeftBar .patternWebIndicator,
	.patternBookView .twikiTopRow {
		background-color:#FFFFFF;
	}
	.patternBookView {
		border-color:#FFFFFF;
	}
	.patternPreviewPage #patternMain {
		/* uncomment to set the preview image */
		/*background-image:url("/twiki/pub/TWiki/PreviewBackground/preview2bg.gif    ");*/
	}
	
</style><style type="text/css" media="all">



</style>
<style type="text/css" media="all">
	@import url("/twiki/pub/TWiki/TWikiNetSkin/print.css");
</style><!--GOOGLEANALYTICSPLUGIN--><!-- Google Analytics script -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69012-21']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body class="patternViewPage patternPrintPage">
<a name="PageTop"></a>
<div id="patternScreen">
<div id="patternPageShadow">
<div id="patternPage">
<div id="patternOuter">
<div id="patternFloatWrap">
<div id="patternMain">
<div id="patternMainContents">
<div class="patternContent"><div class="patternTopic"> <h1><a name="Glexec_With_Pilot_Certificate"></a> Glexec With Pilot Certificate </h1>
<p />
The current glexec installation instructions default to having one certificate per node; sites have traditionally used either a host certificate for the worker node or a proxy certificate.  The two basic tradeoffs are: <ul>
<li> <strong>Proxy certificate</strong>: Copy a short-lived proxy from a central host (such as the CE) to the worker nodes.  The downside here is that an outage of this automated process will cause a cluster-wide outage of glexec.
</li> <li> <strong>Host certificate</strong>: Create a host certificate for each host.  The downside here is the host certificate needs to be renewed once a year and the sheer number of certificates necessary for this model.
</li></ul> 
<p />
This page documents a third model - using the pilot proxy certificate.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Security_considerations"></a> Security considerations </span></h2>
<p />
glexec uses the certificate as a mechanism to authenticate the SSL session between the worker node and GUMS.  GUMS decides who is authorized to lookup mappings based on the client certificate.  By making these changes, you'll be allowing all pilots to <strong>lookup</strong> any DN to Unix user mapping.
<p />
For example, this would allow any pilot to know that "/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Brian Bockelman" maps to "uscmsPool018" at Nebraska.
<p />
This does <strong>not</strong> allow the pilots to map to an arbitrary user, nor does it change how the mapping works.
<p />
Each site should consider this security ramification; OSG Security believes this is an acceptable change to the security model.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Engineering_considerations"></a> Engineering considerations </span></h2>
<p /> <ul>
<li> To complete this document, you will need change configuration files on all worker nodes and edit the GUMS configuration.  This can be done on a live site with no outage on either worker nodes or GUMS.  However, this requires a bit more coordination. This document is written assuming you make this change during a downtime.
</li> <li> <strong>gums-1.3.18.009-15.2</strong> or later is required.
</li></ul> 
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Changes_to_lcmaps"></a> Changes to lcmaps </span></h2>
<p />
<strong>On the worker nodes running glexec</strong>, you need to remove the following lines from <code>/etc/lcmaps.db</code> for the GUMS module:
<p />
<pre>
            &#34;-cert   /etc/grid-security/hostcert.pem&#34;
            &#34;-key    /etc/grid-security/hostkey.pem&#34;
            &#34;--cert-owner root&#34;
</pre>
<p />
This should not be done on a CE.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Changes_to_gums_config"></a> Changes to gums.config </span></h2>
<p />
The necessary GUMS configuration changes are more straightforward if you edit <code>/etc/gums/gums.config</code> instead of using the web interface.  Before you make any changes, create a backup of this file.
<p />
For each vomsUserGroup, change the access level from "read self" to "read all".  For example, this stanza:
<p />
<pre>
      &#60;vomsUserGroup
         name&#61;&#39;sbgrid&#39;
         access&#61;&#39;read self&#39;
         description&#61;&#39;&#39;
         vomsServer&#61;&#39;sbgrid&#39;
         matchFQAN&#61;&#39;vo&#39;
         acceptProxyWithoutFQAN&#61;&#39;false&#39;
         voGroup&#61;&#39;/SBGrid&#39;/&#62;
</pre>
<p />
Should become:
<p />
<pre>
      &#60;vomsUserGroup
         name&#61;&#39;sbgrid&#39;
         access&#61;&#39;read all&#39;
         description&#61;&#39;&#39;
         vomsServer&#61;&#39;sbgrid&#39;
         matchFQAN&#61;&#39;vo&#39;
         acceptProxyWithoutFQAN&#61;&#39;false&#39;
         voGroup&#61;&#39;/SBGrid&#39;/&#62;
</pre>
<p />
Next, add a new <code>hostToGroupMapping</code> stanza by duplicating your current one.  Change the <code>cn</code> attribute to <code>dn</code> and set the value of the attribute to match the worker node host names.  For example, the following <code>hostToGroupMapping</code>:
<p />
<pre>
      &#60;hostToGroupMapping
         groupToAccountMappings&#61;&#39;banned, Localgroup Mapping, CMSIntegration, cmslcgadminMapping, CMShiproduction, CMSProdPool, CMST1Production&#39;
         description&#61;&#39;&#39;
         cn&#61;&#39;&#42;/?&#42;.unl.edu&#39;/&#62;
</pre>
<p />
should become <strong>two</strong> stanzas:
<p />
<pre>
      &#60;hostToGroupMapping
         groupToAccountMappings&#61;&#39;banned, Localgroup Mapping, CMSIntegration, cmslcgadminMapping, CMShiproduction, CMSProdPool, CMST1Production&#39;
         description&#61;&#39;&#39;
         dn&#61;&#39;&#42;.unl.edu&#39;/&#62;
</pre>
<p />
Recall that the '*' character in this mapping matches only <strong>one</strong> DNS hostname component.  So, <code>*.unl.edu</code> matches <code>node1.unl.edu</code> but not <code>node1.red.unl.edu</code>.
<p />
<h2 class="twikinetRoundedAttachments"><span class="twikinetHeader"><a name="Testing"></a> Testing </span></h2>
<p />
On a worker node, try the following (assuming you have a valid proxy in place):
<p />
<pre>
X509&#95;USER&#95;PROXY&#61;/tmp/x509up&#95;u`id -u` GLEXEC&#95;CLIENT&#95;CERT&#61;/tmp/x509up&#95;u`id -u` /usr/sbin/glexec `which whoami`
</pre>
<p />
This command should succeed and print out the same mapping as it did before the changes.  Note that in production use the two variables will not be set to the same value; X509_USER_PROXY will point to the pilot's certificate and GLEXEC_CLIENT_CERT will point to the user's certificate.</div><!-- /patternTopic-->
<p />
<p />
</div><!-- /patternContent-->
<hr />
This topic: Documentation/Release3<span class='twikiSeparator'>&nbsp;&gt;&nbsp;</span>GlexecPilotCert</span> <br />    
Topic revision: r4 - 06 Dec 2016 - 18:12:41 - <a href="/bin/view/Main/KyleGross" class="twikiLink">KyleGross</a>
</div><!-- /patternMainContents-->
</div><!-- /patternMain-->
</div><!-- /patternFloatWrap-->
<div class="clear">&nbsp;</div>
</div><!-- /patternOuter--><div id="patternBottomBar"><div id="patternBottomBarContents"><div id="twikinetBadge"><a href="http://www.twiki.net/"><img src="https://twiki.opensciencegrid.org/twiki/pub/TWiki/TWikiNetSkin/twiki-badge-88x31.gif" alt="TWIKI.NET" width="88" height="31" border="0" /></a></div><!--/twikinetBadge--><div id="patternWebBottomBar"><p>
<font size="-1">
TWiki |
<a href="https://ticket.grid.iu.edu/goc/twiki">Report Bugs</a> |
<a href="https://twiki.grid.iu.edu/bin/view/Operations/IUPrivacyPolicy">Privacy Policy</a>
</p>
<p>
<font size="-2">
<span class="twikiRight"> <a href="http://twiki.org/"><img src="/twiki/pub/TWiki/TWikiLogos/T-logo-80x15.gif" alt="This site is powered by the TWiki collaboration platform" width="80" height="15" title="This site is powered by the TWiki collaboration platform" border="0" /></a></span>Copyright by the contributing authors. All material on this collaboration platform is the property of the contributing authors..
</font>
</p></div><!--/patternWebBottomBar--></div><!-- /patternBottomBarContents--></div><!-- /patternBottomBar-->
</div><!-- /patternPage-->
</div><!-- /patternPageShadow-->
</div><!-- /patternScreen-->
</body></html>
<p />